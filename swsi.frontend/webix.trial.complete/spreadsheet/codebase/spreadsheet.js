/*
@license
Webix SpreadSheet v.10.3.2
This software is covered by Webix Trial License.
Usage without proper license is prohibited.
(c) XB Software Ltd.
*/
!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";const e="#DIV/0!",t="#VALUE!",n="#NUM!",i="#N/A";function r(e){const t=new Date(e.getFullYear(),0,0),n=e.valueOf()-t.valueOf()+60*(t.getTimezoneOffset()-e.getTimezoneOffset())*1e3;return Math.floor(n/864e5)}function o(e){const t=new Date(Math.round(86400*(e-25569)*1e3));return new Date(t.getTime()+6e4*t.getTimezoneOffset())}function a(e){return 25569+(e.getTime()-6e4*e.getTimezoneOffset())/864e5}function s(e){return!(!e&&0!==e||(e*=1,isNaN(e)))&&e}function l(e){if(1===e.length){const t=e[0];return"object"==typeof t?t:[t]}let t=[];for(let n=0;n<e.length;n++)t=t.concat(e[n]);return t}function u(e){return!e&&0!==e}function c(e){return"string"==typeof e?"TRUE"===e:!!e}function h(e){const t="string"==typeof e?new Date(e):o(e);if(t.getTime())return t;throw`${e} is invalid date`}function d(e){const t=s(e);if("number"!=typeof t)throw`${e} is not a number`;return t}function f(e,i,r,o,a){let l=s(e);l<0&&8==a&&(i=null);let u,c=i?s(i):null;if("number"!=typeof l||"boolean"==typeof c)throw t;if(l<r&&(l=r),l>o&&(l=o),c<-1)throw n;c&&(c=Math.floor(+c));const h=e<0&&16===a?"FF":"";if(u=o<2147483648?(l>>>0&o-r).toString(a):(l>>>0).toString(a),c&&u.length>c)throw n;return(h+u).padStart(c,"0").toUpperCase()}function g(...e){return l(e).join("")}function m(e,t){return u(e)?"":e.toString().substring(0,t)}function v(e,t,n){return u(e)?"":e.toString().substring(t,t+n)}function p(e,t){return u(e)?"":e.toString().substring(e.length-t)}function b(e){return u(e)?"":e.toString().toLowerCase()}function w(e){return u(e)?"":e.toString().toUpperCase()}function _(e){if(u(e))return"";const t=e.toString().toLowerCase().split(" ");e="";for(const n in t)e+=(e?" ":"")+t[n].substring(0,1).toUpperCase()+t[n].substring(1);return e}function x(e){return u(e)?"":e.toString().trim()}function y(e){return u(e)?0:e.toString().length}const C=/[\0-\x1F]/g;function S(e,t,n=0){const i=s(n);if("number"==typeof i&&t)return`${t}`.indexOf(`${e}`,i-1)+1;throw"index cannot be string"}function E(e,t,n=0){const i=s(n);if("number"==typeof i){const n=`${t}`.toLowerCase().indexOf(`${e}`.toLowerCase(),i-1)+1;if(0!==n)return n;throw"not found"}}function $(e,t,n,i){if(!e||!t||!n&&""!==n)return`${e}`;if(void 0===i)return`${e}`.replace(new RegExp(`${t}`,"g"),`${n}`);{let r=0,o=0;for(;`${e}`.indexOf(`${t}`,r)>0;)if(r=`${e}`.indexOf(`${t}`,r+1),o++,o===i)return`${e}`.substring(0,r)+n+`${e}`.substring(r+`${t}`.length)}}function R(e,t,n,i){const r=s(t),o=s(n);if("number"==typeof r&&"number"==typeof o){const t=e.toString(),n=i.toString();return t.replace(t.substr(r-1,o),n)}}var A=Object.freeze({__proto__:null,CONCATENATE:g,LEFT:m,MID:v,RIGHT:p,LOWER:b,UPPER:w,PROPER:_,TRIM:x,LEN:y,CHAR:function(e){const t=s(e);if("number"==typeof t)return String.fromCharCode(t)},CLEAN:function(e=""){return`${e}`.replace(C,"")},CODE:function(e=""){return`${e}`.charCodeAt(0)},EXACT:function(e,t){return e===t},FIND:S,FIXED:function(e,t=2,n=!1){const i=s(e),r=s(t);if("number"==typeof i&&"number"==typeof r){const e=i.toFixed(r);if(c(n))return`${e}`;const[t,o]=`${e}`.split(".");return t.replace(/\B(?=(\d{3})+(?!\d))/g,",")+"."+o}},NUMBERVALUE:function(e,t=".",n=","){if("string"==typeof e&&"string"==typeof t&&"string"==typeof n)return Number(e.replace(t,".").replace(n,""))},REGEXEXTRACT:function(e,t){if("string"==typeof e&&"string"==typeof t){const n=e.match(new RegExp(t));return n?n[n.length>1?n.length-1:0]:null}},REGEXMATCH:function(e,t){if("string"==typeof e&&"string"==typeof t)return!!e.match(new RegExp(t))},REGEXREPLACE:function(e,t,n){if("string"==typeof e&&"string"==typeof t)return e.replace(new RegExp(t),`${n}`)},REPT:function(e,t){const n=s(t);if("number"==typeof n)return new Array(n+1).join(`${e}`)},SEARCH:E,SUBSTITUTE:$,T:function(e){return"string"==typeof e&&"TRUE"!==e&&"FALSE"!==e?`${e}`:""},JOIN:function(e,...t){const n=[];return t.forEach((t=>{"object"==typeof t?n.push(t.join(`${e}`)):n.push(t)})),n.join(`${e}`)},REPLACE:R,ARRAYTOTEXT:function(e,t){return t?`{${e.map((e=>"string"==typeof e?`"${e}"`:e)).join("; ")}}`:e.join("; ")}});const k=[[],[1,2,3,4,5,6,7],[7,1,2,3,4,5,6],[6,0,1,2,3,4,5],[],[],[],[],[],[],[],[7,1,2,3,4,5,6],[6,7,1,2,3,4,5],[5,6,7,1,2,3,4],[4,5,6,7,1,2,3],[3,4,5,6,7,1,2],[2,3,4,5,6,7,1],[1,2,3,4,5,6,7]],T=[void 0,0,1,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,1,2,3,4,5,6,0],I=[[],[6,0],[0,1],[1,2],[2,3],[3,4],[4,5],[5,6],void 0,void 0,void 0,[0,0],[1,1],[2,2],[3,3],[4,4],[5,5],[6,6]];function V(e,t,n){return a(new Date(e,t-1,n))}function N(e,t,n){const i=a(new Date(1900,0,1,e,t,n,0));return i-Math.trunc(i)}function M(e){return o(e).getDate()}function O(e){return o(e).getMonth()+1}function D(e){return o(e).getFullYear()}function q(e){return o(e).getHours()}function z(e){return o(e).getMinutes()}function P(e){return o(e).getSeconds()}function F(){return a(new Date)}function U(e,t,n){const i=n.toLowerCase();if("d"===i)return t-e;const a=o(e),s=o(t);switch(i){case"y":return s.getFullYear()-a.getFullYear();case"m":return 12*(s.getFullYear()-a.getFullYear())+s.getMonth()-a.getMonth();case"d":return Math.floor(t-e);case"md":{const e=s.getDate()-a.getDate();if(e<0){const e=new Date(a.getFullYear(),a.getMonth()+1,0).getDate();return s.getDate()+e-a.getDate()}return e}case"ym":{const e=s.getMonth()-a.getMonth();return e<0?12+e:e}case"yd":{const e=r(s)-r(a);return e<0?365+e:e}}}function L(e,t){const n=h(e),i=h(t);if(n&&i)return Math.round((n.getTime()-i.getTime())/864e5)}function B(e){const t=h(e);if(t){t.setHours(0,0,0),t.setDate(t.getDate()+4-(t.getDay()||7));const e=new Date(t.getFullYear(),0,1);return Math.ceil(((t.getTime()-e.getTime())/864e5+1)/7)}}function H(e,t,n,i){const r=h(e),a=h(t);if(r&&a){const e=void 0===n?I[1]:I[n],t=i||[];for(let e=0;e<t.length;e++){const n=o(t[e]);if(n instanceof Error)throw`The ${t[e]} is not a  number`;t[e]=n}const s=(a.getTime()-r.getTime())/864e5+1;let l=Math.round(s);const u=r;for(let n=0;n<s;n++){const n=(new Date).getTimezoneOffset()>0?u.getUTCDay():u.getDay();let i=!1;n!==e[0]&&n!==e[1]||(i=!0);for(let e=0;e<t.length;e++){const n=t[e];if(n.getDate()===u.getDate()&&n.getMonth()===u.getMonth()&&n.getFullYear()===u.getFullYear()){i=!0;break}}i&&l--,u.setDate(u.getDate()+1)}return l}}function j(e,t,n,i){const r=h(e),l=s(t);if(r&&"number"==typeof l){const e=void 0===n?I[1]:I[n],t=i||[];for(let e=0;e<t.length;e++){const n=o(t[e]);if(n instanceof Error)throw`The ${t[e]} is not a  number`;t[e]=n}let s=0;for(;s<l;){r.setDate(r.getDate()+1);const n=r.getDay();if(n!==e[0]&&n!==e[1]){for(let e=0;e<t.length;e++){const n=t[e];if(n.getDate()===r.getDate()&&n.getMonth()===r.getMonth()&&n.getFullYear()===r.getFullYear()){s--;break}}s++}}return a(r)}}function W(e){return 1===new Date(e,1,29).getMonth()}function X(e,t,n=0){const i=h(e),r=h(t);if(i&&r){let e=i.getDate();const t=i.getMonth()+1,o=i.getFullYear();let a=r.getDate();const s=r.getMonth()+1,l=r.getFullYear();let u=365;const c=l-o+1,h=(new Date(l+1,0,1).getTime()-new Date(o,0,1).getTime())/1e3/60/60/24/c;switch(n){case 0:return 31===e&&31===a?(e=30,a=30):31===e?e=30:30===e&&31===a&&(a=30),(a+30*s+360*l-(e+30*t+360*o))/360;case 1:return o===l||o+1===l&&(t>s||t===s&&e>=a)?((o===l&&W(o)||function(e,t){const n=e.getFullYear(),i=new Date(n,2,1);if(W(n)&&e<i&&t>=i)return!0;const r=t.getFullYear(),o=new Date(r,2,1);return W(r)&&t>=o&&e<o}(i,r)||1===s&&29===a)&&(u=366),L(r.toDateString(),i.toDateString())/u):L(r.toDateString(),i.toDateString())/h;case 2:return L(r.toDateString(),i.toDateString())/360;case 3:return L(r.toDateString(),i.toDateString())/365;case 4:return(a+30*s+360*l-(e+30*t+360*o))/360}}}const Y={DATE:V,TIME:N,DAY:M,MONTH:O,YEAR:D,HOUR:q,MINUTE:z,SECOND:P,NOW:F,DATEDIF:U,DATEVALUE:function(e){if("string"==typeof e)return a(new Date(new Date(e).toDateString()))},DAYS:L,DAYS360:function(e,t,n=0){const i=h(e),r=h(t);if(i&&r){const e=i.getMonth();let t,o,a=r.getMonth();if(c(n))t=31===i.getDate()?30:i.getDate(),o=31===r.getDate()?30:r.getDate();else{const n=new Date(i.getFullYear(),e+1,0).getDate(),s=new Date(r.getFullYear(),a+1,0).getDate();t=i.getDate()===n?30:i.getDate(),r.getDate()===s?t<30?(a++,o=1):o=30:o=r.getDate()}return 360*(r.getFullYear()-i.getFullYear())+30*(a-e)+(o-t)}},EDATE:function(e,t){const n=h(e),i=s(t);if(n&&"number"==typeof i)return n.setMonth(n.getMonth()+i),a(n)},EOMONTH:function(e,t){const n=h(e),i=s(t);if(n&&"number"==typeof i)return a(new Date(n.getFullYear(),n.getMonth()+i+1,0))},ISOWEEKNUM:B,NETWORKDAYS:function(e,t,n){return H(e,t,1,n)},"NETWORKDAYS.INTL":H,TIMEVALUE:function(e){if("string"==typeof e){const t=e.split(" "),n=t[1],i=t[0].split(":"),r=new Date;return r.setHours(+i[0]),n&&"PM"===n.toUpperCase()&&r.setHours(r.getHours()+12),r.setMinutes(+i[1]),i[2]&&r.setSeconds(+i[2]),(3600*r.getHours()+60*r.getMinutes()+r.getSeconds())/86400}},WEEKNUM:function(e,t=1){const n=h(e);if(21===t)return B(t);const i=T[t],r=new Date(n.getFullYear(),0,1),o=r.getDay()<i?1:0,a=r.getTime()-24*Math.abs(r.getDay()-i)*60*60*1e3;return Math.floor((n.getTime()-a)/864e5/7+1)+o},WEEKDAY:function(e,t=1){const n=h(e).getDay();return k[t][n]},WORKDAY:function(e,t,n){return j(e,t,1,n)},"WORKDAY.INTL":j,YEARFRAC:X};function G(e,t,n,i=0,r=0){const o=d(e),a=d(t),s=d(n),l=d(i);let u;if(0===o)u=(s+l)/a;else{const e=Math.pow(1+o,a);u=o*(s*e+l)/(e-1),1===r&&(u/=1+o)}return-u}function K(e,t,n,i=0,r=0){const o=d(e),a=d(t),s=d(n),l=d(i);let u;if(0!==o){const e=Math.pow(1+o,a);return u=l*e+s*(e-1)/o,1===r&&(u=l*e+s*(1+o)*(e-1)/o),-u}u=l+s*a}function Q(e,t,n,i,r=0,o=0){const a=d(e),s=d(n),l=d(t),u=d(i),c=G(a,s,u,d(r),o);let h;return h=1===l?1===o?0:-u:1===o?K(a,l-2,c,u,1)-c:K(a,l-1,c,u,0),h*a}var Z=Object.freeze({__proto__:null,ACCRINT:function(e,t,n,i,r=0,o,a=0){const s=h(e),l=h(n),u=d(i),c=d(r),f=d(o),g=d(a);if(1!==f)throw"This function is only supported with frequency 1";if(-1===[0,1,2,3,4].indexOf(g))throw`Basis is ${a}. It's should be 0, 1, 2, 3 or 4`;if(l<=s)throw"Settlement canot be before or equal to issue";return c*u*X(e,n,g)},PMT:G,FV:K,DB:function(e,t,n,i,r=12){const o=d(e),a=d(t),s=d(n),l=d(i),u=d(r);if(o<0||a<0||s<0||l<0)throw"Parameters cannot be negative";if(-1===[1,2,3,4,5,6,7,8,9,10,11,12].indexOf(u))throw`Month is ${r}. It's should be beetwen 1 and 12`;if(l>s)throw"Period cannot be greater than life";if(a>=o)return 0;const c=+(1-Math.pow(a/o,1/s)).toFixed(3),h=o*c*u/12;let f=h,g=0;const m=i===s?s-1:i;for(let e=2;e<=+m;e++)g=(o-f)*c,f+=g;return 1===i?h:i===s?(o-f)*c:g},DDB:function(e,t,n,i,r=2){const o=d(e),a=d(t),s=d(n),l=d(i),u=d(r);if(o<0||a<0||s<0||l<0||u<0)throw"Parameters cannot be negative";if(l>s)throw"Period cannot be greater than life";if(a>=o)return 0;let c=0,h=0;for(let e=1;e<=+i;e++)h=Math.min(u/s*(o-c),o-a-c),c+=h;return h},DOLLAR:function(e,t=2){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i){if(i>=0)return`$${n.toFixed(i)}`;const e=Math.pow(10,-i);return"$"+Math.trunc(n/e)*e}},DOLLARDE:function(e,t){const n=d(e);let i=d(t);if(i<0)throw"Fraction cannot be negative";if(i>=0&&i<1)throw"Fraction cannot be zero";i=parseInt(`${i}`,10);let r=parseInt(`${e}`,10);r+=n%1*Math.pow(10,Math.ceil(Math.log(i)/Math.LN10))/i;const o=Math.pow(10,Math.ceil(Math.log(i)/Math.LN2)+1);return r=Math.round(r*o)/o,r},DOLLARFR:function(e,t){const n=d(e);let i=d(t);if(i<0)throw"Fraction cannot be negative";if(i>=0&&i<1)throw"Fraction cannot be zero";i=parseInt(`${i}`,10);let r=parseInt(`${e}`,10);return r+=n%1*Math.pow(10,-Math.ceil(Math.log(i)/Math.LN10))*i,r},EFFECT:function(e,t){const n=d(e);let i=d(t);if(n<=0)throw"Rate cannot be less than or equal to zero";if(i<1)throw"Periods cannot be less than 1";return i=parseInt(`${i}`,10),Math.pow(1+n/i,i)-1},FVSCHEDULE:function(e,t){const n=d(e),i=t.map((e=>d(e))),r=i.length;let o=n;for(let e=0;e<r;e++)o*=1+i[e];return o},IRR:function(e,t=0){const n=l(e).map((e=>d(e)));let i=d(t);const r=function(e,t,n){const i=n+1;let r=e[0];for(let n=1;n<e.length;n++)r+=e[n]/Math.pow(i,(t[n]-t[0])/365);return r},o=function(e,t,n){const i=n+1;let r=0;for(let n=1;n<e.length;n++){const o=(t[n]-t[0])/365;r-=o*e[n]/Math.pow(i,o+1)}return r},a=[];let s=!1,u=!1;for(let e=0;e<n.length;e++)a[e]=0===e?0:a[e-1]+365,n[e]>0&&(s=!0),n[e]<0&&(u=!0);if(!s||!u)throw"Values should contain at least one positive value and one negative value";i=void 0===t?.1:i;let c,h,f,g=i,m=!0;do{f=r(n,a,g),c=g-f/o(n,a,g),h=Math.abs(c-g),g=c,m=h>1e-10&&Math.abs(f)>1e-10}while(m);return g},IPMT:Q,ISPMT:function(e,t,n,i){const r=d(e),o=d(t),a=d(n);return d(i)*r*(o/a-1)},NPV:function(...e){const t=l(e).map((e=>d(e))),n=d(t[0]);let i=0;for(let e=1;e<t.length;e++)i+=t[e]/Math.pow(1+n,e);return i},NOMINAL:function(e,t){const n=d(e);let i=d(t);if(n<=0)throw"Rate cannot be less then or equal to zero";if(i<1)throw"Periods cannot be less then 1";return i=parseInt(`${i}`,10),(Math.pow(n+1,1/i)-1)*i},NPER:function(e,t,n,i=0,r=0){const o=d(e),a=d(t),s=d(n),l=d(i),u=d(r),c=a*(1+o*u)-l*o,h=s*o+a*(1+o*u);return Math.log(c/h)/Math.log(1+o)},PDURATION:function(e,t,n){const i=d(e),r=d(t),o=d(n);if(i<=0)throw"Rate cannot be less then or equal to zero";return(Math.log(o)-Math.log(r))/Math.log(1+i)},PPMT:function(e,t,n,i,r=0,o=0){const a=d(e),s=d(t),l=d(n),u=d(i),c=d(r),h=d(o);return G(a,l,u,c,h)-Q(a,s,l,u,c,h)},PV:function(e,t,n,i=0,r=0){const o=d(e),a=d(t),s=d(n),l=d(i),u=d(r);return 0===o?-s*a-l:((1-Math.pow(1+o,a))/o*s*(1+o*u)-l)/Math.pow(1+o,a)},SYD:function(e,t,n,i){const r=d(e),o=d(t),a=d(n);return(r-o)*(a-d(i)+1)*2/(a*(a+1))},TBILLPRICE:function(e,t,n){const i=h(e),r=h(t),o=d(n);if("number"==typeof o&&r>i)return 100*(1-o*Math.round((r.getTime()-i.getTime())/864e5)/360)},TBILLYIELD:function(e,t,n){const i=h(e),r=h(t),o=d(n);if("number"==typeof o&&r>i)return(100-o)/o*360/Math.round((r.getTime()-i.getTime())/864e5)}});const J={1:"#ERROR",2:"#ERROR",3:"#REF!",4:"#SPILL!"};function ee(e,t,n){return n+64*t+64*e*4096}function te(e){return[e<2147483648?e>>18:e/262144&16777215,e>>6&4095,63&e]}function ne(e){return e<2147483648?e>>18:e/262144&16777215}function ie(e){return 63&e}function re(e,t,n){const[i,r]=te(e),[o,a]=te(t),s=o-i,l=a-r;for(let t=0;t<=s;t++)for(let i=0;i<=l;i++)n(e+64*i+4096*t*64)}function oe(e,t,n,i){let r=0;for(let o=0;o<n;o++)for(let n=0;n<t;n++)i(e+64*n+4096*o*64,r),r++}function ae(e,t){const n=e.code,i=e.source;let r,o,a,s,l,u="";const c=n.length;for(let h=0;h<c;h+=3)switch(n[h]){case 5:{let i;9===n[h+6]&&(i=t.pageName(ie(n[h+7]))),u+=le(i||e.source.substr(n[h+1],n[h+2]))+"!";break}case 7:[r,a,l]=te(n[h+4]),t.z!==l&&5!==n[h-3]&&(u+=le(t.pageName(l))+"!"),u+=se(r,a,n[h+5]);break;case 4:u+=i.substr(n[h+1],n[h+2]).toUpperCase();break;case 8:[r,a,l]=te(n[h+4]),[o,s]=te(n[h+7]),t.z!==l&&5!==n[h-3]&&(u+=le(t.pageName(l))+"!"),u+=se(r,a,n[h+5]),u+=":",u+=se(o,s,n[h+8]);break;case 9:break;case 2:u+="{{"+i.substr(n[h+1],n[h+2])+"}}";break;case 3:u+="#REF!";break;case 1:u+='"'+i.substr(n[h+1],n[h+2])+'"';break;case 13:{u+="{";const e=n[h+1],t=n[h+2];h+=3;for(let r=0;r<t;r++){for(let t=0;t<e;t++){t>0&&(u+=",");const e=n[h];1===e?u+='"'+i.substr(n[h+1],n[h+2])+'"':11===e&&(u+=i.substr(n[h+1],n[h+2])),h+=3}r<t-1&&(u+=";")}h-=3,u+="}";break}default:u+=i.substr(n[h+1],n[h+2])}return u}function se(e,t,n){let i="";2&n&&(i+="$");let r="";for(t+=1;t>0;){let e=t%26;0===e&&(e=26),r=String.fromCharCode(64+e)+r,t=(t-e)/26}return i+=r,1&n&&(i+="$"),i+=e+1,i}function le(e){return-1!==e.indexOf(" ")?`'${e}'`:e}let ue;function ce(e){return e<=122}function he(e){return e<=122?e>=65&&94!=e||35===e||36===e||46===e:e>191}function de(e){return e>=97}function fe(e){const t=e.charCodeAt(0);return t>=48&&t<=57}function ge(e,t){let n;do{t++,n=e.charCodeAt(t)}while(n>=48&&n<=57);return t}function me(e,t){let n;do{n=e[++t]}while('"'!==n);return t}function ve(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function pe(e,t){let n;do{n=e[++t]}while(ve(n));return t}function be(e,t){if("<"===e[t]){const n=e[t+1];">"!==n&&"="!==n||t++}else">"===e[t]&&"="===e[t+1]&&t++;return t+1}function we(e,t,n){const i=e.length;let r=!0,o=t,a=!1,s=!1,l=!1,u=0;for(;o<i;o++){const t=e[o];if("'"!==t){if(!a){l=!0;const e=t.charCodeAt(0);if(he(e)){ce(e)?de(e)&&(s=!0):r=!1,1==u&&u++;continue}if(fe(t)){0==u&&u++;continue}break}}else{if(l)break;if(a){o++;break}a=!0}}const c=e[o];let h=t,d=o-t;return a&&(d-=1+("'"===e[o-1]?1:0),d<0&&(d=0),h++,n=5),0===n&&(":"===c&&r?1!==u?n=3:(n=8,s&&(ue=!0)):"!"===c?n="#"===e[h]?3:5:"("===c?(function(e,t,n){const i=e.substr(t,n);return i.toUpperCase()!==i}(e,h,d)&&(ue=!0),n=4):"}"===c&&"}"===e[o-1]?n=2:1===u&&r?(n=7,s&&(ue=!0)):n=6),[h,d,o,n]}function _e(e,t,n){let i=0,r=0,o=1,a=1,s=0,l=!1;for(let e=t.length-1;e>=0;e--){const n=t[e].charCodeAt(0);36!==n?n<58?(r+=(n-48)*o,o*=10):(l||(o=1,i=r,r=0,l=!0,a+=1),r+=(n-(n>96?96:64))*o,o*=26):s+=a}r>4095?e.push(3,0,0):e.push(9,ee(i-1,r-1,n),s)}function xe(e,t){const n=[];ue=!1;let i=-1,r=-1,o=0;for(let s=0;s<e.length;s++){const l=e[s];if(r>-1){if("}"==l){const e=n[r+2]+=1,t=n[r+1]=o/e;t-Math.round(t)!=0&&n.push(3,0,0),r=-1}else if('"'===l){const t=me(e,s);s++,n.push(1,s,t-s),o++,s=t}else if("-"===l){const t=ge(e,s+1);n.push(11,s,t-s),o++,s=t-1}else if(fe(l)){const t=ge(e,s);n.push(11,s,t-s),o++,s=t-1}else" "===l||"\t"===l||","===l||(";"===l?n[r+2]+=1:n.push(3,0,0));continue}if('"'==l){i>-1?(n.push(1,i+1,s-i-1),i=-1):i=s;continue}if(i>-1)continue;if("{"==l){if("{"==e[s+1]){const[t,i,r]=we(e,s+2,2);n.push(2,t,i),s=r+2-1;continue}r=n.length,o=0,n.push(13,0,0);continue}if("'"==l||((a=l.charCodeAt(0))<=122?a>=65&&94!=a||35===a||36===a:a>191)){let i,[r,o,a,l]=we(e,s,0);const u=n.length;if(7!==l&&8!==l||5!==n[n.length-3])i=t.z,n.push(l,r,o);else{const a="'"===e[r-2]?1:0,s=n[u-2],c=n[u-1];i=t.page(e.substr(s,c)),void 0===i&&(n.push(3,0,0),i=0),n.push(l,r-c-2*a-1,o+c+2*a+1)}if(s=a-1,6===l)t.name(n,e,t);else if(8===l){const t=n.length;if(_e(n,e.substr(r,o),i),[r,o,a,l]=we(e,s+2,0),5===l&&([r,o,a,l]=we(e,a+1,0)),7!==l){n[t-3]=7;continue}_e(n,e.substr(r,o),i);const u=n[t+1],c=n[t+4];(u>c||ne(u)>ne(c))&&(n[t+1]=c,n[t+4]=u),n[t-1]+=o+1,s=a-1}else 7===l?_e(n,e.substr(r,o),i):3!==l&&5!==l||s++;continue}if(ve(l)){const t=pe(e,s);n.push(12,s,t-s),s=t-1;continue}if(fe(l)){const t=ge(e,s);n.push(11,s,t-s),s=t-1;continue}const u=be(e,s);n.push(10,s,u-s),s=u-1}var a;const s={code:n,source:e,exec:null,broken:0,triggers:null};return ue&&(s.source=ae(s,t)),s}function ye(e){return"            ".substr(0,10-e.length)}const Ce=[">","<","=","+"];function Se(e,t){const n=function(e,t){const n=e.code,i=e.source;let r="",o=0;const a=[],s=n.length;for(let l=0;l<s;l+=3)switch(n[l]){case 4:r+=`ctx.m["${i.substr(n[l+1],n[l+2]).toUpperCase()}"]`;break;case 1:r+='"'+i.substr(n[l+1],n[l+2])+'"';break;case 2:r+=`ctx.p("${i.substr(n[l+1],n[l+2])}")`;break;case 6:case 7:{let e,t;if(10===n[l-3]?e=l-3:12===n[l-3]&&10===n[l-6]&&(e=l-6),10===n[l+6]?t=l+6:12===n[l+6]&&10===n[l+9]&&(t=l+9),e||t){const o=e?i[n[e+1]]:null,a=t?i[n[t+1]]:null;if("&"==o||"&"==a){r+=`(ctx.v(${n[l+4]}) === null ? "" : ctx.v(${n[l+4]}))`;break}if(-1!=Ce.indexOf(o)||-1!=Ce.indexOf(a)){r+=`(ctx.v(${n[l+4]}) === null ? 0 : ctx.v(${n[l+4]}))`;break}}r+=`ctx.v(${n[l+4]})`;break}case 8:r+=`ctx.r(${n[l+4]}, ${n[l+7]})`;break;case 10:if(1===n[l+2]){const e=i[n[l+1]];"&"===e?r+='+""+':t&&"+"==e?r+="*1+1*":"="===e?r+="==":";"===e?r+=",":"{"===e?r+="[":"}"===e?r+="]":"^"===e?r+="**":"%"===e?n[l+3]&&10!==n[l+3]?r+=t?"/0+":e:r+=("/"==a[o]?"*":"/")+"100":("("==e?(o++,a.push("+")):")"==e&&(o--,a.pop()),r+=e),"+"!=e&&"-"!=e&&"*"!=e&&"/"!=e&&"&"!=e||(a[o]=e)}else if(2===n[l+2]){const e=i.substr(n[l+1],n[l+2]);r+="<>"===e?"!=":e}else r+=i.substr(n[l+1],n[l+2]);break;case 11:r+=i.substr(n[l+1],n[l+2]);break;case 3:return"";case 9:case 5:case 12:break;case 13:{r+="ctx.a([";const t=n[l+1],o=n[l+2];l+=3;const a=l+t*o*3;let s=!1;for(;l<a;l+=3){s&&(r+=",");const t=n[l];if(11===t)r+=i.substr(n[l+1],n[l+2]);else if(1===t)r+='"'+i.substr(n[l+1],n[l+2])+'"';else if(3===t)return e.broken=3,"";s=!0}l-=3,r+=`],${t}, ${o})`;break}}return r}(e,t);if(!n)return e.broken=3,void(e.exec=null);try{e.exec=new Function("ctx",`return ${n}`)}catch(t){e.broken=1,e.exec=null}}function Ee(e,t){const n=+bt(e),i=+wt(e),r=+bt(t),o=+wt(t);return lt(n*r-i*o,n*o+i*r)}function $e(e,t){const n=+bt(e),i=+wt(e);return lt(n+ +bt(t),i+ +wt(t))}function Re(e){return e>0?Math.floor(e):Math.ceil(e)}function Ae(e){return e<0?Math.floor(e):Math.ceil(e)}function ke(...e){let t=0;const n=l(e);for(let e=0;e<n.length;e++){const i=s(n[e]);"number"==typeof i&&(t+=i)}return t}function Te(...e){let t=0,n=0;const i=l(e);for(let e=0;e<i.length;e++){const r=s(i[e]);"number"==typeof r&&(t+=r,n++)}return n?t/n:0}function Ie(...e){const t=l(e);let n=0,i=0;for(let e=0;e<t.length;e++){const r=t[e],o=s(t[e]);"number"==typeof o?(n+=o,i++):(!0===r&&n++,(r||!1===r)&&i++)}return i?n/i:0}function Ve(...e){let t=0;const n=l(e);for(let e=0;e<n.length;e++)"number"==typeof s(n[e])&&t++;return t}function Ne(...e){let t=0;const n=l(e);for(let e=0;e<n.length;e++)n[e]&&1*n[e]!=0&&t++;return t}function Me(...e){let t=-1/0;const n=l(e);for(let e=0;e<n.length;e++){const i=s(n[e]);"number"==typeof i&&i>t&&(t=i)}return t===-1/0?0:t}function Oe(...e){let t=1/0;const n=l(e);for(let e=0;e<n.length;e++){const i=s(n[e]);"number"==typeof i&&i<t&&(t=i)}return t===1/0?0:t}function De(...e){let t=!1,n=1;const i=l(e);for(let e=0;e<i.length;e++){const r=s(i[e]);"number"==typeof r&&(t=!0,n*=r)}return t?n:null}function qe(...e){const t=e[0].length;for(const n in e)if(e[n].length!==t)return;let n=0;for(let t=0;t<e[0].length;t++){let i=!1,r=1;for(const n in e){const o=s(e[n][t]);"number"==typeof o&&(r*=o,i=!0)}i&&(n+=r)}return n}function ze(e,t,n){const i=l(e);let r=t?0:-1;const o=n?Ie(...e):Te(...e);let a=0;for(let e=0;e<i.length;e++){const t=i[e];let l=s(i[e]);if("number"!=typeof l){if(!n||"boolean"!=typeof t&&!t)continue;l=!0===t?1:0}r++,a+=Math.pow(l-o,2)}return r?a/r:0}function Pe(...e){return ze(e,!1,!1)}function Fe(...e){return ze(e,!1,!0)}function Ue(...e){return ze(e,!0,!1)}function Le(...e){return ze(e,!0,!0)}function Be(...e){return Math.sqrt(Pe(...e))}function He(...e){return Math.sqrt(Ue(...e))}function je(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i)return Math.pow(n,i)}function We(e){const t=s(e);if("number"==typeof t&&t>=0)return Math.sqrt(t)}function Xe(e){const t=s(e);if("number"==typeof t)return Math.abs(t)}function Ye(){return Math.random()}function Ge(e){const t=s(e);if("number"==typeof t)return Math.floor(t)}function Ke(e,t){const n=s(e),i=s(t)||0;if("number"==typeof n&&"number"==typeof i)return i<0?Math.round(n/Math.pow(10,Math.abs(i)))*Math.pow(10,Math.abs(i)):parseFloat(n.toFixed(i))}function Qe(e,t){const n=s(e),i=s(t)||0;if("number"==typeof n&&"number"==typeof i)return Math.floor(n*Math.pow(10,i))/Math.pow(10,i)}function Ze(e,t){const n=s(e),i=s(t)||0;if("number"==typeof n&&"number"==typeof i)return Math.ceil(n*Math.pow(10,i))/Math.pow(10,i)}const Je={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};function et(e,t=1,n=0){const i=s(e);let r=s(t);const o=s(n);if("number"==typeof i&&"number"==typeof r&&"number"==typeof o)return 0===r?0:(r=Math.abs(r),i>=0?Math.ceil(i/r)*r:0===n?-1*Math.floor(Math.abs(i)/r)*r:-1*Math.ceil(Math.abs(i)/r)*r)}const tt=[];function nt(e){const t=s(e);if("number"==typeof t&&t>-1){const e=Math.floor(t);return 0===e||1===e?1:(tt[e]>0||(tt[e]=nt(e-1)*e),tt[e])}}function it(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i)return nt(n)/(nt(i)*nt(n-i))}function rt(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i){const e=Math.abs(i);return n>=0?Math.floor(n/e)*e:-1*Math.ceil(Math.abs(n)/e)*e}}function ot(e,t=10){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i)return Math.log(n)/Math.log(i)}function at(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i)return n+Math.ceil((i-n+1)*Math.random())-1}const st=["","C","CC","CCC","CD","D","DC","DCC","DCCC","CM","","X","XX","XXX","XL","L","LX","LXX","LXXX","XC","","I","II","III","IV","V","VI","VII","VIII","IX"];function lt(e,t,i="i"){const r=s(e),o=s(t);if("number"!=typeof r&&"number"!=typeof o)throw n;let a="",l="";return e&&(a=e.toString()),t&&1!==t?l=t+i:1===t&&(l=i),t>0?`${a?`${a}+`:""}${l}`:a+l}function ut(e,t=null){return f(e,t,-512,511,2)}function ct(e,t=null){return f(e,t,-274877906944,274877906943,16)}function ht(e,t=null){return f(e,t,-536870912,536870911,8)}const dt=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17];function ft(e){const t=e<0;let n,i=0,r=0;const o=2/(2+(e=Math.abs(e))),a=4*o-2;for(let e=dt.length-1;e>0;e--)n=a*i-r+dt[e],r=i,i=n;const s=o*Math.exp(-e*e+.5*(dt[0]+a*i)-r);return t?s-1:1-s}function gt(e,n){const i=s(e),r=s(n);if("number"==typeof i)return"number"==typeof r?ft(r)-ft(i):ft(i);throw t}function mt(e){const n=s(e);if("number"==typeof n)return Math.exp(n);throw t}const vt=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7],pt=Math.pow(2,39);function bt(e){if("string"!=typeof e)throw t;if(["i","+i","1i","+1i","-i","-1i","j","+j","1j","+1j","-j","-1j"].indexOf(e)>=0)return 0;let i=e.indexOf("+"),r=e.indexOf("-");0===i&&(i=e.indexOf("+",1)),0===r&&(r=e.indexOf("-",1));const o=e.substring(e.length-1,e.length),a="i"===o||"j"===o;if(i>=0||r>=0){if(!a)throw n;if(i>=0){if(isNaN(+e.substring(0,i))||isNaN(+e.substring(i+1,e.length-1)))throw n;return Number(e.substring(0,i))}if(isNaN(+e.substring(0,r))||isNaN(+e.substring(r+1,e.length-1)))throw n;return Number(e.substring(0,r))}if(a){if(isNaN(+e.substring(0,e.length-1)))throw n;return 0}if(isNaN(+e))throw n;return+e}function wt(e){if("string"!=typeof e)throw t;if(["i","j"].indexOf(e)>=0)return 1;let i=(e=e.replace("+i","+1i").replace("-i","-1i").replace("+j","+1j").replace("-j","-1j")).indexOf("+"),r=e.indexOf("-");0===i&&(i=e.indexOf("+",1)),0===r&&(r=e.indexOf("-",1));const o=e.substring(e.length-1,e.length),a="i"===o||"j"===o;if(i>=0||r>=0){if(!a)throw n;if(i>=0){if(isNaN(+e.substring(0,i))||isNaN(+e.substring(i+1,e.length-1)))throw n;return Number(e.substring(i+1,e.length-1))}if(isNaN(+e.substring(0,r))||isNaN(+e.substring(r+1,e.length-1)))throw n;return-Number(e.substring(r+1,e.length-1))}if(a){const t=+e.substring(0,e.length-1);if(isNaN(t))throw n;return t}if(isNaN(+e))throw n;return 0}function _t(e){const t=+bt(e),n=+wt(e);return lt(Math.cos(t)*Math.cosh(n),-Math.sin(t)*Math.sinh(n))}function xt(e){const t=+bt(e),n=+wt(e);return lt(Math.cos(n)*(Math.exp(t)+Math.exp(-t))/2,Math.sin(n)*(Math.exp(t)-Math.exp(-t))/2)}function yt(e,t){const n=+bt(e),i=+wt(e),r=+bt(t),o=+wt(t),a=Math.pow(r,2)+Math.pow(o,2);return lt((n*r+i*o)/a,(i*r-n*o)/a)}function Ct(e){const t=+bt(e),n=+wt(e);return lt(Math.sin(t)*Math.cosh(n),Math.cos(t)*Math.sinh(n))}function St(e){const t=+bt(e),n=+wt(e);return lt(Math.cos(n)*(Math.exp(t)-Math.exp(-t))/2,Math.sin(n)*(Math.exp(t)+Math.exp(-t))/2)}const Et=Math.pow(2,29);function $t(e,n,i){const r=s(n);if("number"!=typeof r||n<0||n>1||i&&(0===n||1===n))throw t;let o=l(e).sort(((e,t)=>e-t));i&&(o=[0,...o]);const a=(o.length+(i?0:-1))*r,u=Math.floor(a);if(void 0===o[u+1])return o[u];const c=o[u+1]-o[u];return o[u]+c*(a-u)}function Rt(e,i,r){const o=s(i);if("number"!=typeof o)throw t;switch(o){case 0:if(r)throw t;return Oe(...e);case 1:return $t(e,.25,r);case 2:return $t(e,.5,r);case 3:return $t(e,.75,r);case 4:if(r)throw t;return Me(...e);default:throw n}}function At(e,t,n,i){const r=d(e),o=d(t),a=d(n);if(1==t)return 1/a;const s=Math.exp(-Math.pow(r/a,o));return i?1-s:o/Math.pow(a,o)*Math.pow(r,o-1)*s}function kt(e,t,n,i=!1){const r=d(e),o=d(t),a=d(n),s=(e,t,n)=>it(t,e)*Math.pow(n,e)*Math.pow(1-n,t-e);if(!i)return s(r,o,a);let l=0;for(let e=0;e<r+1;e++)l+=s(e,o,a);return l}function Tt(t,n,r){const o=t.filter((e=>"number"==typeof e)),a=n.filter((e=>"number"==typeof e));if(o.length!==a.length)throw i;const s=o.length;if(0===s)throw e;const l=o.reduce(((e,t)=>e+t),0)/s,u=a.reduce(((e,t)=>e+t),0)/s;let c=0;for(let e=0;e<s;e++)c+=(o[e]-l)*(a[e]-u);return c/(r?s-1:s)}function It(e,t){return Tt(e,t,!1)}const Vt={ABS:Xe,ACOS:function(e){const t=s(e);if("number"==typeof t)return Math.acos(t)},ACOSH:function(e){const t=s(e);if("number"==typeof t)return Math.acosh(t)},ACOT:function(e){const t=s(e);if("number"==typeof t)return Math.atan(1/t)},ACOTH:function(e){const t=s(e);if("number"==typeof t)return.5*Math.log((t+1)/(t-1))},ADD:function(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i)return n+i},ARABIC:function(e){if(!s(e)&&/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/.test(`${e}`)){let t=0;return`${e}`.replace(/[MDLV]|C[MD]?|X[CL]?|I[XV]?/g,(function(e){return t+=Je[e],e})),+t}},ASIN:function(e){const t=s(e);if("number"==typeof t)return Math.asin(t)},ASINH:function(e){const t=s(e);if("number"==typeof t)return Math.asinh(t)},ATAN:function(e){const t=s(e);if("number"==typeof t)return Math.atan(t)},ATAN2:function(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i)return Math.atan2(i,n)},ATANH:function(e){const t=s(e);if("number"==typeof t)return Math.log((1+t)/(1-t))/2},AVEDEV:function(...t){const n=l(t).filter((e=>"number"==typeof e)),i=n.length;if(0===i)throw e;const r=n.reduce(((e,t)=>e+t),0)/i;return n.reduce(((e,t)=>e+Math.abs(t-r)),0)/i},AVERAGE:Te,AVERAGEA:Ie,BASE:function(e,t,n=0){const i=s(e),r=s(t),o=s(n);if("number"==typeof i&&"number"==typeof r&&"number"==typeof o){const e=i.toString(r);return new Array(Math.max(o+1-e.length,0)).join("0")+e.toUpperCase()}},BINOMDIST:kt,"BINOM.INV":function(e,t,n){const i=d(e),r=d(t),o=d(n);for(let e=0;e<=i;e++)if(kt(e,i,r,!0)>=o)return e},"BINOM.DIST.RANGE":function(e,t,n,i){const r=d(e),o=d(t),a=d(n);let l=s(i);"number"!=typeof l&&(l=a);let u=0;for(let e=a;e<=l;e++)u+=it(r,e)*Math.pow(o,e)*Math.pow(1-o,r-e);return u},"BINOM.DIST":kt,BITAND:function(e,n){const i=s(e),r=s(n);if("number"==typeof i&&"number"==typeof r)return i&r;throw t},BITLSHIFT:function(e,n){const i=s(e),r=s(n);if("number"==typeof i&&"number"==typeof r)return r>0?i<<r:i>>-r;throw t},BITOR:function(e,n){const i=s(e),r=s(n);if("number"==typeof i&&"number"==typeof r)return i|r;throw t},BITRSHIFT:function(e,n){const i=s(e),r=s(n);if("number"==typeof i&&"number"==typeof r)return r>0?i>>r:i<<-r;throw t},BITXOR:function(e,n){const i=s(e),r=s(n);if("number"==typeof i&&"number"==typeof r)return i^r;throw t},CEILING:et,COMBIN:it,COMBINA:function(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i)return 0===n&&0===i?1:it(n+i-1,n-1)},COMPLEX:lt,CORREL:function(t,n){if(t.length!==n.length)throw i;const r=t.filter((e=>"number"==typeof e)),o=n.filter((e=>"number"==typeof e)),a=r.length,s=r.reduce(((e,t)=>e+t),0)/a,l=o.reduce(((e,t)=>e+t),0)/a;let u=0,c=0,h=0;for(let e=0;e<a;e++)u+=(r[e]-s)*(o[e]-l),c+=Math.pow(r[e]-s,2),h+=Math.pow(o[e]-l,2);const d=Math.sqrt(c*h);if(!d)throw e;return u/d},COS:function(e){const t=s(e);if("number"==typeof t)return Math.cos(t)},COSH:function(e){const t=s(e);if("number"==typeof t)return Math.cosh(t)},COT:function(e){const t=s(e);if("number"==typeof t)return 1/Math.tan(t)},COTH:function(e){const t=s(e);if("number"==typeof t){const e=Math.exp(2*t);return(e+1)/(e-1)}},COUNT:Ve,COUNTA:Ne,COUNTBLANK:function(...e){let t=0;const n=l(e);for(let e=0;e<n.length;e++)0===n[e]||n[e]||t++;return t},COVAR:It,"COVARIANCE.P":It,"COVARIANCE.S":function(e,t){return Tt(e,t,!0)},CSC:function(e){const t=s(e);if("number"==typeof t)return 1/Math.sin(t)},CSCH:function(e){const t=s(e);if("number"==typeof t)return 2/(Math.exp(t)-Math.exp(-t))},DEC2BIN:ut,DEC2HEX:ct,DEC2OCT:ht,DECIMAL:function(e,t){const n=s(e),i=s(t);if(!`${n}`.match("/[2-9]/")&&"number"==typeof n&&"number"==typeof i&&i>1&&i<37)return parseInt(`${n}`,i)},DEGREES:function(e){const t=s(e);if("number"==typeof t)return 180*t/Math.PI},DELTA:function(e,n){const i=s(e),r=s(n);if("number"==typeof i||"number"==typeof i)return+(i===r);throw t},DEVSQ:function(...e){const t=l(e),n=[];t.forEach((e=>{"number"==typeof e&&n.push(e)}));const i=n.reduce(((e,t)=>e+t),0)/n.length;return n.reduce(((e,t)=>e+Math.pow(t-i,2)),0)},DIVIDE:function(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i&&0!==i)return n/i},EQ:function(e,t){return typeof e==typeof t&&e==t},ERF:gt,ERFC:function(e,n){const i=s(e);if("number"==typeof i)return 1-gt(i,n);throw t},EVEN:function(e){const t=s(e);if("number"==typeof t){const e=Ae(t);return e%2?e+Math.sign(t):e}},EXP:mt,FACT:nt,FACTDOUBLE:function e(t){const n=s(t);if("number"==typeof n){const t=Math.floor(n);return t<=0?1:t*e(t-2)}},FISHER:function(e){const n=s(e);if("number"==typeof n&&n>-1&&n<1)return.5*Math.log((1+n)/(1-n));throw t},FISHERINV:function(e){const n=s(e);if("number"==typeof n){const e=Math.exp(2*n);return(e-1)/(e+1)}throw t},FLOOR:rt,GAMMA:function e(i){let r=s(i);if("number"!=typeof r)throw t;if(!(Number.isInteger(r)&&r<=0)){if(r<.5)return Math.PI/(Math.sin(Math.PI*r)*e(1-r));{r-=1;let e=vt[0];for(let t=1;t<9;t++)e+=vt[t]/(r+t);const t=r+7+.5;return Math.sqrt(2*Math.PI)*Math.pow(t,r+.5)*Math.exp(-t)*e}}throw n},GCD:function(...e){const t=l(e),n=t.length;if(!n)return 1;let i=t[0],r=1;for(;"number"!=typeof i;){if(i=t[r],r>t.length)throw"The arguments should contain at least one numeric value";r++}let o=i<0?-i:i;for(;r<n;r++){const e=s(t[r]);if("number"==typeof e){let t=e<0?-e:e;for(;o&&t;)o>t?o%=t:t%=o;o+=t}}return o},GEOMEAN:function(...e){const t=l(e);if(t.some((e=>!Number.isFinite(e)||e<=0)))throw n;return Math.pow(t.reduce(((e,t)=>t*e),1),1/t.length)},GESTEP:function(e,n=0){const i=s(e),r=s(n);if("number"==typeof i&&"number"==typeof r)return+(e>=n);throw t},GT:function(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i)return n>i},GTE:function(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i)return n>=i},HARMEAN:function(...e){const t=l(e);if(t.some((e=>!Number.isFinite(e)||e<=0)))throw n;const i=t.reduce(((e,t)=>e+1/t),0);return 1/(1/t.length*i)},HEX2BIN:function(e,t){return ut(parseInt(e.toString(),16),t)},HEX2DEC:function(e,n){let i=parseInt(e.toString(),16);if(!Number.isFinite(i))throw t;const r=i>pt;r&&(i=-(i-2*pt));const o=n?s(n):null,a=i.toString();return(r?"-":"")+(o?a.padStart(o,"0"):a)},HEX2OCT:function(e,t=null){let n=parseInt(e.toString(),16);return n>pt&&(n^=pt),ht(n,t)},IMABS:function(e){const n=bt(e),i=wt(e);if(!Number.isFinite(+n)||!Number.isFinite(+i))throw t;return Math.sqrt(Math.pow(+n,2)+Math.pow(+i,2))},IMAGINARY:wt,IMCONJUGATE:function(e){return lt(+bt(e),-+wt(e))},IMCOS:_t,IMCOSH:xt,IMCOT:function(e){return yt(_t(e),Ct(e))},IMCSC:function(e){return yt("1",Ct(e))},IMCSCH:function(e){return yt("1",St(e))},IMDIV:yt,IMEXP:function(e){const t=+bt(e),n=+wt(e),i=Math.exp(t);return lt(i*Math.cos(n),i*Math.sin(t))},IMLN:function(e){const t=+bt(e),n=+wt(e);return lt(Math.log(Math.sqrt(t*t+n*n)),Math.atan(n/t))},IMPOWER:function(e,n){const i=s(n);if("number"!=typeof i)throw t;const r=+bt(e),o=+wt(e),a=Math.sqrt(r*r+o*o),l=Math.pow(a,i),u=Math.atan(o/r);return lt(l*Math.cos(i*u),l*Math.sin(i*u))},IMPRODUCT:function(...e){if(0===e.length)throw t;let n=e[0];for(const t of e.slice(1))n=Ee(n.toString(),t.toString());return n.toString()},IMREAL:bt,IMSEC:function(e){return yt("1",_t(e))},IMSECH:function(e){return yt("1",xt(e))},IMSIN:Ct,IMSINH:St,IMSQRT:function(e){const t=+bt(e),n=+wt(e),i=Math.sqrt(Math.sqrt(t*t+n*n)),r=Math.atan(n/t)/2;return lt(i*Math.cos(r),i*Math.sin(r))},IMSUB:function(e,t){const n=+bt(e),i=+wt(e);return lt(n-+bt(t),i-+wt(t))},IMSUM:function(...e){if(0===e.length)throw t;let n=e[0];for(const t of e.slice(1))n=$e(n.toString(),t.toString());return n.toString()},IMTAN:function(e){return yt(Ct(e),_t(e))},INT:Ge,LARGE:function(e,n){const i=s(n),r=e.sort(((e,t)=>e-t));if("number"==typeof i&&!e.some((e=>"number"!=typeof s(e))))return r[r.length-i];throw t},LN:function(e){const t=s(e);if("number"==typeof t)return Math.log(t)},LOG:ot,LOG10:function(e){const t=s(e);if("number"==typeof t)return Math.log(t)/Math.log(10)},LT:function(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i)return n<i},LTE:function(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i)return n<=i},MAX:Me,MEDIAN:function(...e){const t=l(e);t.sort((function(e,t){return e-t}));const n=Math.floor(t.length/2);return t.length%2?t[n]:(t[n-1]+t[n])/2},MIN:Oe,MINUS:function(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i)return n-i},MOD:function(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i&&0!==i){const e=Math.abs(n%i);return t>0?e:-e}},MROUND:function(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i&&n*i>-1)return Math.round(n/i)*i},MULTINOMIAL:function(...e){const t=l(e);let n=0,i=1;for(let e=0;e<t.length;e++){const r=s(t[e]);"number"==typeof r&&(n+=r,i*=nt(t[e]))}return nt(n)/i},MULTIPLY:function(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i)return n*i},NE:function(e,t){return typeof e!=typeof t||e!=t},OCT2BIN:function(e,t=null){let n=parseInt(e.toString(),8);return n&Et&&(n=-(2*Et-n)),ut(n,t)},OCT2DEC:function(e,n=null){const i=n?s(n):null;let r=parseInt(e.toString(),8);if(r&Et&&(r=-(2*Et-r)),!Number.isFinite(r)||"boolean"==typeof i)throw t;return r.toString().padStart(i||0,"0")},OCT2HEX:function(e,t=null){let n=parseInt(e.toString(),8);return n&Et&&(n=-(2*Et-n)),ct(n,t)},ODD:function(e){const t=s(e);if("number"==typeof t){const e=Ae(t);return e%2?e:e+Math.sign(t)}},PERCENTILE:$t,"PERCENTILE.INC":$t,"PERCENTILE.EXC":function(e,t){return $t(e,t,!0)},PERMUT:function(e,n){const i=s(e),r=s(n);if("number"==typeof i&&"number"==typeof r)return nt(i)/nt(i-r);throw t},PI:function(){return Math.PI},POW:function(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i)return je(e,t)},POWER:je,PRODUCT:De,QUARTILE:Rt,"QUARTILE.INC":Rt,"QUARTILE.EXC":function(e,t){return Rt(e,t,!0)},QUOTIENT:function(e,t){const n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i)return Re(n/i)},RADIANS:function(e){const t=s(e);if("number"==typeof t)return t*Math.PI/180},RAND:Ye,RANDBETWEEN:at,ROMAN:function(e){const t=s(e);if("number"==typeof t){const e=String(t).split("");let n="",i=3;for(;i--;)n=(st[+e.pop()+10*i]||"")+n;return new Array(+e.join("")+1).join("M")+n}},ROUND:Ke,ROUNDDOWN:Qe,ROUNDUP:Ze,SEC:function(e){const t=s(e);if("number"==typeof t)return 1/Math.cos(t)},SECH:function(e){const t=s(e);if("number"==typeof t)return 2/(Math.exp(t)+Math.exp(-t))},SIGN:function(e){const n=s(e);if("number"==typeof n)return 0===n?0:n/Math.abs(n);throw t},SIN:function(e){const t=s(e);if("number"==typeof t)return Math.sin(t)},SINH:function(e){const t=s(e);if("number"==typeof t)return Math.sinh(t)},SMALL:function(e,n){const i=s(n),r=e.sort(((e,t)=>e-t));if("number"==typeof i&&!e.some((e=>"number"!=typeof s(e))))return r[i-1];throw t},SQRT:We,SQRTPI:function(e){const t=s(e);if("number"==typeof t&&t>-1)return Math.sqrt(t*Math.PI)},STDEV:Be,"STDEV.S":Be,"STDEV.P":He,STDEVA:function(...e){return Math.sqrt(Fe(...e))},STDEVP:He,STDEVPA:function(...e){return Math.sqrt(Le(...e))},STEYX:function(t,n){if(t.length!==n.length)throw i;const r=t.filter((e=>"number"==typeof e)),o=n.filter((e=>"number"==typeof e)),a=r.length;if(2===a)throw e;const s=r.reduce(((e,t)=>e+t),0)/a,l=o.reduce(((e,t)=>e+t),0)/a;let u=0,c=0,h=0;for(let e=0;e<a;e++)u+=(r[e]-s)*(o[e]-l),c+=Math.pow(r[e]-s,2),h+=Math.pow(o[e]-l,2);if(2===h)throw e;return Math.sqrt((c-Math.pow(u,2)/h)/(a-2))},SUBTOTAL:function(e,...t){const n=s(e),i=l(t);if("number"==typeof n)switch(n){case 1:case 101:return Te(...i);case 102:case 2:return Ve(...i);case 103:case 3:return Ne(...i);case 104:case 4:return Me(...i);case 105:case 5:return Oe(...i);case 106:case 6:return De(...i);case 107:case 7:case 110:case 10:return;case 108:case 8:return He(...i);case 109:case 9:return ke(...i);case 111:case 11:return Ue(...i)}},SUM:ke,SUMPRODUCT:qe,SUMSQ:function(...e){let t=0;const n=l(e);for(let e=0;e<n.length;e++){const i=s(n[e]);"number"==typeof i&&(t+=Math.pow(i,2))}return t},SUMX2MY2:function(e,t){if(!e.find((e=>"number"!=typeof s(e)))&&!t.find((e=>"number"!=typeof s(e)))){let n=0;for(let i=0;i<e.length;i++)n+=e[i]*e[i]-t[i]*t[i];return n}},SUMX2PY2:function(e,t){if(!e.find((e=>"number"!=typeof s(e)))&&!t.find((e=>"number"!=typeof s(e)))){let n=0;for(let i=0;i<e.length;i++)n+=e[i]*e[i]+t[i]*t[i];return n}},SUMXMY2:function(e,t){if(!e.find((e=>"number"!=typeof s(e)))&&!t.find((e=>"number"!=typeof s(e)))){let n=0;for(let i=0;i<e.length;i++)n+=Math.pow(e[i]-t[i],2);return n}},TAN:function(e){const t=s(e);if("number"==typeof t)return Math.tan(t)},TANH:function(e){const t=s(e);if("number"==typeof t)return Math.tanh(t)},TRUNC:function(e){const t=s(e);if("number"==typeof t)return Re(t)},VAR:Pe,"VAR.S":Pe,"VAR.P":Ue,VARA:Fe,VARP:Ue,VARPA:Le,WEIBULL:At,"WEIBULL.DIST":At};function Nt(e){return void 0===e?null:e}function Mt(e,t,n,i){void 0===n&&(n=0);let r=-1;if(0===n)r=t.indexOf(e);else{let i="string"==typeof e?"":-1/0*n;1===n?t.forEach(((t,n)=>{t<=e&&t>i&&(i=t,r=n)})):-1===n&&t.forEach(((t,n)=>{t>=e&&t<i&&(i=t,r=n)}))}return r+1}const Ot={LOOKUP:function(e,t,n){const i=Mt(e,t,1);if(0===i)throw"#N/A";return(n||t)[i-1]},HLOOKUP:function(e,t,n,i){let r=!0;void 0!==i&&(r=c(i));const o=t.$width?t.$width:t.length,a=Mt(e,t.slice(0,o),r?1:0);if(0===a)throw"#N/A";return Nt(t[o*((n||1)-1)+a-1])},VLOOKUP:function(e,t,n,i){let r=!0;void 0!==i&&(r=c(i));const o=t.$width?t.$width:1,a=t.length/o;let s;if(1===a)s=t;else{s=[];for(let e=0;e<a;e++)s.push(t[o*e])}const l=n,u=Mt(e,s,r?1:0);if(0===u)throw"#N/A";return Nt(t[o*(u-1)+(l||1)-1])},XLOOKUP:function(e,t,n,i,r,o){const a=Mt(e,t,r);if(0===a){if(void 0!==i)return i;throw"#N/A"}return(n||t)[a-1]},INDEX:function(e,t,n){const i=t,r=n;return Nt(e[(e.$width?e.$width:1)*(i-1)+(r||1)-1])},MATCH:function(e,t,n){let i=n;void 0===n&&(i=1);const r=Mt(e,t,i);if(0===r)throw"#N/A";return r},XMATCH:function(e,t,n,i){const r=Mt(e,t,n);if(0===r)throw"#N/A";return r},CHOOSE:function(e,...t){let n=s(e);if(t.length>1&&"number"==typeof n){if(t.length<n)throw"the index number is greater than the length of the array of values";if(n<=0)throw"index cannot be less than or equal to 0";return n--,t[n]}}};var Dt=Object.freeze({__proto__:null,IF:function(e,t,n){return e?t:n},AND:function(...e){for(let t=0;t<e.length;t++)if(!c(e[t]))return!1;return!0},NOT:function(e){return!c(e)},OR:function(...e){for(let t=0;t<e.length;t++)if(e[t])return!0;return!1},FALSE:function(){return!1},TRUE:function(){return!0}}),qt=Object.freeze({__proto__:null,ISBLANK:function(e){return u(e)},ISBINARY:function(e){return/^[01]{1,10}$/.test(`${e}`)},ISEVEN:function(e){const t=s(e);return"number"==typeof t&&t%2==0},ISODD:function(e){const t=s(e);return"number"==typeof t&&t%2!=0},ISNONTEXT:function(e){return"string"!=typeof e},ISNUMBER:function(e){return"number"==typeof s(e)},ISTEXT:function(e){return"string"==typeof e},N:function(e){const t=s(e);if("number"==typeof t)return t;const n=new Date(e);return n.getTime()?a(n):"TRUE"===e||!0===e?1:0}});const zt={SUM:ke,AVERAGE:Te,AVERAGEA:Ie,COUNT:Ve,COUNTA:Ne,MIN:Oe,MAX:Me,SQRT:We,POWER:je,LOG:ot,EXP:mt,PRODUCT:De,SUMPRODUCT:qe,ABS:Xe,RAND:Ye,RANDBETWEEN:at,ROUND:Ke,ROUNDUP:Ze,ROUNDDOWN:Qe,INT:Ge,CEILING:et,FLOOR:rt},Pt={CONCATENATE:g,MID:v,LEFT:m,RIGHT:p,LOWER:b,UPPER:w,PROPER:_,TRIM:x,LEN:y,SEARCH:E,FIND:S,REPLACE:R,SUBSTITUTE:$,NOW:F},Ft={DATE:V,TIME:N,YEAR:D,MONTH:O,DAY:M,HOUR:q,MINUTE:z,SECOND:P,DATEDIF:U},Ut=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},zt),Pt),Ft),Ot),qt),Dt),Lt=Object.assign({},Ut),Bt=()=>Object.keys(Lt);function Ht(e){Object.assign(Lt,e)}function jt(e,t,n,i,r,o){const[a,s,l]=te(e),[u,c,h]=te(i);return!(l!==h||a>=u+r||a+t<=u||s>=c+o||s+n<=c)}Object.assign({},zt),Object.assign({},Pt),Object.assign({},Ft);const Wt=Math.pow(10,8);function Xt(e,t,n){n.add?e.has(t)||n.add(t):e.add(t)}function Yt(e){if(e.keys)return Array.from(e.keys());const t=[];return e.forEach(((e,n)=>t.push(n))),t}function Gt(e){if(e.values)return e.values();const t=[];e.forEach(((e,n)=>t.push(n)));let n=0;return{add:e=>{t.push(e)},next:()=>{const e=t[n];return n++,{done:n>t.length,value:e}}}}class Kt{constructor(e){(e=e||{get:null,set:null,strict:!1})&&(this._getter=e.get,this._setter=e.set,this._strict=e.strict),this._parser=xe,this._printer=Se,this._parseContext={name:function(){},pageName:()=>"",pageObj:()=>null,page:function(){return 0},z:0},this.$count=0,this._data=new Map,this._triggers=new Map,this._holders={},this._context={a:(e,t,n)=>(e.$width=t,e.$height=n,e),v:e=>{if(-1===e)throw new Error;const t=this._getter(e);return void 0===t?null:t},r:(e,t)=>{const[n,i]=te(e),[r,o]=te(t),a=r-n,s=o-i+1,l=[];l.$width=s,l.$height=a+1;for(let t=0;t<=a;t++)for(let n=0;n<s;n++)l[t*s+n]=this._getter(e+64*n+4096*t*64);return l},m:Lt,e:e=>{throw e},p:e=>this.getPlaceholder(e)}}getTriggerList(e){return this._triggers.get(e)}setValue(e,t,n,i){""===t&&(t=null),this._removeTriggers(e,null),this._setter(e,t,n)&&(i||this.trigger(e))}clean(e){this._removeTriggers(e,null)}getValue(e){return this._getter(e)}getMeta(){return this._meta}setMeta(e){this._meta=Object.assign(Object.assign({},this._meta),e)}setPlaceholder(e,t){"*"===e?Object.entries(t).forEach((e=>this.setPlaceholder(e[0],e[1]))):(null===t?delete this._holders[e]:this._holders[e]=t,this.each(((t,n)=>{(function(e,t,n){for(let i=0;i<e.length;i+=3)if(2===e[i]&&t.substr(e[i+1],e[i+2])==n)return!0;return!1})(n.code,n.source,e)&&this.setMath(t,n.source,this._parseContext)})))}getPlaceholder(e){if("*"===e)return this._holders;const t=this._holders[e];return void 0===t?null:t}setMath(e,t,n,i){const r=this._generate(t,n),o=this._setMathAt(e,r);i||this._execAndTrigger(o)}refresh(e){this._execAndTrigger(e)}getMath(e){return this._data.get(e)}trigger(e,t){const n=this._triggers.get(e);if(n){const e=!t;t||(t=new Set);for(let e=0;e<n.length;e++)t.add(n[e]);e&&this.triggerSet(t)}return null}triggerSet(e){const t=new Map;for(;e.size;){const n=Gt(e);let i=!1;e:for(let r=n.next();!r.done;r=n.next()){const n=this._data.get(r.value);let o=t.get(r.value);if(o&&(1==o&&(o=this._check_for_loops(r.value,n.triggers,t)),2==o))continue;const a=n.triggers;if(a)for(let t=0;t<a.length;t++)if(e.has(a[t]))continue e;this._execAndTrigger(r.value,e),o||t.set(r.value,1),e.delete(r.value),i=!0}if(!i)return void e.forEach((t=>this._errorAndTrigger(t,e)))}}getStats(){return{math:this._data.size,trigger:this._triggers.size}}_check_for_loops(e,t,n){const i=new Set;t.forEach((e=>i.add(e)));const r=Gt(i);for(let t=r.next();!t.done;t=r.next()){if(t.value==e)return n.set(e,2),2;const o=n.get(t.value);if(o&&o>1)return n.set(e,o),o;const a=this._data.get(t.value);a&&a.triggers&&a.triggers.forEach((e=>Xt(i,e,r)))}return n.set(e,3),3}_setMathAt(e,t){if(this._removeTriggers(e,t)){if(t.triggers)if(-1===t.triggers.indexOf(e)&&3!==t.broken)for(let n=0;n<t.triggers.length;n++){const i=t.triggers[n];let r=this._triggers.get(i);void 0===r&&(r=[],this._triggers.set(i,r)),r.push(e)}else t=Object.assign(Object.assign({},t),{broken:3});return this._data.set(e,t),e}}_removeTriggers(e,t){const n=this._data.get(e);if(!n)return!0;if(n===t)return!1;n.$width&&this._clearArea(e,!1);const i=n.triggers;if(i&&3!==n.broken)for(let t=0;t<i.length;t++){const n=i[t],r=this._triggers.get(n);if(r){const t=r.filter((t=>t!==e));t.length?this._triggers.set(n,t):this._triggers.delete(n)}}return this._data.delete(e),!0}parse(e,t){return this._parser(e,t||this._parseContext)}exec(e,t){const n=this._generate(e,t);return this._exec(n)}each(e){Yt(this._data).forEach((t=>e(t,this._data.get(t))))}setLogger(e){this._err_handler=e}_setErr(e,t){return e.broken=2,t&&this._err_handler&&this._err_handler(t),J[e.broken]}_exec(e){if(e.broken>0&&2!==e.broken)return J[e.broken];try{const t=e.exec(this._context);return e.broken=0,"number"==typeof t?isFinite(t)?Math.round(t*Wt)/Wt:this._setErr(e):t}catch(t){return this._setErr(e,t)}}toString(e,t){return ae(e,t||this._parseContext)}regenerate(e,t,n){n=Object.assign({},n||this._parseContext),Yt(this._data).forEach((i=>{let r=!1;const o=this._data.get(i),a=ie(i);if(t&&a===e)this._removeTriggers(i,null);else{for(let t=0;t<o.code.length;t+=3)if(9===o.code[t]&&ie(o.code[t+1])===e){r=!0;break}r&&(n.z=a,t?this.setMath(i,o.source,n):(o.source=ae(o,n),o.code=this._parser(o.source,n).code))}}))}recalculate(e,t){t=Object.assign({},t||this._parseContext);const n=new Set;this.each((i=>{if(e){const e=this._data.get(i);if(e.broken&&2!==e.broken)return t.z=ie(i),void this.setMath(i,e.source,t)}n.add(i)})),this.triggerSet(n)}_generate(e,t,n){const i=n||this._parser(e,t||this._parseContext);return this._printer(i,this._strict),i.triggers=function(e){let t=[];const n=e.code,i=n.length;for(let e=0;e<i;e+=3)switch(n[e]){case 7:case 6:{const i=n[e+4];t.push(i);break}case 8:re(n[e+4],n[e+7],(e=>t.push(e)))}if(t.length>10){const e=new Set;t=t.filter((t=>!e.has(t)&&(e.add(t),!0)))}return t.length?t:null}(i),i}_execAndTrigger(e,t){this.$count+=1;const n=this._data.get(e);if(n){const i=this._exec(n);if(Array.isArray(i)&&63!==ie(e))return void this._complexSetter(e,i,t);this._setter(e,i,2)&&this.trigger(e,t)}}_complexSetter(e,t,n){const{$width:i,$height:r}=t,o=this._data.get(e);o.$width=i,o.$height=r;try{oe(e,i,r,((i,r)=>{this._setter(i,t[r],2,0===r?null:e)&&this.trigger(i,n)}))}catch(t){this._clearArea(e,!0)}}_clearArea(e,t){const{$width:n,$height:i}=this._data.get(e);oe(e,n,i,((n,i)=>{0===i&&t?this._setter(n,J[4],1)&&this.trigger(n):(t?this._setter(n,null,3,e):this._setter(n,null,3,-1))&&this.trigger(n)}))}_errorAndTrigger(e,t){const n=this._data.get(e),i=this._setErr(n);this._setter(e,i,2)&&this.trigger(e,t)}debug(e,t=!1){const n=function(e){const t=e.code,n=e.source;let i="";const r=t.length;for(let e=0;e<r;e+=3){const r=t[e];let o;switch(r){case 4:o="method";break;case 1:o="text";break;case 5:o="page";break;case 2:o="holder";break;case 6:o="name";break;case 7:o="arg";break;case 8:o="range";break;case 9:o="data";break;case 10:o="op";break;case 11:o="number";break;case 3:o="error";break;case 12:o="extra";break;case 13:o="arr"}i+=9===r?`            ${t[e+1]}.${t[e+2]}\n`:13===r?`[${o}]${ye(o)}${t[e+1]} x ${t[e+2]}\n`:`[${o}]${ye(o)}${n.substr(t[e+1],t[e+2])}\n`}return i}(this.parse(e));if(t)return n;console.log(n)}transpose(e,t,n,i){i=i||this._parseContext;const[r,o,a]=te(e),s=new Map,l=new Map,u=new Set;Yt(this._data).forEach((e=>{const[c,h,d]=te(e),f=this._data.get(e),g=d===i.z?i:Object.assign(Object.assign({},i),{z:d}),m=this._transpose(f,r,o,t,n,i,g);let v=e;if(d===a&&(h>=o||c>=r)&&(v=ee(c>=r?c+t:c,h>=o?h+n:h,d)),f!==m||e!==v){if(l.set(e,m),d===a&&(n<0&&h>=o&&h<o-n||t<0&&c>=r&&c<r-t))return;s.set(v,m),f.broken!==m.broken&&u.add(v)}})),Yt(s).forEach((e=>this._setMathAt(e,s.get(e)))),Array.from(l.keys()).forEach((e=>{s.has(e)||this._removeTriggers(e,null)})),t>0&&this._triggerRow(r,t,u),n>0&&this._triggerColumn(o,n,u),t<0&&this._triggerColumn(r-1,2,u),n<0&&this._triggerColumn(o-1,2,u),this.triggerSet(u)}_triggerColumn(e,t,n){const i=t?e+t:e;Yt(this._triggers).forEach((t=>{const r=function(e){return e>>6&4095}(t);r>=e&&r<i&&this.trigger(t,n)}))}_triggerRow(e,t,n){const i=t?e+t:e;Yt(this._triggers).forEach((t=>{const r=ne(t);r>=e&&r<i&&this.trigger(t,n)}))}moveMath(e,t,n,i,r,o,a){return"string"==typeof e&&(e=this.parse(e,o)),this._moveMath(e,t,n,i,r,a||o).source}_moveMath(e,t,n,i,r,o){const a=e.code;for(let e=0;e<a.length;e+=3)if(7===a[e]){let[o,s]=te(a[e+4]);jt(r.id,r.h,r.w,a[e+4],1,1)&&(o+=t,s+=n,a[e+4]=ee(o,s,i)),e+=3}else if(8===a[e]){let[o,s]=te(a[e+4]),[l,u]=te(a[e+7]);jt(r.id,r.h,r.w,a[e+4],l-o+1,u-s+1)&&(o+=t,s+=n,l+=t,u+=n,a[e+4]=ee(o,s,i),a[e+7]=ee(l,u,i)),e+=6}let s={code:a,broken:e.broken,source:e.source,triggers:null,exec:null};return s=this._parser(ae(s,o),o),this._generate(s.source,o,s)}transposeMath(e,t,n,i){return"string"==typeof e&&(e=this.parse(e,i)),i=i||this._parseContext,this._transpose(e,-1,-1,t,n,i,i).source}_transpose(e,t,n,i,r,o,a){let s=!0,l=e.code;const u=!(t<0||n<0);for(let e=0;e<l.length;e+=3)if(7===l[e]){let[a,c,h]=te(l[e+4]);if(o.z!==h)continue;const d=l[e+5];if(!u&&3==d)continue;(u||!(1&d))&&0!==i&&a>=t&&(s&&(l=[].concat(l),s=!1),a+=i,(a<t||a<0)&&(l[e]=3)),(u||!(2&d))&&0!==r&&c>=n&&(s&&(l=[].concat(l),s=!1),c+=r,(c<n||c<0)&&(l[e]=3)),s||(l[e+4]=ee(a,c,h)),e+=3}else if(8===l[e]){const a=l[e+5],c=l[e+8];if(!u&&3===a&&3===c)continue;let[h,d,f]=te(l[e+4]),[g,m]=te(l[e+7]);if(o.z!==f)continue;0!==i&&((u||!(1&a))&&(i>0?h>=t:h>t)&&(s&&(l=[].concat(l),s=!1),h+=i,h<0&&(l[e]=3)),(u||!(1&c))&&g>=t&&(s&&(l=[].concat(l),s=!1),g+=i,g<h&&(l[e]=3))),0!==r&&((u||!(2&a))&&(r>0?d>=n:d>n)&&(s&&(l=[].concat(l),s=!1),d+=r,d<0&&(l[e]=3)),(u||!(2&c))&&m>=n&&(s&&(l=[].concat(l),s=!1),m+=r,m<d&&(l[e]=3))),s||(l[e+4]=ee(h,d,f),l[e+7]=ee(g,m,f)),e+=6}if(s)return e;let c={code:l,broken:e.broken,source:e.source,triggers:null,exec:null};return c=this._parser(ae(c,a),a),this._generate(c.source,a,c)}}class Qt{constructor(e,t,n){this._id=e,this._store=t,this._meta={},this._parseContext=Object.assign(Object.assign({},n),{z:e}),this.reset(),this._parseMode=!1}reset(){this._data=[],this._rows=[],this._cols=[],this._spans=[]}getMeta(){return this._meta}setMeta(e){this._meta=Object.assign(Object.assign({},this._meta),e)}getID(){return this._id}cellID(e,t){return ee(e,t,this._id)}getSize(){const e=this._data.length;let t=0;return this._data.forEach((e=>{e&&e.length>t&&(t=e.length)})),[e,t]}getContext(){return this._parseContext}addRow(e,t){this._data.splice.apply(this._data,Zt(e,t)),this._store.transpose(ee(e,0,this._id),t,0,this._parseContext),this._rows.splice.apply(this._rows,Zt(e,t)),this._recalculateSpans(e,t,0)}removeRow(e,t){return this._data.splice(e,t),this._store.transpose(ee(e,0,this._id),-t,0,this._parseContext),this._rows.splice(e,t),this._recalculateSpans(e,-t,0)}addColumn(e,t){const n=Zt(e,t);this._data.forEach((e=>{e&&e.splice.apply(e,n)})),this._store.transpose(ee(0,e,this._id),0,t,this._parseContext),this._cols.splice.apply(this._cols,Zt(e,t)),this._recalculateSpans(e,0,t)}removeColumn(e,t){this._data.forEach((n=>{n&&n.splice(e,t)})),this._store.transpose(ee(0,e,this._id),0,-t,this._parseContext),this._cols.splice(e,t),this._recalculateSpans(e,0,-t)}setCell(e,t,n){let i=this._data[e];i||(i=this._data[e]=[]);const r=i[t];i[t]=r?Object.assign(Object.assign(Object.assign({},r),n),{value:r.value}):n,void 0!==n.value&&this.setValue(e,t,n.value)}clearCell(e,t){const n=this._data[e];n&&n[t]&&(n[t]=null,this._store.setValue(ee(e,t,this._id),""))}setValue(e,t,n,i){const r=ee(e,t,this._id);"string"==typeof n&&n.length>1&&"="===n[0]?this._store.setMath(r,n.substr(1),this._parseContext):this._store.setValue(r,n,i)}getCell(e,t,n){let i=this._data[e],r=i?i[t]:null;return r||!n||(i||(i=this._data[e]=[]),r=i[t],r||(r=i[t]={value:null})),r}getValue(e,t,n){if(n){const n=this._store.getMath(ee(e,t,this._id));if(n)return"="+n.source}const i=this.getCell(e,t,!1);return i?i.value:null}getRange(e,t,n,i){const r=[];for(let o=e;o<=n;o++)for(let e=t;e<=i;e++)r.push(this.getValue(o,e,!1));return r}getCellRange(e,t,n,i){const r=[];for(let o=e;o<=n;o++)for(let e=t;e<=i;e++)r.push(this.getCell(o,e));return r}eachCell(e){this._data.forEach(((t,n)=>{t&&t.forEach(((t,i)=>{t&&e(n,i,t)}))}))}serialize(e){const t=[];return this.eachCell(((n,i,r)=>{if(r=Object.assign({},r),e){const e=this._store.getMath(ee(n,i,this.getID()));e&&(r.value="="+e.source)}t.push([n,i,r])})),t}parse(e,t){this.reset(),this._store.each((e=>{ie(e)===this._id&&this._store.clean(e)})),this.parseBlock(e,t,!0)}parseBlock(e,t,n){const i=new Set;this._parseMode=!0,e.forEach((([e,r,o])=>{const a=ee(e,r,this._id);n||this._store.clean(a);let s=this._data[e];s||(s=this._data[e]=[]);const l=(o=s[r]=Object.assign({},o)).value;if(l)if("string"==typeof l&&l.length>1&&"="===l[0]){const e=l.substr(1);this._store.setMath(a,e,this.getContext(),!0),i.add(a)}else t&&(o.value=null,this._store.setValue(a,l,null,!0),this._store.trigger(a,i))})),this._store.triggerSet(i),this._parseMode=!1}throwError(e){if(!this._parseMode)throw e}setRowMeta(e,t){const n=this._rows[e]||{};this._rows[e]=n?Object.assign(Object.assign({},n),t):t}getRowMeta(e,t){const n=this._rows[e];if(t&&!n){const t={};return this._rows[e]=t,t}return n||null}setColumnMeta(e,t){const n=this._cols[e]||{};this._cols[e]=n?Object.assign(Object.assign({},n),t):t}getColumnMeta(e,t){const n=this._cols[e];if(t&&!n){const t={};return this._cols[e]=t,t}return n||null}sort(e,t,n=0,i="asc"){const[r,o]=te(e),[a,s]=te(t),l="asc"===i,u=[],c=[];for(let e=r;e<=a;e++){const t=[];for(let n=o;n<=s;n++){const i=this._store.getMath(this.cellID(e,n));t.push({value:this.getValue(e,n),row:e,math:i||null})}u.push(t)}u.sort(((e,t)=>{const i=e[n].value,r=t[n].value;return"string"==typeof i&&"string"==typeof r||"number"==typeof i&&"number"==typeof r?i<r?l?-1:1:i>r?l?1:-1:0:"number"==typeof i?-1:1}));for(let e=r;e<=a;e++)for(let t=o;t<=s;t++){const n=u[e-r][t-o];if(n.math){const t=n.row-e,i=this._store.transposeMath(n.math,-t,0,this._parseContext);n.value=`=${i}`}c.push([e,t,{value:n.value}])}this.parseBlock(c)}addSpan(e,t,n){let i;if(!(t>1||n>1))return i=this._spans.findIndex((t=>t.id===e)),void(-1!==i&&this._spans.splice(i,1));for(let i=0;i<=this._spans.length-1;i++){const r=this._spans[i];jt(e,t,n,r.id,r.info.width,r.info.height)&&this._spans.splice(i,1)}this._spans.push({id:e,info:{width:t,height:n}})}getSpan(e){return this._spans.find((t=>t.id===e))||null}getSpans(){return this._spans}_recalculateSpans(e,t,n){if(this._spans.length)for(let i=this._spans.length-1;i>=0;i--){const r=this._spans[i];let{height:o,width:a}=r.info,[s,l]=te(r.id);t&&([s,o]=this._adjustSpan(s,o,e,t)),n&&([l,a]=this._adjustSpan(l,a,e,n)),a<1||o<1||a+o<=2?this._spans.splice(i,1):(r.id=ee(s,l,this._id),r.info.height=o,r.info.width=a)}}_adjustSpan(e,t,n,i){const r=e+t;if(i<0){const o=n+(i=-i);n>e?n<=r&&(t-=Math.min(i,e+t-n)):o>e?(t-=o-e,e=i-(o-e)):e-=i}else n<=e?e+=i:n<=r&&(t+=i);return[e,t]}}function Zt(e,t){const n=[e,0];for(let e=0;e<t;e++)n.push(null);return n}class Jt{constructor(e,t,n){this._ranges=new Map,this._counter=1,this._rangeOrder=[],this._store=e,this._page=t,this._pageGetter=n}get(e){return this._store.getMath(this._ranges.get(e))}toId(e){return this._ranges.get(e)}add(e,t){const n=this._ranges.get(e)||this._next_id();this._store.setMath(n,t,this._page.getContext()),this._ranges.set(e,n),this._refresh(e)}remove(e){this._ranges.delete(e),this._counter=1,this._refresh(e)}serialize(){return Array.from(this._ranges.keys()).map((e=>[e,this.get(e).source]))}parse(e){e.forEach((e=>this.add(e[0],e[1])))}_refresh(e){const t=e.indexOf("!");let n="";-1!==t&&(n=e.substr(0,t),e=e.substr(t+1)),this._store.each(((t,i)=>{if(function(e,t,n,i){for(let r=0;r<e.length;r+=3)if(6===e[r]){if(""!==n){if(5===e[r-3]&&t.substr(e[r-2],e[r-1])!==n)continue;return!0}if(t.substr(e[r+1],e[r+2])===i)return!0}return!1}(i.code,i.source,n,e)){const e=ie(t);this._store.setMath(t,i.source,this._pageGetter(e).getContext())}}))}_next_id(){for(;this._rangeOrder[this._counter];)this._counter++;return this._rangeOrder[this._counter]=!0,ee(this._counter,0,this._page.getID())}renamePage(e,t){e+="!",t&&(t+="!"),this._ranges.forEach(((n,i,r)=>{0===i.indexOf(e)&&(t?r.set(i.replace(e,t),n):this._store.clean(n),r.delete(i))}))}}class en{constructor(e,t){this._store=e,this._pageGetter=t}copy(e,t){t||(t=e);const n=this._serialize(e,t);return this._store.setMeta({$clipboard:n}),n}paste(e,t,n,i,r=this._updateCurrentCell){var o;if(i=i||0,!(null===(o=n=n||this._store.getMeta().$clipboard)||void 0===o?void 0:o.data.length))return;const[a,s,l]=te(e),[u,c]=te(t),h=this._pageGetter(l),[d,f]=te(n.from||0),g=n.data,m=[],v=a-d,p=s-f;if(0===i){const e=g[0].length-1;for(let t=0;t<=g.length-1;t++)for(let n=0;n<=e;n++){const e=g[t][n],i=a+t,o=s+n,u=this._updateCell(i,o,l,e,v,p,r);u&&m.push(u)}}if(1===i)for(let e=a;e<=u;e++)for(let t=s;t<=c;t++){const n=t-s,i=g[e-a][n],o=this._updateCell(e,t,l,i,v,p,r);o&&m.push(o)}if(2===i){let e=0;for(let t=a;t<=u;t++){let n=0;e===g.length&&(e=0);for(let i=s;i<=c;i++){n===g[0].length&&(n=0);const o=g[e][n],a=t-(d+e),s=i-(f+n),u=this._updateCell(t,i,l,o,a,s,r);u&&m.push(u),n++}e++}}h.parseBlock(m)}clean(e,t,n){n=n||255;const[i,r,o]=te(e),[a,s]=te(t),l=this._pageGetter(o),u=[],c=[];for(let e=i;e<=a;e++)for(let t=r;t<=s;t++){const i=l.getCell(e,t),r=ee(e,t,o),a=255===n?{}:Object.assign({},i);if(1&n){const e=this._store.getTriggerList(r);e&&c.push(...e),delete a.value}u.push([e,t,a])}l.parseBlock(u),this._refreshRelatedFormulas(c)}_refreshRelatedFormulas(e){tn(e).forEach((e=>this._store.refresh(e)))}_serialize(e,t){const[n,i,r]=te(e),[o,a]=te(t),s=this._pageGetter(r),l={from:e,data:[]};for(let e=n;e<=o;e++){const t=[];for(let n=i;n<=a;n++){const i=s.getCell(e,n),o=this._store.getMath(ee(e,n,r));let a;o&&(a=o.source);const l=[i?Object.assign({},i):null];a&&l.push(a),t.push(l)}l.data.push(t)}return l}reset(){this._store.setMeta({$clipboard:null})}move(e,t){const{data:n,from:i}=t||this._store.getMeta().$clipboard,[r,o,a]=te(i),s=n.length,l=n[0].length,[u,c,h]=te(e),d=[],f=[],g=this._pageGetter(h),m={id:i,h:s,w:l};for(let e=0;e<s;e++)for(let t=0;t<l;t++){const v=n[e][t],[p,b]=v,w=ee(r+e,o+t,a),_=this._store.getTriggerList(w);if(_){const e=this._getTriggersOutsideCutRange(_,i,s,l);e.length&&d.push(...e)}const x=u+e,y=c+t;if(p){if(b){const e=this._pageGetter(a).getContext(),t=this._store.moveMath(b,u-r,c-o,h,m,e,g.getContext());p.value=`=${t}`}f.push([x,y,p])}else f.push([x,y,{}])}g.parseBlock(f),this._updateRelatedFormulas(d,u-r,c-o,h,m)}_updateRelatedFormulas(e,t,n,i,r){tn(e).forEach((e=>{const[,,o]=te(e),a=this._store.getMath(e),s=this._pageGetter(o).getContext(),l=this._store.moveMath(a,t,n,i,r,s);this._store.setMath(e,l,s)}))}_getTriggersOutsideCutRange(e,t,n,i){const r=[];return e.forEach((e=>{jt(t,n,i,e,1,1)||r.push(e)})),r}_updateCell(e,t,n,i,r,o,a){const[s,l]=i,u=this._pageGetter(n),c=s?Object.assign({},s):{value:null};c.formula=l?`=${this._store.transposeMath(l,r,o)}`:null;const h=a(u.getCell(e,t)||{},c);return h?[e,t,h]:null}_updateCurrentCell(e,t){return t.formula&&(t.value=t.formula),t}fromCSV(e,t="\n",n="\t"){return{data:e.split(t).map((e=>e.split(n).map((e=>[{value:e}]))))}}}function tn(e){const t=new Set(e);return Array.from(t)}class nn{constructor(e){this._cfg=e||{strict:!1},this._pages=[],this._pageNames=[],this._pageName2ID=new Map,this._pCounter=0,this._parseContext={page:e=>this._pageName2ID.get(e),pageName:e=>this._pageNames[e],pageObj:e=>this._pages[e],name:(e,t,n)=>{const i=e.length,r=t.substr(e[i-2],e[i-1]);let o;if(5===e[i-6]){const n=t.substr(e[i-5],e[i-4]);o=this._ranges.toId(n+"!"+r)||this._ranges.toId(r)}else o=this._ranges.toId(n.pageName(n.z)+"!"+r)||this._ranges.toId(r);e.push(9,o||-1,0)},z:0};const t=this._store=new Kt(Object.assign(Object.assign({},this._cfg),{get:e=>{const[t,n,i]=te(e);return this._pages[i].getValue(t,n)},set:(e,n,i,r)=>{const[o,a,s]=te(e),l=this._pages[s].getCell(o,a,!0),u=r?null:"number"==typeof l.spill?l.spill:n||0===n?l.source:null;if(3===i){if(r>=0&&(l.spill=r,l.source!==r))return!1;l.source=r=null}else if(null===n&&!r&&l.source)return!1;r&&e!==r&&l.source!==r&&(l.value||0===l.value||"number"==typeof l.source&&l.source!==r)&&this._pages[s].throwError("spill error"),l.source!==r&&(l.source=r);const c=2===i||3===i;if((null==i||c)&&(i=l.$format||0),l.$format=i,"string"==typeof n&&1!=i&&n){let e=parseFloat(n);c&&(e=e.toString()),e==n&&(n=parseFloat(n))}const h=l.value!==n;return h&&(l.value=n),"number"==typeof u&&t.triggerSet(new Set([u])),h}})),n=this._pages[63]=new Qt(63,this._store,this._parseContext);this._ranges=new Jt(this._store,n,this.getPage.bind(this)),this._cm=new en(this._store,this.getPage.bind(this))}addPage(e){for(;this._pages[this._pCounter];)this._pCounter++;const t=this._pCounter,n=new Qt(t,this._store,this._parseContext);return this._pageName2ID.set(e,t),this._pages[t]=n,this._pageNames[t]=e,n}renamePage(e,t){if(e===t)return;const n=this._pageName2ID.get(e);this._pageName2ID.delete(e),this._pageName2ID.set(t,n),this._pageNames[n]=t,this._ranges.renamePage(e,t);const i=this._pages[n].getContext();this._store.regenerate(n,!1,i)}removePage(e){const t=this._pageName2ID.get(e),n=this._pages[t].getContext();this._pageName2ID.delete(e),this._pages[t]=this._pageNames[t]=null,this._pCounter=0,this._ranges.renamePage(e,null),this._store.regenerate(t,!0,n)}getPage(e){return"string"==typeof e&&(e=this._pageName2ID.get(e)),this._pages[e]}getRanges(){return this._ranges}getStore(){return this._store}find(e,{firstOnly:t,resultsLimit:n=100}){const i=[];return this._pages.forEach(((r,o)=>{r.eachCell(((r,a,s)=>{const l=s.value;e(l)&&(t&&0===i.length||!t&&i.length<n)&&i.push({id:ee(r,a,o),value:l})}))})),i}getCopyManager(){return this._cm}}var rn={labels:{common:"Common",currency:"Currency",number:"Number",percent:"Percent",date:"Date",string:"Text","custom-format":"Custom","decimal-places":"Decimal places",separator:"Group separator",negative:"Negative number","currency-symbol":"Сurrency","date-format":"Date format","format-docs":"How to create a format","undo-redo":"Undo/Redo",font:"Font",text:"Text",cell:"Cell",align:"Align",format:"Number",column:"Column",borders:"Borders",px:"px",apply:"Apply",cancel:"Cancel",save:"Save",sheet:"Sheet","conditional-format":"Conditional Format","conditional-common":"Common","conditional-text":"Text",condition:"Condition","conditional-style":"Style","conditional-operator":"Operator","conditional-between":"between","conditional-not-equal":"not equal",range:"Range","range-title":"Named ranges","range-name":"Name","range-cells":"Range","range-scope":"Scope","range-global":"Book","image-or":"or","image-title":"Add image","image-upload":"Select file for upload","image-url":"URL (e.g. http://*)","sparkline-title":"Add sparkline","sparkline-type":"Type","sparkline-range":"Range","sparkline-color":"Color","sparkline-positive":"Positive","sparkline-negative":"Negative","format-title":"Set format","format-pattern":"Format pattern","dropdown-empty":"Empty cells","dropdown-empty-option":"Empty option","dropdown-title":"Add dropdown","dropdown-range":"Range",ok:"OK","import-title":"Import","import-not-support":"Sorry, your browser does not support import","export-title":"Export","export-name":"Name of xslx file","export-all-sheets":"Export all sheets","link-title":"Add Link","link-name":"Text","link-url":"URL",image:"Image","add-image-cell":"Add to cell","add-image-top":"Add above cells",graph:"Graph","add-sparkline":"Add to cell","add-chart":"Add above cells",controls:"Controls","add-checkbox":"Add checkbox","add-radio":"Add radio group",display:"Display",value:"Value","range-remove-confirm":"Are you sure you want to remove the range permanently?","sheet-remove-confirm":"Are you sure you want to remove the sheet permanently?","merge-cell-confirm":"Only the left top value will remain after merging. Continue?","error-range":"The range is incorrect!","error-link":"The link is incorrect!",print:"Print","print-title":"Before you print..","print-settings":"General settings","print-paper":"Paper size","print-layout":"Layout",sheets:"Sheets:",selection:"Selected cells",borderless:"Hide gridlines","sheet-names":"Show sheet names","skip-rows":"Skip empty rows",margin:"Hide margins","page-letter":"Letter","page-a4":"A4 (210x297mm)","page-a3":"A3 (297x420mm)","page-width":"Page width","page-actual":"Actual Size","page-portrait":"Portrait","page-landscape":"Landscape","external-ui":"External UI","print-borders":"Show print borders",comment:"Comment",width:"Width",height:"Height","fit-content":"Fit to content","default-size":"Reset to default","edit-view":"Edit","remove-view":"Remove","chart-edit":"Edit chart","chart-common":"Common","chart-series":"Series","chart-extras":"Extras","export-view":"Download","export-view-pdf":"PDF document","export-view-png":"PNG image","export-view-excel":"Excel file","line-chart":"Line","area-chart":"Area","bar-chart":"Bar","donut-chart":"Donut","pie-chart":"Pie","radar-chart":"Radar","spline-chart":"Spline","splinearea-chart":"Spline Area","scatter-chart":"Scatter","chart-scale":"Scale","chart-x-axis":"X axis","chart-y-axis":"Y axis","chart-lines":"Lines","chart-scale-color":"Scale color","chart-xAxis-title":"Title","chart-yAxis-title":"Title","chart-col-xAxis":"Use left column as xAxis","chart-col-yAxis":"Use left column as yAxis","chart-row-xAxis":"Use top row as xAxis","chart-row-yAxis":"Use top row as yAxis","chart-xAxis-range":"Range","chart-yAxis-origin":"Origin","chart-yAxis-start":"Start","chart-yAxis-end":"End","chart-yAxis-step":"Step","chart-yAxis-note":"* Set all the following parameters to see the effect","chart-legend":"Legend","chart-row-legend":"Use top row as legend","chart-col-legend":"Use left column as legend","chart-legend-range":"Legend range","chart-legend-align":"Align","chart-legend-left":"Left","chart-legend-right":"Right","chart-legend-center":"Center","chart-legend-valign":"Vertical align","chart-legend-top":"Top","chart-legend-middle":"Middle","chart-legend-bottom":"Bottom","chart-item":"Data","stacked-chart":"Stacked","horizontal-chart":"Horizontal","chart-range":"Range","chart-series-color":"Color","add-line":"Add line","chart-type":"Type","chart-tooltip":"Tooltips","chart-label":"Labels","chart-data-from":"Data series from","chart-columns":"columns","chart-rows":"rows","chart-markers":"Markers","chart-markers-square":"Square","chart-markers-triangle":"Triangle","chart-markers-diamond":"Diamond","chart-markers-round":"Round","chart-pie-3d":"3D","chart-radar-circle":"Circled lines","add-cell-validation":"Add data validation","remove-cell-validation":"Remove data validation","highlight-invalid-data":"Highlight invalid data","remove-highlight-invalid-data":"Remove highlighting of invalid data","validation-placeholder-text":"Some text","validation-type":"Type","validation-any":"Any","validation-date":"Date","validation-number":"Number","validation-text":"Text","validation-text-length":"Text length","validation-range":"Range","validation-integer":"Integers only","validation-ignore-empty":"Ignore empty","validation-input-message":"Input message","validation-error-title":"Error title","validation-error-message":"Error message","validation-error-handle":"Error handle","validation-error-stop":"Stop","validation-error-warning":"Warning","validation-error-information":"Information","validation-error-title-text":"Error","validation-error-message-text":"Invalid data","validation-error-save":"Save","validation-error-restore":"Restore"},tooltips:{color:"Font color",background:"Background color","font-family":"Font family","font-size":"Font size","text-align":"Horizontal align","vertical-align":"Vertical align",borders:"Borders","borders-no":"Clear borders","borders-left":"Left border","borders-top":"Top border","borders-right":"Right border","borders-bottom":"Bottom border","borders-all":"All borders","borders-outer":"Outer borders","borders-top-bottom":"Top and bottom borders","borders-color":"Border color","align-left":"Left align","align-center":"Center align","align-right":"Right align","align-top":"Top align","align-middle":"Middle align","align-bottom":"Bottom align",span:"Merge",wrap:"Text wrap",undo:"Undo",redo:"Redo",format:"Number format","increase-decimals":"Increase decimal places","decrease-decimals":"Decrease decimal places","font-weight":"Bold","font-style":"Italic",underline:"Underline",strike:"Strike","hide-gridlines":"Hide/show gridlines","hide-headers":"Hide/show headers","show-formulas":"Hide/show formulas","print-borders":"Hide/show print borders","create-filter":"Create/remove filters","freeze-columns":"Freeze/unfreeze columns","add-range":"Set name for the selected range",conditional:"Conditional formatting","add-sheet":"Add Sheet","lock-cell":"Lock/unlock cell",clear:"Clear","add-link":"Add link",row:"Rows",column:"Columns",sheet:"Sheet","add-image":"Image","add-sparkline":"Graph","add-comment":"Comment","increase-indent":"Increase indent","decrease-indent":"Decrease indent",scale:"Scale","show-sheet":"Show sheet",validation:"Validation",controls:"Controls",graph:"Graph",image:"Image"},menus:{"remove-sheet":"Remove sheet","rename-sheet":"Rename sheet","hide-sheet":"Hide sheet",file:"File",new:"New","new-sheet":"New sheet","excel-import":"Import from Excel","excel-export":"Export to Excel",sheet:"Sheets","copy-sheet":"Copy to new sheet",edit:"Edit",undo:"Undo",redo:"Redo",columns:"Columns","insert-column":"Insert column","delete-column":"Delete column","show-column":"Show column","hide-column":"Hide column","resize-column":"Resize column",rows:"Rows","insert-row":"Insert row","delete-row":"Delete row","show-row":"Show row","hide-row":"Hide row","resize-row":"Resize row",insert:"Insert","conditional-format":"Conditional format",common:"common",text:"text",clear:"Clear","clear-value":"Values","clear-style":"Styles","clear-conditional-formats":"Conditional formats","clear-dropdown-editors":"Dropdowns","clear-filters":"Filters","clear-comments":"Comments","clear-all":"All",image:"Image","add-image-cell":"Add to cell","add-image-top":"Add above cells",graph:"Graph","add-sparkline":"Add to cell","add-chart":"Add above cells",controls:"Controls","add-checkbox":"Add checkbox","add-radio":"Add radio group",data:"Data","add-link":"Add link","add-range":"Named ranges",sort:"Sort","sort-asc":"Sort A to Z","sort-desc":"Sort Z to A",view:"View","freeze-columns":"Freeze/unfreeze columns","freeze-rows":"Freeze/unfreeze rows","hide-gridlines":"Hide/show gridlines","hide-headers":"Hide/show headers","show-formulas":"Hide/show formulas","create-filter":"Create/remove filters","add-dropdown":"Add dropdown","lock-cell":"Lock/unlock cell",print:"Print","print-borders":"Hide/show print borders","add-comment":"Comment",cut:"Cut",copy:"Copy",paste:"Paste","special-paste":"Special paste","paste-values":"Values","paste-formulas":"Formulas","paste-styles":"Styles","paste-conditions":"Conditional formats","paste-validation":"Validation","add-cell-validation":"Add data validation","remove-cell-validation":"Remove data validation","highlight-invalid-data":"Highlight invalid data","remove-highlight-invalid-data":"Remove highlighting of invalid data",validation:"Validation"},table:{"math-error":"#ERROR!","math-ref-error":"#REF!","format-error":"INCORRECT FORMAT"},liveEditor:{edit:"Edit:","functions-syntax":Object.assign({SUM:[["Number1","Required. The first value to sum."],["Number2","Optional. The second value to sum."],["Number3","Optional. The third value to sum."]],AVERAGE:[["Number1","Required. A number or cell reference that refers to numeric values."],["Number2","Optional. A number or cell reference that refers to numeric values."]],AVERAGEA:[["Value1","Required. A value or reference to a value that can be evaluated as a number."],["Value2","Optional. A value or reference to a value that can be evaluated as a number."]],COUNT:[["Value1","Required. An item, cell reference, or range."],["Value2","Optional. An item, cell reference, or range."]],COUNTA:[["Value1","Required. An item, cell reference, or range."],["Value2","Optional. An item, cell reference, or range."]],MIN:[["Number1","Required. Number, reference to numeric value, or range that contains numeric values."],["Number2","Optional. Number, reference to numeric value, or range that contains numeric values."]],MAX:[["Number1","Required. Number, reference to numeric value, or range that contains numeric values."],["Number2","Optional. Number, reference to numeric value, or range that contains numeric values."]],SQRT:[["Number","Required. The number to get the square root of."]],POWER:[["Number","Required. Number to raise to a power."],["Power","Required. Power to raise number to (the exponent)."]],LOG:[["Number","Required. Number for which you want the logarithm."],["Base","Optional. Base of the logarithm. Defaults to 10."]],EXP:[["Number","Required. The power that e is raised to."]],PRODUCT:[["Number1","Required. The first number or range to multiply."],["Number2","Optional. The second number or range to multiply."]],SUMPRODUCT:[["Array1","Required. The first array or range to multiply, then add."],["Array2","Optional. The second array or range to multiply, then add."]],ABS:[["Number","Required. The number to get the absolute value of."]],RAND:[],RANDBETWEEN:[["Bottom","Required. An integer representing the lower value of the range."],["Top","Required. An integer representing the upper value of the range."]],ROUND:[["Number","Required. The number to round."],["Num_digits","Required. The place at which number should be rounded."]],ROUNDUP:[["Number","Required. The number to round up."],["Num_digits","Required. The place at which number should be rounded."]],ROUNDDOWN:[["Number","Required. The number to round down."],["Num_digits","Required. The place at which number should be rounded."]],INT:[["Number","Required. The number from which you want an integer."]],CEILING:[["Number","Required. The number that should be rounded."],["Significance","Required. The multiple to use when rounding."]],FLOOR:[["Number","Required. The number that should be rounded."],["Significance","Required. The multiple to use when rounding."]],CONCATENATE:[["Text1","Required. The first text value to join together."],["Text2","Required. The second text value to join together."],["Text3","Optional. The third text value to join together."]],MID:[["Text","Required. The text to extract from."],["Start_num","Required. The location of the first character to extract."],["Num_chars","Required. The number of characters to extract."]],LEFT:[["Text","Required. The text from which to extract characters."],["Num_chars","Optional. The number of characters to extract, starting on the left side of text. Default = 1."]],RIGHT:[["Text","Required. The text from which to extract characters on the right."],["Num_chars","Optional. The number of characters to extract, starting on the right. Optional, default = 1."]],LOWER:[["Text","Required. The text that should be converted to lower case."]],UPPER:[["Text","Required. The text thatto convert to upper case."]],PROPER:[["Text","Required. The text that should be converted to proper case."]],TRIM:[["Text","Required. The text from which to remove extra space."]],LEN:[["Text","Required. The text for which to calculate length."]],SEARCH:[["Find_text","Required. The substring to find."],["Within_text","Required. The text to search within."],["Start_num","Optional. Starting position. Optional, defaults to 1."]],FIND:[["Find_text","Required. The substring to find."],["Within_text","Required. The text to search within."],["Start_num","Optional. The starting position in the text to search. Optional, defaults to 1."]],REPLACE:[["Old_text","Required. The text to replace."],["Start_num","Required. The starting location in the text to search."],["Num_chars","Required. The number of characters to replace."],["New_text","Required. The text to replace old_text with."]],SUBSTITUTE:[["Text","Required. The text to change."],["Old_text","Required. The text to replace."],["New_text","Required. The text to replace with."],["Instance","Optional. The instance to replace. If not supplied, all instances are replaced."]],NOW:[],DATE:[["Year","Required. Number for year."],["Month","Required. Number for month."],["Day","Required. Number for day."]],TIME:[["Hour","Required. The hour for the time you wish to create."],["Minute","Required. The minute for the time you wish to create."],["Second","Required. The second for the time you wish to create."]],YEAR:[["Date","Required. A valid Excel date."]],MONTH:[["Serial_number","Required. A valid Excel date."]],DAY:[["Date","Required. A valid Excel date."]],HOUR:[["Serial_number","Required. A valid Excel time."]],MINUTE:[["Serial_number","Required. A valid date or time."]],SECOND:[["Serial_number","Required. A valid time in a format Excel recognizes."]],DATEDIF:[["Start_date","Required. Start date in Excel date serial number format."],["End_date","Required. End date in Excel date serial number format."],["Unit","Required. The time unit to use (years, months, or days)."]],LOOKUP:[["Lookup_value","Required. The value to search for."],["Lookup_vector","Required. The one-row, or one-column range to search."],["Result_vector","Optional. The one-row, or one-column range of results."]],HLOOKUP:[["Lookup_value","Required. The value to look up."],["Table_array","Required. The table from which to retrieve data."],["Row_index","Required. The row number from which to retrieve data."],["Range_lookup","Optional. A Boolean to indicate exact match or approximate match. Default = TRUE = approximate match."]],VLOOKUP:[["Lookup_value","Required. The value to look for in the first column of a table."],["Table_array","Required. The table from which to retrieve a value."],["Column_index_num","Required. The column in the table from which to retrieve a value."],["Range_lookup","Optional. TRUE = approximate match (default). FALSE = exact match."]],XLOOKUP:[["Lookup","Required. The lookup value."],["Lookup_array","Required. The array or range to search."],["Return_array","Required. The array or range to return."],["Not_found","Optional. Value to return if no match found."],["Match_mode","Optional. 0 = exact match (default), -1 = exact match or next smallest, 1 = exact match or next larger, 2 = wildcard match."],["Search_mode","Optional. 1 = search from first (default), -1 = search from last, 2 = binary search ascending, -2 = binary search descending."]],INDEX:[["Array","Required. A range of cells, or an array constant."],["Row_num","Required. The row position in the reference or array."],["Col_num","Optional. The column position in the reference or array."],["Area_num","Optional. The range in reference that should be used."]],MATCH:[["Lookup_value","Required. The value to match in lookup_array."],["Lookup_array","Required. A range of cells or an array reference."],["Match_type","Optional. 1 = exact or next smallest (default), 0 = exact match, -1 = exact or next largest."]],XMATCH:[["Lookup_value","Required. The lookup value."],["Lookup_array","Required. The array or range to search."],["Match_mode","Optional. 0 = exact match (default), -1 = exact match or next smallest, 1 = exact match or next larger, 2 = wildcard match."],["Search_mode","Optional. 1 = search from first (default), -1 = search from last, 2 = binary search ascending, -2 = binary search descending."]],CHOOSE:[["Index_num","Required. The value to choose. A number between 1 and 254."],["Value1","Required. The first value from which to choose."],["Value2","Optional. The second value from which to choose."]],ISBLANK:[["Value","Required. The value to check."]],ISBINARY:[["Value","Required. The value to check."]],ISEVEN:[["Value","Required. The numeric value to check."]],ISODD:[["Value","Required. The numeric value to check."]],ISNONTEXT:[["Value","Required. The value to check."]],ISNUMBER:[["Value","Required. The value to check."]],ISTEXT:[["Value","Required. The value to check."]],N:[["Value","Required. The value to convert to a number."]],IF:[["Logical_test","Required. A value or logical expression that can be evaluated as TRUE or FALSE."],["Value_if_true","Optional. The value to return when logical_test evaluates to TRUE."],["Value_if_false","Optional. The value to return when logical_test evaluates to FALSE."]],AND:[["Logical1","Required. The first condition or logical value to evaluate."],["Logical2","Optional. The second condition or logical value to evaluate."]],NOT:[["Logical","Required. A value or logical expression that can be evaluated as TRUE or FALSE."]],OR:[["Logical1","Required. The first condition or logical value to evaluate."],["Logical2","Optional. The second condition or logical value to evaluate."]],FALSE:[],TRUE:[],ACOS:[["Number","Required. The value to get the inverse cosine of. The number must be between -1 and 1 inclusive."]],ACOSH:[["Number","Required. Any real number equal to or greater than 1."]],ACOT:[["Number","Required. Number is the cotangent of the angle you want. This must be a real number."]],ACOTH:[["Number","Required. The absolute value of Number must be greater than 1."]],ADD:[["Number1","Required. The first value to sum."],["Number2","Required. The second value to sum."]],ARABIC:[["Roman_text","Required. The Roman numeral in text that you want to convert."]],ASIN:[["Number","Required. The value to get the inverse sine of. The number must be between -1 and 1 inclusive."]],ASINH:[["Number","Required. Any real number."]],ATAN:[["Number","Required. The value to get the inverse tangent of."]],ATAN2:[["X_num","Required. The x coordinate of the input point."],["Y_num","Required. The y coordinate of the input point."]],ATANH:[["Number","Required. Any real number between 1 and -1."]],AVEDEV:[["Number1","Required. First value or reference."],["Number2","Optional. Second value or reference."]],BASE:[["Number","Required. The number to convert to a given base."],["Radix","Required. The base to convert to."],["Min_length","Optional. The minimum string length to return, achieved by padding with zeros."]],BINOMDIST:[["Number_s","Required. The number of successes."],["Trials","Required. The number of independent trials."],["Probability_s","Required. The probability of success on each trial."],["Cumulative","Required. TRUE = cumulative distribution function, FALSE=probability mass function."]],"BINOM.INV":[["Trials","Required. The number of Bernoulli trials."],["Probability_s","Required. The probability of a success on each trial."],["Alpha","Required. The criterion value."]],"BINOM.DIST.RANGE":[["Trials","Required. The number of independent trials. Must be greater than or equal to 0."],["Probability_s","Required. The probability of success in each trial. Must be greater than or equal to 0 and less than or equal to 1."],["Number_s","Required. The number of successes in trials. Must be greater than or equal to 0 and less than or equal to Trials."],["Number_s2","Optional. If provided, returns the probability that the number of successful trials will fall between Number_s and number_s2. Must be greater than or equal to Number_s and less than or equal to Trials."]],"BINOM.DIST":[["Number_s","Required. The number of successes."],["Trials","Required. The number of independent trials."],["Probability_s","Required. The probability of success on each trial."],["Cumulative","Required. TRUE = cumulative distribution function, FALSE=probability mass function."]],BITAND:[["Number1","Required. A positive decimal number."],["Number2","Required. A positive decimal number."]],BITLSHIFT:[["Number","Required. The number to be bit shifted."],["Shift_amount","Required. The amount of bits to shift, if negative shifts bits to the right instead."]],BITOR:[["Number1","Required. A positive decimal number."],["Number2","Required. A positive decimal number."]],BITRSHIFT:[["Number","Required. The number to be bit shifted."],["Shift_amount","Required. The amount of bits to shift to the right, if negative shifts bits to the left instead."]],BITXOR:[["Number1","Required. A positive decimal number."],["Number2","Required. A positive decimal number."]],COMBIN:[["Number","Required. The total number of items."],["Number_chosen","Required. The number of items in each combination."]],COMBINA:[["Number","Required. The total number of items."],["Number_chosen","Required. The number of items in each combination."]],COMPLEX:[["Real_num","Required. The real number."],["I_num","Required. The imaginary number."],["Suffix",'Optional. The suffix, either "i" or "j".']],CORREL:[["Array1","Required. A range of cell values."],["Array2","Required. A second range of cell values."]],COS:[["Number","Required. The angle in radians for which you want the cosine."]],COSH:[["Number","Required. The hyperbolic angle."]],COT:[["Number","Required. The angle provided in radians."]],COTH:[["Number","Required."]],COUNTBLANK:[["Range","Required. The range in which to count blank cells."]],COVAR:[["Array1","Required. The first cell range of integers."],["Array2","Required. The second cell range of integers."]],"COVARIANCE.P":[["Array1","Required. The first cell range of integers."],["Array2","Required. The second cell range of integers."]],"COVARIANCE.S":[["Array1","Required. The first cell range of integers."],["Array2","Required. The second cell range of integers."]],CSC:[["Number","Required. The angle provided in radians."]],CSCH:[["Number","Required."]],DEC2BIN:[["Number","Required. The decimal number you want to convert to binary."],["Places","Optional. Pads the resulting binary number with zeros up to the specified number of digits. If omitted returns the least number of characters required to represent the number."]],DEC2HEX:[["Number","Required. The decimal number you want to convert to hexadecimal."],["Places","Optional. Pads the resulting number with zeros up to the specified number of digits. If omitted returns the least number of characters required to represent the number."]],DEC2OCT:[["Number","Required. The decimal number you want to convert to octal."],["Places","Optional. Pads the resulting octal number with zeros up to the specified number of digits. If omitted returns the least number of characters required to represent the number."]],DECIMAL:[["Number","Required. A text string representing a number."],["Radix","Required. The base of the number to be converted, an integer between 2-36."]],DEGREES:[["Angle","Required. Angle in radians that you want to convert to degrees."]],DELTA:[["Number1","Required. The first number."],["Number2","Optional. The second number."]],DEVSQ:[["Number1","Required. First value or reference."],["Number2","Optional. Second value or reference."]],DIVIDE:[["Number1","Required. The number we are dividing."],["Number2","Required. The number by which we divide."]],EQ:[["Number1","Required. First value or reference."],["Number2","Required. Second value or reference."]],ERF:[["Lower_limit","Required. The lower bound for integrating ERF."],["Upper_limit","Optional. The upper bound for integrating ERF. If omitted, ERF integrates between zero and lower_limit."]],ERFC:[["X","Required. The lower bound for integrating ERFC."]],EVEN:[["Number","Required. The number to round up to an even integer."]],FACT:[["Number","Required. The number to get the factorial of."]],FACTDOUBLE:[["Number","Required. A number greater than or equal to -1."]],FISHER:[["X","Required. A numeric value for which you want the transformation."]],FISHERINV:[["Y","Required. The value for which you want to perform the inverse of the transformation."]],GAMMA:[["Number","Required. Returns a number."]],GCD:[["Number1","Required. The first number."],["Number2","Optional. The second number."]],GEOMEAN:[["Number1","Required. First value or reference."],["Number2","Optional. Second value or reference."]],GESTEP:[["Number","Required. The value to test against step."],["Step","Optional. The threshold value. If you omit a value for step, GESTEP uses zero."]],GT:[["Number1","Required. First value or reference."],["Number2","Required. Second value or reference."]],GTE:[["Number1","Required. First value or reference."],["Number2","Required. Second value or reference."]],HARMEAN:[["Number1","Required. First value or reference."],["Number2","Optional. Second value or reference."]],HEX2BIN:[["Number","Required. The hexadecimal number you want to convert to binary."],["Places","Optional. Pads the resulting binary number with zeros up to the specified number of digits. If omitted returns the least number of characters required to represent the number."]],HEX2DEC:[["Number","Required. The hexadecimal number you want to convert to decimal."]],HEX2OCT:[["Number","Required. The hexadecimal number you want to convert to octal."],["Places","Optional. Pads the resulting binary number with zeros up to the specified number of digits. If omitted returns the least number of characters required to represent the number."]],IMABS:[["Inumber","Required. A complex number."]],IMAGINARY:[["Inumber","Required. A complex number."]],IMCONJUGATE:[["Inumber","Required. A complex number for which you want the conjugate."]],IMCOS:[["Inumber","Required. A complex number for which you want the cosine."]],IMCOSH:[["Inumber","Required. A complex number for which you want the hyperbolic cosine."]],IMCOT:[],IMCSC:[["Inumber","Required. A complex number for which you want the cosecant."]],IMCSCH:[["Inumber","Required. A complex number for which you want the hyperbolic cosecant."]],IMDIV:[["Inumber1","Required. The complex numerator or dividend."],["Inumber2","Required. The complex denominator or divisor."]],IMEXP:[["Inumber","Required. A complex number for which you want the exponential."]],IMLN:[["Inumber","Required. A complex number for which you want the natural logarithm."]],IMPOWER:[["Inumber","Required. A complex number."],["Number","Required. Power to raise number."]],IMPRODUCT:[["Inumber1","Required. Complex number 1."],["Inumber2","Optional. Complex number 2."]],IMREAL:[["Inumber","Required. A complex number."]],IMSEC:[["Inumber","Required. A complex number for which you want the secant."]],IMSECH:[["Inumber","Required. A complex number for which you want the hyperbolic secant."]],IMSIN:[["Inumber","Required. A complex number for which you want the sine."]],IMSINH:[["Inumber","Required. A complex number for which you want the hyperbolic sine."]],IMSQRT:[["Inumber","Required. A complex number for which you want the square root."]],IMSUB:[["Inumber1","Required. Complex number 1."],["Inumber2","Required. Complex number 2."]],IMSUM:[["Inumber1","Required. Complex number 1."],["Inumber2","Optional. Complex number 2."]],IMTAN:[["Inumber","Required. A complex number for which you want the tangent."]],LARGE:[["Array","Required. An array or range of numeric values."],["K","Required. Position as an integer, where 1 corresponds to the largest value."]],LN:[["Number","Required. A number to take the natural logarithm of."]],LOG10:[["Number","Required. Number for which you want the logarithm."]],LT:[["Number1","Required. First value or reference."],["Number2","Required. Second value or reference."]],LTE:[["Number1","Required. First value or reference."],["Number2","Required. Second value or reference."]],MEDIAN:[["Number1","Required. A number or cell reference that refers to numeric values."],["Number2","Optional. A number or cell reference that refers to numeric values."]],MINUS:[["Number1","Required. The number from which we subtract."],["Number2","Required. The number by which we subtract."]],MOD:[["Number","Required. The number to be divided."],["Divisor","Required. The number to divide with."]],MROUND:[["Number","Required. The number that should be rounded."],["Significance","Required. The multiple to use when rounding."]],MULTINOMIAL:[["Number1, number2, ...","Required. Number1 is required, subsequent numbers are optional. 1 to 255 values for which you want the multinomial."]],MULTIPLY:[["Number1","Required. The number to multiply."],["Number2","Required. The number to multiply by."]],NE:[["Number1","Required. First value or reference."],["Number2","Required. Second value or reference."]],OCT2BIN:[["Number","Required. The octal number you want to convert. Number may not contain more than 10 characters. The most significant bit of number is the sign bit. The remaining 29 bits are magnitude bits. Negative numbers are represented using two's-complement notation."],["Places","Optional. The number of characters to use. If places is omitted, OCT2BIN uses the minimum number of characters necessary. Places is useful for padding the return value with leading 0s (zeros)."]],OCT2DEC:[["Number","Required. The octal number you want to convert. Number may not contain more than 10 octal characters (30 bits). The most significant bit of number is the sign bit. The remaining 29 bits are magnitude bits. Negative numbers are represented using two's-complement notation."]],OCT2HEX:[["Number","Required. The octal number you want to convert. Number may not contain more than 10 octal characters (30 bits). The most significant bit of number is the sign bit. The remaining 29 bits are magnitude bits. Negative numbers are represented using two's-complement notation."],["Places","Optional. The number of characters to use. If places is omitted, OCT2HEX uses the minimum number of characters necessary. Places is useful for padding the return value with leading 0s (zeros)."]],ODD:[["Number","Required. The number to round up to an odd integer."]],PERCENTILE:[["Array","Required. Data values."],["K","Required. Number representing kth percentile."]],"PERCENTILE.INC":[["Array","Required. Data values."],["K","Required. Number representing kth percentile."]],"PERCENTILE.EXC":[["Array","Required. Data values."],["K","Required. A value between 0 and 1 that represents the k:th percentile."]],PERMUT:[["Number","Required. The total number of items."],["Number_chosen","Required. The number of items in each combination."]],PI:[],POW:[["Number","Required. Number to raise to a power."],["Power","Required. Power to raise number to (the exponent)."]],QUARTILE:[["Array","Required. A reference containing data to analyze."],["Quart","Required. The quartile value to return."]],"QUARTILE.INC":[["Array","Required. A reference containing data to analyze."],["Quart","Required. The quartile value to return."]],"QUARTILE.EXC":[["Array","Required. A reference containing data to analyze."],["Quart","Required. The quartile value to return, 1-3."]],QUOTIENT:[["Numerator","Required. The number to be divided."],["Denominator","Required. The number to divide by."]],RADIANS:[["Angle","Required. Angle in degrees to convert to radians."]],ROMAN:[["Number","Required. Number (in Arabic numeral) you want to convert to Roman numeral."],["Form","Optional. The type of Roman numeral you want."]],SEC:[["Number","Required. The angle in radians for which you want the secant."]],SECH:[],SIGN:[["Number","Required. The number to get the sign of."]],SIN:[["Number","Required. The angle in radians for which you want the sine."]],SINH:[["Number","Required. The hyperbolic angle."]],SMALL:[["Array","Required. An array or range of numeric values."],["K","Required. Position as an integer, where 1 corresponds to the smallest value."]],SQRTPI:[["Number","Required. The number by which pi is multiplied."]],STDEV:[["Number1","Required. First number or reference in the sample."],["Number2","Optional. Second number or reference."]],"STDEV.S":[["Number1","Required. First number or reference in the sample."],["Number2","Optional. Second number or reference."]],"STDEV.P":[["Number1","Required. First number or reference in the sample."],["Number2","Optional. Second number or reference."]],STDEVA:[["Number1","Required. First number or reference in the sample."],["Number2","Optional. Second number or reference."]],STDEVP:[["Number1","Required. First number or reference in the sample."],["Number2","Optional. Second number or reference."]],STDEVPA:[["Number1","Required. First number or reference in the sample."],["Number2","Optional. Second number or reference."]],STEYX:[["Known_y's","Required. An array or range of dependent data points."],["Known_x's","Required. An array or range of independent data points."]],SUBTOTAL:[["Function_num","Required. A number that specifies which function to use in calculating subtotals within a list. See table below for full list."],["Ref1","Required. A named range or reference to subtotal."],["Ref2","Optional. A named range or reference to subtotal."]],SUMSQ:[["Number1","Required. The first argument containing numeric values."],["Number2","Optional. The first argument containing numeric values."]],SUMX2MY2:[["Array_x","Required. The first range or array containing numeric values."],["Array_y","Required. The second range or array containing numeric values."]],SUMX2PY2:[["Array_x","Required. The first range or array containing numeric values."],["Array_y","Required. The second range or array containing numeric values."]],SUMXMY2:[["Array_x","Required. The first range or array containing numeric values."],["Array_y","Required. The second range or array containing numeric values."]],TAN:[["Number","Required. The angle in radians for which you want the tangent."]],TANH:[["Number","Required. Any real number."]],TRUNC:[["Number","Required. The number to truncate."],["Num_digits","Optional. The precision of the truncation (default is 0)."]],VAR:[["Number1","Required. First number or reference."],["Number2","Optional. Second number or reference."]],"VAR.S":[["Number1","Required. First number or reference."],["Number2","Optional. Second number or reference."]],"VAR.P":[["Number1","Required. First number or reference."],["Number2","Optional. Second number or reference."]],VARA:[["Number1","Required. First number or reference."],["Number2","Optional. Second number or reference."]],VARP:[["Number1","Required. First number or reference."],["Number2","Optional. Second number or reference."]],VARPA:[["Number1","Required. First number or reference."],["Number2","Optional. Second number or reference."]],WEIBULL:[["X","Required. The value at which to evaluate the function."],["Alpha","Required. A parameter to the distribution."],["Beta","Required. A parameter to the distribution."],["Cumulative","Required. Determines the form of the function."]],"WEIBULL.DIST":[["X","Required. The value at which to evaluate the function."],["Alpha","Required. A parameter to the distribution."],["Beta","Required. A parameter to the distribution."],["Cumulative","Required. Determines the form of the function."]],CHAR:[["Number","Required. A number between 1 and 255."]],CLEAN:[["Text","Required. The text to clean."]],CODE:[["Text","Required. The text for which you want a numeric code."]],EXACT:[["Text1","Required. The first text string to compare."],["Text2","Required. The second text string to compare."]],FIXED:[["Number","Required. The number to round and format."],["Decimals","Optional. Number of decimals to use. Default is 2."],["No_commas","Optional. Suppress commas. TRUE = no commas, FALSE = commas. Default is FALSE."]],NUMBERVALUE:[["Text","Required. The text to convert to a number."],["Decimal_separator","Optional. The character for decimal values."],["Group_separator","Optional. The character for grouping by thousands."]],REGEXEXTRACT:[["Text","Required. The input text."],["Regular_expression","Required. The first part of text that matches this expression will be returned."]],REGEXMATCH:[["Text","Required. The text to be tested against the regular expression."],["Regular_expression","Required. The regular expression to test the text against."]],REGEXREPLACE:[["Text","Required. The text, a part of which will be replaced."],["Regular_expression","Required. The regular expression. All matching instances in text will be replaced."],["Replacement","Required. The text which will be inserted into the original text."]],REPT:[["Text","Required. The text to repeat."],["Number_times","Required. The number of times to repeat text."]],T:[["Value","Required. The value to return as text."]],JOIN:[["Text1, text2, ..."],["Text you want to combine"]],ARRAYTOTEXT:[["Array","Required. The array or range to convert to text."],["Format","Optional. Output format. 0 = concise (default), and 1 = strict."]],DATEVALUE:[["Date_text","Required. A valid date in text format."]],DAYS:[["End_date","Required. The end date."],["Start_date","Required. The start date."]],DAYS360:[["Start_date","Required. The start date."],["End_date","Required. The end date."],["Method","Optional. Day count method. FALSE (default) = US method, TRUE = European method."]],EDATE:[["Start_date","Required. Start date as a valid Excel date."],["Months","Required. Number of months before or after start_date."]],EOMONTH:[["Start_date","Required. A date that represents the start date in a valid Excel serial number format."],["Months","Required. The number of months before or after start_date."]],ISOWEEKNUM:[["Date","Required. A valid Excel date in serial number format."]],NETWORKDAYS:[["Start_date","Required. The start date."],["End_date","Required. The end date."],["Holidays","Optional. A list of non-work days as dates."]],"NETWORKDAYS.INTL":[["Start_date","Required. The start date."],["End_date","Required. The end date."],["Weekend","Optional. Setting for which days of the week should be considered weekends."],["Holidays","Optional. A reference to dates that should be considered non-work days."]],TIMEVALUE:[["Time_text","Required. A date and/or time in a text format recognized by Excel."]],WEEKNUM:[["Serial_num","Required. A valid Excel date in serial number format."],["Return_type","Optional. The day the week begins. Default is 1."]],WEEKDAY:[["Serial_number","Required. The date for which you want to get the day of week."],["Return_type","Optional. A number representing day of week mapping scheme. Default is 1."]],WORKDAY:[["Start_date","Required. The date from which to start."],["Days","Required. The working days before or after start_date."],["Holidays","Optional. A list dates that should be considered non-work days."]],"WORKDAY.INTL":[["Start_date","Required. The start date."],["Days","Required. The end date."],["Weekend","Optional. Setting for which days of the week should be considered weekends."],["Holidays","Optional. A list of one or more dates that should be considered non-work days."]],YEARFRAC:[["Start_date","Required. The start date."],["End_date","Required. The end date."],["Basis","Optional. The type of day count basis to use (see below)."]],ACCRINT:[["Id","Required. Issue date of the security."],["Fd","Required. First interest date of security."],["Sd","Required. Settlement date of security."],["Rate","Required. Interest rate of security."],["Par","Required. Par value of security."],["Freq","Required. Coupon payments per year (annual = 1, semiannual = 2; quarterly = 4)."],["Basis","Optional. Day count basis (see below, default =0)."],["Calc","Optional. Calculation method (see below, default = TRUE)."]],PMT:[["Rate","Required. The interest rate for the loan."],["Nper","Required. The total number of payments for the loan."],["Pv","Required. The present value, or total value of all loan payments now."],["Fv","Optional. The future value, or a cash balance you want after the last payment is made. Defaults to 0 (zero)."],["Type","Optional. When payments are due. 0 = end of period. 1 = beginning of period. Default is 0."]],FV:[["Rate","Required. The interest rate per period."],["Nper","Required. The total number of payment periods."],["Pmt","Required. The payment made each period. Must be entered as a negative number."],["Pv","Optional. The present value of future payments. If omitted, assumed to be zero. Must be entered as a negative number."],["Type","Optional. When payments are due. 0 = end of period, 1 = beginning of period. Default is 0."]],DB:[["Cost","Required. Initial cost of asset."],["Salvage","Required. Asset value at the end of the depreciation."],["Life","Required. Periods over which asset is depreciated."],["Period","Required. Period to calculation depreciation for."],["Month","Optional. Number of months in the first year. Defaults to 12."]],DDB:[["Cost","Required. Initial cost of asset."],["Salvage","Required. Asset value at the end of the depreciation."],["Life","Required. Periods over which asset is depreciated."],["Period","Required. Period to calculation depreciation for."],["Factor","Optional. Rate at which the balance declines. If omitted, defaults to 2."]],DOLLAR:[["Number","Required. The number to convert."],["Decimals","Required. The number of digits to the right of the decimal point. Default is 2."]],DOLLARDE:[["Fractional_dollar","Required. Dollar component in special fractional notation."],["Fraction","Required. The denominator in the fractional unit. 8 = 1/8, 16 = 1/16, 32 = 1/32, etc."]],DOLLARFR:[["Decimal_dollar","Required. Pricing as a normal decimal number."],["Fraction","Required. The denominator in the fractional unit. 8 = 1/8, 16 = 1/16, 32 = 1/32, etc."]],EFFECT:[["Nominal_rate","Required. The nominal or stated interest rate."],["Npery","Required. Number of compounding periods per year."]],FVSCHEDULE:[["Principal","Required. The initial investment sum."],["Schedule","Required. Schedule of interest rates, provided as range or array."]],IRR:[["Values","Required. Array or reference to cells that contain values."],["Guess","Optional. An estimate for expected IRR. Default is .1 (10%)."]],IPMT:[["Rate","Required. The interest rate per period."],["Per","Required. The payment period of interest."],["Nper","Required. The total number of payment periods."],["Pv","Required. The present value, or total value of all payments now."],["Fv","Optional. The cash balance desired after last payment is made. Defaults to 0."],["Type","Optional. When payments are due. 0 = end of period. 1 = beginning of period. Default is 0."]],ISPMT:[["Rate","Required. Interest rate."],["Per","Required. Period (starts with zero, not 1)."],["Nper","Required. Number of periods."],["Pv","Required. Present value."]],NPV:[["Rate","Required. Discount rate over one period."],["Value1","Required. First value(s) representing cash flows."],["Value2","Optional. Second value(s) representing cash flows."]],NOMINAL:[["Effect_rate","Required. The effective annual interest rate."],["Npery","Required. Number of compounding periods per year."]],NPER:[["Rate","Required. The interest rate per period."],["Pmt","Required. The payment made each period."],["Pv","Required. The present value, or total value of all payments now."],["Fv","Optional. The future value, or a cash balance you want after the last payment is made. Defaults to 0."],["Type","Optional. When payments are due. 0 = end of period. 1 = beginning of period. Default is 0."]],PDURATION:[["Rate","Required. Interest rate per period."],["Pv","Required. Present value of the investment."],["Fv","Required. Future value of the investment."]],PPMT:[["Rate","Required. The interest rate per period."],["Per","Required. The payment period of interest."],["Nper","Required. The total number of payments for the loan."],["Pv","Required. The present value, or total value of all payments now."],["Fv","Optional. The cash balance desired after last payment is made. Defaults to 0."],["Type","Optional. When payments are due. 0 = end of period. 1 = beginning of period. Default is 0."]],PV:[["Rate","Required. The interest rate per period."],["Nper","Required. The number of payment periods."],["Pmt","Required. The payment made each period."],["Fv","Optional. Future value. If omitted, defaults to zero."],["Type","Optional. Payment type, 0 = end of period, 1 = beginning of period. Default is 0."]],SYD:[["Cost","Required. Initial cost of asset."],["Salvage","Required. Asset value at the end of the depreciation."],["Life","Required. Periods over which asset is depreciated."],["Period","Required. Period to calculation depreciation for."]],TBILLPRICE:[["Settlement","Required. Settlement date of the security."],["Maturity","Required. Maturity date of the security."],["Discount","Required. The discount rate for the security."]],TBILLYIELD:[["Settlement","Required. Settlement date of the security."],["Maturity","Required. Maturity date of the security."],["Price","Required. Price per $100."]]},{IMAGE:[["Url","Required. Image link"]],HYPERLINK:[["Link_location","Required. The path and file name to the document to be opened. Link_location can refer to a place in a document — such as a specific cell or named range."],["Friendly_name","Optional. The jump text or numeric value that is displayed in the cell. Friendly_name is displayed in blue and is underlined. If friendly_name is omitted, the cell displays the link_location as the jump text."]],SPARKLINE:[["Range","Required. Range or named range"],["Type","Required. Sparkline type"],["Positive_color","Required. Positive color"],["Negative_color","Required. Negative color"]],CHECKBOX:[["State","Optional. Сheckbox state"]],RADIO:[["Y_position","Required. Y-axis position in radio group"],["X_position","Required. X-axis position in radio group"],["Row_count","Required. Rows count in radio group"],["Col_count","Required. Сolumns count in radio group"],["State","Optional. Radio button state"]]})},formats:{dateFormat:"mm/dd/yyyy",timeFormat:"hh:mm AM/PM",longDateFormat:"dd mmmm yyyy",fullDateFormat:"mm/dd/yyyy hh:mm AM/PM",parseDateTime:"%m/%d/%Y %G:%i:%s",parseDate:"%m/%d/%Y",currencies:["{obj} €","¥{obj}","R$ {obj}","{obj} rub."]}};function on(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function an(e,t,n){return t=cn(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,dn()?Reflect.construct(t,n||[],cn(e).constructor):t.apply(e,n))}function sn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ln(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,vn(i.key),i)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function un(e,t,n){return(t=vn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cn(e){return cn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},cn(e)}function hn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fn(e,t)}function dn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(dn=function(){return!!e})()}function fn(e,t){return fn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},fn(e,t)}function gn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,a,s=[],l=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=o.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){u=!0,r=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return s}}(e,t)||bn(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mn(e){return function(e){if(Array.isArray(e))return on(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||bn(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vn(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function pn(e){return pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pn(e)}function bn(e,t){if(e){if("string"==typeof e)return on(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?on(e,t):void 0}}webix.i18n.spreadsheet=rn,webix.protoUI({name:"ssheet-align",$cssName:"richselect",$init:function(e){e.options={view:"datasuggest",body:{view:"ssheet-icons",tooltip:{template:"#tooltip#"},xCount:3,yCount:1},data:e.data}}},webix.ui.richselect),webix.protoUI({name:"ssheet-borders-suggest",defaults:{width:300},$init:function(e){var t=webix.skin.$name;e.body={margin:6,cols:[{view:"ssheet-icons",scroll:!1,select:!0,xCount:4,yCount:2,tooltip:{template:function(e){return webix.i18n.spreadsheet.tooltips["borders-"+e.id]}},on:{onAfterSelect:function(){this.getParentView().getParentView().updateMasterValue(!0)}},template:function(e){return"<span class='"+("webix_ssheet_button_icon webix_ssheet_icon ssi-borders-"+e.value)+"'></span>"},data:e.data},{view:"ssheet-separator"},{rows:[{view:"ssheet-color",css:e.css,name:e.name,width:68,value:"contrast"==t||"dark"==t?"#ffffff":"#000000",tooltip:webix.i18n.spreadsheet.tooltips["borders-color"],title:"<span class='webix_icon wxi-pencil'></span>",on:{onChange:function(){this.getParentView().getParentView().getParentView().updateMasterValue(!1)}}},{view:"richselect",css:"webix_ssheet_border_type",value:"thin",suggest:{fitMaster:!1,width:130,css:"webix_ssheet_suggest",body:{template:"<div class='webix_ssheet_border webix_ssheet_border_#id#'></div>"},data:[{id:"thin"},{id:"medium"},{id:"thick"},{id:"dashed"},{id:"dotted"},{id:"double"}]}},{}]}]}},updateMasterValue:function(e){var t=this.getValue();webix.$$(this.config.master).setValue(t,"user"),e&&this.hide()},setValue:function(e){e[0]&&this.getList().select(e[0]),e[1]&&this.getColorView().setValue(e[1]),e[2]&&this.getTypeView().setValue(e[2])},getValue:function(){return[this.getList().getSelectedId(),this.getColorView().getValue()||"",this.getTypeView().getValue()||""]},getList:function(){return this.getBody().getChildViews()[0]},getColorView:function(){return this.getBody().getChildViews()[2].getChildViews()[0]},getTypeView:function(){return this.getBody().getChildViews()[2].getChildViews()[1]},getItemText:function(){return"<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-borders-all'>"}},webix.ui.suggest),webix.protoUI({name:"ssheet-borders",$cssName:"richselect",$init:function(e){e.options={view:"ssheet-borders-suggest",fitMaster:!1,data:e.data},this.$ready.push(webix.bind((function(){this.getPopup().config.master=this.config.id}),this))},setValue:function(e,t){if(webix.isArray(e)){this.config.value&&e[0]==this.config.value[0]&&e[1]==this.config.value[1]||this.getPopup().setValue(e);var n=this.config.value;this.config.value=e,e[0]&&this.callEvent("onChange",[this.getValue(),n,t])}return e},getValue:function(){return this.getPopup().getValue().join(",")},getList:function(){return this.getPopup().getBody().getChildViews()[0]},getColorView:function(){return this.getPopup().getBody().getChildViews()[1].getChildViews()[0]}},webix.ui.richselect),webix.protoUI({$cssName:"colorboard",name:"ssheet-colorboard",defaults:{height:196,width:244,css:"webix_ssheet_colorboard",palette:[["#000000","#434343","#666666","#999999","#b7b7b7","#cccccc","#d9d9d9","#efefef","#f3f3f3","#ffffff"],["#980000","#ff0000","#ff9900","#ffff00","#00ff00","#00ffff","#4a86e8","#0000ff","#9900ff","#ff00ff"],["#e6b8af","#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#c9daf8","#cfe2f3","#d9d2e9","#ead1dc"],["#dd7e6b","#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#a4c2f4","#9fc5e8","#b4a7d6","#d5a6bd"],["#cc4125","#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6d9eeb","#6fa8dc","#8e7cc3","#c27ba0"],["#a61c00","#cc0000","#e69138","#f1c232","#6aa84f","#45818e","#3c78d8","#3d85c6","#674ea7","#a64d79"],["#85200c","#990000","#b45f06","#bf9000","#38761d","#134f5c","#1155cc","#0b5394","#351c75","#741b47"],["#5b0f00","#660000","#783f04","#7f6000","#274e13","#0c343d","#1c4587","#073763","#20124d","#4c1130"]]},$init:function(){this.attachEvent("onSelect",(function(e){this.getParentView().setMasterValue({value:e},!1,"user")}))}},webix.ui.colorboard),webix.protoUI({$cssName:"richselect",name:"ssheet-color",defaults:{css:"webix_ssheet_color",icon:"wxi-menu-down",suggest:{borderless:!0,body:{view:"ssheet-colorboard"}}},$init:function(){this.$view.className+=" webix_ssheet_color"},$renderInput:function(e,t,n){var i=this.renderColor.call(this);return t=t.replace(/([^>]>)(.*)(<\/div)/,(function(t,n,r,o){return n+e.title+i+o})),webix.ui.colorpicker.prototype.$renderInput.call(this,e,t,n)},$setValue:function(e){e=e||"",this.getColorNode().style.backgroundColor=e},renderColor:function(){return"<div class='webix_ssheet_cp_color' style='background-color:"+this.config.value+";'> </div>"},getColorNode:function(){return this.$view.firstChild.firstChild.childNodes[1]},$renderIcon:function(){return webix.ui.text.prototype.$renderIcon.apply(this,arguments)}},webix.ui.colorpicker);var wn={value:null,set:function(e,t){this.value?e.call(t):(this.start(),e.call(t),this.end())},start:function(){this.value=webix.uid()},end:function(){this.value=null}};function _n(){Ht(Y),Ht(Z),Ht(Vt),Ht(A)}function xn(e,t,n,i,r){var o=e.getCellValue(t,n,!0,r);if(/^=(radio)\(/i.test(o)){var a=o.match(/\((.+?)\)/)[1].split(",").map((function(e){return e.trim()})),s=gn(a,4),l=s[0],u=s[1],c=s[2],h=s[3];if(!1===i)e.setCellValue(t,n,"=radio(".concat(l,", ").concat(u,", ").concat(c,", ").concat(u,", 0)"),r),e.refresh();else e.getCellValue(t,n,!1)||wn.set((function(){for(var i=1;i<=c;i++)for(var o=1;o<=h;o++)e.setCellValue(t-l+i,n-u+o,"=radio(".concat(i,", ").concat(o,", ").concat(c,", ").concat(h,", ").concat(i==l&&o==u?1:0,")"),r);e.refresh()}))}}function yn(e,t,n,i){(function(e,t){Lt[e]=t})(t=t.toUpperCase(),n),e.$$("liveEditor")&&[webix.$$(e.$$("liveEditor").config.suggest).getList(),webix.$$(e.$$("formulaButton").config.popup).getBody()].forEach((function(e){e.exists(t)||(e.add({id:t,value:t}),i&&e.sort("value","asc","string"))}))}function Cn(e){var t=new Date(Math.round(86400*(e-25569)*1e3));return new Date(t.getTime()+6e4*t.getTimezoneOffset())}function Sn(e){return(25569+(e.getTime()-6e4*e.getTimezoneOffset())/864e5).toString()}function En(e,t){if("string"==typeof e){if(/^=(checkbox)\(/i.test(e))return"<span class='webix_icon ssheet_checkbox wxi-checkbox-".concat(t?"marked":"blank","'></span>");if(/^=(radio)\(/i.test(e))return"<span class='webix_icon ssheet_radio wxi-radiobox-".concat(t?"marked":"blank","'></span>")}return t}var $n=Object.freeze({__proto__:null,addMath:yn,addMathMethods:_n,getExcelDateFromJs:Sn,getJsDateFromExcel:Cn,getMathTemplate:En,init:function(e){var t={IMAGE:function(e){return'<img class="webix_ssheet_cimage" src="'.concat(webix.template.escape(e),'">')},HYPERLINK:function(e,t){var n,i=webix.template.escape;return n="#"==e[0]?'href="javascript:void(0);" class="webix_ssheet_ref" data-ref="'.concat(i(e.substr(1)),'"'):'target="blank" href="'.concat(i(e),'"'),"<a ".concat(n,">").concat(i(t||e),"</a>")},SPARKLINE:function(t,n,i,r){var o={type:n,color:i,negativeColor:r,paddingX:2,paddingY:2};"donut"==n?webix.extend(o,{type:"pie",donut:1},!0):"barH"==n&&webix.extend(o,{type:"bar",horizontal:1},!0);for(var a=0;a<t.length;a++)t[a]=t[a]||0;var s=e.$$("cells").config,l="pie"==o.type||"radar"==n,u=l?100:s.columnWidth,c=l?100:s.rowHeight;return webix.Sparklines.getTemplate(o)(t,{width:u,height:c})},CHECKBOX:function(e){return!!e},RADIO:function(e,t,n,i,r){return!!r}},n=Object.keys(t);n.forEach((function(i,r){return yn(e,i,t[i],r==n.length-1)}));var i=e.$$("cells");i.on_click.ssheet_checkbox=function(t,n){var i=e.getCellValue(n.row,n.column,!1);e.setCellValue(n.row,n.column,"=checkbox(".concat(i?0:1,")")),e.refresh()},i.on_click.ssheet_radio=function(t,n){xn(e,n.row,n.column)},e.attachEvent("onCommand",(function(t){"add-radio"==t.id?e.addRadio():"add-checkbox"==t.id&&e.addCheckbox()}))},setRadioState:xn});function Rn(e){return!e&&0!==e||e instanceof Date||isNaN(e)||(e=Cn(e)),e}function An(e){return e&&e instanceof Date&&(e=Sn(e)),e}function kn(e,t,n){var i,r=e.config.save;if(r){if("all"==t){if(!r.all)return;n={data:e.serialize({sheets:!0})},i=r.all}else i="string"==typeof r?r+"/"+t:r[t];if(i=webix.proxy.$parse(i)){if("function"==typeof i)return i(t,n);if(i.$proxy&&i.save)return i.save(e,n,null,null);var o=webix.ajax();"all"===t&&o.headers({"Content-type":"application/json"}),o.post(i,n)}}}webix.protoUI({$cssName:"datepicker",name:"ssheet-datepicker",getValue:function(){return An(webix.ui.datepicker.prototype.getValue.apply(this))||""},$prepareValue:function(e){return e=Rn(e),webix.ui.datepicker.prototype.$prepareValue.apply(this,[e])}},webix.ui.datepicker),webix.protoUI({$cssName:"daterangepicker",name:"ssheet-daterangepicker",getValue:function(){var e=webix.ui.datepicker.prototype.getValue.apply(this);return e&&((e=webix.copy(e)).start=An(e.start),e.end=An(e.end)),e||""},$prepareValue:function(e){return e?e.start||e.end||(e={start:e}):e={start:null,end:null},e.start=Rn(e.start),e.end=Rn(e.end),webix.ui.daterangepicker.prototype.$prepareValue.apply(this,[e])}},webix.ui.daterangepicker),webix.protoUI({$cssName:"window",name:"ssheet-dialog",$init:function(e){this.$view.className+=" webix_ssheet_dialog",this.config.buttons=e.buttons,this.config.close=!0},getBodyConfig:function(e){e.borderless=!0;var t=this.getFormElements(e);return{view:"form",css:"webix_ssheet_form",padding:webix.skin.$active.layoutPadding.form,elements:t}},getFormElements:function(e){var t;return webix.isArray(e)?t=e:(t=[]).push(e),this.config.buttons&&(t.push({height:1}),t.push({margin:10,cols:[{},{view:"button",css:"ssheet_cancel_button",label:webix.i18n.spreadsheet.labels.cancel,autowidth:!0,click:function(){this.getTopParentView().callEvent("onCancelClick",[])}},{view:"button",label:webix.i18n.spreadsheet.labels.save,hotkey:"enter",autowidth:!0,click:function(){this.getTopParentView().callEvent("onSaveClick",[])}}]})),t},body_setter:function(e){return"object"==pn(e)&&(webix.isUndefined(e.padding)&&(e.padding=webix.skin.$active.layoutPadding.form),"form"==e.view&&e.elements?(e.elements=this.getFormElements(e.elements),e.css||(e.css="webix_ssheet_form")):e=this.getBodyConfig(e)),webix.ui.window.prototype.body_setter.call(this,e)},defaults:{move:!0,head:"Dialog",buttons:!0,close:!0,autofocus:!1,width:350}},webix.ui.window,webix.IdSpace),webix.protoUI({$cssName:"datatable",name:"ssheet-dialog-table",$init:function(e){e.headerRowHeight||(e.headerRowHeight=34),this.$view.className+=" webix_ssheet_dialog_table"}},webix.ui.datatable),webix.protoUI({name:"ssheet-suggest-labels",defaults:{fitMaster:!1,padding:0,borderless:!0},$init:function(){this.$view.className+=" webix_ssheet_suggest"},getItemText:function(e){return this.getList().getItem(e).value}},webix.ui.suggest),webix.protoUI({name:"ssheet-form-suggest",defaults:{padding:0,borderless:!0},$init:function(){this.$view.className+=" webix_ssheet_suggest"}},webix.ui.suggest),webix.protoUI({$cssName:"colorpicker",name:"ssheet-colorpicker",$init:function(){this.$view.className+=" webix_ssheet_colorpicker"},defaults:{suggest:{borderless:!0,body:{view:"ssheet-colorboard"}}}},webix.ui.colorpicker),webix.protoUI({name:"formlate",setValue:function(e){return this.setHTML(e)},getValue:function(){return""}},webix.ui.template),webix.protoUI({name:"ssheet-icons",$cssName:"dataview",$init:function(){this.$view.className+=" webix_ssheet_dataview"},defaults:{borderless:!0,template:"<span class='webix_ssheet_button_icon #css#' ></span>",type:{width:36,height:36}}},webix.ui.dataview),webix.protoUI({name:"ssheet-suggest",defaults:{padding:0,css:"webix_ssheet_suggest"}},webix.ui.contextmenu);var Tn=Object.freeze({__proto__:null,init:function(e){for(var t,n=[{name:"onSheetAdd",type:"insert"},{name:"onSheetRemove",type:"remove"},{name:"onSheetRename",type:"rename"},{name:"onSheetStateChange",type:"state"},{name:"onCellChange"},{name:"onStyleChange"},{name:"onAction"},{name:"onRowOperation"},{name:"onColumnOperation"},{name:"onAfterConditionSet"},{name:"onAfterRangeSet"},{name:"onAfterSpan"},{name:"onAfterSplit"},{name:"onZoom"},{name:"onAfterFilter",view:"cells"},{name:"onRowResize",view:"cells"},{name:"onColumnResize",view:"cells"}],i=function(){var i=n[r];(i.view?e.$$(i.view):e).attachEvent(i.name,(function(n,r,o,a,s){if(!e._loading_data&&!e._type_change){var l;if(i.type)l="rename"==i.type?[i.type,r,n]:[i.type,n];else{var u=e.getActiveSheet();"onAction"==i.name&&r.page&&r.page!=u?u=r.page:-1!=["onAfterSplit","onAfterSpan","onCellChange","onColumnOperation","onRowOperation"].indexOf(i.name)&&a!=u?u=a:-1!=["onStyleChange","onAfterConditionSet"].indexOf(i.name)&&s!=u?u=s:"onZoom"==i.name&&(u=o),l=["update",u]}clearTimeout(t),t=webix.delay((function(){return e.callEvent("onChange",l)}))}}))},r=0;r<n.length;r++)i();e.attachEvent("onChange",(function(){kn(e,"all")}))},save:kn}),In={},Vn={},Nn="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function Mn(e){var t=Nn.length,n=Math.floor(--e/t);return n>0?Mn(n)+Nn[e%t]:Nn[e%t]}function On(e){for(var t=Object.keys(Vn).length+1;t<=e;t++){var n=Mn(t);In[n]=t,Vn[t]=n}}function Dn(e){for(var t,n=0;n<e.length;n++)if(e.charCodeAt(n)<59){t=n;break}var i=e.substr(0,t);return[1*e.substr(t),In[i]]}function qn(e,t,n){var i=e.indexOf("!"),r=n||"";-1!==i&&("'"===(r=e.substr(0,i))[0]&&(r=r.substr(1,r.length-2)),e=e.substr(i+1));var o=e.split(":");if(2!=o.length){if(!t)return null;var a=t.ranges.getCode(e,r);if(!a&&!(a=t.ranges.getCode(e,!0)))return null;var s=a.split("!");(s[0]!=n||t.getActiveSheet())&&(r=s[0].replace(/'/g,"")),o=(a=s[1]).split(":")}var l=Dn(o[0]),u=Dn(o[1]);if(l[0]&&l[1]&&u[0]&&u[1])return[l[0],l[1],u[0],u[1],r]}function zn(e){return-1==e.indexOf(" ")?e:"'".concat(e,"'")}function Pn(e,t,n,i,r){return(r?zn(r)+"!":"")+Vn[t]+e+":"+Vn[i]+n}function Fn(e,t){if("object"===pn(e))return e;var n=qn(e,t);return{start:{row:n[0],column:n[1]},end:{row:n[2],column:n[3]},sheet:n[4]}}function Un(e,t,n,i){for(var r=Fn(e),o=r.start.row;o<=r.end.row;o++)for(var a=r.start.column;a<=r.end.column;a++)n(t,{row:o,column:a},i)}function Ln(e){if("string"==typeof e){var t=e.split(":");if(2==t.length){for(var n=0;n<t.length;n++){if(!Hn(t[n].split("!").pop()))return}return!0}}}var Bn=/^[A-Z]+[0-9]+$/;function Hn(e){return Bn.test(e)}function jn(e,t,n,i){var r=!1;if(Ln(e)){var o=gn(qn(e),5),a=o[0],s=o[1],l=o[2],u=o[3],c=o[4];if(a>l){var h=[l,a];a=h[0],l=h[1]}if(s>u){var d=[u,s];s=d[0],u=d[1]}if("row"===t&&i.row<=l){if((n<0&&i.row<a||n>0&&i.row<=a)&&(a+=n),(l+=n)<a)return"";r=!0}else if("column"===t&&i.column<=u){if((n<0&&i.column<s||n>0&&i.column<=s)&&(s+=n),(u+=n)<s)return"";r=!0}r&&(e=Pn(a,s,l,u,c))}return e}var Wn={width:38,margin:7,paddingY:1,sectorPadding:5,sectorMargin:0},Xn={color:"#666666",background:"#ffffff","font-family":"'PT Sans', Tahoma","font-size":"15","text-align":"left","vertical-align":"middle","white-space":"nowrap"},Yn={material:"'Roboto', sans-serif",mini:"'Roboto', sans-serif",flat:"'PT Sans', Tahoma",compact:"'PT Sans', Tahoma",contrast:"'PT Sans', Tahoma",willow:"'Open Sans', sans-serif",dark:"'Open Sans', sans-serif"};function Gn(e,t){return e[Kn(e,t)]}function Kn(e,t){for(var n=-1,i=0;n<0&&i<e.length;i++)t(e[i])&&(n=i);return n}function Qn(e,t,n,i){for(var r=0;r<e.length;r++){var o=e[r];o[0]>n&&(n=o[0]),o[1]>i&&(i=o[1])}if(t)for(var a=0;a<t.length;a++){var s=t[a][0]+t[a][3]-1,l=t[a][1]+t[a][2]-1;s>n&&(n=s),l>i&&(i=l)}return[1*n,1*i]}var Zn=["color","background","text-align","font-family","font-size","font-style","underline","font-weight","vertical-align","wrap","borders","format","border-right","border-bottom","border-left","border-top","strike","indent"],Jn={format:function(){return""},"text-align":{left:function(){return"justify-content:flex-start;"},center:function(){return"justify-content:center;text-align:center;"},right:function(){return"justify-content:flex-end;text-align:right;"}},"vertical-align":{top:function(){return"align-items:flex-start;"},middle:function(){return"align-items:center;"},bottom:function(){return"align-items:flex-end;"}},wrap:{wrap:function(){return"white-space: normal !important;"}},"border-left":function(e,t){return ei("border-left",e,t)},"border-top":function(e,t){return ei("border-top",e,t)},"border-right":function(e,t){return ei("border-right",e,t)},"border-bottom":function(e,t){return ei("border-bottom",e,t)},"font-weight":function(e){return"bold"==e["font-weight"]?"font-weight:"+("'Roboto', sans-serif"==(e["font-family"]||Xn["font-family"])?500:700)+";":""},underline:function(e){var t="underline"==e.underline?"underline":"";if(t){var n="strike"==e.strike?"line-through":"";return"text-decoration: ".concat(t," ").concat(n,";")}return""},strike:function(e){return"underline"!=e.underline&&"strike"==e.strike?"text-decoration: line-through;":""},indent:function(e,t){var n=1*e.indent;if(n>0){var i="right"==e["text-align"]?"right":"left";return{innerCss:"margin-".concat(i,":").concat((8*n+12)*t,"px;")}}},"font-size":function(e,t){var n=e["font-size"];return 1!=t&&(n=e["font-size"].replace("px","")*t+"px"),"font-size:"+n+";"}};function ei(e,t,n){var i=t[e];if(i){var r=gn(i.split(","),2),o=r[0],a=r[1],s=1;return"medium"==(a=a||"thin")?s=2:"thick"!=a&&"double"!=a||(s=3),s=s*n+"px",-1!=["thin","medium","thick"].indexOf(a)&&(a="solid"),"".concat(e,": ").concat(s," ").concat(a," ").concat(o," !important;")}return""}var ti,ni={"border-left":function(e,t,n){return e.column==t.start.column||"no"==n},"border-right":function(e,t,n){return e.column==t.end.column||"all"==n||"no"==n},"border-top":function(e,t,n){return e.row==t.start.row||"no"==n},"border-bottom":function(e,t,n){return e.row==t.end.row||"all"==n||"no"==n}},ii={borders:function(e,t,n,i){var r=e.$$("cells").getSelectArea(),o=(n=n.split(","))[0],a=n[1],s=n[2],l=["border-left","border-right","border-bottom","border-top"];"top-bottom"==o?l=["border-top","border-bottom"]:"no"!=o&&"all"!=o&&"outer"!=o&&(l=["border-"+o]);for(var u=0;u<l.length;u++){var c=l[u];if(!0===e.callEvent("onAction",["check-borders",{row:i.row,column:i.column,area:r,type:o,mode:c}])||ni[c](i,r,o))t=hi(e,t,c,"no"==o?"":"".concat(a,",").concat(s),i)}return t}};function ri(e){e._styles={},e._styles_cache={},e._styles_max=1;var t=".wss_"+e.$index;webix.html.removeStyle(t)}function oi(e){var t={};li(e,t),ri(e),ci(e,t,!0)}function ai(e,t,n,i){if(n&&n!=e.getActiveSheet()){var r=e._mData.getPage(n);if(r){var o=r.getCell(t.row-1,t.column-1);if(o&&o.style){var a=Gn(e._sheets,(function(e){return e.name==n})).content.styles||[],s=Gn(a,(function(e){return e[0]==o.style}));if(s)return{id:o.style,text:s[1],props:wi(s[1])}}}}else{var l=e._mPage.getCell(t.row-1,t.column-1),u=e.$$("cells").getSpan(t.row,t.column);if(u&&(i||u[0]==t.row&&u[1]==t.column))for(var c=u[5].split(" "),h=0;h<c.length;h++){var d=e._styles[c[h]];if(d)return d}if(l&&l.style)return e._styles[l.style]}return null}function si(e,t,n){var i=e._mPage.getCell(t-1,n-1);return i&&i.format||""}function li(e,t){var n=[];for(var i in e._styles_cache)n.push([e._styles_cache[i].id,i]);t.styles=n}function ui(e,t,n,i){var r,o={props:wi(Zn.map((function(){return""})).join(";"))};if(n)for(var a in n.props)o.props[a]=n.props[a];for(var s in t)o.props[s]=t[s];if(o.text=bi(o),i&&i!=e.getActiveSheet()){if(!(r=Gn(e._sheets,(function(e){return e.name==i}))))return null;if(r.content.styles){var l=Gn(r.content.styles,(function(e){return e[1]==o.text}));if(l)return webix.extend(o,{id:l[0]})}else r.content.styles=[]}else{var u=e._styles_cache[o.text];if(u)return u}return pi(e,o,!1,r),o}function ci(e,t,n){if(t.styles)for(var i=0;i<t.styles.length;i++){var r=t.styles[i];pi(e,{id:r[0],text:r[1],props:wi(r[1])},!0)}if(!n)for(var o=0;o<t.data.length;o++){var a=gn(t.data[o],4),s=a[0],l=a[1],u=a[3];u&&di(e,s,l,e._styles[u])}}function hi(e,t,n,i,r){if(ii[n])return ii[n](e,t,i,r);if(t&&t.props[n]==i)return t;var o={text:"",id:0,props:t?webix.copy(t.props):{}};o.props[n]=i,o.text=bi(o);var a=e._styles_cache[o.text];return a||(pi(e,o),o)}function di(e,t,n,i,r){var o=!r||r==e.getActiveSheet(),a=o?e._mPage:e._mData.getPage(r);if(a){var s=a.getCell(t-1,n-1,!0);if(s.style=i&&i.id,s.format=i&&i.props.format,!o){var l=Gn(e._sheets,(function(e){return e.name==r})).content.data,u=Gn(l,(function(e){return e[0]==t&&e[1]==n}));u?u[3]=s.style:l.push([t,n,"",s.style])}}}function fi(e,t,n,i){return vi(e,t,n,i)}function gi(e,t,n,i){Un(t,e,(function(e,t,n){return vi(e,t,n.style,n.page)}),{style:n,page:i})}function mi(e,t,n,i){ti.innerHTML=t,ti.style.width=i?i+"px":"auto",ti.className="webix_table_cell webix_cell "+n,e._table.$view.appendChild(ti);var r=Math.max(0,ti.offsetWidth+1),o=Math.max(0,ti.offsetHeight+1);return e._table.$view.removeChild(ti),ti.innerHTML="",{width:r,height:o}}function vi(e,t,n,i){var r=ai(e,t,i),o=e.getActiveSheet();i||(i=o),e.callEvent("onBeforeStyleChange",[t.row,t.column,n,r,i])&&wn.set((function(){var a=n&&n.props.format||null,s=r&&r.props.format||null,l=a!=s;if((!l||l&&e.callEvent("onBeforeFormatChange",[t.row,t.column,a,s,i]))&&(di(e,t.row,t.column,n,i),e.callEvent("onStyleChange",[t.row,t.column,n,r,i]),l&&e.callEvent("onFormatChange",[t.row,t.column,a,s,i]),e.saveCell(t.row,t.column,i),i==o)){var u=e.getSelectedId();u&&u.row==t.row&&u.column==t.column&&e.callEvent("onCommand",[{id:"toolbar-update"}])}}))}function pi(e,t,n,i){if(i&&i.name!=e.getActiveSheet()){for(var r=1;!t.id||Gn(i.content.styles,(function(e){return e[0]==t.id}));)t.id="wss"+r++;i.content.styles.push([t.id,t.text])}else{for(e._styles_cache[t.text]=t;!t.id||e._styles[t.id];)t.id="wss"+e._styles_max++;e._styles[t.id]=t;var o=function(e,t){var n="",i="";for(var r in t)if(t[r])if(Jn[r]){if(Jn[r][t[r]])n+=Jn[r][t[r]](t);else if("function"==typeof Jn[r]){var o=Jn[r](t,e._zoom);"object"==pn(o)?(n+=o.css||"",i+=o.innerCss||""):n+=o}}else n+=r+":"+t[r]+";";return{css:n,innerCss:i}}(e,t.props),a=o.css,s=o.innerCss,l=".wss_"+e.$index;webix.html.addStyle(l+" ."+t.id+"{"+a+"}",l),webix.html.addStyle(l+" ."+t.id+" div:first-child{"+s+"}",l)}n||kn(e,"styles",{name:t.id,text:t.text,page:i?i.name:e.getActiveSheet()})}function bi(e){for(var t=[],n=0;n<Zn.length;n++)t.push(e.props[Zn[n]]);return t.join(";")}function wi(e){for(var t=e.split(";"),n={},i=0;i<Zn.length;i++)n[Zn[i]]=t[i];return n}function _i(e,t,n){wn.set((function(){Un(t,e,(function(e,t){ai(e,t,n)&&fi(e,t,null,n)}))}))}function xi(e){var t=e.serialize();t.styles=yi(t),ri(e),ci(e,t)}function yi(e){for(var t=e.data,n=e.styles,i={},r=0;r<t.length;r++){var o=t[r][3];o&&(i[o]=1)}for(var a=[],s=0;s<n.length;s++){i[n[s][0]]&&a.push(n[s])}return a}var Ci=Object.freeze({__proto__:null,addStyle:ui,clearRangeStyle:_i,compactStyles:xi,getFormat:si,getStyle:ai,getTextSize:mi,init:function(e){e.attachEvent("onStyleSet",(function(t,n){return function(e,t,n){wn.set((function(){e.eachSelectedCell((function(i){var r=e.$$("cells").getSpan(i.row,i.column);(!r||r&&r[0]==i.row&&r[1]==i.column)&&function(e,t,n,i){var r=ai(e,t);if("indent"==n){var o=1*(r&&r.props[n]||0);if(!o&&-1==i)return;i+=o}var a=hi(e,r,n,i,t);a&&a!=r&&vi(e,t,a)}(e,i,t,n)}))})),e.refresh()}(e,t,n)})),e.attachEvent("onDataParse",(function(t){return ci(e,t)})),e.attachEvent("onDataSerialize",(function(t){return li(e,t)})),e.attachEvent("onReset",(function(){return ri(e)})),e.attachEvent("onUndo",(function(t,n,i,r){"style"==t&&function(e,t,n,i){var r={row:t,column:n};fi(e,r,i)}(e,n,i,r)})),ri(e),ti||(ti=webix.html.create("DIV",{style:"visibility:hidden; position:absolute; top:0px; left:0px; height:auto;"},""))},removeUnusedStyles:yi,setRangeStyle:gi,setStyle:fi,styleFromText:wi,styleToText:bi,style_names:Zn,zoomStyles:oi});var Si,Ei,$i,Ri,Ai={},ki=[],Ti={common:1};function Ii(){var e=webix.i18n.spreadsheet.formats;for(var t in ki=(ki=(ki=[webix.i18n.price]).concat(webix.copy(e.currencies))).map((function(e){var t=function(e){return webix.template(e)("")}(e);return{format:e,id:t,value:t.trim()}})),$i={},Si=0,Ri={},Ei={},Ai={price:{getFormat:function(e,t){return t.css="webix_ssheet_format_price",webix.i18n.priceFormat(e)},values:webix.extend({zeros:webix.i18n.priceSettings.decimalSize,symbol:webix.i18n.price.replace("{obj}",""),separator:1,negative:1,type:"price"},Vi("price"))},int:{getFormat:function(e,t){return t.css="webix_ssheet_format_int",webix.i18n.numberFormat(e)},values:webix.extend({zeros:webix.i18n.decimalSize,separator:1,negative:1,type:"int"},Vi("int"))},percent:{getFormat:function(e,t){return t.css="webix_ssheet_format_percent",Math.round(100*e)+"%"},values:webix.extend({zeros:0,separator:0,negative:1,type:"percent"},Vi("percent"))},date:{getFormat:function(t,n){return n.css="webix_ssheet_format_date",Pi(e.dateFormat,Vi("date"))(t)},values:{type:"date",date:e.dateFormat}},string:{getFormat:function(e,t){return t.css="webix_ssheet_format_text",e},values:{type:"string"}}})Ti[t]=1,Ri[t]=Ki(Gi(t,Ai[t].values)),Ei[Ri[t]]=t}function Vi(e){return"price"==e?{groupSign:webix.i18n.priceSettings.groupDelimiter,decimalSign:webix.i18n.priceSettings.decimalDelimiter}:{groupSign:webix.i18n.groupDelimiter,decimalSign:webix.i18n.decimalDelimiter}}function Ni(e){return Ai[e]?Ai[e].getFormat:Ai[e]}function Mi(e,t){return t?Ki(Qi({values:Ai[e].values,format:Ri[e]}),!0):Ri[e]}function Oi(e,t){if(Ei[e])return Ei[e];var n="object"==pn(t)?"fmt"+Si:t;return Si++,$i[n]=e,"string"==typeof t&&(t=function(e){var t=webix.i18n.spreadsheet.formats,n=[t.dateFormat,t.timeFormat,t.fullDateFormat,t.longDateFormat],i={format:e,type:"custom"};if(Gn(n,(function(t){return t==e})))webix.extend(i,{type:"date",date:e},!0);else{var r,o=gn(e.split(";"),2),a=o[0],s=o[1];if(a&&s)if(0==a.indexOf("[>=0]")&&0==s.indexOf("[<0]"))if(a=a.replace("[>=0]",""),0==(s=s.replace("[<0]","")).indexOf("[red]")&&(s=s.replace("[red]",""),r=!0),"-"==s[0]?(s=s.substring(1),i.negative=r?2:1):r&&("("==s[0]&&")"==s[s.length-1]?(i.negative=4,s=s.substring(1,s.length-1)):i.negative=3),i.negative&&a==s){var l="int",u=-1!=a.indexOf("[$");if("%"==a[a.length-1])a=a.substring(0,a.length-1),l="percent";else for(var c=0;c<ki.length;c++){var h=ki[c].id,d=void 0;if(u?-1!=a.indexOf("[$".concat(h,"]"))&&(a=a.replace("[$".concat(h,"]"),""),d=!0):-1!=a.indexOf(h)&&(a=a.replace(h,""),d=!0),d){l="price",i.symbol=h;break}}var f=Vi(l);0==a.indexOf("#"+f.groupSign)&&(a=a.replace("#"+f.groupSign,""),i.separator=1);var g=gn(a.split(f.decimalSign),2),m=g[0],v=g[1];m&&"0"!=m||v&&!/^[0]+$/.test(v)||(i.type=l,i.delimiters=f,i.zeros=v?v.length:0)}}return i}(e)),webix.extend(t,Vi("custom")),Ai[n]={getFormat:Pi(e,{decimalSign:t.decimalSign,groupSign:t.groupSign}),values:t},Ri[n]=e,Ei[e]=n,n}function Di(e,t,n,i,r,o){r||(r={format:i,type:"custom"});var a=e.getStyle(t,n,o),s=Oi(i,r);e._sheets.map((function(e){e.content.formats||(e.content.formats=[]),Gn(e.content.formats,(function(e){return e[0]==s}))||e.content.formats.push([s,i])}));var l=ui(e,{format:s},a,o);e.setStyle(t,n,l,o)}function qi(e,t,n){var i=e.getStyle(t,n),r=ui(e,{format:""},i);e.setStyle(t,n,r)}function zi(e){var t=e.match(/.*\[[><=].*/g),n=e.split(";");return t||n.length>1&&(n[0]=(n.length>2?"[>0]":"[>=0]")+n[0],n[1]="[<0]"+n[1],n[2]&&(n[2]="[=0]"+n[2])),n}function Pi(e,t){for(var n,i=webix.i18n.spreadsheet.table["format-error"],r=zi(e),o=['var spaces = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";'],a=0;a<r.length;a++){var s=Ji(r[a]);o.push(Fi(s.condition,s.color.toLowerCase(),s.symbol,s.fmt,a,r.length>0,t))}try{n=new Function("val","extra","try{ ".concat(o.join("\n"),' return val; } catch(err) { return "').concat(i,'"; }'))}catch(e){n=function(){return i}}return n}function Fi(e,t,n,i,r,o,a){var s="";return e&&(s+=r?"else if":"if","="===e[0]&&(e="="+e),s+="(val"+e+"){",o&&(s+="val = Math.abs(val);")),t&&(s+='extra.css = "webix_ssheet_format_'+t+'";'),s+=function(e,t,n){if(!e)return"return val;";var i,r,o,a,s,l='return ""',u="",c=1,h=[],d="date";if(n){var f=Gn(ki,(function(e){return e.id==n}));s="left",f&&(s=Kn(f.format.split("{obj}"),(function(e){return e}))?"right":"left")}for(var g=0;g<e.length;g++){var m=er(e[g-1])&&er(e[g+1]);if('"'!=e[g]){if(webix.isUndefined(i))if("%"==e[g]&&(c*=100),/[a-zA-Z]/.test(e[g])){var v=ji(e.substr(g),d);if(v){if(o||a)return'throw "unexpected number placeholder";';h.push(v.format),l+="/*date*/",d=v.type,g+=v.length-1;continue}l+='+"'.concat(e[g],'"')}else if(e[g]===t.decimalSign&&m)u+=t.decimalSign;else if("@"==e[g]){if(o||h.length)return'throw "unexpected number placeholder";';a||(l+="+fmt",a=!0),u+=e[g]}else if(er(e[g])){if(a||h.length)return'throw "unexpected text placeholder";';o||("left"==s&&(l+='+"'.concat(n,'"')),l+="+fmt","right"==s&&(l+='+"'.concat(n,'"')),o=!0),u+=e[g]}else e[g]===t.groupSign&&m?r=!0:l+='+"'.concat(e[g],'"')}else webix.isUndefined(i)?i=g:(l+='+"'.concat(e.substr(i+1,g-i-1),'"'),i=void 0)}if(h.length){-1!=h.indexOf("%A")&&(h=h.map((function(e){switch(e){case"%G":return"%g";case"%H":return"%h";default:return e}})));for(var p=0;p<h.length;p++)l=l.replace("/*date*/","+dateParts[".concat(p,"]"))}return"\n\t\t".concat(h.length?"val = (".concat(Cn,')(val); var dateParts = webix.Date.dateToStr("').concat(h.join(";"),'")(val).split(";");'):"","\n\t\t").concat(u?"".concat(function(e,t,n,i){var r='if(/^@+$/.test("'.concat(e,'") || isNaN(val)){ var fmt = val; }else {'),o=n.decimalSign,a=tr(e,o),s=gn(a,2),l=s[0],u=s[1];u=(u||"").split("").reverse().join("");var c=l.indexOf("0");c>=0&&(c=l.length-c);var h=l.indexOf("?");h>=0&&(h=l.length-h);var d=u.indexOf("0");d>=0&&(d=u.length-d);var f=u.indexOf("?");f>=0&&(f=u.length-f);var g=u.length;return r+="\n\tval = val*".concat(i,";\n\tvar parts = val.toFixed(").concat(g,').split(".");\n\tvar left = parts[0];\n\tvar lsize = left.length; \n\tvar right = parts[1] || "";\n\tif (left.length < ').concat(c,') left = "0000000000".substr(0, ').concat(c," - left.length)+left;\n\tif (left.length < ").concat(h,") left = spaces.substr(0, 6*(").concat(h," - left.length))+left;\n\tif (").concat(t,') {\n\t\tvar buf = [];\n\t\tvar start = 3;\n\t\twhile (lsize > start) { buf.push(left.substr(left.length-start,3)); start+=3; }\n\t\tvar last = left.substr(0,left.length-start+3);\n\t\tif (last !== "-")\n\t\t\tbuf.push(last);\n\t\telse\n\t\t\tbuf.push("-"+buf.pop());\n\n\t\tleft = buf.reverse().join("').concat(n.groupSign,'");\n\t}\n\tif (right){\n\t\tvar zpoint = right.length-1;\n\t\twhile (zpoint >= ').concat(d,'){\n\t\t\tif (right[zpoint] !== "0"){\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tzpoint--;\n\t\t}\n\n\t\tif (zpoint <= right.length)\n\t\t\tright = right.substr(0, zpoint+1);\n\n\t\tif (right.length < ').concat(f,"){\n\t\t\tright += spaces.substr(0, 6*(").concat(f,' - right.length));\n\t\t}\n\t}\n\tvar fmt = left+(right?"').concat(o,'":"")+right;\n\t'),r+"}\n"}(u,r,t,c),";"):"","\n\t\t").concat(l,";")}(i,a,n),s+(e?"}":"")}var Ui={yy:"%y",yyyy:"%Y",m:"%n",mm:"%m",mmm:"%M",mmmm:"%F",mmmmm:"%F",d:"%j",dd:"%d",ddd:"%D",dddd:"%l"},Li={h:"%G",hh:"%H",m:"%i",mm:"%i",s:"%s",ss:"%s","AM/PM":"%A"},Bi=Object.keys(Ui).sort((function(e,t){return t.length-e.length})),Hi=Object.keys(Li).sort((function(e,t){return t.length-e.length}));function ji(e,t){var n=[{name:"date",order:Bi,types:Ui},{name:"time",order:Hi,types:Li}];/^m{1,2}(?!m)/.test(e)&&"date"!=t&&n.reverse();for(var i=0;i<n.length;i++)for(var r=n[i],o=0;o<r.order.length;o++)if(0==e.indexOf(r.order[o]))return{format:r.types[r.order[o]],length:r.order[o].length,type:r.name}}function Wi(e,t,n,i,r){var o=!r||r==e.getActiveSheet(),a=o?e._mPage:e._mData.getPage(r);if(a){var s=function(e,t,n){if(t&&n){if("object"===pn(t)&&"object"===pn(n)){for(var i=[],r=t.row;r<=n.row;r++)for(var o=t.column;o<=n.column;o++)i.push({row:r,column:o});return i}return[{row:t,column:n}]}return e.getSelectedId(!0)}(e,n,i);if(0!=s.length){var l=a.getCell(s[0].row-1,s[0].column-1),u=l&&l.format,c=l&&l.value?l.value.toString():"";if((webix.rules.isNumber(c)||u)&&(wn.set((function(){for(var n=0;n<s.length;n++)Xi(e,t,s[n],r,a)})),o)){e.refresh();var h=ir(e,s[0].row,s[0].column)||"common";h=Yi(h)?"custom":h,e.callEvent("onCommand",[{id:"toolbar-update",name:"format",value:h}])}}}}function Xi(e,t,n,i,r){var o,a=r.getCell(n.row-1,n.column-1),s=a&&a.format,l=a&&a.value?a.value.toString():"";s?((o=webix.copy({values:Ai[s].values,format:Mi(s)})).format=function(e,t,n){for(var i=Qi(e),r=0;r<i.length;r++){if(i[r].decimals)t>0?i[r].right.placeholders+=Array(t+1).join("0"):i[r].right.placeholders=i[r].right.placeholders.slice(0,t);else{var o=!i[r].left.text&&!i[r].right.text,a=!i[r].left.placeholders&&!i[r].right.placeholders;t<0&&o&&a&&webix.rules.isNumber(n)&&n.indexOf(".")>-1?(i[r].left.placeholders="0",i[r].right.placeholders=Array(n.split(".")[1].length).join(Array(t+1).join("0"))):t>0&&(i[r].left.placeholders||o)&&(i[r].left.placeholders=i[r].left.placeholders||"0",i[r].right.placeholders=Array(t+1).join("0"),i[r].decimals=!0)}i[r].decimals=i[r].right.placeholders.length>0}return Ki(i)}(o,t,l),o.values&&Object.prototype.hasOwnProperty.call(o.values,"zeros")&&(o.values.zeros=Math.max(o.values.zeros+t,0))):(o={values:{negative:1,zeros:webix.rules.isNumber(l)&&l.split(".")[1]?Math.max(l.split(".")[1].length+t,0):Math.max(t,0),separator:0,type:"int"}}).format=Ki(Gi(o.values.type,o.values));Di(e,n.row,n.column,o.format,o.values,i)}function Yi(e){return!Ti[e]}function Gi(e,t){if("string"==e)return[{left:{text:"@"}}];if(t.date)return[{left:{text:t.date}}];var n=[{condition:">=0",left:{text:""},right:{text:""}},{condition:"<0",left:{text:""},right:{text:""}}];if(webix.extend(n,Vi(e)),n[0].right.placeholders=n[1].right.placeholders=t.zeros?Array(t.zeros+1).join("0"):"",n[0].separator=n[1].separator=t.separator&&"percent"!=e,n[0].left.placeholders=n[1].left.placeholders=n[0].separator?"#"+n.groupSign+"0":"0",n[0].decimals=n[1].decimals=!!t.zeros,n[1].color=1!=t.negative?"red":"",n[1].left.text+=t.negative<3?"-":"",4==t.negative&&(n[1].left.text+="("),"percent"===e)n[0].right.text=n[1].right.text+="%";else if("price"===e){var i=t.symbol,r=Kn(Gn(ki,(function(e){return e.id==i})).format.split("{obj}"),(function(e){return e}))?"right":"left";n[0][r].symbol=n[1][r].symbol=i}return 4==t.negative&&(n[1].right.text+=")"),n}function Ki(e,t){for(var n="",i=0;i<e.length;i++){if(e[i].condition&&(n+="["+e[i].condition+"]"),e[i].color&&(n+="["+e[i].color+"]"),e[i].left){if(e[i].left.text)n+=e[i].left.text;if(e[i].left.symbol&&(n+="[$"+e[i].left.symbol+"]"),e[i].left.placeholders){var r=e[i].left.placeholders;n+=t?r.replace(e.groupSign,","):r}}if(e[i].decimals&&(n+=t?".":e.decimalSign),e[i].right)if(e[i].right.placeholders&&(n+=e[i].right.placeholders),e[i].right.symbol&&(n+="[$"+e[i].right.symbol+"]"),e[i].right.text)n+=e[i].right.text;i!=e.length-1&&(n+=";")}return n}function Qi(e){for(var t=e.format.split(";"),n=[],i=function(){var i=Ji(t[r]);n[r]={color:i.color,condition:i.condition,left:{},right:{}};var o=i.fmt;n.groupSign=e.values.groupSign,n.decimalSign=e.values.decimalSign,o.indexOf(n.groupSign)>-1&&(n[r].separator=!0);var a=tr(o,n.decimalSign),s=a[0],l=a[1]||"";a[1]&&(n[r].decimals=!0),s=Zi(s,"left",n.groupSign),l=Zi(l,"right",n.groupSign),n[r].left={text:s.leftText,placeholders:s.placeholders},n[r].right={text:s.rightText+l.rightText,placeholders:l.placeholders};var u=i.symbol;if(u){var c=Gn(ki,(function(e){return e.id==u})),h="left";c&&(h=Kn(c.format.split("{obj}"),(function(e){return e}))?"right":"left"),n[r][h].symbol=u}},r=0;r<t.length;r++)i();return n}function Zi(e,t,n){var i;"left"==t&&(i=(i=e.match(/[#?0]/))?i.index:1/0);for(var r="",o="",a="",s=0;s<e.length;s++)if(er(e[s]))a+=e[s];else{if(e[s]==n&&er(e[s+1])&&er(e[s-1])){a+=e[s];continue}if("left"==t&&s<i){r+=e[s];continue}o+=e[s]}return{leftText:r,rightText:o,placeholders:a}}function Ji(e){var t="",n="",i="",r=e.indexOf("[");if(-1!=r&&e[1].match(/[><=]/)){var o=e.indexOf("]");n=e.substr(r+1,o-r-1),e=e.substr(o+1)}if(-1!=(r=e.indexOf("[$"))){var a=r+e.substr(r).indexOf("]");i=e.substr(r+2,a-r-2),e=e.substr(0,r)+e.substr(a+1)}if(-1!=(r=e.indexOf("["))){var s=e.indexOf("]");t=e.substr(r+1,s-r-1),e=e.substr(s+1)}return{condition:n,color:t,symbol:i,fmt:e}}function er(e){return"0"===e||"#"===e||"?"===e}function tr(e,t){var n=e.match("[#?0][/"+t+"][#?0]");return n?[e.substring(0,n.index+1),e.substring(n.index+2)]:[e]}function nr(e,t,n){if(e=e&&e.fmt?e.fmt:Mi(e)){var i,r=Ji(zi(e)[0]).fmt;if(r)for(var o=0;o<r.length;o++)if('"'==r[o]&&(i=!i),!i){if("date"==t&&/[a-zA-Z]/.test(r)){var a=ji(r.substr(o),"date");if(a){if(!n)return!0;if("time"==a.type)return!0}}if("string"==t&&"@"==r[o])return!0}}}function ir(e,t,n){var i=e._mPage.getCell(t-1,n-1);return i&&i.format||null}function rr(e){return e<-99974430.925||e>100025569.125}function or(e,t,n){var i=ir(e,t,n),r=webix.i18n.spreadsheet.formats,o=nr(i,"date",!0);return webix.Date.dateToStr(r[o?"parseDateTime":"parseDate"])}function ar(e,t){var n,i=t[3];if(i){var r=Gn(e.styles,(function(e){return e[0]==i}));if(r){var o=wi(r=r[1]).format;o&&(e.formats&&(n=Gn(e.formats,(function(e){return e[0]==o}))),n=n?n[1]:Mi(o))}}return n}var sr=Object.freeze({__proto__:null,addFormat:Di,changeAreaDecimals:Wi,checkFormat:nr,get currencies(){return ki},formToValues:Gi,format2code:Pi,get formatCache(){return Ei},get formatHelpers(){return Ai},get formatsCount(){return Si},getDateEditFormat:or,getDelimiters:Vi,getFormat:Ni,getFormatFromData:ar,getFormatName:ir,getFormatSource:Mi,init:function(e){e.attachEvent("onDataParse",(function(e){return function(e,t){var n,i=t.formats;if(i)for(n=0;n<i.length;n++)Oi(i[n][1],i[n][0])}(0,e)})),e.attachEvent("onDataSerialize",(function(e,t){return function(e,t){var n=[];for(var i in Ri)Ti[i]||n.push([i,Ri[i]]);t.formats=n}(0,e)}))},isCustom:Yi,isDateInvalid:rr,removeFormat:qi,serializeFormat:Ki,setDefaultFormats:Ii});function lr(e){var t=e.charCodeAt(0);return t<=122?t>=65||35==t||36==t||46==t:t>191}function ur(e,t){for(var n=e.length,i=n-1;i>=0;i--){if(!lr(e[i])){if(t&&cr(e[i]))continue;return n}n=i}}function cr(e){var t=e.charCodeAt(0);return t>=48&&t<=57}function hr(e,t){var n,i="",r=!1;for(n=t;n<e.length;n++){var o=e[n];if("'"!==o){if(!r)if("!"==o){if("#"==e[t])continue;"'"===(i=e.substr(t,n-t))[0]&&(i=i.substr(1,i.length-2)),t=n+1}else if(!lr(o)&&!cr(o))return[e.substr(t,n-t),n,t,i]}else r=!r}return[e.substr(t),n,t,i]}var dr=/^[A-Z$]+[0-9]+$/;function fr(e){for(var t=0,n=0,i=1,r=1,o=0,a=!1,s=e.length-1;s>=0;s--){var l=e[s].charCodeAt(0);36!==l?l<58?(n+=(l-48)*i,i*=10):(a||(i=1,t=n,n=0,a=!0,r+=1),n+=(l-64)*i,i*=26):o+=r}return[t,n,o]}function gr(e,t,n,i){for(var r,o=t.getActiveSheet(),a=[],s=0,l=!1,u=!1,c="="===e[c]?1:0;c<e.length;c++){var h=e[c];if('"'==h)l=!l;else if(!l)if("{"==h&&"{"==e[c+1])u=!0;else if("}"==h&&"}"==e[c+1])u=!1;else if(!u){var d="'"===h;if(d||lr(h)){var f=gn(hr(e,c),4),g=f[0],m=f[1],v=f[3],p=m-1;if("("!==e[p+1])if(r=g,dr.test(r))v&&v!=o&&!n||(mr(a,e,c,s,v?[v,g,d]:g),s=p+1);else if(n)mr(a,e,c,s,v?[v,g,d]:g),s=p+1;else{var b=t.ranges.getCode(g,v||i);if(b||(b=t.ranges.getCode(g,!0)),b){var w=b.split("!");w[0]==o&&(mr(a,e,c,s,[v,g,d,w[1]]),s=p+1)}}c=p}}}return s!=e.length&&a.push(e.substr(s)),a}function mr(e,t,n,i,r){0!==n&&e.push(t.substr(i,n-i)),e.push(r)}function vr(e){var t=e.getValue(),n=e.getInputNode(),i=webix.html.offset(n),r=n.selectionStart,o=webix.html.getTextSize(t.substring(0,r),"webix_ssheet_formula").width;return{x:i.x+o,y:i.y+i.height}}function pr(e,t,n){var i=ar(t,n),r={value:n[2],fmt:i?{fmt:i}:null,type:n[4]};return xr(e,r),r}function br(e,t,n,i){n=Sn(n),t.value=n,e._loading_data||e._page_value_set||e.setCellValue(t.row,t.col,n,i)}function wr(e){var t=e?"number":null;return nr(e,"string")?t="string":nr(e,"date")&&(t="date"),t}function _r(e,t,n,i){var r=(i=i?e._mData.getPage(i):e._mPage).getCell(t-1,n-1);return r&&r.type||null}function xr(e,t,n,i){var r=!(t.row&&t.col);e._setType=!0;var o,a="string"==typeof t.value&&"="==t.value[0],s=(!n||t.fmt==Mi("date"))&&(!e._loading_data||e._page_value_set||"date"==t.type);r||i&&i!=e.getActiveSheet()||(o=a&&!t.fmt?function(e,t){for(var n,i=0,r=gr(t,e),o=0;o<r.length;o++)if(o%2==0){var a=r[o].match(/(([a-zA-Z]*\()|\))(?=(?:[^"]|"[^"]*")*$)/g);a&&a.forEach((function(e){e.indexOf("(")>-1?(i++,n||/^(SUM|AVERAGE|MAX|MIN|INT|ROUND|ROUNDDOWN|ROUNDUP|TRUNC)?\($/gi.test(e)||(n=i)):--i<n&&(n=null)}))}else if(!n){if(webix.isArray(r[o]))if(/^[A-Za-z]+$/.test(r[o][1]))r[o]=r[o][3].split(":")[0];else{if(r[o][0]!=e.getActiveSheet())continue;r[o]=r[o][1]}var s=fr(r[o]),l=ir(e,s[0],s[1]);if(l)return{fmt:Mi(l)}}}(e,t.value):null);var l=wr(t.fmt||o),u=function(e,t,n,i,r,o,a){var s="string";if(!webix.isUndefined(t.value))if(i)s="number",/^=(now|date|time)\(/i.test(t.value)?s="date":/^=(sparkline|image)\(/i.test(t.value)&&(s="string");else if(isNaN(t.value)){if("string"!=r&&n){var l=webix.Date.strToDate(webix.i18n.spreadsheet.formats.parseDateTime)(t.value);""==l||isNaN(l)||(o?br(e,t,l,a):e.ignoreUndo((function(){return br(e,t,l)})),s="date")}}else s="number";return s}(e,t,s,a,l,n,i);if(t.type=function(e,t,n,i,r){return e=e||t,"string"==t?e="string":n&&(e=n),"date"==e&&!i&&rr(r)&&(e="number"),e}(t.type,u,l,a,t.value),!r){var c=(i&&i!=e.getActiveSheet()?e._mData.getPage(i):e._mPage).getCell(t.row-1,t.col-1,!0);c.$format="string"==l?1:0,function(e,t,n,i,r,o){var a=t.row,s=t.col,l="string"==typeof t.value,u=l&&"="==t.value[0],c=e.getCellEditor(a,s),h=!o||o==e.getActiveSheet();e._loading_data||e._page_value_set||"number"!==t.type||!l||u||""===t.value||e.setCellValue(a,s,1*t.value,o);if(r)e.setFormat(a,s,r.fmt);else if("date"==t.type){if("date"!=i){var d=u&&0==t.value.toUpperCase().indexOf("=TIME("),f=webix.i18n.spreadsheet.formats,g=d?f.timeFormat:f.dateFormat;e.setFormat(a,s,g,o)}u||c||!h||e.setCellEditor(a,s,{editor:"excel_date"},o)}else"string"!=i&&"string"==t.type&&"string"!=n&&e.setFormat(a,s,"@",o);h&&("date"!=t.type||u)&&c&&"excel_date"==c.editor&&e.setCellEditor(a,s,null)}(e,t,u,l,o,i),c.type=t.type}delete e._setType}webix.protoUI({name:"suggest-formula",defaults:{fitMaster:!1,filter:function(e,t){var n=webix.$$(this.config.master),i=n.getInputNode().selectionStart,r=n.getValue();if("="===r.charAt(0)){var o=r.substring(0,i),a=o.substring(ur(o,!0)),s=r.charAt(i);return!a||i!==r.length&&(lr(s)||/^[0-9]/.test(s))||(t=a),0===e.value.toString().toLowerCase().indexOf(t.toLowerCase())}}},$init:function(){var e=this;this.attachEvent("onBeforeShow",(function(t){if(t.tagName){var n=webix.$$(e.config.master),i=n.getValue();return!(!i||"="!==i.charAt(0))&&(webix.ui.popup.prototype.show.apply(e,[vr(n)]),!1)}}))},setMasterValue:function(e,t){var n=e.id?this.getItemText(e.id):e.text||e.value;webix.$$(this.config.master).setValueHere(n),t||this.hide(!0),this.callEvent("onValueSuggest",[e,n])},$enterKey:function(){if(this.isVisible())return webix.ui.suggest.prototype.$enterKey.apply(this,arguments)}},webix.ui.suggest);var yr=Object.freeze({__proto__:null,getType:_r,init:function(e){e.attachEvent("onCellChange",(function(e,t,n,i){if(i==this.getActiveSheet()&&!this._setType){var r=ir(this,e,t);xr(this,{row:e,col:t,value:n,fmt:r?{fmt:Mi(r)}:null})}})),e.attachEvent("onBeforeFormatChange",(function(t,n,i,r,o){this._setType||xr(this,{row:t,col:n,value:e.getCellValue(t,n,!0,o),fmt:{fmt:Mi(i)}},!0,o)})),e.attachEvent("onAction",(function(e,t){"dropdown"==e&&t.newValue&&"excel_date"==t.newValue.editor&&("date"!=wr(ir(this,t.row,t.column,t.page))&&this.setFormat(t.row,t.column,webix.i18n.spreadsheet.formats.dateFormat,t.page))}))},loadCell:pr});function Cr(e){return{view:"ssheet-suggest",css:"webix_ssheet_suggest",autowidth:!0,template:function(e){var t="";return e.icon&&(t+="<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+e.icon+"'></span> "),t+=e.value||webix.i18n.spreadsheet.menus[e.id]||e.id},data:e,on:{onItemClick:function(e){var t=this.config.master;if(t){var n=webix.$$(t).getTopParentView(),i=[this.getItem(e)];if(webix.$$(t).config.area){var r=n.$$("cells").getSelectArea();r&&(i=i.concat([r.start,r.end]))}n.callEvent("onCommand",i)}}}}}function Sr(e,t,n){return(n=n?e._mData.getPage(n):e._mPage).serialize(t).map((function(e){var t=e[2].value;return null===t&&(t=""),[++e[0],++e[1],t,e[2].style||"",e[2].type]})).filter((function(e){return e[2]||0===e[2]||e[3]}))}webix.protoUI({name:"live-editor",$cssName:"texthighlight",$init:function(e){var t=this,n=this.getTopParentView();this.paramsPopup=webix.ui({view:"popup",width:350,maxHeight:300,body:{scroll:"auto",autoheight:!0,template:function(e){for(var t='<p class = "webix_ssheet_method_name">'.concat(e.method,"</p>"),n=e.params,i=0;i<n.length;i++){var r='<span class = "webix_ssheet_method_param_name">'.concat(n[i][0]+": ","</span>");t+="<p".concat(e.number==i?" class = 'webix_ssheet_method_param_active'":"",">").concat(r,'<span class="webix_ssheet_method_param_description">').concat(n[i][1],"</p>")}return t}}}),n._destroy_with_me.push(this.paramsPopup),e.suggest={width:350,height:200,view:"suggest-formula",css:"webix_ssheet_math_suggest",data:e.suggestData,template:function(e){return e.pos?e.id:e.value},body:{template:function(e){return 0==e.id.indexOf("$range_")?'<span class="webix_ssheet_left">'.concat(e.value,'</span><span class="webix_ssheet_range webix_ssheet_right">').concat(e.pos,"</span>"):e.value}},on:{onBeforeShow:function(){var e=this,t=this.getList(),i=t.find((function(e){return 0==e.id.indexOf("$range_")}));i&&i.forEach((function(e){return t.remove(e.id)}));var r=n.ranges.serialize(n.getActiveSheet()).map((function(e){return{id:"$range_"+e[0],value:e[0],pos:e[1],global:e[2]}})),o=r.filter((function(e){return!e.global}));r.filter((function(e){return e.global})).forEach((function(e){o.find((function(t){return t.value==e.value}))||o.push(e)})),o.forEach((function(e){return t.add(e)})),t.filter((function(t){return e.config.filter.apply(e,[t,e.getMasterValue()])})),t.sort("value","asc","string")}}},e.highlight=this.highlight,this._highlightedCells={},this.$view.className+=" webix_ssheet_formula",this.attachEvent("onKeyPress",(function(e,i){if(delete t._update_range,13==e){if(new Date-(t._last_value_set||0)>300){var r=t.config.activeCell;t.showActiveSheet(!0),t.updateCellValue(r),t.getInputNode().blur()}webix.html.preventEvent(i)}else 27==e?(t.showActiveSheet(),webix.delay((function(){var e=n.getSelectedId(),i=t.getCellValue(e.row,e.column);t.getValue()==i?n.$$("cells").refresh(e.row):t.setValue(i),delete n.$handleSelection,webix.UIManager.setFocus(n.$$("cells"))}))):e>=33&&e<=40&&t.showParamsPopup()})),this.attachEvent("onItemClick",(function(){this.showParamsPopup()})),this.attachEvent("onAfterRender",(function(){var e=this;webix.eventRemove(this.keydownEv),this.keydownEv=webix.event(this.getInputNode(),"keydown",(function(t){e.endEdit(t)}))}))},showParamsPopup:function(){var e=this;webix.delay((function(){var t=e.paramsPopup,n=e.getValue();if("="==n[0])for(var i=0,r=0,o=e.getInputNode().selectionStart-1;o>0;o--)switch(n[o]){case",":r||i++;break;case")":r++;break;case"(":if(!r){var a=n.substring(0,o),s=a.substring(ur(a,!0));if(s){s=s.toUpperCase();var l=webix.i18n.spreadsheet.liveEditor["functions-syntax"][s];if(l&&l.length){var u=t.getBody();u.setValues({params:l,number:i,method:s});var c=webix.$$(e.config.suggest),h=void 0;if(c.isVisible()){var d=c.config;h={x:d.left,y:d.top+c.$height+10}}else h=vr(e);t.show(h);var f=u.$view.querySelector(".webix_ssheet_method_param_active");if(f){var g=f.offsetTop+f.offsetHeight-u.$height;u.scrollTo(0,g>0?g:0)}e.focus()}else t.hide()}return}r--}t.hide()}))},highlight:function(e){this.showParamsPopup();var t="",n=this.getTopParentView(),i=webix.template.escape;for(var r in this._highlightedCells){var o=this._highlightedCells[r];this.changeCellCss(o[0],o[1],o[2],!0)}if(this._highlightedCells={},e&&"="==e[0])for(var a=gr(e,n,null,this._activeMath),s=n.getActiveSheet(),l=1,u=0;u<a.length;u++)if(u%2==0)t+=i(a[u]);else{var c=webix.isArray(a[u]),h=c?this.prepareSheet(a[u][0],a[u][2]):"",d=this._activeMath,f=!(c||d&&d!=s),g=fr(c?a[u][1]:a[u]),m=c?h+a[u][1]:a[u],v=c&&!ur(a[u][1]);if(v||f||c&&a[u][0]==s){var p=void 0;if(":"==a[u+1]&&a[u+2]||v){var b=void 0,w=void 0;if(v){var _=a[u][3].split(":");g=fr(_[0]),b=fr(_[1])}else b=fr(webix.isArray(a[u+2])?a[u+2][1]:a[u+2]),w=webix.isArray(a[u+2])?h+a[u+2][1]:a[u+2],u+=2;p=this.setColor(g[0],g[1],b[0],b[1],l),t+='<span class="webix_ssheet_highlight_color_'.concat(p||l,'">').concat(v?m:m+":"+w,"</span>")}else{if(a[u-1]&&":"==a[u-1][a[u-1].length-1]){t+=m;continue}p=this.setColor(g[0],g[1],g[0],g[1],l),t+='<span class="webix_ssheet_highlight_color_'.concat(p||l,'">').concat(m,"</span>")}p||(l+=7==l?-6:1)}else t+=m}else t=i(e);return n.$$("cells").refresh(),document.activeElement==this.getInputNode()&&this.paintValue(),t},showActiveSheet:function(e){var t=this.getTopParentView(),n=t._table;if(this._activeMath){if(this._activeMath!=t.getActiveSheet()){var i=this.config.activeCell;this.define({activeCell:null}),t.showSheet(this._activeMath),webix.delay((function(){n.select(i.row+(e?1:0),i.column)}))}delete this._activeMath}else e&&webix.delay((function(){n.moveSelection("down")}))},changeCellCss:function(e,t,n,i){for(var r="webix_ssheet_highlight_background_".concat(n),o=e.start;o<=e.end;o++)for(var a=t.start;a<=t.end;a++)this.getTopParentView().$$("cells")[i?"removeCellCss":"addCellCss"](o,a,r,!0)},endEdit:function(e){9==(e.which||e.keyCode)&&(webix.html.preventEvent(e),this.getInputNode().blur(),this.updateCellValue(),this.getTopParentView()._table.moveSelection(e.shiftKey?"left":"right"))},paintValue:function(){var e=this.getTopParentView();if(!this._activeMath||this._activeMath==e.getActiveSheet()){var t=this.config.activeCell,n=e._table.getItemNode(t);t&&n&&(n.innerHTML="<div>".concat(webix.template.escape(this.getValue()),"</div>"))}},updateCellValue:function(e){var t=this.getValue(),n=this.getTopParentView();(e=e||this.config.activeCell)?t!==n.getCellValue(e.row,e.column)&&(this.config.value=t,n.setCellValue(e.row,e.column,t),n.refresh()):this.setValue("");delete n.$handleSelection},$setValueHere:function(e){this.setValueHere(e)},setValueHere:function(e){this._last_value_set=new Date;var t=this.getValue();if(t&&"="===t.charAt(0)){var n=this.getInputNode().selectionStart,i=t.substring(0,n),r=t.substring(n);"("==i[i.length-1]&&(i=i.substring(0,i.length-1)),i=i.substring(0,ur(i,!0));var o=0==e.indexOf("$range_");o&&(e=e.substr(7)),i+=e+(o||"("==r[0]?"":"("),this.setValue(i+r),this.getInputNode().setSelectionRange(i.length,i.length)}},expectOperator:function(e){var t=this.getValue();if("="==t[0]){for(var n=e?t.length:this.getInputNode().selectionStart;" "==t[n-1];)n--;return t[n-1]&&t[n-1].match(/[+&\-/*=(:,]/)}},setRange:function(e,t){var n,i,r=this.getInputNode().selectionStart,o=this.getValue();t&&(t=this._update_range&&r==this._update_range.pos+this._update_range.len);var a=t?this._update_range.pos:r;n=o.substring(0,a)+e,i=o.substring(r),this._update_range={pos:a,len:e.length},this.setValue(n+i)},prepareSheet:function(e,t){return e?((webix.isUndefined(t)?-1!=e.indexOf(" "):t)?"'".concat(e,"'"):e)+"!":""},prepareArea:function(e,t){return{start:Math.min(e,t),end:Math.max(e,t)}},setColor:function(e,t,n,i,r){var o=this.prepareArea(e,n),a=this.prepareArea(t,i),s=[o.start,o.end,a.start,a.end].join(","),l=this._highlightedCells[s];if(l)return l[2];this._highlightedCells[s]=[o,a,r],this.changeCellCss(o,a,r)},getCellValue:function(e,t){var n=this.getTopParentView(),i=n.getCellValue(e,t);"date"==_r(n,e,t)&&"="!=i[0]&&(i=or(n,e,t)(Cn(i)));return i}},webix.ui.texthighlight),webix.protoUI({name:"ssheet-separator",defaults:{css:"webix_ssheet_toolbar_spacer",template:" ",width:1,borderless:!0}},webix.ui.view),webix.protoUI({name:"sheets",defaults:{layout:"x",borderless:!0,css:"ssheet_list_sheets",select:!0,drag:"order",dragscroll:"x",scroll:!1}},webix.EditAbility,webix.ui.list),webix.protoUI({$cssName:"toggle",name:"ssheet-toggle",toggle:function(){var e=this.getValue();e&&e!=this.config.offValue?this.config.value=this.config.offValue||!1:this.config.value=this.config.onValue||!0;var t=this.getValue();this.$setValue(t),this.callEvent("onChange",[t,e,"user"])},$setValue:function(e){e==this.config.offValue?e=!1:e==this.config.onValue&&(e=!0),webix.ui.toggle.prototype.$setValue.call(this,e)},getValue:function(){var e=this.config,t=e.value;return t&&t!=e.offValue?e.onValue||!0:e.offValue||!1},defaults:{template:function(e,t){var n=!0===e.value||e.value==e.onValue?" webix_pressed":"",i=t.$renderInput(e,t);return"<div class='webix_el_box"+n+"' style='width:"+e.awidth+"px; height:"+e.aheight+"px'>"+i+"</div>"}}},webix.ui.toggle),webix.protoUI({name:"ssheet-toggle-silent",$cssName:"toggle",$allowsClear:!1,setValue:function(){this.blockEvent(),webix.ui.toggle.prototype.setValue.apply(this,arguments),this.unblockEvent()}},webix.ui.toggle),webix.protoUI({name:"ssheet-bar-title",defaults:{borderless:!0},$init:function(){this.$view.className+=" webix_ssheet_subbar_title"}},webix.ui.template),webix.protoUI({name:"ssheet-button",$cssName:"button",defaults:{type:"htmlbutton",width:40},$init:function(e){var t=e.arrow?" webix_ssheet_button_menu":"",n=e.label?"":" webix_ssheet_icon_only";if(this.$view.className+=" webix_ssheet_button"+t+n,e.label||e.icon){var i=e.icon||e.name,r=e.label||"";if(e.arrow)r+="<span class='webix_ssheet_button_icon webix_ssheet_icon_arrow webix_icon wxi-menu-down' style='right:"+webix.skin.$active.inputSpacing/2+"px;'></span>";e.label="<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+i+"'></span> "+r,e.tooltip=webix.i18n.spreadsheet.tooltips[e.name]||""}e.options&&!e.popup&&(e.popup=Cr(e.options))}},webix.ui.button),webix.protoUI({name:"ssheet-button-icon-top",$cssName:"button",defaults:{type:"htmlbutton",width:70,height:70},$init:function(e){if(this.$view.className+=" ssheet_button_icon_top",e.label){var t=e.icon||e.name||"",n=e.label;e.label="<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+t+"'></span><br/>",e.label+="<span class='ssheet_button_icon_top_text'>"+n+"</span>",e.arrow&&(e.label+="<br/><span class='ssheet_button_icon_top_arrow webix_icon wxi-menu-down'></span>"),e.tooltip=webix.i18n.spreadsheet.tooltips[e.name]||""}e.options&&!e.popup&&(e.popup=Cr(e.options))}},webix.ui.button),webix.protoUI({name:"multicheckbox",defaults:{padding:0,type:"clean",borderless:!0,elementsConfig:{labelWidth:0}},$init:function(e){e.rows=[{height:1e-6}],this.$ready.push((function(){this._initOnChange()}))},_initOnChange:function(){this.attachEvent("onChange",(function(e){var t=this.$eventSource.config.name;if(this.blockEvent(),"$all"==t){for(var n in this.elements)this.elements[n].setValue(e);e||this._getCheckboxes()[0].setValue(1)}else{var i=this.getValue(!0);if(webix.isArray(i)&&(!i.length||!Gn(i,(function(e){return!e.$hiddenSheet}))))Gn(this._getCheckboxes(),(function(e){return!e.config.$hiddenSheet})).setValue(1);this.elements.$all.setValue(!0===this.getValue(!0)?1:0)}this.unblockEvent()}))},setValue:function(e){if(this.elements={},this._count=e.length,e.length>1){var t=[],n=[];e.forEach((function(e){var t='<span class="webix_icon wxi-eye'.concat(e.hidden?"-slash":"",'"></span>');n.push({view:"checkbox",labelRight:t+e.name,name:e.name,value:e.active,$hiddenSheet:e.hidden})}));var i=n.length*webix.skin.$active.inputHeight,r=i>400;t.push({view:"scrollview",body:{rows:n},scroll:r,height:r?400:i}),t.push({template:"<div class='ss_sep_line'></div>",height:10}),t.push({view:"checkbox",labelRight:webix.i18n.spreadsheet.labels["export-all-sheets"],name:"$all",value:0}),webix.ui(t,this)}else this.getChildViews().length>1&&webix.ui([{height:1e-6}],this)},getValue:function(e){for(var t=this._getCheckboxes(),n=[],i=0;i<t.length;i++)if(t[i].getValue()){var r=t[i].config;n.push(e?r:r.name)}return n.length==this._count||n},_getCheckboxes:function(){var e=this.queryView("scrollview");return e?e.getBody().getChildViews():[]}},webix.ui.form),webix.protoUI({name:"formlist",defaults:{paddingY:5,height:120},$init:function(e){var t=this;e.cols=[{css:"webix_inp_label",template:e.label,width:e.labelWidth,borderless:!0},{view:"list",data:e.data,css:e.css,template:e.template,select:!0,scroll:!1,borderless:!0,on:{onSelectChange:function(){t.getParentView().callEvent("onChange",[])}}}]},setValue:function(e){this.getChildViews()[1].select(e)},getValue:function(){return this.getChildViews()[1].getSelectedId()},refresh:function(){this.getChildViews()[1].refresh()},focus:function(){}},webix.ui.layout),webix.protoUI({name:"ssheet-ui",defaults:{move:!0,css:"webix_shadow_none webix_ssheet_ui",head:!1,resize:!0,toFront:!0,minWidth:50,minHeight:200,escHide:!1,autofit:!1},$init:function(){this.$view.setAttribute("webixignore","1"),this.$ready.push((function(){webix.UIManager.addHotKey("delete",webix.bind(this._removeView,this)),webix.UIManager.addHotKey("backspace",webix.bind(this._removeView,this)),this.getMenu()})),this.attachEvent("onDestruct",(function(){webix.eventRemove(this._clickEv),this._menu.destructor()}))},move_setter:function(e){return e&&webix.DragControl.addDrag(this.$view,this),e},$dragPos:function(e,t){return this.callEvent("onViewMove",[e,t]),e},$dragCreate:function(e,t){var n=t.target;if(n.getAttribute&&!n.getAttribute("webix_disable_drag")&&!n.getAttribute("webixignore")){this.getMenu().hide();var i=webix.html.offset(e),r=webix.html.pos(t),o=webix.html.offset(e.parentNode),a=webix.$$(this.config.master).getScrollState();return webix.DragControl.top=i.y-r.y-o.y,webix.DragControl.left=i.x-r.x-o.x+a.x,webix.toNode(this.$view)}},$dragDestroy:function(e,t){var n=this.config.left=parseInt(t.style.left,10),i=this.config.top=parseInt(t.style.top,10);webix.DragControl.top=webix.DragControl.left=0,this.callEvent("onViewMoveEnd",[n,i])},getMenu:function(){var e=this,t=webix.i18n.spreadsheet.labels;if(!this._menu){var n=[{value:t["export-view"],submenu:[{id:"pdf",value:t["export-view-pdf"]},{id:"png",value:t["export-view-png"]},{id:"excel",value:t["export-view-excel"]}]}];webix.$$(this.config.master).getTopParentView().config.readonly||(n=[{id:"edit",value:t["edit-view"]}].concat(mn(n),[{id:"del",value:t["remove-view"]}])),this._menu=webix.ui({view:"contextmenu",submenuConfig:{externalUI:this.config.id},data:n,on:{onMenuItemClick:function(t){return e._menuActions(t)},onBeforeShow:function(){return e._toggleExcel()}}});var i=webix.html.create("span",{class:"webix_ssheet_view_menu webix_icon wxi-dots"});this._clickEv=webix.event(i,"click",(function(){e._menu.isVisible()?e._menu.hide():e._menu.show(i)})),this.$view.firstChild.appendChild(i)}return this._menu},_menuActions:function(e){switch(e){case"del":this.callEvent("onViewRemove",[]);break;case"edit":this.callEvent("onViewEdit",[]);break;case"pdf":webix.toPDF(this.getBody(),{display:"image"});break;case"png":webix.toPNG(this.getBody());break;case"excel":webix.toExcel(this.getBody(),{header:!1})}},_toggleExcel:function(){var e=this.getBody();e.data&&e.data.pull?this._menu.showMenuItem("excel"):this._menu.hideMenuItem("excel")},_removeView:function(e){e&&e.getTopParentView()==this&&this.callEvent("onViewRemove",[])}},webix.ui.window),webix.protoUI({name:"ssheet-series",$init:function(e){var t=this;this.hidden={},e.rows=[{view:"scrollview",borderless:!0,body:{view:"accordion",css:"webix_ssheet_accordion",margin:webix.skin.$active.layoutMargin.form,multi:!0,type:"clean",rows:[this.getSectionConfig()]},on:{onAfterScroll:function(){webix.callEvent("onClick",[])}}},{view:"button",label:webix.i18n.spreadsheet.labels["add-line"],click:function(){t.addSection()}}]},getSectionConfig:function(e){var t=this,n=this,i=webix.i18n.spreadsheet.labels,r="<span class='webix_icon webix_ssheet_series_icon wxi-trash'></span>",o=webix.skin.$active.dataPadding-2;return{view:"accordionitem",header:"".concat(i["chart-item"]," ").concat(e?e+1:1," ").concat(r),body:{view:"form",padding:o,elementsConfig:{labelWidth:180},on:{onChange:function(){t.callEvent("onChange",[])}},elements:[{view:"text",label:i["chart-range"],name:"range",range:!0,on:{onChange:function(e,t){var i=e.toUpperCase();e!=i&&(this.blockEvent(),this.setValue(i),this.unblockEvent()),n.callEvent("onRangeChange",[i,t])}}},{view:"ssheet-colorpicker",label:i["chart-series-color"],name:"color",hidden:this.hidden.color},{view:"checkbox",label:i["chart-tooltip"],name:"tooltip"},{view:"checkbox",label:i["chart-label"],name:"label",hidden:this.hidden.label},{view:"richselect",label:i["chart-markers"],value:"square",name:"marker",hidden:this.hidden.marker,suggest:{view:"ssheet-form-suggest",data:[{id:"square",value:i["chart-markers-square"]},{id:"triangle",value:i["chart-markers-triangle"]},{id:"diamond",value:i["chart-markers-diamond"]},{id:"round",value:i["chart-markers-round"]}]}}]},onClick:{"wxi-trash":function(){var e=this.getParentView();e.removeView(this);for(var t=e.getChildViews(),o=0;o<t.length;o++)t[o].define({header:"".concat(i["chart-item"]," ").concat(o+1," ").concat(r)}),t[o].refresh();return n.callEvent("onChange",[]),!1}}}},addSection:function(){var e=this.getLayout(),t=e.getChildViews().length,n=e.addView(this.getSectionConfig(t));webix.$$(n).queryView({name:"range"}).focus()},setValue:function(e){e=e||[];var t=this.getLayout().getChildViews(),n=t.length;if(n>e.length)for(var i=n;i>e.length;i--)this.getLayout().removeView(t[i-1]);else if(e.length>n)for(var r=e.length;r>n;r--)this.addSection();for(var o=0;o<t.length;o++){var a=t[o].getChildViews()[0],s=a.queryView({name:"range"});s.blockEvent(),a.setValues(e[o]),s.unblockEvent()}},setSubValue:function(e,t){e.blockEvent(),e.setValue(t),e.unblockEvent()},getLayout:function(){return this.queryView("scrollview").getBody()},hideSubviews:function(e,t){this.hidden[e]=!t,this.queryView({name:e},"all").forEach((function(e){t?e.show():e.hide()}))},getValue:function(){var e=[];return this.getLayout().getChildViews().forEach((function(t){e.push(t.getChildViews()[0].getValues())})),e}},webix.ui.layout),webix.protoUI({name:"ssheet-toolbar-scrollview",$getSize:function(){var e=webix.ui.scrollview.prototype.$getSize.apply(this,arguments),t=this.getBody().$getSize(0,0),n=0;return this.config.scroll?n=webix.env.scrollSize:this.$view.style["overflow-x"]="hidden",e[2]=e[3]=t[2]+n,e},$setSize:function(e,t){var n=this,i=this.getBody().$getSize(0,0),r=this.config.scroll,o=e<i[0]&&"x";if(o!=r)return this.define({scroll:o}),webix.delay((function(){n.resize()}));webix.ui.scrollview.prototype.$setSize.apply(this,[e,t])}},webix.ui.scrollview);var Er=Object.freeze({__proto__:null,getSheetData:Sr,init:function(e){e.attachEvent("onDataParse",(function(t){return function(e,t){var n=t.table||{frozenColumns:0,frozenRows:0};e._frozenColumns=e._frozenRows=0,n&&(webix.isUndefined(n.frozenColumns)||e.freezeColumns(n.frozenColumns),webix.isUndefined(n.frozenRows)||e.freezeRows(n.frozenRows));t.sizes&&e.$$("cells").define("fixedRowHeight",!1)}(e,t)})),e.attachEvent("onDataSerialize",(function(t,n){return function(e,t,n){var i=!n||!1!==n.math,r=e.$$("cells"),o=r.getState(),a=o.ids.concat(o.hidden);a.splice(a.indexOf("rowId"),1),t.data=Sr(e,i),webix.extend(t.table,{frozenColumns:e._frozenColumns||0,frozenRows:e._frozenRows||0})}(e,t,n)})),e.attachEvent("onUndo",(function(t,n,i,r){"value"==t&&function(e,t,n,i){e.setCellValue(t,n,i)}(e,n,i,r)}))}}),$r=["rename-sheet","remove-sheet","copy-sheet","hide-sheet"],Rr={"remove-sheet":function(e){return function(e){e.confirm({text:webix.i18n.spreadsheet.labels["sheet-remove-confirm"]}).then((function(){Ur(e,e._activeSheet)}))}(e)},"rename-sheet":function(e){return zr(e)},"new-sheet":function(e){return qr(e)},"copy-sheet":function(e){return function(e){qr(e,e.serialize())}(e)},"hide-sheet":function(e){return Or(e,e._activeSheet,"hidden")}};function Ar(e){e.attachEvent("onComponentInit",(function(){return function(e){jr(e),e.attachEvent("onAfterSheetShow",(function(t){return function(e,t){e.$$("sheets")&&(e.$$("sheets").select(t),e.$$("sheets").showItem(t))}(e,t)})),e.attachEvent("onCommand",(function(e){Rr[e.id]&&Rr[e.id](this)})),e.$$("sheets")&&(e.$$("sheets").data.attachEvent("onStoreUpdated",(function(){Mr(e),Nr(e)})),e.$$("sheets").attachEvent("onAfterRender",webix.once((function(){webix.delay((function(){return Mr(e)}))}))),e.$$("sheets").attachEvent("onAfterScroll",(function(){return Nr(e)})),e.$$("sheets").attachEvent("onAfterDrop",(function(t){return function(e,t,n){for(var i in e._sheets)if(e._sheets[i].name==t){var r=e._sheets.splice(i,1);e._sheets.splice(n,0,r[0]);break}}(e,t.start,t.index)})),e.$$("sheets").attachEvent("onAfterEditStop",(function(t){return Lr(e,t.old,t.value)})))}(e)}))}var kr=[.5,.75,.9,1,1.1,1.25,1.5,1.75,2,3,4];function Tr(e){var t=webix.i18n.spreadsheet.tooltips,n=e.config.readonly,i=e.config.sheetTabWidth,r="auto"==i?e.defaults.sheetTabWidth:i,o={view:"toolbar",id:"bottom-toolbar",css:"webix_ssheet_bottom_toolbar webix_layout_toolbar",paddingY:0,height:34,elements:[{hidden:n,padding:{top:2,bottom:2,left:4},cols:[{view:"icon",icon:"wxi-plus",width:30,id:"add-sheet",click:function(){return qr(e)},tooltip:webix.i18n.spreadsheet.tooltips["add-sheet"]},{view:"icon",icon:"wxi-dots",width:30,id:"show-sheet",popup:Vr(e),tooltip:webix.i18n.spreadsheet.tooltips["show-sheet"]}]},{id:"sheets",view:"sheets",maxWidth:5*r,minWidth:r,editable:!n,editaction:"dblclick",editor:"text",editValue:"value",type:{width:i,height:32,template:function(e){return"<div style='"+(n?"width: 100%;padding-right:9px;":"width:calc(100% - 20px);")+"'>"+e.value+"</div>"+(n?"":"<div class='webix_input_icon wxi-menu-down webix_ssheet_sheet_arrow'></div>")},css:"ssheet_order_sheets"},onClick:{webix_ssheet_sheet_arrow:function(t,n){!function(e,t,n){e.$sheetMenu||(e.$sheetMenu=webix.ui(function(e){for(var t=[],n=0;n<$r.length;n++)t.push({id:$r[n],value:webix.i18n.spreadsheet.menus[$r[n]]||$r[n]});var i={view:"ssheet-suggest",data:t};return e.callEvent("onViewInit",["sheet-menu",i]),i}(e)),e._destroy_with_me.push(e.$sheetMenu),e.$sheetMenu.attachEvent("onItemClick",(function(t){return function(e,t){e.$sheetMenu.data.getMark(t,"webix_disabled")||(Rr[t]?Rr[t](e):e.callEvent("onCommand",[{id:t}]))}(e,t)})));var i=1==e.$$("sheets").count();e.$sheetMenu.getItem("remove-sheet")&&e.$sheetMenu[i?"disableItem":"enableItem"]("remove-sheet");e.$sheetMenu.getItem("hide-sheet")&&e.$sheetMenu[i?"disableItem":"enableItem"]("hide-sheet");e.callEvent("onBeforeSheetMenu",[n])&&e.$sheetMenu.show(t)}(e,t,n)}},on:{onItemClick:function(t){t!=e._activeSheet&&e.showSheet(t)}}},{view:"button",type:"htmlbutton",width:34,id:"prev-sheet",disabled:!0,hidden:!0,label:"<span class='webix_icon wxi-menu-left'></span>",batch:"pager",click:function(){Ir(e,-1)}},{view:"button",type:"htmlbutton",width:34,id:"next-sheet",hidden:!0,label:"<span class='webix_icon wxi-menu-right'></span>",batch:"pager",click:function(){Ir(e,1)}},{gravity:1e-6},{view:"ssheet-zoom",numbers:kr,value:1,width:108,tooltip:t.scale,id:"zoom",on:{onChange:function(t,n,i){"user"==i&&e.zoom(t)}}}]};return e.callEvent("onViewInit",["bottom-toolbar",o]),o}function Ir(e,t){var n=e.$$("sheets"),i=e.config.sheetTabWidth;"auto"==i&&(i=e.defaults.sheetTabWidth),n.scrollTo(n.getScrollState().x+t*i,0)}function Vr(e){return{view:"popup",css:"webix_ssheet_suggest",width:125,body:{view:"list",select:!0,css:"webix_ssheet_show_list",template:"<span class='webix_icon wxi-#icon#'></span>#id#",on:{onAfterSelect:function(t){Or(e,t,"visible"),e.showSheet(t),this.getParentView().hide()}},maxHeight:200,autoheight:!0},on:{onShow:function(){this.getBody().showItem(e.getActiveSheet())},onBeforeShow:function(){var t=e._sheets.filter((function(e){return"veryHidden"!=e.state})).map((function(e){return{id:e.name,icon:"hidden"==e.state?"eye-slash":"eye"}})),n=this.getBody();n.clearAll(),n.parse(t),n.select(e.getActiveSheet())}}}}function Nr(e){var t=e.$$("sheets"),n=t.getScrollState().x;if(0==n)e.$$("prev-sheet").disable();else if(e.$$("prev-sheet").enable(),t.$view.scrollWidth-n==t.$width)return e.$$("next-sheet").disable();e.$$("next-sheet").enable()}function Mr(e){var t=e.$$("sheets");e.$$("bottom-toolbar").showBatch("pager",t.$width!=t.$view.scrollWidth)}function Or(e,t,n){var i=Yr(e,t);if(n!=i.state&&("visible"!=n||i.state)){if("visible"!=n){var r=Pr(e);if(1==r.length&&r[0]===i)return;t==e._activeSheet&&Fr(e,t)}i.state=n,Dr(e),e.callEvent("onSheetStateChange",[t,n])}}function Dr(e){var t=e.$$("sheets");t&&t.filter((function(t){var n=Yr(e,t.id).state;return"hidden"!=n&&"veryHidden"!=n}))}function qr(e,t,n,i){var r,o;return r=Kn(e._sheets,(function(t){return t.name==e._activeSheet})),o=r>-1?r+1:e._sheets.length,n&&!Gn(e._sheets,(function(e){return e.name==n}))||(n=function(e){var t=e._sheets.length+1;for(;Yr(e,webix.i18n.spreadsheet.labels.sheet+t);)t++;var n=webix.i18n.spreadsheet.labels.sheet+t;return n}(e)),t=t||{data:[]},e._sheets.splice(o,0,{name:n,content:t}),e.$$("sheets")&&e.$$("sheets").add({id:n,value:n},o),e._mData.addPage(n),Br(e,n,t,e.config.prepareData),!1!==i&&e.showSheet(n),e.callEvent("onSheetAdd",[n]),n}function zr(e,t){t||(t=e._activeSheet),e.$$("sheets").edit(t)}function Pr(e){return e._sheets.filter((function(e){return"hidden"!=e.state&&"veryHidden"!=e.state}))}function Fr(e,t){var n=Pr(e),i=Kn(n,(function(e){return e.name==t})),r=i-1;n[r]||(r=0),n.splice(i,1),e.showSheet(n[r].name)}function Ur(e,t){if(e._sheets.length>1){var n=Pr(e);if(1==n.length&&n[0]===Yr(e,t))return;e._activeSheet==t&&Fr(e,t);var i=Kn(e._sheets,(function(e){return e.name==t}));e._sheets.splice(i,1),e._mData.removePage(t),e.$$("sheets")&&(e.$$("sheets").remove(t),e.$$("sheets").refresh()),e.callEvent("onSheetRemove",[t])}}function Lr(e,t,n){if(t!=n){for(var i=1;!n||Yr(e,n);)n=webix.i18n.spreadsheet.labels.sheet+i,i++;n=n.replace(/[*?:[\]\\/]/g,"").substring(0,31);var r=Yr(e,t),o=e.$$("sheets");if(r.name=n,e._activeSheet==t&&(e._activeSheet=n),o)o.getItem(t).value=n,o.data.changeId(t,n),o.refresh(n);e._mData.renamePage(t,n),e.callEvent("onSheetRename",[t,n])}}function Br(e,t,n,i){e.ranges.parse(n.ranges,t),webix.extend(n,{styles:[],formats:[],editors:[]});var r=e._mData.getPage(t),o=n.data.map((function(r){var o=webix.isUndefined(r[2])||null===r[2];if(i){if(o)r[2]="";else{var a=/^=link\(/i;"string"==typeof r[2]&&a.test(r[2])&&(r[2]=r[2].replace(a,"=HYPERLINK("))}var s=pr(e,n,r);r[2]=s.value,r[3]=r[3]||"",r[4]=s.type,Hr(r,n)}else if(o)throw"unsupported value in ".concat(zn(t),"!").concat(Vn[r[0]]).concat(r[1]);return[r[0]-1,r[1]-1,{value:r[2],type:r[4],style:r[3],$format:nr({fmt:ar(n,r)},"string")?1:0}]}));r.parse(o,!0)}function Hr(e,t,n){var i="date"==e[4];if(i||n){var r="string"==typeof e[2],o=n&&r&&/^=hyperlink\(/i.test(e[2]),a=e[3]?Gn(t.styles,(function(t){return t[0]==e[3]})):null,s=a?wi(a[1]):{},l=i&&t.editors?Gn(t.editors,(function(t){return t[0]==e[0]&&t[1]==e[1]})):null;if(i&&(!a||!s.format)||o){var u={};o?(e[3]="wss_link"+(a?"_"+e[3]:""),u={color:"#0000ff",underline:"underline"}):r&&/^=time\(/i.test(e[2])?(e[3]="wss_load_time"+(a?"_"+e[3]:""),u.format=e[3]+"_fmt",t.formats.push([u.format,webix.i18n.spreadsheet.formats.timeFormat])):(e[3]="wss_load_date"+(a?"_"+e[3]:""),u.format="date"),i&&!l&&(t.editors||(t.editors=[]),t.editors.push([e[0],e[1],{editor:"excel_date"}])),Gn(t.styles,(function(t){return t[0]==e[3]}))||t.styles.push([e[3],bi({props:webix.extend(s,u,!0)})])}}}function jr(e,t,n){t||(t={data:[]}),t.sheets||(t=Wr(t)),e._activeSheet="",e._sheets=t.sheets,e._mData=new nn({strict:e.config.strict}),t.sheets.forEach((function(t){e._mData.addPage(t.name)})),t.sheets.forEach((function(t){var i=t.content,r=t.name;Br(e,r,i,n)})),function(e,t){var n=e.$$("sheets");if(n){n.clearAll();var i=[];t.sheets.forEach((function(e){i.push({id:e.name,value:e.name})})),n.parse(i),Dr(e)}}(e,t),Xr(e,Pr(e)[0].name)}function Wr(e){return{sheets:[{name:webix.i18n.spreadsheet.labels.sheet+1,content:e}]}}function Xr(e,t){if(t!=e._activeSheet&&e.callEvent("onBeforeSheetShow",[t])){e._activeSheet&&(Yr(e,e._activeSheet).content=e.serialize()),e._activeSheet=t;var n=Yr(e,t).content;e._mPage=e._mData.getPage(t),Kr(e,n),e.callEvent("onAfterSheetShow",[t])}}function Yr(e,t){return Gn(e._sheets,(function(e){return e.name==t}))}function Gr(e,t){return"hidden"!=(t=Yr(e,t)).state&&"veryHidden"!=t.state}function Kr(e,t){var n=gn(Qn(Sr(e),t.spans,e.config.rowCount,e.config.columnCount),2),i=n[0],r=n[1];i==e.config.rowCount&&r==e.config.columnCount||(e.config.rowCount=i,e.config.columnCount=r,e._resetTable()),On(r),e.callEvent("onReset",[]),e._loading_data=!0,e.callEvent("onDataParse",[t]),e._loading_data=!1,e._table.refresh(),e.config.bottombar&&e.$$("sheets").refresh()}function Qr(e,t,n){for(var i=[],r=e.$$("cells"),o=r.getState().order,a=r.data.order,s=n||e._zoom,l=r.config.columnWidth,u=r.config.rowHeight,c=1;c<o.length;c++){var h=Math.ceil(r.getColumnConfig(o[c]).width/s);h&&h!=l&&i.push([0,c,h])}for(var d=0;d<a.length;d++){var f=Math.ceil(r.getItem(a[d]).$height/s);f&&f!=u&&i.push([1*a[d],0,f])}t.sizes=i}function Zr(e,t){var n=1;t.table&&t.table.zoom&&(n=t.table.zoom);for(var i=e.$$("cells"),r=i.config.columnWidth,o=i.config.rowHeight,a=1;a<=e.config.rowCount;a++){e.$$("cells").getItem(a).$height=o*n}var s=("contrast"==webix.skin.$name||"flat"==webix.skin.$name?24:20)*n,l=e.getColumn("rowId");l.width=40*n,l.header[0].height=s;for(var u=1;u<=e.config.columnCount;u++){var c=e.getColumn(u);c.header[0].height=s,c.width=r*n}if(t.sizes)for(var h=0;h<t.sizes.length;h++){var d=t.sizes[h];if(1*d[0]!=0){var f=e.$$("cells").getItem(d[0]);f&&(f.$height=d[2]*n)}else{var g=e.getColumn(d[1]);g&&(g.width=d[2]*n)}}e.refresh(!0)}function Jr(e,t){var n={table:{zoom:e._zoom}};Qr(e,n,t),Zr(e,n)}function eo(e,t,n){if(!e._loading_data){var i=ai(e,{row:t,column:n});if(i&&i.props.wrap){var r=e._table,o=r.getItem(t),a=o.$height||r.config.rowHeight;r.eachColumn((function(n,i){var o=ai(e,{row:t,column:n});if(o&&o.props&&"wrap"===o.props.wrap){var s,l=this.getText(t,n),u=i.width,c=r.getSpan(t,n);if(c){var h=r.getSpanNode({row:c[0],column:c[1]});u=h.offsetWidth,s=h.offsetHeight}(e.getCellEditor(t,n)||e.getCellFilter(t,n))&&(u+=20);var d=mi(e,l,o.id,u).height;s&&(d=s>=d?0:d-s+a),a=Math.max(a,d)}})),o.$height=a}}}var to=Object.freeze({__proto__:null,init:function(e){if(e.config.resizeCell){var t=e.$$("cells");t.define("resizeRow",{headerOnly:!0,size:10}),t.define("resizeColumn",{headerOnly:!0,size:10}),t.define("fixedRowHeight",!1),t.attachEvent("onRowResize",(function(t){e.$$("cells").refreshSelectArea(),kn(e,"sizes",{row:t,column:0,size:e.$$("cells").getItem(t).$height,page:e.getActiveSheet()})})),t.attachEvent("onColumnResize",(function(t){e.$$("cells").refreshSelectArea(),kn(e,"sizes",{row:0,column:t,size:e.getColumn(t).width,page:e.getActiveSheet()})})),e.attachEvent("onUndo",(function(t,n,i,r){"c-resize"!=t&&"r-resize"!=t||function(e,t,n,i){var r=e.$$("cells");t?(r.getItem(t).$height=i,kn(e,"sizes",{row:t,column:0,size:i,page:e.getActiveSheet()})):r.setColumnWidth(n,i);r.refreshSelectArea()}(e,n,i,r)}))}e.attachEvent("onDataParse",(function(t){Zr(e,t)})),e.attachEvent("onDataSerialize",(function(t){Qr(e,t)})),e.attachEvent("onAction",(function(e,t){"before-grid-change"==e&&function(e,t,n,i,r){var o,a=i.sizes,s=[];if(n){for(o=a.length-1;o>=0;o--){var l=gn(a[o],3),u=l[0],c=l[1],h=l[2];if(u&&"row"==t&&u>=r.row){if(n<0&&u<r.row-n)continue;s.push([1*u+n,c,h])}else if(c&&"column"==t&&c>=r.column){if(n<0&&c<r.column-n)continue;s.push([u,1*c+n,h])}else s.push(a[o])}if(n>0)if("column"==t)for(var d=function(e){var t=Gn(a,(function(t){return t[1]==r.column+e}));t&&s.push([0,r.column+e,t[2]])},f=0;f<n;f++)d(f);else for(var g=function(e){var t=Gn(a,(function(t){return t[0]==r.row+e}));t&&s.push([r.row+e,0,t[2]])},m=0;m<n;m++)g(m);i.sizes=s}}(0,t.name,t.inc,t.data,t.start)})),e.attachEvent("onBeforeStyleChange",(function(t,n,i,r){!r||"wrap"!==r.props.wrap||i&&i.props.wrap==r.props.wrap||delete e._table.getItem(t).$height})),e.attachEvent("onStyleChange",(function(t,n){return eo(e,t,n)})),e.attachEvent("onCellChange",(function(t,n,i,r){r==e.getActiveSheet()&&eo(e,t,n)}))},load:Zr,zoomSizes:Jr}),no="webix_lock";function io(e,t,n,i,r,o,a){var s=e.getActiveSheet();o||(o=s);var l=e.$$("cells");if("object"===pn(t)&&"object"===pn(n))wn.set((function(){!function(e,t,n,i){for(var r=e.row;r<=t.row;r++)for(var o=e.column;o<=t.column;o++)n.call(this,r,o)}(t,n,(function(t,n){io(e,t,n,i,!0,o,!0)}))}));else if(i=!1!==i,o==s){(e._locks[t]=e._locks[t]||{})[n]=i,i?l.addCellCss(t,n,no,!0):l.removeCellCss(t,n,no,!0)}else{var u=Gn(e._sheets,(function(e){return e.name==o}));if(u){var c=u.content.locked;if(c){var h=u.content.locked,d=Kn(h,(function(e){return e[0]==t&&e[1]==n}));i?-1==d&&h.push([t,n]):-1!=d&&h.splice(d,1)}else!c&&i&&(u.content.locked=[[t,n]])}}a||e.callEvent("onAction",["lock",{row:t,column:n,value:!i,newValue:i}]),r||l.refresh()}function ro(e,t,n,i){return i&&i!=e.getActiveSheet()?!(!(i=Gn(e._sheets,(function(e){return e.name==i})))||!i.content.locked)&&!!Gn(i.content.locked,(function(e){return e[0]==t&&e[1]==n})):e._locks[t]&&e._locks[t][n]||!1}var oo=Object.freeze({__proto__:null,init:function(e){e._locks={},e.attachEvent("onReset",(function(){return function(e){e._locks={}}(e)})),e.attachEvent("onUndo",(function(t,n,i,r){"lock"===t&&io(e,n,i,!!r,!0)})),e.attachEvent("onCommand",(function(t){"lock-cell"===t.id&&function(e){var t=e.$$("cells").getSelectArea();if(t){var n=e.isCellLocked(t.start.row,t.start.column);e.lockCell(t.start,t.end,!n)}}(e)})),e.attachEvent("onAction",(function(e,t){"before-grid-change"==e&&function(e,t,n,i,r){var o=i.locked,a=o.length;if(n)for(;a--;){var s=gn(o[a],2),l=s[0],u=s[1];(l&&"row"==t&&l>=r.row||u&&"column"==t&&u>=r.column)&&("row"==t?l<r.row-n?o.splice(a,1):o[a][0]=1*l+n:"column"==t&&(u<r.column-n?o.splice(a,1):o[a][1]=1*u+n))}}(0,t.name,t.inc,t.data,t.start)}))},isCellLocked:ro,load:function(e,t){var n=t.locked;if(n)for(var i=0;i<n.length;i++)io(e,n[i][0],n[i][1],!0,!0)},lockCell:io,lockCss:no,serialize:function(e,t){var n=[];for(var i in e._locks)for(var r in e._locks[i])e._locks[i][r]&&n.push([i,r]);t.locked=n}});function ao(e,t,n){var i=e.$$("cells").getSpan()[t];if(i)return i[n]}function so(e,t){var n=[],i=e.$$("cells").getSpan();if(i){for(var r in i){var o=i[r];for(var a in o){var s=o[a];n.push([1*r,1*a,s[0],s[1]])}}t.spans=n}return t}function lo(e,t,n,i,r,o){if(o=o||e.getActiveSheet(),!(n<2&&i<2)&&(r||e.callEvent("onBeforeSpan",[t.row,t.column,[n,i],o]))){if(o==e.getActiveSheet()){var a=e._mPage.getCell(t.row-1,t.column-1),s=a&&a.style||"",l=fo(e,t.row,t.column);l&&(s+=" "+l),e.$$("cells").addSpan(t.row,t.column,n,i,null,s)}else{var u=Yr(e,o);u&&(u.content.spans||(u.content.spans=[]),u.content.spans.push([t.row,t.column,i,n]))}!function(e,t,n,i,r){for(var o=1*t.row,a=1*t.column,s=!e.getCellValue(o,a,r),l=o;l<o+i;l++)for(var u=a;u<a+n;u++){var c=e.getCellValue(l,u,r);""===c||u==a&&l==o||(s&&(s=!1,e.setCellValue(o,a,c,r)),e.setCellValue(l,u,"",r))}}(e,t,n,i,o),r||(e.callEvent("onAfterSpan",[t.row,t.column,[n,i],o]),kn(e,"spans",{page:o,row:t.row,column:t.column,x:n,y:i}))}}function uo(e,t,n){var i,r,o,a=(n=n||e.getActiveSheet())==e.getActiveSheet();a?i=e.$$("cells").getSpan(t.row,t.column):(o=Yr(e,n))&&o.content.spans&&(r=Kn(o.content.spans,(function(e){return e[0]==t.row&&e[1]==t.column})),-1!=r&&(i=o.content.spans[r])),i&&e.callEvent("onBeforeSplit",[t.row,t.column,[i[2],i[3]],n])&&(a?e.$$("cells").removeSpan(t.row,t.column):o.content.spans.splice(r,1),e.callEvent("onAfterSplit",[t.row,t.column,[i[2],i[3]],n]),kn(e,"spans",{row:t.row,column:t.column,x:0,y:0,page:n}))}function co(e){var t,n,i,r;i=r=0,t=n=1/0;for(var o=0;o<e.length;o++){var a=1*e[o].column,s=1*e[o].row;t=Math.min(a,t),i=Math.max(a,i),n=Math.min(s,n),r=Math.max(s,r)}return{cell:{row:n,column:t},x:i-t+1,y:r-n+1}}function ho(e,t,n,i,r){var o=ao(e,t,n);o&&(r?-1==o[3].indexOf(i)&&(o[3]+=" "+i):o[3]=o[3].replace(" "+i,""))}function fo(e,t,n){var i=[];return e.getCellEditor(t,n)&&i.push("ss_editor"),e.getCellFilter(t,n)&&i.push("ss_filter"),i.join(" ")}var go={"border-right":function(e,t,n,i){return i.end.column==t+n[0]-1},"border-bottom":function(e,t,n,i){return i.end.row==e+n[1]-1}};function mo(e,t,n,i,r,o,a){var s="row"==t.group?e[3]:e[2],l="row"==t.group?[1*e[0],1*e[0]+e[3]-1]:[1*e[1],1*e[1]+e[2]-1],u="row"==t.group?[n.row,i.row]:[n.column,i.column],c=u[1]-u[0]+1;u[0]=Math.max(u[0],l[0]),u[1]=Math.min(u[1],l[1]);var h=u[0]==l[0];if(u[0]<=u[1]){if("del"==t.id&&(c=-1*(u[1]-u[0]+1)),"del"==t.id&&h&&s>-1*c){var d=Gn(o,(function(t){return t[0]==e[0]&&t[1]==e[1]}));d&&a.push(d)}h&&"add"==t.id||(e[2]="column"==t.group?e[2]+c:e[2],e[3]="row"==t.group?e[3]+c:e[3])}return e}function vo(e,t,n,i,r,o){var a=e._table.getSpan(n,i);if(t&&t.span){var s=t.span;n==1*s[0]+o.row&&i==1*s[1]+o.column&&(e._table.mapCells(n,i,s[3],s[2],(function(t,n,i){(a=e._table.getSpan(n,i))&&uo(e,{row:a[0],column:a[1]})}),!0),lo(e,{row:n,column:i},s[2],s[3]),1===r&&uo(e,{row:t.row,column:t.col}))}else a&&uo(e,{row:a[0],column:a[1]})}var po=Object.freeze({__proto__:null,addSpan:lo,adjustSpan:mo,getRange:co,init:function(e){e.attachEvent("onStyleChange",(function(t,n,i){var r=ao(e,t,n);if(r){var o=fo(e,t,n);r[3]=(i?i.id:"")+(o?" "+o:"")}})),e.attachEvent("onDataParse",(function(t){!function(e,t){if(t.spans)for(var n=0;n<t.spans.length;n++){var i=t.spans[n];lo(e,{row:i[0],column:i[1]},1*i[2],1*i[3],!0)}}(e,t)})),e.attachEvent("onDataSerialize",(function(t){so(e,t)})),e.attachEvent("onUndo",(function(t,n,i,r,o){"span"!=t&&"split"!=t||("span"==t&&(o=!o),function(e,t,n,i,r){r?uo(e,{row:t,column:n}):lo(e,{row:t,column:n},i[0],i[1])}(e,n,i,r,o))})),e.attachEvent("onAction",(function(t,n){if("lock"==t&&n.page==e.getActiveSheet())ho(e,n.row,n.column,no,n.newValue);else if("before-grid-change"==t)!function(e,t,n,i,r){var o=i.spans;if(n)for(var a=o.length-1;a>=0;a--){var s=gn(o[a],2),l=s[0],u=s[1];n<0&&("row"==t&&l<=r.row-n-1?n=r.row-o[a][0]:"column"==t&&u<=r.column-n-1&&(n=r.column-o[a][1])),("row"==t&&l>=r.row||"column"==t&&u>=r.column)&&(o[a][0]="row"==t?1*l+n:l,o[a][1]="column"==t?1*u+n:u)}}(0,n.name,n.inc,n.data,n.start);else if("check-borders"==t)return function(e,t,n,i,r){var o=ao(e,t,n);return!(!o||!go[r])&&go[r](t,n,o,i)}(e,n.row,n.column,n.area,n.mode)}))},pasteSpan:vo,removeSpan:uo,serialize:so,setSpanCss:ho});function bo(e,t,n){var i=[],r={},o=e._activeSheet,a=function(e,t,n,i,r){var o=webix.html.create("div",{class:"webix_ssheet_print"});t.xCorrection=1,t.header=t.header||!1,t.trim=!!webix.isUndefined(t.trim)||t.trim,t.sheetnames=!!webix.isUndefined(t.sheetnames)||t.sheetnames;var a=e.$index,s=wo(t),l=t.sheets,u=t.data;l&&"current"!=u&&"selection"!=u?"string"==typeof l?l=[l]:!0!==l&&"all"!=u||(l=e._sheets.map((function(e){return e.name}))):l=[n];return l=l.filter((function(t){return Gr(e,t)})),l.forEach((function(l,u){e.$index=a+"_"+u;var c=e.$$("cells");e.showSheet(l);var h=e._zoom;e.ignoreUndo((function(){return e.zoom(1)}));var d="wss_"+e.$index;e._print=!0;var f=c.$customPrint(t,!0);delete e._print;var g=f.firstChild;if(g){for(var m=gn(g.children,2),v=m[0],p=m[1],b=v.childElementCount,w=t.sheetnames?20:0,_=w,x=1;x<=b;x++)_+=c.getItem(x).$height||c.config.rowHeight;if(_>s.height/4)for(var y=b-1;y>=0;y--)p.firstChild?webix.html.insertBefore(v.children[y],p.firstChild):p.appendChild(v.children[y]);if(w){var C=webix.html.create("tr",{class:"webix_ssheet_sheetname"},"<td>".concat(l,":</td>"));v.firstChild?webix.html.insertBefore(C,v.firstChild):v.appendChild(C)}var S=f.firstChild;S&&(l!=n&&webix.html.removeCss(S,"wss_"+a),webix.html.addCss(S,d)),o.appendChild(f)}if(t.external){var E=function(){var n=e.views._pull[$];if("image"==n.type){var a=webix.html.create("IMG",{src:n.data,width:(n.config.width||500)+"px",height:(n.config.height||300)+"px"}),s=webix.promise.defer();i.push(s),a.onload=function(){return s.resolve()},o.appendChild(a)}else{var l=webix.$$($).getBody();if(l.$customPrint){var u=l.$customPrint({size:t.size},!0);u.then?(r[i.length]=o.childElementCount,i.push(u)):o.appendChild(u)}else o.appendChild(function(e){var t=e.$view.cloneNode(!0),n=e.$view.getElementsByTagName("canvas");if(n.length)for(var i=n.length-1;i>=0;i--){t.getElementsByTagName("canvas")[i].getContext("2d").drawImage(n[i],0,0)}var r=webix.html.create("div",{class:"webix_ssheet_ui"});return r.appendChild(t),r}(webix.$$($).getBody()))}};for(var $ in e.views._pull)E()}if(u+1<e._sheets.length&&(g||t.external&&Object.keys(e.views._pull).length)){var R=webix.html.create("DIV",{class:"webix_print_pagebreak"});o.appendChild(R)}e.$index=a,e.ignoreUndo((function(){return e.zoom(h)}))})),o}(e,t,o,i,r);e.showSheet(o);var s=webix.promise.defer();return webix.promise.all(i).then((function(i){for(var o=Object.keys(r).sort(e.$$("cells").data.sorting.as.int),l=o.length-1;l>=0;l--){var u=o[l];a.insertBefore(i[u],a.childNodes[r[u]])}if(n)return s.resolve(a);webix.html.insertBefore(a,t.docFooter,document.body),window.print(),function(e,t){webix.html.remove(t),e._sheets.forEach((function(t,n){webix.html.removeStyle(".wss_"+e.$index+"_"+n)}))}(e,a),s.resolve()})),s}function wo(e){var t=webix.env.printSizes.find((function(t){return t.id==e.paper})),n="landscape"==e.mode,i=e.margin?2*webix.env.printMargin:0;return{width:t[n?"height":"width"]*webix.env.printPPI-i,height:t[n?"width":"height"]*webix.env.printPPI-i}}function _o(e,t){if(!t||e._printBorders.$render){yo(e);for(var n={rows:{},cols:{}},i=e.$$("cells"),r=e._printBorders,o=wo(r),a=r.sheetnames?20:0,s=i.config.topSplit,l=a,u=1;u<=s;u++)l+=(i.getItem(u).$height||i.config.rowHeight)/e._zoom;l>o.height/4&&(s=0,l=a);for(var c=l,h=s+1;h<=e.config.rowCount;h++){var d=(i.getItem(h).$height||i.config.rowHeight)/e._zoom;c+d>o.height&&(c=l,n.rows[1==h?h:h-1]=1),c+=d}if("page"!=r.fit)for(var f=0,g=1;g<=e.config.columnCount;g++){var m=(i.getColumnConfig(g).width||i.config.columnWidth)/e._zoom;f+m>o.width&&(f=0,n.cols[1==g?g:g-1]=1),f+=m}e._printBorders.$render=n,e.refresh()}}function xo(e,t,n){var i="",r=e._printBorders.$render,o=e.$$("cells").getSpan(t,n);if(o){var a=1*o[0]+(o[3]-1),s=1*o[1]+(o[2]-1);ho(e,o[0],o[1],"webix_ss_print_border_right",r&&r.cols[s]),ho(e,o[0],o[1],"webix_ss_print_border_bottom",r&&r.rows[a]);var l=e._printBorders.$renderedSpanBorders;if(r){var u=n!=s&&r.cols[n],c=t!=a&&r.rows[t];(u||c)&&(l[o[0]]||(l[o[0]]={}),l[o[0]][o[1]]||(l[o[0]][o[1]]={}),u&&Co(e,l[o[0]][o[1]],o,n,"right"),c&&Co(e,l[o[0]][o[1]],o,t,"bottom"))}else yo(e)}return r&&(r.cols[n]&&(i+="webix_ss_print_border_right"),r.rows[t]&&(i+=(i?" ":"")+"webix_ss_print_border_bottom")),i}function yo(e){var t=e._printBorders.$renderedSpanBorders;for(var n in t)for(var i in t[n])for(var r in t[n][i])webix.html.remove(t[n][i][r]);e._printBorders.$renderedSpanBorders={}}function Co(e,t,n,i,r){t[r]||(t[r]={});var o=t[r][i],a=e.$$("cells");if(!o){for(var s=0,l=1*n["right"==r?1:0];l<=i;l++)s+="right"==r?a.getColumnConfig(l).width||a.config.columnWidth:a.getItem(l).$height||a.config.rowHeight;o=t[r][i]=webix.html.create("div",{class:"webix_ss_print_border_".concat(r),style:"".concat("right"==r?"left":"top",":").concat(s-1,"px;")})}webix.delay((function(){var e=a.getSpanNode({row:n[0],column:n[1]});e.contains(o)||e.appendChild(o)}))}var So=Object.freeze({__proto__:null,getPrintBordersCss:xo,init:function(e){e.$customPrint=function(t,n){return bo(e,t,n)},e._printBorders={paper:webix.env.printSizes.find((function(e){return"a4"==e.id}))?"a4":webix.env.printSizes[0].id,fit:"page",mode:"landscape",margin:1,sheetnames:1,$renderedSpanBorders:{}},e.attachEvent("onUndo",(function(t,n,i,r){"print-borders"==t&&e.showPrintBorders(r)})),e.attachEvent("onAfterSheetShow",(function(){return _o(e,!0)})),e.attachEvent("onChange",(function(t,n){"update"==t&&n==e.getActiveSheet()&&_o(e,!0)})),e.attachEvent("onAfterSplit",(function(t,n,i,r){var o=e._printBorders.$renderedSpanBorders;if(r==e.getActiveSheet()&&o[t]&&o[t][n]){for(var a in o[t][n])webix.html.remove(o[t][n][a]);delete o[t][n]}}))},print:bo,removePrintInnerBorders:yo,showBorders:_o}),Eo={};function $o(e,t,n,i){var r;if((i=i||e.getActiveSheet())==e.getActiveSheet()){var o=e.$$("cells");if(r=e._zoom||1,"in"!=t&&"out"!=t||(t=ko(r,"in"==t?1:-1,kr)),e._zoom=t,o.define({minColumnWidth:40*t}),e.$$("zoom")&&e.$$("zoom").setValue(t),t!=r){var a=webix.skin.$active.fontSize*t,s="contrast"==webix.skin.$name||"flat"==webix.skin.$name?24:20,l="webix_ssheet_zoom_"+t.toString().replace(".","_");o.$view.className=o.$view.className.replace(/ webix_ssheet_zoom_\w+/,""),o.define({css:l}),n||(yo(e),Jr(e,r),oi(e)),Eo[l]||1==t||(Eo[l]=1,webix.html.addStyle("\n\t\t\t\t\t.".concat(l," .webix_hcell, .").concat(l," .webix_cell{\n\t\t\t\t\t\tfont-size: ").concat(a,"px;\n\t\t\t\t\t}\n\n\t\t\t\t\t.").concat(l," .sheet_column_0 .webix_cell{\n\t\t\t\t\t\tpadding: 0 ").concat(12*t,"px;\n\t\t\t\t\t}\n\n\t\t\t\t\t.").concat(l,".webix_ssheet_table .webix_hs_left .webix_hcell.webix_first:before{\n\t\t\t\t\t\tright: ").concat(4*t,"px;\n\t\t\t\t\t\tbottom: ").concat(4*t,"px;\n\t\t\t\t\t\tborder-top-width: ").concat((s-8)*t,"px;\n\t\t\t\t\t\tborder-right-width: ").concat((s-8)*t,"px;\n\t\t\t\t\t}\n\n\t\t\t\t\t.").concat(l," .webix_cell{\n\t\t\t\t\t\tpadding: ").concat(2*t,"px 0px;\n\t\t\t\t\t}\n\n\t\t\t\t\t.").concat(l," .webix_cell div:first-child{\n\t\t\t\t\t\tmargin: 0 ").concat(12*t,"px;\n\t\t\t\t\t}\n\t\t\t\t")),webix.html.addStyle("\n\t\t\t\t\t.".concat(l," .webix_cell.ss_filter, .").concat(l," .webix_cell.ss_editor{\n\t\t\t\t\t\tpadding-right: ").concat(16*t,"px;\n\t\t\t\t\t}\n\t\t\t\t\t.").concat(l," .ssheet_filter_sign, .").concat(l," .webix_cell.ss_editor:after{\n\t\t\t\t\t\tfont-size: ").concat(20*t,"px;\n\t\t\t\t\t\tright: ").concat(6*t,"px;\n\t\t\t\t\t}\n\t\t\t\t\t.").concat(l," .webix_cell.ss_filter.ss_editor:after{\n\t\t\t\t\t\tright: ").concat(28*t,"px;\n\t\t\t\t\t}\n\t\t\t\t\t.").concat(l," .webix_cell.ss_filter.ss_editor{\n\t\t\t\t\t\tpadding-right: ").concat(36*t,"px;\n\t\t\t\t\t}\n\t\t\t\t\t.").concat(l," .webix_lock:before{\n\t\t\t\t\t\tfont-size: ").concat(a,"px;\n\t\t\t\t\t}\n\t\t\t\t\t.").concat(l," .ssheet_commented_sign:before{\n\t\t\t\t\t\tborder-top-width: ").concat(8*t,"px;\n\t\t\t\t\t\tborder-left-width: ").concat(8*t,"px;\n\t\t\t\t\t}\n\t\t\t\t")))}}else{var u=Yr(e,i);if(!u)return;u.content.table||(u.content.table={zoom:1}),r=u.content.table.zoom,"in"!=t&&"out"!=t||(t=ko(r,"in"==t?1:-1,kr)),u.content.table.zoom=t}n||r==t||e.callEvent("onZoom",[t,r,i])}function Ro(e,t){t.table={zoom:e._zoom}}function Ao(e,t){var n=1;t.table&&t.table.zoom&&(n=t.table.zoom),$o(e,n,!0)}function ko(e,t,n){var i,r=n.indexOf(e);if(-1!=r)return n[r+t]||e;for(var o=0;o<n.length;o++)if(n[o]>e){if(t<0&&-1==--o)return e;i=n[o];break}return t<0&&!i&&(i=n[n.length-1]),i||e}var To=Object.freeze({__proto__:null,getNext:ko,init:function(e){e.attachEvent("onUndo",(function(t,n,i,r){"zoom"==t&&$o(e,r)})),e.attachEvent("onDataSerialize",(function(t){return Ro(e,t)})),e.attachEvent("onDataParse",(function(t){return Ao(e,t)}))},load:Ao,serialize:Ro,zoom:$o});webix.protoUI({name:"ssheet-zoom",$cssName:"counter webix_ssheet_zoom",$init:function(){var e=this;this.attachEvent("onAfterRender",(function(){e.$setValue(e.config.value),e.getInputNode().readOnly=!0,webix.event(e.$view.firstChild,"keydown",(function(e){return webix.html.preventEvent(e)}))}))},$setValue:function(e){this.getInputNode().value=parseInt(100*e,10)+"%"},shift:function(e,t){var n=ko(this.config.value,e,this.config.numbers);this.setValue(n,t)}},webix.ui.counter),webix.editors.excel_date=webix.extend({createPopup:function(){var e=webix.editors.excel_date;if(!e.popup){var t=webix.ui({view:"popup",body:{view:"calendar",icons:!0,timepicker:!0,on:{onChange:function(e){e=e[0],this.getParentView()._last_input_target.value=e?Sn(e):"",webix.callEvent("onEditEnd",[])}}},on:{onEnter:function(){webix.callEvent("onEditEnd",[])}}});e.popup=t.config.id}return e.popup},render:function(){var e=this,t=webix.html.create("div",{class:"webix_dt_editor"},"<input type='text'>");return this.popup=this.createPopup(),webix.event(t.firstChild,"click",(function(){return e.getPopup().show(t)})),t},getPopup:function(){return webix.$$(this.popup)},showPopup:function(){var e=this.getInputNode(),t=this.getPopup();t._last_input_target=e,t.show(e),e.setAttribute("aria-expanded","true")},updateCalendar:function(e){var t=this.getPopup().getBody();t.blockEvent(),t.setValue(e),t.unblockEvent()},afterRender:function(){this.showPopup()},setValue:function(e){e=""===e||isNaN(1*e)?new Date:Cn(e),this.updateCalendar(e);var t=webix.$$(this.config.node).queryView((function(e){return"spreadsheet"===e.name}),"parent"),n=or(t,this.config.row.id,this.config.id);this.getInputNode().value=n(e)},getValue:function(){var e=this.getInputNode().value;return this.getPopup().hide(),e}},webix.editors.text),webix.editors.ss_richselect=webix.extend({getFormat:function(e){var t,n=this.getInputNode();return e&&n.exists(e)&&(t=n.getItem(e)),t&&t.format},popupInit:function(e){webix.editors.richselect.popupInit.apply(this,arguments),e.getList().define("template",(function(e){return e.$value||e.value}))}},webix.editors.richselect);var Io={span:function(e){var t=e.$$("cells").getSelectArea();if(t)if(function(e,t){var n,i,r=t.start,o=t.end;for(n=1*r.row;n<=1*o.row;n++)for(i=1*r.column;i<=1*o.column;i++)if(e.$$("cells").getSpan(n,i))return!0;return!1}(e,t))e.splitCell();else{for(var n=[],i=t.start.row;i<=t.end.row;i++){for(var r=t.start.column;r<=t.end.column;r++){var o=e.getCellValue(i,r);if(o&&n.push(o),n.length>1)break}if(n.length>1)break}n.length>1?e.confirm({text:webix.i18n.spreadsheet.labels["merge-cell-confirm"]}).then((function(){return e.combineCells()})):e.combineCells()}},undo:function(e){return e.undo()},redo:function(e){return e.redo()},"hide-gridlines":function(e){return e.hideGridlines("toggle")},"hide-headers":function(e){return e.hideHeaders("toggle")},"freeze-columns":function(e){return e.freezeColumns()},"freeze-rows":function(e){return e.freezeRows()},"increase-decimals":function(e){return Wi(e,1)},"decrease-decimals":function(e){return Wi(e,-1)},"increase-indent":function(e){return e.callEvent("onStyleSet",["indent",1])},"decrease-indent":function(e){return e.callEvent("onStyleSet",["indent",-1])},"show-formulas":function(e){return e.showFormulas("toggle")},"print-borders":function(e){return e.showPrintBorders("toggle")}};var Vo=[{id:"Arial",value:"Arial"},{id:"'Roboto', sans-serif",value:"Roboto"},{id:"'PT Sans', Tahoma",value:"PT Sans"},{id:"'Open Sans', sans-serif",value:"Open Sans"},{id:"Tahoma",value:"Tahoma"},{id:"Verdana",value:"Verdana"},{id:"Calibri, Tahoma",value:"Calibri"}];function No(e){var t=webix.i18n.spreadsheet.menus,n=[{id:"add",group:"column",value:t["insert-column"]},{id:"del",group:"column",value:t["delete-column"]},{id:"show",group:"column",value:t["show-column"],neighbors:!0},{id:"hide",group:"column",value:t["hide-column"]}];return 0!=e.config.resizeCell&&n.push({id:"resize",group:"column",value:t["resize-column"]}),n}function Mo(e){var t=webix.i18n.spreadsheet.menus,n=[{id:"add",group:"row",value:t["insert-row"]},{id:"del",group:"row",value:t["delete-row"]},{id:"show",group:"row",value:t["show-row"],neighbors:!0},{id:"hide",group:"row",value:t["hide-row"]}];return 0!=e.config.resizeCell&&n.push({id:"resize",group:"row",value:t["resize-row"]}),n}function Oo(){return[{id:"clear-value",value:qo("value")},{id:"clear-style",value:qo("style")},{id:"clear-conditional-formats",value:qo("conditional-formats")},{id:"clear-dropdown-editors",value:qo("dropdown-editors")},{id:"clear-filters",value:qo("filters")},{id:"clear-comments",value:qo("comments")},{$template:"Separator"},{id:"clear-all",value:qo("all")}]}var Do=[{id:"no",value:"no"},{id:"left",value:"left"},{id:"top",value:"top"},{id:"right",value:"right"},{id:"bottom",value:"bottom"},{id:"all",value:"all"},{id:"outer",value:"outer"},{id:"top-bottom",value:"top-bottom"}];function qo(e){var t=webix.i18n.spreadsheet.menus;return t.clear+" "+t["clear-"+e].toLowerCase()}var zo={"font-weight":"bold","font-style":"italic",underline:"underline",strike:"strike"},Po={button:function(e){return{view:"ssheet-toggle",width:e.width||Wn.width,id:e.name,name:e.name,label:e.label,css:e.css||"",onValue:zo[e.name],offValue:"normal",tooltip:webix.i18n.spreadsheet.tooltips[e.name]||""}},colorButton:function(e){return{view:"ssheet-color",css:e.css,name:e.name,width:e.width||Wn.width+24,title:"<span class='webix_ssheet_button_icon webix_ssheet_color_button_icon webix_ssheet_icon ssi-"+e.name+"' ></span>",tooltip:webix.i18n.spreadsheet.tooltips[e.name]||""}},toggleButton:function(e){return{view:"ssheet-toggle-silent",width:Wn.width,id:e.name,name:e.name,label:"<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+(e.icon||e.name)+"'></span>",tooltip:webix.i18n.spreadsheet.tooltips[e.name]||""}},iconButton:function(e){var t=webix.copy(e);return webix.extend(t,{view:"button",width:Wn.width,id:e.name,label:"<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+e.name+"'></span>",css:"",tooltip:webix.i18n.spreadsheet.tooltips[e.name]||webix.i18n.spreadsheet.menus[e.name]||""}),e.onValue&&webix.extend(t,{view:"ssheet-toggle",onValue:e.onValue,offValue:e.offValue},!0),t},segmented:function(e){return{view:"segmented",name:e.name,css:e.css||"",width:e.width||Wn.width+76,options:e.options}},select:function(e){return webix.extend(e,{view:"richselect",id:e.name,value:Xn[e.name],suggest:{css:"webix_ssheet_suggest",padding:0,data:e.options}}),e.tooltip=webix.i18n.spreadsheet.tooltips[e.name]||"",e.popupWidth&&(e.suggest.fitMaster=!1,e.suggest.width=e.popupWidth),e.popupTemplate&&(e.suggest.body={template:e.popupTemplate}),e.popupEvents&&(e.suggest.body=e.suggest.body||{},e.suggest.body.on=e.popupEvents),e},separator:function(){return{view:"ssheet-separator"}},title:function(e){var t=e.title;return 0===t.indexOf("$")&&(t=""),{template:t=webix.i18n.spreadsheet.labels[e.title]||t,view:"ssheet-bar-title",height:Wn.titleHeight}},borders:function(e){return{view:"ssheet-borders",width:e.width||Wn.width+24,data:Do,id:e.name,name:e.name,tooltip:webix.i18n.spreadsheet.tooltips[e.name]}},align:function(e){return{view:"ssheet-align",value:Xn[e.name],width:e.width||Wn.width+24,data:e.options,name:e.name,tooltip:webix.i18n.spreadsheet.tooltips[e.name]}},condFormat:function(e){return{view:"ssheet-cond-format",width:40,id:e.name,name:e.name}}},Fo={"font-family":function(){return Po.select({name:"font-family",options:Vo,width:100,view:"combo"})},"font-size":function(){return Po.select({name:"font-size",options:["8","9","10","11","12","14","15","16","18","20","22","24","28","36"],width:70,view:"text",icon:"wxi-menu-down",css:"webix_ssheet_text",on:{onItemClick:function(){var e=webix.$$(this.config.suggest);e.isVisible()||e.show(this.getInputNode())}}})},"font-weight":function(){return Po.button({name:"font-weight",label:"B",css:"webix_ssheet_bold"})},"font-style":function(){return Po.button({name:"font-style",label:"I",css:"webix_ssheet_italic"})},underline:function(){return Po.button({name:"underline",label:"U",css:"webix_ssheet_underline"})},strike:function(){return Po.button({name:"strike",label:"S",css:"webix_ssheet_strike"})},color:function(){return Po.colorButton({name:"color",icon:"font",css:"webix_ssheet_color"})},background:function(){return Po.colorButton({name:"background",icon:"paint-brush",css:"webix_ssheet_background",width:70})},borders:function(){return Po.borders({name:"borders"})},"text-align":function(){var e=webix.i18n.spreadsheet.tooltips;return Po.align({name:"text-align",css:"webix_ssheet_align",options:[{id:"left",css:"webix_ssheet_icon ssi-left",tooltip:e["align-left"]},{id:"center",css:"webix_ssheet_icon ssi-center",tooltip:e["align-center"]},{id:"right",css:"webix_ssheet_icon ssi-right",tooltip:e["align-right"]}]})},"vertical-align":function(){var e=webix.i18n.spreadsheet.tooltips;return Po.align({name:"vertical-align",css:"webix_ssheet_align",options:[{id:"top",css:"webix_ssheet_icon ssi-top",tooltip:e["align-top"]},{id:"middle",css:"webix_ssheet_icon ssi-middle",tooltip:e["align-middle"]},{id:"bottom",css:"webix_ssheet_icon ssi-bottom",tooltip:e["align-bottom"]}]})},wrap:function(){return Po.iconButton({name:"wrap",onValue:"wrap",offValue:"nowrap"})},format:function(){return Po.select({name:"format",width:106,options:(e=webix.i18n.spreadsheet.labels,[{id:"common",value:e.common},{id:"price",value:e.currency,example:"98.20"},{id:"int",value:e.number,example:"2120.02"},{id:"percent",value:e.percent,example:"0.5"},{id:"date",value:e.date,example:"45000"},{id:"string",value:e.string,example:"012345"},{id:"custom",value:e["custom-format"]}]),popupWidth:180,popupTemplate:function(e){var t=Ai[e.id]?Ai[e.id].getFormat:"",n={css:""},i=t&&e.example?t(e.example,n):"";return e.value+(t?"<span class='webix_ssheet_right"+(n.css?" "+n.css:"")+"'>"+i+"</span>":"")},popupEvents:{onItemClick:function(e){"custom"==e&&this.getTopParentView().callEvent("onCommand",[{id:e}])}}});var e},column:function(e){return{name:"column",view:"ssheet-button",icon:"column",arrow:!0,area:!0,width:58,options:No(e)}},row:function(e){return{name:"row",view:"ssheet-button",icon:"row",arrow:!0,area:!0,width:58,options:Mo(e)}},clear:function(){return{name:"clear",view:"ssheet-button",icon:"clear-styles",arrow:!0,area:!0,width:58,options:Oo()}},validation:function(){return{name:"validation",view:"ssheet-button",icon:"validation",arrow:!0,area:!0,width:58,options:[{id:"add-cell-validation",value:webix.i18n.spreadsheet.labels["add-cell-validation"]},{id:"remove-cell-validation",value:webix.i18n.spreadsheet.labels["remove-cell-validation"]},{id:"highlight-invalid-data",value:webix.i18n.spreadsheet.labels["highlight-invalid-data"]},{id:"remove-highlight-invalid-data",value:webix.i18n.spreadsheet.labels["remove-highlight-invalid-data"]}]}},image:function(){return{name:"image",view:"ssheet-button",icon:"add-image",arrow:!0,options:[{id:"add-image-cell",value:webix.i18n.spreadsheet.labels["add-image-cell"]},{id:"add-image-top",value:webix.i18n.spreadsheet.labels["add-image-top"]}]}},graph:function(){return{name:"graph",view:"ssheet-button",icon:"add-sparkline",arrow:!0,options:[{id:"add-sparkline",value:webix.i18n.spreadsheet.labels["add-sparkline"]},{id:"add-chart",value:webix.i18n.spreadsheet.labels["add-chart"]}]}},controls:function(){return{name:"controls",view:"ssheet-button",icon:"add-control",arrow:!0,options:[{id:"add-checkbox",value:webix.i18n.spreadsheet.labels["add-checkbox"]},{id:"add-radio",value:webix.i18n.spreadsheet.labels["add-radio"]}]}},comment:function(){return{name:"comment",view:"ssheet-button",icon:"comments",arrow:!0,area:!0,width:55}},"create-filter":function(){return Po.toggleButton({name:"create-filter"})},"hide-gridlines":function(){return Po.toggleButton({name:"hide-gridlines"})},"hide-headers":function(){return Po.toggleButton({name:"hide-headers"})},"show-formulas":function(){return Po.toggleButton({name:"show-formulas"})},"print-borders":function(){return Po.toggleButton({name:"print-borders",icon:"borders-no"})}};function Uo(e,t){for(var n=[],i=0;i<t.length;i++){var r=t[i];if("object"==pn(r))n.push(r);else{var o=Fo[r]?Fo[r](e):Po.iconButton({name:r});n.push(o)}}return n}function Lo(e,t,n){return{rows:[{padding:2,cols:[{margin:2,cols:Uo(e,n)}]},Po.title({title:t})]}}function Bo(e){var t=webix.i18n.spreadsheet;return t.menus[e]||t.labels[e]||t.tooltips[e]||e}function Ho(e){var t=function(){var e,t,n,i={undo:["undo","redo"],insert:["add-sparkline","add-image","add-comment"]},r={};for(t in i)for(r[t]=0,e=0;e<i[t].length;e++)n=webix.html.getTextSize(Bo(i[t][e]),"webix_ssheet_button_measure").width+7,r[t]=Math.max(n,r[t]);return r}(),n=Wn.titleHeight;return e?[{padding:3,margin:0,rows:[{margin:2,cols:[{$button:"excel-export"},{$button:"print"},{$button:"print-borders"}]},{template:Bo("file"),view:"ssheet-bar-title",height:n}]},{view:"ssheet-separator"},{padding:3,margin:0,rows:[{margin:2,cols:[{$button:"hide-gridlines"},{$button:"hide-headers"},{$button:"show-formulas"}]},{template:Bo("view"),view:"ssheet-bar-title",height:n}]},{view:"ssheet-separator"},{}]:[{padding:3,margin:0,rows:[{margin:2,cols:[{name:"sheet",view:"ssheet-button-icon-top",label:Bo("sheet"),arrow:!0,options:[{id:"new-sheet"},{id:"copy-sheet"},{id:"remove-sheet"},{id:"hide-sheet"}]},{rows:[{$button:"excel-import"},{$button:"excel-export"}]},{rows:[{$button:"print"},{$button:"print-borders"}]}]},{template:Bo("file"),view:"ssheet-bar-title",height:n,width:85}]},{view:"ssheet-separator"},{padding:3,rows:[{$button:"undo",view:"ssheet-button",label:Bo("undo"),width:t.undo},{$button:"redo",view:"ssheet-button",label:Bo("redo"),width:t.undo},{template:Bo("undo-redo"),view:"ssheet-bar-title",height:n}]},{view:"ssheet-separator"},{padding:3,rows:[{margin:2,cols:[{margin:2,cols:[{$button:"font-family",width:4*(webix.skin.$active.inputHeight+2)+6},{$button:"font-size"}]},{$button:"borders"}]},{margin:2,cols:[{margin:2,cols:[{$button:"font-weight"},{$button:"font-style"},{$button:"underline"},{$button:"strike"}]},{$button:"background"},{$button:"color"}]},{template:Bo("font"),view:"ssheet-bar-title",height:n}]},{view:"ssheet-separator"},{padding:3,rows:[{margin:2,cols:[{$button:"text-align"},{$button:"span"},{$button:"increase-indent"}]},{margin:2,cols:[{$button:"vertical-align"},{$button:"wrap"},{$button:"decrease-indent"}]},{template:Bo("align"),view:"ssheet-bar-title",height:n}]},{view:"ssheet-separator"},{padding:3,rows:[{$button:"format"},{margin:2,cols:[{$button:"increase-decimals"},{$button:"decrease-decimals"}]},{template:Bo("number"),view:"ssheet-bar-title",height:n}]},{view:"ssheet-separator"},{padding:3,rows:[{cols:[{$button:"sort-asc"},{$button:"create-filter"},{$button:"conditional-format"},{$button:"add-link"},{$button:"clear"}]},{cols:[{$button:"sort-desc"},{$button:"add-range"},{$button:"lock-cell"},{$button:"add-dropdown"},{$button:"validation"}]},{template:Bo("edit"),view:"ssheet-bar-title",height:n}]},{view:"ssheet-separator"},{padding:3,rows:[{cols:[{$button:"image",view:"ssheet-button",label:Bo("image"),width:t.insert},{$button:"add-comment",view:"ssheet-button",label:Bo("comment"),width:t.insert}]},{cols:[{$button:"graph",view:"ssheet-button",label:Bo("graph"),width:t.insert},{$button:"controls",view:"ssheet-button",label:Bo("controls"),width:t.insert}]},{template:Bo("insert"),view:"ssheet-bar-title",height:n}]},{view:"ssheet-separator"},{padding:3,rows:[{cols:[{rows:[{$button:"row"},{$button:"column"}]},{rows:[{$button:"hide-gridlines"},{$button:"hide-headers"}]},{rows:[{$button:"freeze-rows"},{$button:"freeze-columns"}]},{rows:[{$button:"show-formulas"},{}]}]},{template:Bo("view"),view:"ssheet-bar-title",height:n}]},{view:"ssheet-separator"},{}]}var jo={"undo-redo":["undo","redo"],font:["font-family","font-size","font-weight","font-style","underline","strike","color","background","borders"],align:["text-align","vertical-align","wrap","span","increase-indent","decrease-indent"],format:["format"]};function Wo(e){e.attachEvent("onComponentInit",(function(){return function(e){e.attachEvent("onAfterSelect",(function(t){return Xo(e,t)}))}(e)})),e.attachEvent("onCommand",(function(t){"toolbar-update"==t.id&&(t.name?function(e,t,n){var i=e.$$("bar").elements[t];i&&i.setValue(n)}(e,t.name,t.value):Xo(e,e.getSelectedId(!0)))}));var t=[];if(e.config.toolbar){var n=e.config.toolbar;"full"==n&&(n=Ho(e.config.readonly),webix.isUndefined(e.config.bottombar)&&(e.config.bottombar=!0)),t=function(e,t){var n=function(t){for(var i=0;i<t.length;i++){var r=t[i].$button;if(r){var o=Fo[r]?Fo[r](e):Po.iconButton({name:r});webix.extend(t[i],o)}t[i].rows&&n(t[i].rows),t[i].cols&&n(t[i].cols)}};return n(t),t}(e,n)}else t=function(e,t){var n=[];for(var i in t)n.push(Lo(e,i,t[i])),n.push(Po.separator());return n}(e,e.config.buttons||jo);var i={view:webix.env.$customScroll?"scrollview":"ssheet-toolbar-scrollview",scroll:"x",body:{view:"toolbar",css:"webix_ssheet_toolbar webix_layout_toolbar",id:"bar",padding:0,elements:t,on:{onChange:function(t,n,i){if("user"==i){var r=this.$eventSource,o=r.config.name;"format"==o&&"common"==t&&(t="");var a="font-size"==o;if((a||"font-family"==o)&&(!t||a&&isNaN(t)))return r.setValue(n);if(a){var s=Math.floor(400/.75),l=Math.max(1,Math.min(s,t));l!=t&&(t=l,r.setValue(t)),t+="px"}"format"==o&&"custom"==t||e.callEvent("onStyleSet",[o,t]),webix.UIManager.setFocus(e.$$("cells"))}},onItemClick:function(t){var n=e.innerId(t);Io[n]?Io[n].call(this,e):e.callEvent("onCommand",[{id:n}])}}}};return e.callEvent("onViewInit",["toolbar",i]),i}function Xo(e,t){var n=function(e,t){for(var n=["font-family","font-size","text-align","vertical-align","format","background","color"],i=t[0],r=Yo(e,i),o=1;o<t.length;o++){for(var a=Yo(e,t[o]),s=n.length-1;s>=0;s--){var l=n[s];r[l]!=a[l]&&(delete r[l],n.splice(s,1))}if(!n.length)break}return r}(e,t);e.$$("bar").setValues(n)}function Yo(e,t){var n=e.$$("cells").getSpan(t.row,t.column);if(n){var i=gn(n,2);t.row=i[0],t.column=i[1]}var r=ai(e,t),o=r?webix.copy(r.props):{};for(var a in Xn)o[a]||(o[a]=Xn[a]);o["font-size"]=o["font-size"].replace("px","");var s=si(e,t.row,t.column)||"common";return o.format=Yi(s)?"custom":s,o}function Go(e,t,n){var i=t.$$("cells").config.columns,r={row:e,column:i["rowId"==i[0].id?1:0].id},o={row:n||e,column:i[i.length-1].id};r.column&&o.column&&na(r,o,t)}function Ko(e){var t=e.$$("cells").data.order,n=e.$$("cells").config.columns,i="rowId"==n[0].id?1:0,r={row:t[0],column:n[i].id},o={row:t[t.length-1],column:n[n.length-1].id};r.column&&o.column&&na(r,o,e)}function Qo(e,t,n){var i=t.$$("cells").data.order;na({row:i[0],column:e},{row:i[i.length-1],column:n||e},t)}function Zo(e,t){var n=t.$$("cells").getSelectArea();return!!(n&&e>=n.start.column&&e<=n.end.column)}function Jo(e,t,n){return ea(e,n)&&Zo(t,n)}function ea(e,t){var n=t.$$("cells").getSelectArea();return!!(n&&e>=n.start.row&&e<=n.end.row)}function ta(e,t){var n=t.$$("cells").getSelectArea();n?Qo(Math.min(n.start.column,n.end.column,e),t,Math.max(n.start.column,n.end.column,e)):Qo(e,t)}function na(e,t,n){n.$$("cells").addSelectArea(e,t)}function ia(e,t){var n=t.$$("cells"),i=0,r=n.getColumnConfig(e).width;n.eachRow((function(o){var a=25,s=n.getSpan(o,e);if(!(s&&s[2]>1)){var l=t.getCellValue(o,e),u=this.getText(o,e),c=t.getStyle(o,e),h=c?c.id:"";if(u.replace(/<\/?[^>]+(>|$)/g,""))a=mi(t,u,h).width;var d=t._zoom;t.getCellEditor(o,e)&&(a+=18*d),t.getCellFilter(o,e)&&(a+=18*d),/^=(checkbox|radio)\(/i.test(l)&&(a+=18*d),c&&"wrap"==c.props.wrap&&a>r&&(a=r),a>i&&(i=a)}})),n.setColumnWidth(e,i)}function ra(e,t){var n=25;t._table.eachColumn((function(i){if("rowId"!=i){var r=this.getText(e,i),o=this.getColumnConfig(i).width,a=t._table.getSpan(e,i);a&&(o=t._table.getSpanNode({row:a[0],column:a[1]}).offsetWidth);var s=t.getStyle(e,i),l=s?s.id:"";if(r.replace(/<\/?[^>]+(>|$)/g,"")){var u=mi(t,r,l,o);u.height>n&&(n=u.height)}}})),t._table.setRowHeight(e,n)}function oa(e,t,n){if(n._table.config.header){var i=n._table,r="webix_highlight",o=e.row,a=t.row,s=e.column,l=t.column,u=i.config.columns,c=u[1].id;if("rowId"==s?s==l?(e.column=s=c,t.column=l=u[u.length-1].id):e.column=s=c:"rowId"==l&&(t.column=l=c),a<o){var h=[a,o];o=h[0],a=h[1]}if(l<s){var d=[l,s];s=d[0],l=d[1]}if(i.eachRow((function(e){e<o||e>a?i.removeCellCss(e,"rowId",r,!0):i.addCellCss(e,"rowId",r,!0)})),webix.delay((function(){return i.refresh()})),i.eachColumn((function(e){var t=i.getHeaderNode(e);"rowId"!=e&&t&&(e<s||e>l?webix.html.removeCss(t,r):webix.html.addCss(t,r,!0))})),n.$$("navigation")){var f="";if(s&&l){if(!o){var g=i.data.order;o=g[0],a=g[g.length-1]}var m=(f=Pn(o,s,a,l)).split(":");m[0]==m[1]&&(f=m[0])}n.$$("navigation").setValue(f)}}}var aa=Object.freeze({__proto__:null,adjustColumn:ia,adjustRow:ra,highlightColRow:oa,isCellSelected:Jo,isColSelected:Zo,isRowSelected:ea,selectAll:Ko,selectColumn:Qo,selectColumns:ta,selectRow:Go});function sa(e){return webix.i18n.spreadsheet.labels[e]||e}function la(e){return e&&!isNaN(e)&&!rr(e)}var ua={number:[{id:"greater",batch:"text",handler:function(e,t){return""!==e&&1*e>1*t}},{id:"less",batch:"text",handler:function(e,t){return""!==e&&1*e<1*t}},{id:"greaterOrEqual",batch:"text",handler:function(e,t){return""!==e&&1*e>=1*t}},{id:"lessOrEqual",batch:"text",handler:function(e,t){return""!==e&&1*e<=1*t}},{id:"equal",batch:"text",handler:function(e,t){return e==t}},{id:"notEqual",batch:"text",handler:function(e,t){return e!=t}},{id:"contains",batch:"text",handler:function(e,t){return-1!==e.toString().toLowerCase().indexOf(t.toString().toLowerCase())}},{id:"notContains",batch:"text",handler:function(e,t){return-1===e.toString().toLowerCase().indexOf(t.toString().toLowerCase())}}],text:[{id:"contains",batch:"text",handler:function(e,t){return-1!==e.toString().toLowerCase().indexOf(t.toString().toLowerCase())}},{id:"notContains",batch:"text",handler:function(e,t){return-1===e.toString().toLowerCase().indexOf(t.toString().toLowerCase())}},{id:"equal",batch:"text",handler:function(e,t){return e.toString().toLowerCase()===t.toString().toLowerCase()}},{id:"notEqual",batch:"text",handler:function(e,t){return e.toString().toLowerCase()!==t.toString().toLowerCase()}},{id:"beginsWith",batch:"text",handler:function(e,t){return 0===e.toString().toLowerCase().lastIndexOf(t.toString().toLowerCase(),0)}},{id:"notBeginsWith",batch:"text",handler:function(e,t){return 0!==e.toString().toLowerCase().lastIndexOf(t.toString().toLowerCase(),0)}},{id:"endsWith",batch:"text",handler:function(e,t){return e=e.toString(),t=t.toString(),-1!==e.toLowerCase().indexOf(t.toLowerCase(),e.length-t.length)}},{id:"notEndsWith",batch:"text",handler:function(e,t){return e=e.toString(),t=t.toString(),-1===e.toLowerCase().indexOf(t.toLowerCase(),e.length-t.length)}}],date:[{id:"greater",batch:"datepicker",handler:function(e,t){return la(e)&&e>t}},{id:"less",batch:"datepicker",handler:function(e,t){return la(e)&&e<t}},{id:"greaterOrEqual",batch:"datepicker",handler:function(e,t){return la(e)&&e>=t}},{id:"lessOrEqual",batch:"datepicker",handler:function(e,t){return la(e)&&e<=t}},{id:"equal",batch:"datepicker",handler:function(e,t){return la(e)&&e==t}},{id:"notEqual",batch:"datepicker",handler:function(e,t){return!la(e)||e!=t}},{id:"between",batch:"daterangepicker",handler:function(e,t){return!!la(e)&&((!t.start||e>t.start)&&(!t.end||e<t.end))}},{id:"notBetween",batch:"daterangepicker",handler:function(e,t){return!!la(e)&&(!t.start||e<=t.start||!t.end||e>=t.end)}}]},ca=webix.copy(ua);function ha(){var e=webix.copy(ua);return e.number=e.number.concat([{id:"between",handler:function(e,t){return(!t.start||e>t.start)&&(!t.end||e<t.end)}},{id:"notBetween",handler:function(e,t){return!t.start||e<=t.start||!t.end||e>=t.end}}]),e}function da(e,t){return isNaN(1*t)?"="==t.charAt(0)&&t.length>1&&null===(t=e._mData.getStore().exec(t.substring(1),e._mPage.getContext()))&&(t=""):t*=1,t}function fa(e,t,n,i){var r="";if(!e.conditions._empty){var o=e.conditions.get(t,n);if(o){var a=e.$$("cells").getSpan(t,n),s=e.getCellValue(t,n,!1);s||0===s||(s="");var l=_r(e,t,n);l&&"string"!=l||(l="text");for(var u=function(){var u,h=s,d=o[c][0],f=e.conditions.handlers,g=["text",l,"number","date"];g=g.filter((function(e,t){return g.indexOf(e)==t}));for(var m=0;m<g.length;m++){var v=g[m];if(u=Gn(f[v],(function(e){return e.id==d}))){u=u.handler,"text"==v&&"equal"!=d&&"notEqual"!=d&&(h=i);break}}var p=o[c][1];if(p=webix.isArray(p)?{start:da(e,p[0]),end:da(e,p[1])}:da(e,p),!r&&u&&u(h,p)){if(r=o[c][2],!a)return 1;ho(e,t,n,o[c][2],!0)}else ho(e,t,n,o[c][2],!1)},c=o.length-1;c>=0&&!u();c--);}}return r}function ga(e,t,n,i){return i._empty=!1,e[t]||(e[t]={}),e[t][n]||(e[t][n]=[]),e[t][n]}function ma(e,t,n){if(n&&n!=e.getActiveSheet()){var i=Yr(e,n);i&&(i.content.conditions=t)}else{var r={">":"greater","<":"less","=":"equal","!=":"notEqual","<>":"between"};if(this._empty=!0,!t)return;for(var o=t.length;o--;){var a=t[o],s=ga(this._pull,a[0],a[1],this);a[2]=r[a[2]]||a[2],s.push([a[2],a[3],a[4]])}}}function va(e,t){if(t&&t!=e.getActiveSheet()){var n=Yr(e,t);n&&(n.content.conditions=[])}else this._pull={}}function pa(e,t,n,i,r){if(i.map((function(t){return Ea(e,t)})),r&&r!=e.getActiveSheet()){var o=Yr(e,r);o&&(_a(e,t,n,r),o.content.conditions||(o.content.conditions=[]),i.forEach((function(e){o.content.conditions.push([t,n].concat(mn(e)))})))}else ga(this._pull,t,n,this),this._pull[t][n]=i}function ba(e,t,n,i){var r;if(i&&i!=e.getActiveSheet()){var o=Yr(e,i);if(o&&o.content.conditions){for(var a,s=webix.copy(o.content.conditions),l=[];-1!=(a=Kn(s,(function(e){return e[0]==t&&e[1]==n})));)l.push(s[a].slice(2,5)),s.splice(a,1);l.length&&(r=l)}}else this._pull[t]&&this._pull[t][n]&&(r=this._pull[t][n]||null);return r||null}function wa(e,t,n,i,r,o,a){var s=Ea(e,[i,r,o]);if(a&&a!=e.getActiveSheet()){var l=Yr(e,a);l&&(l.content.conditions||(l.content.conditions=[]),l.content.conditions.push([t,n].concat(mn(s))))}else ga(this._pull,t,n,this).push(s)}function _a(e,t,n,i){if(i&&i!=e.getActiveSheet()){var r=Yr(e,i);if(r&&r.content.conditions)for(var o;-1!=(o=Kn(r.content.conditions,(function(e){return e[0]==t&&e[1]==n})));)r.content.conditions.splice(o,1)}else{this.get(t,n)&&delete this._pull[t][n]}}function xa(e,t){var n=[];if(t&&t!=e.getActiveSheet()){var i=Yr(e,t);i&&i.content.conditions&&(n=i.content.conditions)}else for(var r in this._pull)for(var o in this._pull[r])for(var a=0;a<this._pull[r][o].length;a++){var s=this._pull[r][o][a];n.push([r,o,s[0],s[1],s[2]])}return n}function ya(e,t,n){wn.set((function(){Un(t,e,(function(e,t){var i=e.conditions.get(t.row,t.column,n);i&&Sa("remove",t.row,t.column,i,null,e,n)})),e.refresh()}))}function Ca(e,t,n,i,r){var o=t.condition;Sa("update",n,i,e.conditions.get(n,i)||null,o,e),1===r&&Sa("remove",t.row,t.col,o,null,e)}function Sa(e,t,n,i,r,o,a){o.callEvent("onBeforeConditionSet",[t,n,i,r,a])&&(o.conditions[e].apply(o.conditions,[t,n,"remove"==e?a:r]),o.callEvent("onAfterConditionSet",[t,n,i,r,a]))}function Ea(e,t){var n=t[1];return"="==n[0]&&(t[1]=e._mData.getStore().parse(n).source),t}ca.textLength=[{id:"greater",handler:function(e,t){return e.toString().length>t}},{id:"less",handler:function(e,t){return e.toString().length<t}},{id:"greaterOrEqual",handler:function(e,t){return e.toString().length>=t}},{id:"lessOrEqual",handler:function(e,t){return e.toString().length<=t}},{id:"equal",handler:function(e,t){return e.toString().length==t}},{id:"notEqual",handler:function(e,t){return e.toString().length!=t}}],ca.number=ca.number.concat([{id:"between",handler:function(e,t){return(!t.start||e>t.start)&&(!t.end||e<t.end)}},{id:"notBetween",handler:function(e,t){return!t.start||e<=t.start||!t.end||e>=t.end}}]);var $a=Object.freeze({__proto__:null,_changeCondition:Sa,clearConditionalFormats:ya,getConditionCss:fa,init:function(e){e.conditions={_empty:!0,_pull:{},handlers:ha(),add:function(t,n,i,r,o,a){wa.apply(this,[e,t,n,i,r,o,a])},update:function(t,n,i,r){pa.apply(this,[e,t,n,i,r])},remove:function(t,n,i){_a.apply(this,[e,t,n,i])},get:function(t,n,i){return ba.apply(this,[e,t,n,i])},parse:function(t,n){ma.apply(this,[e,t,n])},serialize:function(t){return xa.apply(this,[e,t])},clear:function(t){va.apply(this,[e,t])}},e.attachEvent("onConditionSet",(function(t){return function(e,t){wn.set((function(){e.eachSelectedCell((function(n){var i=e.conditions.get(n.row,n.column);if(i)for(var r=0;r<i.length;r++)ho(e,n.row,n.column,i[r][2],!1);Sa("update",n.row,n.column,i||null,t,e)}))})),e.refresh()}(e,t)})),e.attachEvent("onUndo",(function(t,n,i,r){"condition"==t&&function(e,t,n,i){e.conditions.get(t,n)&&e.conditions.remove(t,n);i&&e.conditions.update(t,n,i)}(e,n,i,r)})),e.attachEvent("onDataSerialize",(function(t){return function(e,t){t.conditions=e.conditions.serialize()}(e,t)})),e.attachEvent("onDataParse",(function(t){return function(e,t){e.conditions.parse(t.conditions)}(e,t)})),e.attachEvent("onReset",(function(){return e.conditions.clear()})),e.attachEvent("onAction",(function(e,t){"before-grid-change"==e&&function(e,t,n,i,r){var o=i.conditions,a=o.length;if(n)for(;a--;){var s=gn(o[a],2),l=s[0],u=s[1];("row"==t&&l>=r.row||"column"==t&&u>=r.column)&&("row"==t?l<r.row-n?o.splice(a,1):o[a][0]=1*l+n:"column"==t&&(u<r.column-n?o.splice(a,1):o[a][1]=1*u+n))}}(0,t.name,t.inc,t.data,t.start)})),function(e){e.conditions.clear()}(e)},pasteCondition:Ca});function Ra(e,t,n,i){var r;if(i&&i!=e.getActiveSheet()){var o=Yr(e,i);o&&o.content.validation&&(r=Gn(o.content.validation,(function(e){return e[0]==t&&e[1]==n})))&&(r=r[2])}else e.validation._pull[t]&&e.validation._pull[t][n]&&(r=e.validation._pull[t][n]);return r||null}function Aa(e,t,n,i,r,o){o=o||e.getActiveSheet();var a=Ra(e,t,n,o);if(o!=e.getActiveSheet()){var s=Yr(e,o);s.content.validation||(s.content.validation=[]),a?Gn(s.content.validation,(function(e){return e[0]==t&&e[1]==n}))[2]=i:s.content.validation.push([t,n,i])}else e.validation._pull[t]||(e.validation._pull[t]={}),e.validation._pull[t][n]=i;r||e.callEvent("onAction",["validation",{row:t,column:n,newValue:i,value:a,page:o}])}function ka(e,t,n,i,r){r=r||e.getActiveSheet();var o=Ra(e,t,n,r);if(o){if(r!=e.getActiveSheet()){var a=Yr(e,r).content.validation,s=Kn(a,(function(e){return e[0]==t&&e[1]==n}));a.splice(s,1)}else delete e.validation._pull[t][n],e.$$("cells").updateItem(t,n);i||e.callEvent("onAction",["validation",{row:t,column:n,newValue:null,value:o,page:r}])}}function Ta(e,t){return isNaN(1*t)?"="==t.charAt(0)&&t.length>1&&null===(t=e._mData.getStore().exec(t.substring(1),e._mPage.getContext()))&&(t=""):t*=1,t}function Ia(e,t,n,i,r){var o=!1,a=e.validation.get(t,n,r);if(a){var s,l=a.type;if(""===(s=webix.isUndefined(i)||"text"!=l&&"textLength"!=l?e.getCellValue(t,n,!1,r):i))return!!a.ignoreEmpty;var u=a.value;u&&(u=webix.isArray(u)?{start:Ta(e,u[0]),end:Ta(e,u[1])}:Ta(e,u));var c=e.validation.handlers[l];if(c)(0,Gn(c,(function(e){return e.id==a.condition})).handler)(s,u)||(o=!0);if(!o)switch(l){case"number":a.integer&&parseInt(s)!=s&&(o=!0);break;case"date":"date"!=_r(e,t,n,r)&&(o=!0);break;case"range":webix.isArray(u)&&-1!=u.indexOf(s)||(o=!0)}}return o}function Va(e,t,n,i){var r="";return e.validation._highlight&&Ia(e,t,n,i)&&(r="webix_ss_invalid_data"),e.$$("cells").getSpan(t,n)&&ho(e,t,n,"webix_ss_invalid_data",!!r),r}function Na(e){if(!e._commentSel){var t=e.getSelectedId(!0),n=e.validation._inputMessage;if(!e._context&&t&&1==t.length){var i=(t=t[0]).row,r=t.column,o=e.validation.get(i,r);if(o&&o.inputMessage){n||(n=e.validation._inputMessage=webix.ui({view:"popup",css:"ssheet_validation_input_message",minWidth:150,minHeight:50,height:100,width:250,resize:!0,body:{scroll:"auto",template:" "}}),e._destroy_with_me.push(n)),n.getBody().setHTML(o.inputMessage);var a=e.$$("cells"),s=a.getSpan(i,r),l=s?{row:i,column:1*s[1]+s[2]-1}:t;return n.show(a.getItemNode(l),{pos:"bottom"})}}n&&n.hide()}}function Ma(e,t,n,i,r){var o=t.validation;e.validation.add(n,i,o),1===r&&e.validation.remove(t.row,t.col)}var Oa=Object.freeze({__proto__:null,getValidationCss:Va,init:function(e){e.validation={handlers:webix.copy(ca),get:function(t,n,i){return Ra(e,t,n,i)},add:function(t,n,i,r){return Aa(e,t,n,i,!1,r)},remove:function(t,n,i){return ka(e,t,n,!1,i)},highlight:function(t,n){return function(e,t,n){if(n=n||e.getActiveSheet(),n!=e.getActiveSheet()){var i=Yr(e,n);i.content.table||(i.content.table={}),t="toggle"==t?!i.content.table.highlightInvalid:!!t,i.content.table.highlightInvalid=t?1:0}else e.validation._highlight="toggle"==t?!e.validation._highlight:!!t,e.refresh()}(e,t,n)},_pull:{}},e.attachEvent("onReset",(function(){return function(e){e.validation._pull={}}(e)})),e.attachEvent("onUndo",(function(t,n,i,r){"validation"===t&&function(e,t,n,i){Ra(e,t,n)&&ka(e,t,n,!0);i&&Aa(e,t,n,i,!0)}(e,n,i,r)})),e.attachEvent("onAction",(function(e,t){"before-grid-change"==e&&function(e,t,n,i,r){var o=i.validation,a=o.length;if(n)for(;a--;){var s=gn(o[a],2),l=s[0],u=s[1];(l&&"row"==t&&l>=r.row||u&&"column"==t&&u>=r.column)&&("row"==t?l<r.row-n?o.splice(a,1):o[a][0]=1*l+n:"column"==t&&(u<r.column-n?o.splice(a,1):o[a][1]=1*u+n))}}(0,t.name,t.inc,t.data,t.start)})),e.attachEvent("onCommand",(function(t){"highlight-invalid-data"==t.id?e.validation.highlight(!0):"remove-highlight-invalid-data"==t.id?e.validation.highlight():"remove-cell-validation"==t.id&&wn.set((function(){return e.eachSelectedCell((function(t){return e.validation.remove(t.row,t.column)}))}))})),e.attachEvent("onDataSerialize",(function(t){var n,i;return n=function(e){var t=e.validation._pull,n=[];for(var i in t)for(var r in t[i])n.push([i,r,t[i][r]]);return[n,e.validation._highlight?1:0]}(e),i=gn(n,2),t.validation=i[0],t.table.highlightInvalid=i[1],n})),e.attachEvent("onDataParse",(function(t){return function(e,t){var n=t.validation;if(n)for(var i=0;i<n.length;i++){var r=n[i];e.validation._pull[r[0]]||(e.validation._pull[r[0]]={}),e.validation._pull[r[0]][r[1]]=r[2]}t.table&&t.table.highlightInvalid&&(e.validation._highlight=!0)}(e,t)})),e.attachEvent("onReset",(function(){e.validation._pull={},e.validation._highlight=!1})),e.attachEvent("onChange",(function(){return Na(e)})),e.$$("cells").attachEvent("onSelectChange",(function(){return Na(e)}))},isInvalid:Ia,pasteValidation:Ma});function Da(e,t){return t||e.alert({type:"alert-error",text:webix.i18n.spreadsheet.labels["error-link"]}),!1}function qa(e,t,n){try{var i,r,o,a,s,l=t.split("!");switch(l.length){case 1:l=gn(l,1)[0];break;case 2:var u=gn(l,2);if(s=u[0],l=u[1],-1!=s.indexOf(" ")&&("'"!=s[0]||"'"!=s[s.length-1]))return Da(e,n);break;default:return Da(e,n)}if(Hn(l)){var c=gn(Dn(l),2);i=c[0],o=c[1]}else{var h=qn(t,e);if(!h)return Da(e,n);var d=gn(h,5);i=d[0],o=d[1],r=d[2],a=d[3],s=d[4]}if(s){if(!Yr(e,s=s.replaceAll("'","")))return Da(e,n);s!=e.getActiveSheet()&&e.showSheet(s)}var f=e.$$("cells");return f.showCell(i,o),f.addSelectArea({row:i,column:o},{row:r||i,column:a||o}),!0}catch(t){return Da(e,n)}}function za(e,t){e.attachEvent("onComponentInit",(function(){return function(e){var t,n,i=e._table,r=webix.event(document.body,"pointermove",function(){var t;return function(n){"mouse"===n.pointerType&&(clearTimeout(t),t=webix.delay((function(t){if(!e.comments._activeComment.editStatus){var n=i.locate(t),r=e.comments.commentsView&&e.comments.commentsView.isVisible();if(n&&e.comments.get(n.row,n.column)){var o=e.comments._activeComment.cell;(!o||o.row==n.row&&o.column==n.column)&&r||e.callEvent("onCommand",[{id:"add-comment",cell:n,viewonly:!0}])}else r&&!e.comments.commentsView.$view.contains(t.target)&&e.callEvent("onCommentHide",[])}}),!0,[n],250))}}());e.config.math&&(i.config.editMath=!0);function o(){var t=i.getSelectedId(!0);if(t.length){oa(t[0],t[t.length-1]?t[t.length-1]:t[0],e)}else{var n={row:0,column:0};oa(n,n,e)}}i.attachEvent("onBeforeEditStop",(function(t,n){i.$anyKey=!1;var r=e.getCellValue(n.row,n.column);""===r&&""===t.value||(t.value!=r&&(e.setCellValue(n.row,n.column,t.value),i.refresh()),t.value=t.old)})),i.attachEvent("onEnter",(function(e){i.getEditor()&&webix.delay((function(){i.moveSelection("down")})),webix.html.preventEvent(e)})),e.attachEvent("onBeforeEditStart",(function(t,n){return!e.isCellLocked(t,n)})),i.attachEvent("onAfterEditStart",(function(t){var n=t.row,r=t.column,o=e.getCellValue(n,r);i.$anyKey&&(i.$anyKey=!1,o=""),i.getEditor().setValue(o)})),i.attachEvent("onBeforeEditStart",(function(t){return e.callEvent("onBeforeEditStart",[t.row,t.column])})),i.attachEvent("onBeforeSelect",(function(e){return"rowId"!=e.column})),i.attachEvent("onBeforeBlockSelect",(function(t,n,i){oa(i?t:webix.copy(t),i?n:webix.copy(n),e)})),i.attachEvent("onSelectChange",(function(){return o()})),i.attachEvent("onAfterColumnShow",(function(){webix.delay((function(){return o()}))})),i.attachEvent("onColumnResize",(function(){webix.delay((function(){return o()}))})),webix.event(i.$view.firstChild,"mousedown",(function(e){var n=i.config.resizeColumn,r=i.locate(e);if(r&&r.cind){if(n){var o=i.getColumnConfig(r.column).width,a=webix.html.posRelative(e);if(a.x<n.size||o-a.x<n.size+1)return}t=r.cind}})),webix.event(i.$view.firstChild,"mousemove",(function(r){if(t){var o=i.locate(r);o&&(n=o.cind,oa({column:i.columnId(t)},{column:i.columnId(n||1)},e))}}));var a=webix.event(document.body,"mouseup",(function(){t&&(null!=n&&(Qo(i.columnId(t),e,i.columnId(n||1)),n=null),t=null)}));i.attachEvent("onItemDblClick",(function(t){"rowId"===t.column&&ra(t.row,e)}));var s=0;i.attachEvent("onHeaderClick",(function(t,n){if("rowId"!=t.column){var i=new Date;i-s<=300?ia(t.column,e):(s=i,n.shiftKey?ta(t.column,e):Qo(t.column,e))}else Ko(e)}));var l=null;i.attachEvent("onItemClick",(function(t,n){"rowId"===t.column&&(n.shiftKey&&l?Go(l,e,t.row):Go(t.row,e),l=t.row)})),e.attachEvent("onReset",(function(){return Fa(e)})),e.attachEvent("onBeforeSheetShow",(function(){return i.editStop()})),i.attachEvent("onBlur",(function(){webix.delay((function(){var t=document.activeElement;if(!t||"INPUT"!=t.tagName){var n=webix.UIManager.getFocus();n&&!n.config.saveFocus&&n!=i&&n.getTopParentView&&n.getTopParentView()===e&&webix.UIManager.setFocus(i)}}),this,[],100)})),i.attachEvent("onMoveSelection",(function(e,t,n){"rowId"==e.column&&"left"==t&&n.ctrl&&(e.column=1)})),function(e){webix.html.addStyle("#"+e._table.$view.id+".webix_dtable .webix_cell { white-space:nowrap;}")}(e),e.attachEvent("onDestruct",(function(){webix.eventRemove(r),webix.eventRemove(a)}))}(e)}));var n={view:"datatable",id:"cells",css:"webix_ssheet_table webix_data_border wss_"+e.$index,headerRowHeight:"contrast"==webix.skin.$name||"flat"==webix.skin.$name?24:20,spans:!0,leftSplit:1,areaselect:!0,minColumnWidth:40,editable:!0,editaction:t.liveEditor?"custom":"dblclick",minRowHeight:1,navigation:!0,onClick:{webix_ssheet_ref:function(t){var n=t.target.getAttribute("data-ref").replaceAll("&#x27;","'");if(qa(e,n))return!1}}};return t&&(n=webix.extend(n,t,!0)),n}function Pa(e,t,n,i,r,o){var a=e.$$("cells").config.showFormulas&&!o,s=r.id,l=t.id;if(!e._mPage)return"";var u=e._mPage.getCell(l-1,s-1),c=u?u.value:"",h=u?u.format:"",d=e.getCellValue(l,s);if(a&&(c=d),d!=c){var f=webix.i18n.spreadsheet.table;c="#REF!"==c?f["math-ref-error"]:"#ERROR"==c?f["math-error"]:En(d,c)}var g="",m="string"==typeof c&&"+"==c.trim()[0]||!c&&0!==c||isNaN(c),v=!a&&nr(h,"date")&&rr(c),p="";if(o||(p+=e.comments.get(l,s)?"<div class='ssheet_commented_sign'></div>":"",p+=e.getCellFilter(l,s)?"<div class='ssheet_filter_sign'></div>":""),!v&&("boolean"==typeof c||!m||nr(h,"string")))if(h){var b={css:""},w=Ni(h);if(w){var _=w(c,b);_!=webix.i18n.spreadsheet.table["format-error"]?(b.css&&(g='class="'.concat(b.css,'"')),c=_):m||(c*=1)}}else c*=1;return e._print&&!c&&0!==c?"":((webix.isUndefined(c)||null===c)&&(c=""),"<div ".concat(g,">").concat(c,"</div>").concat(e._print?"":p))}function Fa(e){var t=e.$$("cells");t.clearAll();for(var n=e.config.columnCount,i=e.config.rowCount,r=[{id:"rowId",header:"",width:40,css:"sheet_column_0",template:function(e){return e.id}}],o=1;o<=n;o++)r.push({id:o,editor:"text",header:{text:Vn[o]},template:function(t,n,i,r){return Pa(e,t,0,0,r)},cssFormat:function(t,n,i,r){var o=Ua(e,i,r),a=e._mPage.getCell(i-1,r-1),s=a&&a.style||"",l=fa(e,i,r,o);l&&(s+=(s?" ":"")+l);var u=xo(e,i,r);u&&(s+=(s?" ":"")+u);var c=Va(e,i,r,o);return c&&(s+=(s?" ":"")+c),s}}),e.callEvent("onColumnInit",[r[o]]);t.refreshColumns(r);for(var a=[],s=1;s<=i;s++)a.push({id:s});t.parse(a)}function Ua(e,t,n){return Pa(e,{id:t},0,0,{id:n},!0).replace(/<[^>]*>/gi,"")}function La(e){var t=e.$$("cells"),n=webix.env.isMac?"command":"ctrl";if(webix.UIManager.addHotKey(n+"-a",(function(){t.getEditor()||Ko(e)}),t),webix.UIManager.addHotKey(n+"-p",(function(t,n){return function(e,t,n){return t.callEvent("onCommand",[{id:e}]),webix.html.preventEvent(n)}("print",e,n)}),t),!e.config.readonly){webix.UIManager.addHotKey("any",(function(e,n){var i=n.which||n.keyCode,r=113==i;if(!(16==i||i>=112&&i<=123&&!r)){var o=e.getSelectedId(!0);o.length&&(e.config.liveEditor&&r||(t.$anyKey=!0),t.edit(o[0]))}}),t),webix.UIManager.addHotKey("enter",(function(e){var n=e.getSelectedId(!0);n.length&&(e.config.liveEditor&&!t.callEvent("onBeforeLiveEditor",[n[0]])||t.edit(n[0]))}),t),webix.UIManager.addHotKey("backspace",(function(){return Ba(e)}),t),webix.UIManager.addHotKey("delete",(function(){return Ba(e)}),t);var i=webix.env.isMac?"command-shift-z":"ctrl-y";webix.UIManager.addHotKey(i,(function(){return e.redo()}),t),webix.UIManager.addHotKey(n+"-z",(function(){return e.undo()}),t),webix.UIManager.addHotKey(n+"-b",(function(){return ja(e,"font-weight")}),t),webix.UIManager.addHotKey(n+"-i",(function(){return ja(e,"font-style")}),t),webix.UIManager.addHotKey(n+"-u",(function(t,n){return function(e,t){return ja(e,"underline"),webix.html.preventEvent(t)}(e,n)}),t);var r=webix.env.isMac?"command-shift-x":"ctrl-alt-s";webix.UIManager.addHotKey(r,(function(){return ja(e,"strike")}),t),webix.UIManager.addHotKey(n+"-add",(function(t,n){return Ha(e,"in",n)}),t),webix.UIManager.addHotKey(n+"-=",(function(t,n){return Ha(e,"in",n)}),t),webix.UIManager.addHotKey(n+"-subtract",(function(t,n){return Ha(e,"out",n)}),t),webix.UIManager.addHotKey(n+"-0",(function(t,n){return Ha(e,1,n)}),t),webix.UIManager.addHotKey(n+"-`",(function(){return e.showFormulas("toggle")}),t)}}function Ba(e){e.$$("cells").getEditor()||wn.set((function(){e.eachSelectedCell((function(t){return e.setCellValue(t.row,t.column,"")})),e.refresh()}))}function Ha(e,t,n){return e.zoom(t),webix.html.preventEvent(n)}function ja(e,t){var n=e.getSelectedId();if(n){var i=e.getStyle(n.row,n.column),r=zo[t]||t,o=i&&i.props[t]===r?"normal":r;e.callEvent("onStyleSet",[t,o])}}function Wa(e){return e.attachEvent("onComponentInit",(function(){return function(e){var t=e.$$("liveEditor"),n=e.$$("navigation"),i=e._table;function r(n,i){var r=t.config.activeCell;r&&r.row==n&&r.column==i&&Xa(e,{row:n,column:i})}function o(n,i,r){if(!e.getCellEditor(i.row,i.column)&&Xa(e,i,r)){if(t.focus(),!r){t.paintValue();var o=t.getInputNode(),a=o.value.length;o.setSelectionRange(a,a)}return!1}return!0}function a(){t.define({activeCell:null}),t.setValue(""),t.disable()}i.attachEvent("onBeforeEditStart",(function(e){var t=i.$anyKey;return i.$anyKey=!1,o(this,e,t)})),i.attachEvent("onBeforeLiveEditor",(function(e){return o(this,e,!1)})),i.attachEvent("onItemDblClick",(function(t){"rowId"!=t.column&&(e.getCellEditor(t.row,t.column)?this.edit(t):o(this,t,!1))})),i.attachEvent("onAfterScroll",(function(){t.$view.contains(document.activeElement)&&t.paintValue()})),e.attachEvent("onCellChange",(function(n,i,r,o){if(o==e.getActiveSheet()){var a=t.config.activeCell;a&&a.row==n&&a.column==i&&t.setValue(r)}})),e.attachEvent("onAfterSelect",(function(t){e.$handleSelection||Xa(e,t[0])})),e.attachEvent("onChange",(function(n){if("update"==n&&t.isEnabled()){var i=t.config.activeCell;i&&t.getValue()!=e.getCellValue(i.row,i.column)&&(delete t._update_range,t.showActiveSheet(),t.updateCellValue())}})),e.attachEvent("onBeforeSheetShow",(function(r){if(!e._rangeDialog){var o=t.config.activeCell;if(o){var s=t.getInputNode().selectionStart,l=t.getValue();e.getCellValue(o.row,o.column)!=l?(t._activeMath||(t._activeMath=e.getActiveSheet()),webix.delay((function(){if(r==t._activeMath){e.$handleSelection=null;var n=t.config.activeCell;i.select(n.row,n.column)}t.setValue(l),t.refresh(),t.getInputNode().setSelectionRange(s,s),t.paintValue(),e.$handleSelection=function(t,n,i,r){return Ga(e,i,r,t)}}))):(n.setValue(""),a())}}})),e.attachEvent("onReset",(function(){e._rangeDialog||(e.$handleSelection=null)})),e.$$("cells").attachEvent("onFocus",(function(){t._activeMath&&webix.delay((function(){return t.focus()}))})),e.attachEvent("onAfterLoad",(function(){return a()})),e.attachEvent("onAction",(function(n,i){if(!i.page||i.page==e.getActiveSheet()){var r=t.config.activeCell;if("paste"==n)return Xa(e,r);!(r&&r.row==i.row&&r.column==i.column)||"lock"!=n&&"dropdown"!=n||Ya(e,i.row,i.column)}})),e.attachEvent("onFormatChange",(function(t,n,i,o,a){a==e.getActiveSheet()&&r(t,n)})),e.attachEvent("onCellChange",(function(t,n,i,o){o==e.getActiveSheet()&&r(t,n)}))}(e)})),{view:"toolbar",css:"webix_ssheet_toolbar",elements:[{view:"text",icon:"wxi-menu-down",on:{onItemClick:function(){var e=webix.$$(this.config.suggest);e.isVisible()||e.show(this.getInputNode())},onChange:function(t,n,i){"user"==i&&""!==t&&e.showCell(t)}},suggest:{view:"ssheet-suggest-labels",css:"webix_ssheet_nav_suggest",body:{template:"<span class='webix_ssheet_left'>#name#</span><span class='webix_ssheet_right'>#value#</span>",width:250},on:{onBeforeShow:function(){var t=e.ranges.serialize(e.getActiveSheet()).map((function(e){return{name:e[0],value:e[1]}}));if(!t.length)return!1;var n=this.getList();n.clearAll(),n.parse(t)}},data:[]},width:150,id:"navigation"},{view:"ssheet-separator"},{view:"label",label:webix.i18n.spreadsheet.liveEditor.edit,width:65},{view:"button",id:"formulaButton",label:"f(x)",autowidth:!0,popup:{view:"popup",on:{onBeforeShow:function(){var t=this;if(!e.getSelectedId())return!1;webix.delay((function(){var e=t.getBody();e.unselect&&e.unselect(),e.scrollTo(0,0);var n=e.getFilter("value");n.value="",n.focus(),e.filterByAll()}))},onHide:function(){e.$$("liveEditor").focus()}},width:200,body:{view:"datatable",saveFocus:!0,scroll:"y",data:Bt(),columns:[{id:"value",header:[{content:"textFilter"}],fillspace:!0}],on:{onItemClick:function(t){Ka(e,this,t)},onKeyPress:function(t){if(27==t)this.hide();else if(13==t){var n=this.getSelectedId();n&&Ka(e,this,n.row)}}}}}},{view:"live-editor",disabled:!0,id:"liveEditor",suggestData:Bt()}]}}function Xa(e,t,n){var i=e.$$("liveEditor");if(i&&t){var r=Ya(e,t.row,t.column);return i.config.activeCell=t,i.setValue(n?"":i.getCellValue(t.row,t.column)),e._rangeDialog||(e.$handleSelection=r?null:function(t,n,i,r){return Ga(e,i,r,t)}),!r}}function Ya(e,t,n){var i=e.$$("liveEditor"),r=e.getCellEditor(t,n)||e.isCellLocked(t,n);return r?i.disable():i.enable(),r}function Ga(e,t,n,i){var r,o=e.$$("liveEditor"),a=o._update_range,s=o.getInputNode().selectionStart,l="";if(o._activeMath){var u=e.getActiveSheet();o._activeMath!=u&&(l=o.prepareSheet(u))}t==n?r=":"==o.getValue()[(a?a.pos:s)-1]?t:l+t:r="".concat(l+t,":").concat(n);if(a&&a.pos==s-a.len)o.setRange(r,!0),s=o._update_range.pos+r.length;else{if(!o.expectOperator())return function(e,t){var n=e.$$("liveEditor");if(n.isEnabled()){var i=n.config.activeCell;n.showActiveSheet(),n.updateCellValue(i),n.setValue(t?e.getCellValue(t.row,t.column):"")}return!0}(e,i);o.setRange(r),s+=r.length}return o.focus(),o.getInputNode().setSelectionRange(s,s),o.paintValue(),!1}function Ka(e,t,n){var i=e.$$("liveEditor"),r=t.getItem(n).value,o=i.getValue(),a=r+"(";a=0==o.indexOf("=")?o+(i.expectOperator(!0)?"":"+")+a:"="+a,t.getParentView().hide(),i.setValue(a)}var Qa=function(){return ln((function e(t){sn(this,e),this.view=t}),[{key:"$init",value:function(){}},{key:"$show",value:function(){}},{key:"$hide",value:function(){}},{key:"open",value:function(){var e=this;if(this.$dialog){if(this.$dialog.isVisible())return}else this.$dialog=webix.ui(this.$init()),this.view._destroy_with_me.push(this.$dialog),this.$dialog.attachEvent("onHide",(function(){e.$hide(),webix.UIManager.setFocus(e.view)})),this.$dialog.attachEvent("onShow",(function(){webix.UIManager.setFocus(e.$dialog)}));var t=this.$dialog.getBody();this.$dialog.show(),!1===this.$show(this.$dialog,t)&&this.close()}},{key:"close",value:function(){this.$dialog.hide()}}])}();function Za(e){return e?('"'===(e=e.trim())[0]&&(e=e.substr(1)),'"'===e[e.length-1]&&(e=e.substr(0,e.length-1)),e):""}var Ja=function(e){function t(){return sn(this,t),an(this,t,arguments)}return hn(t,e),ln(t,[{key:"$show",value:function(e,t){if(this.cell=this.view.getSelectedId(),!this.cell)return!1;t.elements.preview.setHTML(""),t.elements.url.setValue("");var n=function(e){if(e&&"string"==typeof e&&0===e.indexOf("=IMAGE("))return{url:Za(e.substr(7,e.length-8))}}(this.view.getCellValue(this.cell.row,this.cell.column));n&&n.url&&t.elements.url.setValue(n.url),t.elements.url.focus()}},{key:"$init",value:function(){var e=this,t=this.view.config.save,n=t&&t.images||null;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["image-title"],move:!0,position:"center",body:{view:"form",elements:[{view:"text",name:"url",placeholder:webix.i18n.spreadsheet.labels["image-url"],on:{onChange:function(t){return e.showPreview(t)}}},{view:"label",label:webix.i18n.spreadsheet.labels["image-or"],align:"center"},{view:"uploader",label:webix.i18n.spreadsheet.labels["image-upload"],upload:n,on:{onBeforeFileAdd:function(e){var t=this;if(!this.config.upload){var n=new FileReader;return n.onload=function(e){return t.getFormView().elements.url.setValue(e.target.result)},n.readAsDataURL(e.file),!1}this.getFormView().elements.preview.setHTML("")},onFileUpload:function(e,t){this.getFormView().elements.url.setValue(t.imageURL)}}},{view:"formlate",name:"preview",borderless:!0,css:"webix_ssheet_preview",template:"",height:50}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"okClick",value:function(){var e=this.cell,t=this.fillUrl(this.$dialog.getBody().elements.url.getValue());this.view.addImage(e.row,e.column,t),this.close()}},{key:"fillUrl",value:function(e){return/^[/]|((https?:\/|data:image)\/)/i.test(e)||(e="http://"+e),e}},{key:"showPreview",value:function(e){e&&(e=webix.template.escape(this.fillUrl(e)),this.$dialog.queryView("form").elements.preview.setHTML("<img class='webix_ssheet_cimage' src='"+e+"'></img>"))}}])}(Qa),es=Object.freeze({__proto__:null,DialogBox:Ja,action:"add-image-cell"}),ts=function(e){function t(){return sn(this,t),an(this,t,arguments)}return hn(t,e),ln(t,[{key:"open",value:function(e){this.config=e.config,this.viewid=e.viewid,this.view.callEvent("onUIEditStart",[this.viewid,"image"]),Ja.prototype.open.apply(this,arguments)}},{key:"$hide",value:function(){this.view.callEvent("onUIEditStop",[this.viewid,"image"]),this.config=this.viewid=null}},{key:"$init",value:function(){var e=this;return this.view.attachEvent("onUIEditStart",(function(t,n){e.$dialog&&e.$dialog.isVisible()&&"image"!=n&&e.close()})),this.view.attachEvent("onCommand",(function(t){"close-ui-editor"==t.id&&e.$dialog&&e.$dialog.isVisible()&&e.close()})),Ja.prototype.$init.apply(this,arguments)}},{key:"$show",value:function(e,t){t.elements.preview.setHTML(""),t.elements.url.setValue(""),this.config&&this.config.data&&t.elements.url.setValue(this.config.data),t.elements.url.focus()}},{key:"okClick",value:function(){var e=this.fillUrl(this.$dialog.getBody().elements.url.getValue());if(this.viewid)this.view.views.update(this.viewid,e);else{var t=this.view.views.add(null,null,"image",e);this.view.views.highlight(t)}this.close()}}])}(Ja),ns=Object.freeze({__proto__:null,DialogBox:ts,action:"add-image-top"}),is=!1;function rs(e){cs(e,-1)}function os(e){cs(e,1)}function as(e){is||(e._ssUndoHistory=[],e._ssUndoCursor=-1)}function ss(e,t){e.$skipHistory||e._loading_data||(e._ssUndoHistory.splice(e._ssUndoCursor+1),e._ssUndoHistory.push(t),e._ssUndoCursor++)}function ls(e,t){t.$skipHistory++;try{e.call(t)}finally{t.$skipHistory--}}function us(e){is=!0,e(),is=!1}function cs(e,t){var n=e._ssUndoHistory[t>0?e._ssUndoCursor+t:e._ssUndoCursor];if(n){var i=t>0?n.newValue:n.value,r=t>0,o=[n.action,n.row,n.column,i,r,n.extra];e._ssUndoCursor+=t;var a=n.group,s=e._ssUndoHistory[t>0?e._ssUndoCursor+t:e._ssUndoCursor];ls((function(){e.callEvent("onUndo",o),a&&s&&a==s.group||(e.refresh(),e.callEvent("onAfterUndo",[]))}),e),s&&a&&a==s.group&&cs(e,t)}}var hs,ds=Object.freeze({__proto__:null,ignoreReset:us,ignoreUndo:ls,init:function(e){as(e),function(e){e.attachEvent("onUndo",(function(t,n,i,r){switch(t){case"freeze-row":e.freezeRows(r);break;case"freeze-column":e.freezeColumns(r)}}))}(e),e.attachEvent("onHardReset",(function(){return as(e)})),e.attachEvent("onAfterSheetShow",(function(){return as(e)})),e.attachEvent("onBeforeStyleChange",(function(t,n,i,r){if(ro(e,t,n))return!1;ss(e,{action:"style",row:t,column:n,value:r,newValue:i,group:wn.value})})),e.attachEvent("onBeforeValueChange",(function(t,n,i,r,o){if(ro(e,t,n,o))return!1;o==e.getActiveSheet()&&ss(e,{action:"value",row:t,column:n,value:r,newValue:i,group:wn.value})})),e.attachEvent("onBeforeSpan",(function(t,n,i){if(ro(e,t,n))return!1;ss(e,{action:"span",row:t,column:n,value:i,newValue:i,group:wn.value})})),e.attachEvent("onBeforeSplit",(function(t,n,i){if(ro(e,t,n))return!1;ss(e,{action:"split",row:t,column:n,value:i,newValue:i,group:wn.value})})),e.attachEvent("onAction",(function(t,n){n.page&&n.page!=e.getActiveSheet()||ss(e,{action:t,row:n.row||null,column:n.column||null,value:webix.isUndefined(n.value)?null:n.value,newValue:webix.isUndefined(n.newValue)?null:n.newValue,extra:n.extra||null,group:wn.value})})),e.$$("cells").attachEvent("onColumnResize",(function(t,n,i){return ss(e,{action:"c-resize",row:0,column:t,value:i,newValue:n,group:wn.value})})),e.attachEvent("onColumnOperation",(function(t,n,i,r){r==e.getActiveSheet()&&"add"!==t&&"del"!==t&&ss(e,{action:{id:t,group:"column"},group:wn.value,column:{start:{column:n},end:{column:i}}})})),e.attachEvent("onRowOperation",(function(t,n,i,r){r==e.getActiveSheet()&&"add"!==t&&"del"!==t&&ss(e,{action:{id:t,group:"row"},group:wn.value,row:{start:{row:n},end:{row:i}}})})),e.$$("cells").attachEvent("onRowResize",(function(t,n,i){return ss(e,{action:"r-resize",row:t,column:0,value:i,newValue:n,group:wn.value})})),e.attachEvent("onBeforeConditionSet",(function(t,n,i,r,o){if(ro(e,t,n,o))return!1;o==e.getActiveSheet()&&(i=i?webix.copy(i):null,ss(e,{action:"condition",row:t,column:n,value:i,newValue:r,group:wn.value}))})),e.attachEvent("onZoom",(function(t,n,i){i==e.getActiveSheet()&&ss(e,{action:"zoom",value:n,newValue:t,group:wn.value})})),e.$skipHistory=0},redo:os,reset:as,undo:rs});function fs(e){clearTimeout(hs),hs=webix.delay((function(){var t=e.views;for(var n in t._pull){var i=t._pull[n],r=t._types[i.type],o=r.render,a=r.track;a&&gs(e,t.get(n),a,i,o)}}))}function gs(e,t,n,i,r){var o=ws(e,i);if("chart"==i.type){r&&(t=r(t,i,o,!0));var a=i.config;a&&!ys(a.type)&&function(e,t,n){var i=t.config;"object"!=pn(i.legend)&&(i.legend={fromData:!!i.legend});var r=i.legend;if(r.fromData)e.shift();else if(r.range)for(var o=_s(n,t),a="rows"==i.dataSeries,s=Ss(r.range,a,o),l=0;l<s.length;l++){var u=s[l];delete e[0][u]}}(o,i,e)}n(t,o)}function ms(e,t){for(var n in webix.callEvent("onClick",[]),e.views._pull){var i=webix.$$(n),r=e.views._pull[n];t&&(r.x=ps(e,r.config.width,r.x,"x"),r.y=ps(e,r.config.height,r.y,"y")),vs(e,i,r)}}function vs(e,t,n){var i=e._table.getScrollState();t.define({width:n.config.width*e._zoom,height:n.config.height*e._zoom}),t.resize(),t.show({x:n.x*e._zoom,y:n.y*e._zoom-i.y})}function ps(e,t,n,i){if(n||0===n){var r=("x"==i?function(e){var t=0;return e._table.eachColumn((function(e){"rowId"!==e&&(t+=this.getColumnConfig(e).width)})),t/e._zoom}(e):function(e){var t=0;return e._table.data.each((function(e){t+=e.$height||webix.skin.$active.rowHeight})),t/e._zoom}(e))-t;n=Math.min(Math.max(n,0),r)}else n=e._table.getScrollState()[i]+50;return n}function bs(e){return"string"==typeof e&&-1===e.indexOf("data:image")}function ws(e,t){var n=t.data;if(/^(http|data:image|\/)/i.test(n))return n;var i=[];if(n){var r="rows"==t.config.dataSeries,o=0;n=xs(n);for(var a=0;a<n.length;a++){var s=bs(n[a])?qn(n[a],e):null;if(s){var l=s[4]?e._mData.getPage(s[4]):e._mPage;if(s[5]=o,l){var u=r?Rs.apply(l,s):$s.apply(l,s);o+=u[2];for(var c=0;c<u[0].length;c++)i[c]||(i[c]={}),webix.extend(i[c],u[0][c])}}}}return i}function _s(e,t){var n=t.data;if(!/^(http|data:image|\/)/i.test(n)){var i={};if(n){var r="rows"==t.config.dataSeries,o=0;n=xs(n);for(var a=0;a<n.length;a++){var s=bs(n[a])?qn(n[a],e):null;if(s){var l=s[4]?e._mData.getPage(s[4]):e._mPage;if(s[5]=o,l){var u=r?Rs.apply(l,s):$s.apply(l,s);o+=u[2],webix.extend(i,u[1])}}}}return i}}function xs(e){return e.replace(/\s/g,"").split(",")}function ys(e){return/pie|donut/.test(e)}function Cs(e,t,n,i,r){var o="rows"==n,a=[];if(t){var s=[],l=[],u=[];i&&(i.legend&&(l=Ss(i.legend,o)),i.xAxis&&(s=Ss(i.xAxis,o)),i.series&&(u=i.series.filter((function(e){return-1==l.indexOf(e.range)&&-1==s.indexOf(e.range)})))),t=xs(t);var c=0,h=1;t.forEach((function(t){var n=Ln(t)?qn(t,e):null;if(n){for(var i,d=o?n[0]:n[1],f=o?n[2]:n[3],g=function(){var e=o?Pn(m,n[1],m,n[3],n[4]):Pn(n[0],m,n[2],m,n[4]),r=Gn(u,(function(n){return n.range==e&&(!n.active||n.active==t)}));r&&(r.active||(r.active=t),i=1)},m=d;m<=f;m++)g();for(var v=function(){var e=o?Pn(p,n[1],p,n[3],n[4]):Pn(n[0],p,n[2],p,n[4]);if(-1!=l.indexOf(e)||-1!=s.indexOf(e))return 0;var f,g,m=u.filter((function(n){return n.range==e&&n.active==t}))[0];if(i&&!m&&(!r||!h||p!=d))return 0;a.push(m||{active:t,range:e,marker:"square",tooltip:1,color:(f=c,g=["#e06666","#6aa84f","#3c78d8","#e69138","#783f04","#134f5c","#674ea7","#c27ba0"],g[f%g.length])}),c++},p=d;p<=f;p++)v();h=0}}))}return a}function Ss(e,t,n){var i=[];return(e=xs(e)).forEach((function(e){if(e=Ln(e)?qn(e):null)for(var r=t?e[0]:e[1],o=t?e[2]:e[3],a=r;a<=o;a++){var s=t?Pn(a,e[1],a,e[3],e[4]):Pn(e[0],a,e[2],a,e[4]);i.push(n?n[s]:s)}})),i}function Es(e){return"object"!=pn(e.xAxis)&&(e.xAxis={fromData:!!e.xAxis}),"object"!=pn(e.legend)&&(e.legend={fromData:!!e.legend}),e.legend=webix.extend(e.legend,{layout:"x",align:"center",valign:"bottom"}),e.scale||(e.scale={lines:1}),e}function $s(e,t,n,i,r,o){for(var a=[],s={},l=e,u=0;l<=n;l++,u++){a[u]={};for(var c=t,h=o;c<=i;c++,h++)l==n&&(s["".concat(r?r+"!":"").concat(Vn[c]).concat(e,":").concat(Vn[c]).concat(n)]="data".concat(h),o++),a[u]["data".concat(h)]=this.getValue(l-1,c-1)}return[a,s,o]}function Rs(e,t,n,i,r,o){for(var a=[],s={},l=t,u=0;l<=i;l++,u++){a[u]={};for(var c=e,h=o;c<=n;c++,h++)l==i&&(s["".concat(r?r+"!":"").concat(Vn[t]).concat(c,":").concat(Vn[i]).concat(c)]="data".concat(h),o++),a[u]["data".concat(h)]=this.getValue(c-1,l-1)}return[a,s,o]}var As=Object.freeze({__proto__:null,_getDataParts:xs,_getParts:Ss,_getSeries:Cs,_isPie:ys,_normalizeConfig:Es,init:function(e){var t,n=e._table.$view.querySelector(".webix_ss_center");e.views={register:function(e,t,n){this._types[e]||(this._types[e]={render:t,track:n})},move:function(t,n,i){var r=webix.$$(t),o=webix.copy(this._pull[t]);this._pull[t].x=ps(e,o.config.width,n/e._zoom,"x"),this._pull[t].y=ps(e,o.config.height,i/e._zoom,"y"),e.callEvent("onAction",["move-view",{row:t,newValue:webix.copy(this._pull[t]),value:o}]),vs(e,r,this._pull[t])},add:function(t,i,r,o,a,s){var l=this;a=a||{},"chart"==r&&(a=webix.extend(a,{type:"line",dataSeries:"columns"}));var u=a.height=a.height||300,c=a.width=a.width||500,h=webix.ui({id:s||"$ssheet-ui"+webix.uid(),view:"ssheet-ui",container:n,master:e._table.config.id,width:c,height:u});return h.attachEvent("onViewMoveEnd",(function(t,n){var i=e._table.getScrollState();l.move(s,t,n+i.y)})),h.attachEvent("onViewResize",(function(){var t=l._pull[s],n=webix.copy(t);t.config.height=h.$height,t.config.width=h.$width,e.callEvent("onAction",["resize-view",{row:s,newValue:webix.copy(t),value:n}])})),h.attachEvent("onViewEdit",(function(){var t=l._pull[s],n=l._commands[t.type]||t.type;e.callEvent("onCommand",[{id:n,viewid:s,config:t}])})),h.attachEvent("onViewRemove",(function(){return l.remove(s)})),s=h.config.id,t=ps(e,u,t,"x"),i=ps(e,c,i,"y"),this._pull[s]={x:t,y:i,type:r,data:o,config:a},this.update(s,o,a,!0),vs(e,h,this._pull[s]),s},remove:function(t){var n=this._pull[t];webix.$$(t).close(),delete this._pull[t],e.callEvent("onAction",["add-view",{row:t,newValue:null,value:n}])},get:function(e){return webix.$$(e).getBody()},getConfig:function(e){return this._pull[e]},update:function(t,n,i,r){var o=r?null:webix.copy(this._pull[t]),a=this._pull[t],s=this._types[a.type];if(n=n||i.data||"",delete(i=i||{}).data,"chart"==a.type){var l=i.type;if(l&&!i.series){var u,c=i.xAxis&&i.xAxis.range,h=i.legend&&i.legend.range;o&&o.config&&(ys(l)?o.config.legend&&o.config.legend.fromData&&(u=1):o.config.xAxis&&o.config.xAxis.fromData&&(u=1)),i.series=Cs(e,n,i.dataSeries,{xAxis:c,legend:h},u)}}var d=webix.$$(t),f=i.height||300,g=i.width||500;d.$width!=g&&d.$height!=f&&(d.define({width:g,height:f}),d.resize()),a.data=n,a.config=i;var m=this.get(t);if(n=ws(e,a),s.render){var v=webix.copy(a);v.config.width=v.config.height=0,function(e){var t=function(e){return"datatable"==e.name||"treetable"==e.name},n=e.queryView(t,"self");n=n?[n]:e.queryView(t,"all");n.forEach((function(e){return e.disable()}))}(m=s.render(m,v,n))}s.track&&gs(e,m,s.track,a),e.callEvent("onAction",["add-view",{row:t,newValue:webix.copy(this._pull[t]),value:o}])},highlight:function(e){var t=webix.$$(e),n="webix_ssheet_ui_focused",i=webix.$$(this._activeWin);i&&!i.$destructed&&webix.html.removeCss(i.$view,n),t?(this._activeWin=e,webix.html.addCss(t.$view,n)):delete this._activeWin},_commands:{image:"add-image-top",chart:"add-chart"},_types:{},_pull:{}},e._table.attachEvent("onResize",(function(){return ms(e)})),e._table.attachEvent("onScrollY",(function(){return ms(e)})),e._table.attachEvent("onScrollX",(function(){return ms(e)})),e.attachEvent("onReset",(function(){return function(e){ls((function(){for(var t in e.views._pull)e.views.remove(t)}),e)}(e)})),e.attachEvent("onUndo",(function(t,n,i,r){var o="move-view"===t;(o||"resize-view"==t||"add-view"===t)&&function(e,t,n,i){if(i){var r=i.x,o=i.y,a=i.type,s=i.data,l=i.config;e.views._pull[n]?t?e.views.move(n,r,o):e.views.update(n,s,l):e.views.add(r,o,a,s,l,n);var u=e.$$("chartEditor");u&&u.viewId==n&&u.queryView("form").setValues(l)}else e.views.remove(n)}(e,o,n,r)})),e.attachEvent("onAction",(function(t,n){"header-hide"==t?ms(e):"before-grid-change"==t&&function(e,t,n,i,r){for(var o=i.views,a=0;a<o.length;a++)if(bs(o[a][3])){var s=o[a][4].series;s&&s.forEach((function(e){e.range=jn(e.range,t,n,r),e.active=jn(e.active,t,n,r)}));var l=o[a][4].legend&&o[a][4].legend.range;l&&(o[a][4].legend.range=xs(l).map((function(e){return jn(e,t,n,r)})).join(","));var u=o[a][4].xAxis&&o[a][4].xAxis.range;u&&(o[a][4].xAxis.range=jn(u,t,n,r)),o[a][3]=xs(o[a][3]).map((function(e){return jn(e,t,n,r)})).join(",")}}(0,n.name,n.inc,n.data,n.start)})),e.attachEvent("onZoom",(function(t,n,i){i==e.getActiveSheet()&&ms(e,!0)})),e.attachEvent("onColumnOperation",(function(t,n,i,r){r==e.getActiveSheet()&&ms(e,!0)})),e.attachEvent("onRowOperation",(function(t,n,i,r){r==e.getActiveSheet()&&ms(e,!0)})),e.attachEvent("onDataParse",(function(t){return function(e,t){var n=t.views;n&&ls((function(){n.forEach((function(t){return e.views.add.apply(e.views,t)}))}),e)}(e,t)})),e.attachEvent("onDataSerialize",(function(t,n){return function(e,t,n){for(var i in t.views=[],e.views._pull){var r=e.views._pull[i],o=[r.x,r.y,r.type,r.data,r.config];n&&n.viewIds&&o.push(i),t.views.push(o)}}(e,t,n)})),e.attachEvent("onCellChange",(function(t,n,i,r){r==e.getActiveSheet()&&fs(e)})),e.attachEvent("onMathRefresh",(function(){return fs(e)})),e.attachEvent("onDestruct",(function(){for(var t in e.views._pull)webix.$$(t).destructor()})),webix.attachEvent("onClick",(function(n){var i=webix.$$(n);i&&i.config.externalUI&&(i=webix.$$(i.config.externalUI));var r=i&&(i.queryView("ssheet-ui","self")||i.queryView("ssheet-ui","parent"));if(r){e.views.highlight(r);var o=r.config.id;t&&(e.views.getConfig(o).type==t?r.callEvent("onViewEdit",[]):e.callEvent("onCommand",[{id:"close-ui-editor"}]))}else t||e.views.highlight()})),e.attachEvent("onUIEditStart",(function(n,i){e.views.highlight(n),t=i})),e.attachEvent("onUIEditStop",(function(e,n){t==n&&webix.delay((function(){t=null}))})),e.views.register("chart",(function(t,n,i){var r=function(e,t,n){var i=/<[^>]*>/gi,r=webix.copy(e.config);r=Es(r);var o=r.scale.lines,a=r.scale.color||void 0,s=r.type=function(e){var t=e.type;e.stacked&&-1==t.indexOf("stacked")&&(e.type="stacked"+e.type.charAt(0).toUpperCase()+e.type.substr(1));e["3D"]&&-1==t.indexOf("3D")&&(e.type+="3D");e.horizontal&&-1==t.indexOf("H")&&(e.type+="H");return e.type}(r),l=ys(s),u=r.series;r.series=[];var c,h,d=r.xAxis,f=r.legend,g={height:24,align:f.align||"center",valign:f.valign||"bottom"};if(g.layout="middle"==g.valign?"y":"x",l)f.fromData?c="data0":f.range&&(c=n[f.range]),g.template="#".concat(c,"#");else{if(g.values=[],h=!f.fromData&&f.range){var m="rows"==r.dataSeries;h=Ss(f.range,m,n)}for(var v in r.yAxis=r.yAxis||{},r.yAxis)""===r.yAxis[v]&&delete r.yAxis[v];r.yAxis=webix.extend(r.yAxis,{lineColor:a,color:a,lines:o,lineShape:r.scale.circle?"arc":"default"}),d.fromData?d.range=h?Object.keys(t[0]).filter((function(e){return-1==h.indexOf(e)}))[0]:"data0":d.range&&(d.range=n[d.range])}for(var p=0;p<u.length;p++){var b=u[p].color,w=n[u[p].range];if(w!=d.range&&(!l||w!=c)){var _={value:"#".concat(w,"#"),tooltip:{template:u[p].tooltip?"#".concat(w,"#"):""}};if(_[l?"pieInnerText":"label"]=u[p].label?"#".concat(w,"#"):"","radar"==s||"line"==s||"spline"==s||"scatter"==s?(_.line={color:b},_.item={borderColor:b,type:u[p].marker}):l||(_.color=b),"area"!=s&&"splineArea"!=s||(_.alpha=.7),t[0]&&!l&&(h||f.fromData)){var x=h?t[0][h[p]]:t[0][w],y=x||0===x?(x+"").replace(i,""):"";g.values.push({text:y,color:b})}r.series.push(_)}}l||(r.xAxis={title:r.xAxis.title,lineColor:a,color:a,lines:o},r["barH"==s||"stackedBarH"==s?"yAxis":"xAxis"].template=function(e){var t=e[d.range];return t||0===t?(t+"").replace(i,""):""});c||g.values&&g.values.length?r.legend=g:delete r.legend;"scatter"==s&&(r.xValue=r.xAxis.template,r.origin="auto",delete r.xAxis.template);return webix.extend({view:"chart",padding:{left:80}},r,!0)}(n,i,_s(e,n));return webix.ui(r,t)}),(function(e,t){e.clearAll(),e.parse(t)})),e.views.register("image",(function(e,t,n){var i=webix.extend({css:"webix_ssheet_bgimage",template:'<img src="'.concat(n,'"/>')},t.config||{},!0);return webix.ui(i,e)}))}}),ks=webix.i18n.spreadsheet.labels;function Ts(e){e.attachEvent("onComponentInit",(function(){return function(e){var t=e.$$("chartEditor"),n=t.queryView("form"),i=n.elements;function r(){if(i["legend.fromData"].getValue()){var e=ys(i.type.getValue())?l:u;s(i["legend.range"],e())}}function o(e){e&&c("",i["legend.range"].getValue());var t=ys(i.type.getValue())?l:u;e=e?t():"",s(i["legend.range"],e)}function a(e){e&&c("",i["xAxis.range"].getValue());e=e?l():"",s(i["xAxis.range"],e)}function s(e,t){e.blockEvent(),e.setValue(t),e.unblockEvent()}function l(){var t=i.range.getValue(),n=i.dataSeries.getValue(),r=i["legend.range"].getValue(),o="",a=Cs(e,t,n,{legend:r||""});return a.length&&(o=a[0].range),o}function u(){var t=xs(i.range.getValue()),n="rows"==i.dataSeries.getValue(),r=xs(i["xAxis.range"].getValue()),o=[];return t.forEach((function(i){if(-1==r.indexOf(i)){var a=qn(i,e);if(a){var s=n?Pn(a[0],a[1],a[2],a[1],a[4]):Pn(a[0],a[1],a[0],a[3],a[4]);-1==t.indexOf(s)&&o.push(s)}}})),o.join(",")}function c(t,n){var r=i.range.getValue(),o=i["legend.range"].getValue(),a=i["xAxis.range"].getValue(),l=i.dataSeries.getValue(),u=Cs(e,r,l,{legend:o,xAxis:a});n=xs(n),r=xs(r).filter((function(e){return-1==n.indexOf(e)})),t&&(t=xs(t)).forEach((function(e){u.filter((function(t){return t.range==e})).length||r.push(e)})),s(i.range,r.join(","))}function h(e){var t=i["legend.align"].getList();"middle"==e?t.exists("center")&&t.remove("center"):t.exists("center")||t.add({id:"center",value:ks["chart-legend-center"]},1)}function d(e){var t=i["legend.valign"].getList();"center"==e?t.exists("middle")&&t.remove("middle"):t.exists("middle")||t.add({id:"middle",value:ks["chart-legend-middle"]},1)}function f(e){r();var t=ys(e),n="bar"==e,o=i.series,a="radar"==e||"line"==e||"spline"==e||"scatter"==e;o.hideSubviews("marker",a),o.hideSubviews("label",a||n||t),o.hideSubviews("color",!t),"area"==e||n?i.stacked.show():v(i.stacked),n?i.horizontal.show():v(i.horizontal),"radar"==e?i["scale.circle"].show():v(i["scale.circle"]),t?(p("axis"),p("pie",!0)):(p("axis",!0),p("pie")),t||"radar"==e?p("axisTitle"):p("axisTitle",!0),m()}function g(t){var n=i.range.getValue(),r=i.series.getValue(),o=i["legend.range"].getValue(),a=i["xAxis.range"].getValue(),s=i.dataSeries.getValue();r=Cs(e,n,s,{series:r,legend:o,xAxis:a},t),i.series.setValue(r)}function m(){var e="rows"==i.dataSeries.getValue(),t=i.horizontal.getValue(),n=ys(i.type.getValue());!n&&e||!e&&n?(i["legend.fromData"].define("label",ks["chart-col-legend"]),i["xAxis.fromData"].define("label",ks["chart-row-"+(t?"yAxis":"xAxis")])):(i["legend.fromData"].define("label",ks["chart-row-legend"]),i["xAxis.fromData"].define("label",ks["chart-col-"+(t?"yAxis":"xAxis")])),i["legend.fromData"].refresh(),i["xAxis.fromData"].refresh()}function v(e){e.setValue&&s(e),e.hide()}function p(e,t){n.queryView({batch:e},"all").forEach((function(e){t?e.show():v(e)}))}function b(e){return[{value:"H",name:"horizontal"},{value:"stacked"},{value:"3D"}].forEach((function(t){-1!=e.type.indexOf(t.value)&&(e[t.name||t.value]=1,e.type=e.type.replace(t.value,"").toLowerCase())})),e}e.attachEvent("onCommand",(function(r){if("add-chart"==r.id){var s=r.config,l=s&&s.config||{};t.show(),e.$handleSelection=function(e,n,r,o){var a=webix.UIManager.getFocus();if(t.queryView((function(e){return e==a})))if(a==i.range||a==i["legend.range"]){var s=a.getValue(),l=s.lastIndexOf(",");s=-1==l?"":s.substring(0,l+1),a.setValue(s+r+":"+o)}else a.config.range&&a.setValue(r+":"+o);return!1},n.clear(),e.$$("chartTabs").setValue("common"),(l=Es(l)).range=s?s.data:e.getSelectedRange(),t.viewId=r.viewid?r.viewid:e.views.add(null,null,"chart",l.range,l),e.callEvent("onUIEditStart",[t.viewId,"chart"]),d(l.legend.align),h(l.legend.valign);var u=b(l);n.setValues(u),f(u.type),!ys(u.type)&&l.legend.fromData&&o(l.legend.fromData),l.xAxis.fromData&&a(l.xAxis.fromData),g(),n.queryView("accordionitem","all").forEach((function(e){return e.expand()})),i.range.focus()}})),e.attachEvent("onUIEditStart",(function(n,i){t.isVisible()&&"chart"!=i&&Is(e)})),e.attachEvent("onCommand",(function(n){"close-ui-editor"==n.id&&t.isVisible()&&Is(e)})),e.attachEvent("onAction",(function(n,i){"add-view"!=n||i.newValue||t.isVisible()&&t.viewId==i.row&&Is(e)})),n.attachEvent("onChange",(function(u,v){var p=this.$eventSource;if(p===i.range||p===i["xAxis.range"]||p===i["legend.range"]){var b=u.split("!"),w=2==b.length?b[0]+"!"+b[1].toUpperCase():u.toUpperCase();u!=w&&(u=w,s(p,w))}switch(p){case i.type:f(u);break;case i.horizontal:m();break;case i.range:case i.dataSeries:this.$eventSource==i.dataSeries&&m(),i["legend.fromData"].getValue()&&r(),i["xAxis.fromData"].getValue()&&s(i["xAxis.range"],l()),g();break;case i["xAxis.fromData"]:a(u),g(v);break;case i["legend.fromData"]:o(u),g(ys(i.type.getValue())?v:0);break;case i["legend.align"]:d(u);break;case i["legend.valign"]:h(u);break;case i["xAxis.range"]:i["xAxis.fromData"].getValue()&&s(i["xAxis.fromData"]),c(u,v);break;case i["legend.range"]:i["legend.fromData"].getValue()&&s(i["legend.fromData"]),c(u,v)}var _=n.getValues();e.views.update(t.viewId,_.range,_)})),i.series.attachEvent("onRangeChange",c)}(e)}));var t=webix.skin.$active,n=t.dataPadding-2,i=t.layoutMargin.form;return{width:440,hidden:!0,id:"chartEditor",css:"ssheet_chart",rows:[{height:t.barHeight,css:"ssheet_chart_wizard_head",padding:{left:4},cols:[{view:"icon",inputHeight:t.inputHeight,hotkey:"esc",icon:"webix_ssheet_icon ssi-arrow-left",click:function(){return Is(e)}},{type:"header",borderless:!0,template:ks["chart-edit"]}]},{view:"form",complexData:!0,borderless:!0,padding:{top:0},elementsConfig:{labelWidth:184},elements:[{view:"tabview",id:"chartTabs",cells:[{id:"common",borderless:!0,type:"form",paddingX:0,header:ks["chart-common"],rows:[{view:"scrollview",body:{margin:i,rows:[Vs("type","chart-type",Ns()),{view:"checkbox",label:ks["stacked-chart"],name:"stacked",hidden:!0},{view:"checkbox",label:ks["horizontal-chart"],name:"horizontal",hidden:!0},{view:"checkbox",label:ks["chart-pie-3d"],name:"3D",batch:"pie"},{view:"text",label:ks["chart-range"],name:"range"},{view:"checkbox",label:ks["chart-col-xAxis"],name:"xAxis.fromData",batch:"axis"},{view:"checkbox",label:ks["chart-row-legend"],name:"legend.fromData"},{view:"radio",label:ks["chart-data-from"],name:"dataSeries",vertical:!0,options:[{id:"columns",value:ks["chart-columns"]},{id:"rows",value:ks["chart-rows"]}]},{}]}}]},{id:"advanced",borderless:!0,type:"form",paddingX:0,padding:{bottom:0},header:ks["chart-series"],rows:[{view:"ssheet-series",name:"series"}]},{id:"extras",borderless:!0,type:"form",paddingX:0,header:ks["chart-extras"],rows:[{view:"scrollview",body:{view:"accordion",margin:webix.skin.$active.layoutMargin.form,css:"webix_ssheet_accordion",multi:!0,type:"clean",rows:[{header:ks["chart-legend"],body:{margin:i,padding:n,rows:[{view:"text",label:ks["chart-legend-range"],name:"legend.range"},Vs("legend.align","chart-legend-align",[{id:"left",value:ks["chart-legend-left"]},{id:"center",value:ks["chart-legend-center"]},{id:"right",value:ks["chart-legend-right"]}]),Vs("legend.valign","chart-legend-valign",[{id:"top",value:ks["chart-legend-top"]},{id:"middle",value:ks["chart-legend-middle"]},{id:"bottom",value:ks["chart-legend-bottom"]}])]}},{header:ks["chart-scale"],batch:"axis",id:"scale",body:{margin:i,padding:n,rows:[{view:"checkbox",label:ks["chart-lines"],name:"scale.lines",batch:"axis"},{view:"checkbox",label:ks["chart-radar-circle"],name:"scale.circle",hidden:!0},{view:"ssheet-colorpicker",label:ks["chart-scale-color"],name:"scale.color",batch:"axis"}]}},{header:ks["chart-x-axis"],batch:"axis",body:{margin:i,padding:n,rows:[{view:"text",label:ks["chart-xAxis-range"],name:"xAxis.range",range:!0,batch:"axis"},{view:"text",label:ks["chart-xAxis-title"],name:"xAxis.title",batch:"axisTitle"}]}},{header:ks["chart-y-axis"],batch:"axis",body:{margin:i,padding:n,rows:[{view:"text",label:ks["chart-yAxis-title"],name:"yAxis.title",batch:"axisTitle"},{view:"text",label:ks["chart-yAxis-origin"],name:"origin",batch:"axis",attributes:{type:"number"}},{view:"label",label:ks["chart-yAxis-note"],css:"ssheet_note",height:20},{view:"text",label:ks["chart-yAxis-start"],name:"yAxis.start",batch:"axis",attributes:{type:"number"}},{view:"text",label:ks["chart-yAxis-end"],name:"yAxis.end",batch:"axis",attributes:{type:"number"}},{view:"text",label:ks["chart-yAxis-step"],name:"yAxis.step",batch:"axis",attributes:{type:"number"}}]}},{}]}}]}]}]}]}}function Is(e){var t=e.$$("chartEditor");e.callEvent("onUIEditStop",[t.viewId,"chart"]),t.viewId=null,e.$handleSelection=null,t.hide()}function Vs(e,t,n){return{view:"richselect",name:e,label:ks[t],suggest:{view:"ssheet-form-suggest",data:n}}}function Ns(e){var t=[{id:"line",value:ks["line-chart"]},{id:"spline",value:ks["spline-chart"]},{id:"splineArea",value:ks["splinearea-chart"]},{id:"area",value:ks["area-chart"]},{id:"bar",value:ks["bar-chart"]},{id:"radar",value:ks["radar-chart"]},{id:"pie",value:ks["pie-chart"]},{id:"donut",value:ks["donut-chart"]}];return e||t.push({id:"scatter",value:ks["scatter-chart"]}),t}var Ms=webix.i18n.spreadsheet.labels,Os=function(e){function t(){return sn(this,t),an(this,t,arguments)}return hn(t,e),ln(t,[{key:"$show",value:function(e,t){if(this.cell=this.view.getSelectedId(),!this.cell)return!1;var n=t.elements;this.view.$handleSelection=function(e,t,i,r){return n.range.setValue(i+":"+r),!1},n.range.setValue("");var i=function(e){if(e&&"string"==typeof e&&0===e.indexOf("=SPARKLINE(")){var t=e.substr(11,e.length-12).split(","),n={range:t[0],type:Za(t[1]),color:Za(t[2]),negativeColor:Za(t[3])};return"barH"==n.type&&(n.type="bar",n.horizontal=1),n}}(this.view.getCellValue(this.cell.row,this.cell.column));i&&(t.blockEvent(),n.type.setValue(i.type),n.range.setValue(i.range),i.color&&(n.color_def.setValue(i.color),n.color_pos.setValue(i.color)),i.negativeColor&&n.color_neg.setValue(i.negativeColor),i.horizontal&&n.horizontal.setValue(1),t.unblockEvent(),this.renderPreview()),n.range.focus()}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",head:Ms["sparkline-title"],move:!0,position:"center",body:{view:"form",visibleBatch:1,on:{onChange:function(){return e.renderPreview()}},elements:[{view:"richselect",name:"type",label:Ms["sparkline-type"],value:"line",labelPosition:"left",suggest:{view:"ssheet-form-suggest",data:Ns(!0)},on:{onChange:function(e){var t=this.getFormView();switch(e){case"pie":case"donut":t.showBatch(3);break;case"bar":t.showBatch(2);break;default:t.showBatch(1)}}}},{view:"text",label:Ms["sparkline-range"],name:"range"},{view:"ssheet-colorpicker",label:Ms["sparkline-color"],name:"color_def",id:"add_sparkline_color",value:"#6666FF",batch:"1"},{view:"ssheet-colorpicker",label:Ms["sparkline-positive"],name:"color_pos",value:"#6666FF",batch:"2"},{view:"ssheet-colorpicker",label:Ms["sparkline-negative"],name:"color_neg",value:"#FF6666",batch:"2"},{view:"checkbox",label:Ms["horizontal-chart"],name:"horizontal",batch:"2"},{view:"formlate",name:"preview",borderless:!0,css:"webix_ssheet_preview",height:50}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"checkRange",value:function(e){if(e&&qn(e,this.view))return!0;this.view.alert({text:Ms["error-range"]})}},{key:"okClick",value:function(){var e=this.$dialog.getBody().getValues();if(e.range=e.range.toUpperCase(),e.range&&this.checkRange(e.range)){var t=this.sparkConfig(e);this.view.addSparkline(this.cell.row,this.cell.column,t),this.close()}}},{key:"renderPreview",value:function(){var e=this.$dialog.getBody(),t=e.getValues();if(t.range=t.range.toUpperCase(),t.range&&this.checkRange(t.range)){for(var n=qn(t.range,this.view),i=this.view._mPage.getRange(n[0]-1,n[1]-1,n[2]-1,n[3]-1),r=this.sparkConfig(t,!0),o=0;o<i.length;o++)i[o]=i[o]||0;e.elements.preview.setValue(webix.Sparklines.getTemplate(r)(i,{width:200,height:40}))}else e.elements.preview.setValue("")}},{key:"sparkConfig",value:function(e,t){e=webix.copy(e);var n=this.$dialog.getBody();return"bar"===e.type?(e.color=e.color_pos,e.negativeColor=e.color_neg):n.elements.color_def.isVisible()?e.color=e.color_def:"donut"==e.type&&t&&webix.extend(e,{type:"pie",donut:1},!0),e}}])}(Qa),Ds=Object.freeze({__proto__:null,DialogBox:Os,action:"add-sparkline"}),qs=function(e){function t(){return sn(this,t),an(this,t,arguments)}return hn(t,e),ln(t,[{key:"$show",value:function(e){var t=this,n=e.$$("form");n.clear(),n.clearValidation(),n.elements.name.focus();var i=this.view.getSelectedRange();i&&(i=zn(this.view.getActiveSheet())+"!"+i),n.setValues({range:i,scope:"$global"}),this._updateData(),this.view._rangeDialog=!0,this.view.$handleSelection=function(e,i,r,o){return n.elements.range.setValue(function(e,t,n){return(n?zn(n)+"!":"")+e+":"+t}(r,o,t.view.getActiveSheet())),!1}}},{key:"$hide",value:function(){this.view.$handleSelection=null,this.view._rangeDialog=null}},{key:"saveClick",value:function(){var e=this.view,t=this.$dialog.$$("form"),n=t.getValues();if(n.range){var i=n.range.split("!");1==i.length&&i.unshift(zn(e.getActiveSheet())),n.range=i[0]+"!"+i[1].toUpperCase()}if(n.name=n.name.toUpperCase(),t.setValues(n),t.validate()){var r=this.$dialog.$$("table");if(n.id){var o=r.getItem(n.id);e.ranges.remove(o.name,this._getScope(o)),r.updateItem(n.id,n)}else r.add(n);e.ranges.add(n.name,n.range,this._getScope(n)),e.refresh(),r.unselect(),t.setValues({scope:"$global"})}}},{key:"_getScope",value:function(e){return"$global"==e.scope||e.scope}},{key:"removeRange",value:function(e){var t=this,n=this.view;n.confirm({text:webix.i18n.spreadsheet.labels["range-remove-confirm"]}).then((function(){var i=t.$dialog.$$("table"),r=i.getItem(e);n.ranges.remove(r.name,t._getScope(r)),n.refresh(),i.remove(e)}))}},{key:"editRange",value:function(e){var t=this.$dialog.$$("form"),n=this.$dialog.$$("table");t.clearValidation();var i=webix.copy(n.getItem(e));t.setValues(i)}},{key:"$init",value:function(){var e=this;this.view.attachEvent("onSheetRename",(function(t,n){return e._updateData(t,n)})),this.view.attachEvent("onSheetRemove",(function(t){return e._updateData(t)})),this.view.attachEvent("onSheetAdd",(function(){return e._updateData()}));var t=webix.i18n.spreadsheet.labels,n={padding:0,type:"clean",cols:[{view:"ssheet-dialog-table",id:"table",borderless:!0,columns:[{id:"name",header:t["range-name"],width:120},{id:"range",header:t["range-cells"],width:150},{id:"scope",header:t["range-scope"],width:95,template:function(e){return"$global"==e.scope?t["range-global"]:e.scope}},{template:"<span class='webix_icon ssheet_ranges_edit wxi-pencil'></span>",width:44},{template:"<span class='webix_icon ssheet_ranges_edit wxi-trash'></span>",width:44}],autowidth:!0,height:200,select:"row",on:{onBeforeSelect:function(t){return t==e.$dialog.$$("form").getValues().id}},onClick:{"wxi-trash":function(t,n){return e.removeRange(n)},"wxi-pencil":function(t,n){return e.editRange(n)}}},{width:270,view:"form",id:"form",rules:{name:function(t,n){return!e.$dialog.$$("table").find((function(e){return e.name==n.name&&e.scope==n.scope&&e.id!=n.id}),!0)&&!ur(n.name)},range:Ln,scope:webix.rules.isNotEmpty},elementsConfig:{labelWidth:95},elements:[{view:"text",name:"name",label:t["range-name"]},{view:"text",name:"range",id:"range",label:t["range-cells"],on:{onFocus:function(){return e.view.showCell(e.$dialog.$$("range").getValue(),!0)}}},{view:"richselect",name:"scope",id:"sheets",label:t["range-scope"],suggest:{view:"ssheet-form-suggest",body:{data:[]}}}]}]};return{view:"ssheet-dialog",move:!0,head:webix.i18n.spreadsheet.labels["range-title"],autoheight:!0,width:800,position:"center",body:n,on:{onSaveClick:function(){return e.saveClick()},onCancelClick:function(){return e.close()}}}}},{key:"_updateData",value:function(e,t){if(this.$dialog.isVisible()){var n=this.view._mData.getRanges(),i=webix.i18n.spreadsheet.labels,r=this.$dialog.$$("table"),o=this.$dialog.$$("form"),a=r.getItem(o.getValues().id);if(a){var s=a.name;a=(s=e==a.scope?t?t+"!"+s:null:a.scope+"!"+s)?n.get(s):null}r.clearAll();for(var l,u=n.serialize(),c=[],h=0;h<u.length;h++){var d=h+1,f=gn(u[h],2),g=f[0],m=f[1];a&&n.get(g)==a&&(l=d);var v=g.split("!");c.push({scope:1==v.length?"$global":v[0],name:v[1]||v[0],range:m,id:d})}r.parse(c),o.setValues({id:l},!0),l&&r.select(l);var p=this.$dialog.$$("sheets"),b=p.getList();b.clearAll();var w=[{id:"$global",value:i["range-global"]}];if(this.view._sheets.forEach((function(e){w.push({id:e.name,value:e.name})})),b.parse(w),e){var _=this.$dialog.$$("range"),x=_.getValue();t=t||this.view.getActiveSheet(),0==x.indexOf(zn(e)+"!")&&_.setValue(zn(t)+"!"+x.split("!")[1]),p.getValue()==e&&p.setValue(t)}}}}])}(Qa),zs=Object.freeze({__proto__:null,DialogBox:qs,action:"add-range"}),Ps=function(e){function t(){return sn(this,t),an(this,t,arguments)}return hn(t,e),ln(t,[{key:"$show",value:function(){var e=this.$dialog.$$("form");if(this.cell=this.view.getSelectedId(!0),!this.cell.length)return!1;e.clear();var t=this.view.getCellEditor(this.cell[0].row,this.cell[0].column);t&&e.setValues({range:t.options,empty:t.empty}),this.view.$handleSelection=function(t,n,i,r){return e.elements.range.setValue(i+":"+r),!1},e.elements.range.focus()}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",position:"center",head:webix.i18n.spreadsheet.labels["dropdown-title"],move:!0,body:{padding:0,view:"form",id:"form",elementsConfig:{labelWidth:130},rows:[{view:"text",label:webix.i18n.spreadsheet.labels["dropdown-range"],name:"range"},{view:"checkbox",label:webix.i18n.spreadsheet.labels["dropdown-empty-option"],name:"empty"}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"okClick",value:function(){var e=this.$dialog.$$("form").getValues();qn(e.range,this.view)?(wn.set((function(){for(var t=0;t<this.cell.length;t++)this.view.setCellEditor(this.cell[t].row,this.cell[t].column,{editor:"ss_richselect",options:e.range,empty:e.empty})}),this),this.close()):this.view.alert({text:webix.i18n.spreadsheet.labels["error-range"],type:"alert-error"})}}])}(Qa),Fs=Object.freeze({__proto__:null,DialogBox:Ps,action:"add-dropdown"}),Us=function(){return ln((function e(t){sn(this,e),this._master=t}),[{key:"clear",value:function(e){var t=this,n="string"==typeof e?e:this._master.getActiveSheet();this.serialize(n).forEach((function(n){(!0!==e||n[2])&&t.remove(n[0],e)}))}},{key:"_normalizeName",value:function(e,t){return!0!==t&&(e=(t||this._master.getActiveSheet())+"!"+e),e}},{key:"_normalizeRange",value:function(e,t){return 1==e.split("!").length&&(e=("string"==typeof t?t:this._master.getActiveSheet())+"!"+e),e}},{key:"add",value:function(e,t,n){var i=this._master;i.callEvent("onAfterRangeSet",[e,t,n]),e=this._normalizeName(e,n),i._mData.getRanges().add(e,this._normalizeRange(t,n)),i.callEvent("onMathRefresh",[])}},{key:"getCode",value:function(e,t){e=this._normalizeName(e,t);var n=this._master._mData.getRanges().get(e);if(n)return n.source}},{key:"remove",value:function(e,t){e=this._normalizeName(e,t),this._master._mData.getRanges().remove(e),this._master.callEvent("onMathRefresh",[])}},{key:"parse",value:function(e,t){if(e)for(var n=0;n<e.length;n++){var i=this._master._mData.getRanges(),r=gn(e[n],3),o=r[0],a=r[1],s=r[2];o=this._normalizeName(o,s||t),i.get(o)||i.add(o,this._normalizeRange(a,t))}}},{key:"serialize",value:function(e){e=e||this._master.getActiveSheet();for(var t=this._master._mData.getRanges().serialize(),n=[],i=0;i<t.length;i++){var r=t[i],o=r[0].split("!"),a=1==o.length;(a||o[0]==e)&&n.push([o[a?0:1],r[1],a])}return n}},{key:"getRanges",value:function(e){return this.serialize(e).map((function(e){return{name:e[0],range:e[1],global:e[2]}}))}}])}();function Ls(e,t,n,i,r,o){for(var a=[],s=e._mPage===this,l=t-1;l<=i-1;l++)for(var u=n-1;u<=r-1;u++){for(var c=void 0,h=0;h<o.length;h++){var d=o[h],f=l+1,g=u+1;if((f!=d[0]||g!=d[1])&&f>=d[0]&&f<d[0]+d[3]&&g>=d[1]&&g<d[1]+d[2]){c=!0;break}}if(!c){var m=this.getCell(l,u),v=void 0;v=m?webix.copy(m):{value:""},s?v.$value=Pa(e,{id:l+1},0,0,{id:u+1},!0):delete v.format,v.id=v.value,a.push(v)}}return a}function Bs(e,t,n){var i=[];if("string"==typeof t){var r=qn(t,e);if(r){var o=e._mPage;if(r[4]&&(o=e._mData.getPage(r[4])),o){var a=(o==e._mPage?so(e,{}):Gn(e._sheets,(function(e){return e.name==r[4]})).content).spans;i=Ls.apply(o,[e,r[0],r[1],r[2],r[3],a])}}}else if(webix.isArray(t))for(var s=0;s<t.length;s++){var l=t[s]||0===t[s]?t[s]:"";l="object"===pn(l)?webix.copy(l):{id:l,value:l},i.push(l)}for(var u={},c=i.length-1;c>=0;c--){var h="boolean"==typeof i[c].value;h&&(i[c].value*=1),(h||0===i[c].id)&&(i[c].id=String(i[c].value)),n&&n.unique&&(u[i[c].id]?i.splice(c,1):u[i[c].id]=!0)}if(n){for(var d=!1,f=i.length-1;f>=0;f--){var g=i[f].value;g||0===g?i[f].value=String(g):(i.splice(f,1),d=!0)}n.order&&i.sort((function(t,n){var i=e.$$("cells").data.sorting.as,r=t.value,o=n.value;return webix.rules.isNumber(r)&&webix.rules.isNumber(o)?i.int(r,o):i.string(r,o)})),d&&n.filter&&i.unshift({id:"$empty",value:"",$value:"<span class='webix_ssheet_empty'>"+webix.i18n.spreadsheet.labels["dropdown-empty"]+"</span>"}),n.empty&&i.unshift({id:"$empty",$empty:!0,value:""})}return i}var Hs=Object.freeze({__proto__:null,init:function(e){e.ranges=new Us(e),e.attachEvent("onDataSerialize",(function(t){t.ranges=e.ranges.serialize()}))},rangeOptions:Bs});function js(e){e._table._ssFilters={},Qs(e)}function Ws(e){var t=e._ssFilters,n=[];for(var i in t)for(var r in t[i])n.push(t[i][r]);return n}function Xs(e,t,n){var i=!1;Un(t,e,(function(e,t){e.getCellFilter(t.row,t.column,n)&&(n&&n!=e.getActiveSheet()||(i=!0),e.setCellFilter(t.row,t.column,null,n))})),i&&e.filterSpreadSheet()}function Ys(e,t,n,i,r,o){(i||(i={end:{row:t}}),i.end)&&(i=function(e,t,n,i,r,o){var a=Zs(e,t,n,o);if(t===i||a&&t==i-a[3]+1)for(i=t;i<e.config.rowCount;i++){var s=i+1,l=Zs(e,s,n,o);if(!l||l[0]==s){var u=e.getCellValue(s,n,!1,o?o.name:null);if(!u&&0!==u)break}}return r?i:Pn(t+1,n,i,n)}(e,t,n,i.end.row,r,o));return i}function Gs(e){return!!(e.includes||e.condition&&e.condition.filter)}function Ks(e){var t=e._table._ssFilters;for(var n in t)for(var i in t[n])if(t[n][i])return!0;return!1}function Qs(e){var t=Ks(e);e.callEvent("onCommand",[{id:"toolbar-update",name:"create-filter",value:t}])}function Zs(e,t,n,i){return i?i.content.spans?Gn(i.content.spans,(function(e,i,r,o){return t>=e&&t<e+o&&n>=i&&n<i+r})):void 0:e._table.getSpan(t,n)}function Js(e,t,n){for(var i=t+1;i<e.config.rowCount;i++){var r=e.getCellValue(i,n);if(r||0===r){var o=_r(e,i,n);return"number"==o||"date"==o?o:"text"}if(""!==r)break}return"text"}function el(e,t,n,i,r,o){var a=t.filter;a.options=jn(a.options,"row",o.row,{column:t.col,row:t.row}),a.options=jn(a.options,"column",o.column,{column:t.col,row:t.row}),a.lastRow&&(a.lastRow+=o.row),delete a.value,delete a.handler,e.setCellFilter(n,i,a)}function tl(e,t){for(var n=ua[e],i=0;i<n.length;i++)if(n[i].id==t)return n[i]}function nl(e){return webix.copy(ua[e])}function il(e,t){var n=t.includes,i=t.condition,r=tl(e,i.type),o=r?r.handler:function(){return!0};if(n)for(var a=0;a<n.length;a++)n[a]=String(n[a]);return function(e){return n?-1!==n.indexOf(e):""===i.filter||o(e,i.filter)}}var rl=Object.freeze({__proto__:null,calibrateRange:Ys,clearFilters:Xs,getConditions:nl,getFilterFunction:il,getFilterMode:Js,getFilters:Ws,getSingleOption:tl,init:function(e){var t=e._table;e.attachEvent("onReset",(function(){return js(e)})),js(e),t.on_click.ssheet_filter_sign=function(n,i){var r=t._ssFilters[i.row][i.column],o=r.mode||Js(e,i.row,i.column),a=[];r.options&&("string"==typeof r.options?a=Bs(e,r.options,{unique:!0,order:!0,filter:!0}):webix.isArray(r.options)&&(a=Bs(e,r.options,{filter:!0}))),e.callEvent("onCommand",[{id:"start-filter",cell:i,mode:o,options:a,filter:r}])},t.on_dblclick.ssheet_filter_sign=function(){return!1},e.attachEvent("onCommand",(function(t){"create-filter"===t.id&&function(e){var t=e._table.getSelectArea();Ks(e)?(wn.set((function(){return e.removeFilters()})),t&&e._table.addSelectArea(t.start,t.end)):t&&wn.set((function(){for(var n=t.start.row,i=t.start.column;i<=t.end.column;i++)e.setCellFilter(n,i,{options:t,lastRow:Ys(e,n,i,t,!0)})}));Qs(e)}(e)}));var n=!1;e.attachEvent("onUndo",(function(i,r,o,a){if("filter"==i)a="object"==pn(a)?a:null,e.setCellFilter(r,o,a),n=!0;else if("apply-filter"==i){var s=e.getCellFilter(r,o);if(s.value=a,delete s.handler,a&&a.condition){var l=s.mode||Js(e,r,o);s.handler=il(l,s.value)}n=!0;var u=a&&Gs(a);t[u?"addCellCss":"removeCellCss"](r,o,"ss_filter_active"),ho(e,r,o,"ss_filter_active",u)}})),e.attachEvent("onAfterUndo",(function(){n&&(e.filterSpreadSheet(),n=!1)})),e.attachEvent("onAction",(function(t,n){"filter"==t?n.page==e.getActiveSheet()&&(ho(e,n.row,n.column,"ss_filter",n.newValue),ho(e,n.row,n.column,"ss_filter_active",n.newValue&&n.newValue.value&&Gs(n.newValue.value)),Qs(e)):"before-grid-change"==t&&function(e,t,n,i,r){var o=i.filters;if(n)for(var a=o.length-1;a>=0;a--){var s=gn(o[a],3),l=s[0],u=s[1],c=s[2];if("row"==t&&l>=r.row||"column"==t&&u>=r.column){if("row"==t){if(l<r.row-n){o.splice(a,1);continue}o[a][0]=1*l+n,c.lastRow&&(c.lastRow+=n)}else if("column"==t){if(u<r.column-n){o.splice(a,1);continue}o[a][1]=1*u+n}c.options=jn(c.options,t,n,r)}}}(0,n.name,n.inc,n.data,n.start)}))},isFilter:function(e,t,n){var i=e._table._ssFilters;return i[t]&&!!i[t][n]},isValueActive:Gs,load:function(e,t){var n=t.filters;if(n){for(var i=0;i<n.length;i++)e.setCellFilter(n[i][0],n[i][1],n[i][2]||{options:""});e.filterSpreadSheet()}},pasteFilter:el,serialize:function(e,t){for(var n=Ws(e._table),i=t.filters=[],r=0;r<n.length;r++){var o=n[r],a=o.row,s=o.column,l=o.options,u=o.mode,c=o.value,h=o.lastRow;c=c&&webix.copy(c),i.push([a,s,{value:c,options:l,mode:u,lastRow:h}])}}}),ol=function(e){function t(){return sn(this,t),an(this,t,arguments)}return hn(t,e),ln(t,[{key:"open",value:function(e){var t=this;if(this.cell=e.cell,this.$mode=e.mode,this.$filter=e.filter,!this.cell||this.view.isCellLocked(this.cell.row,this.cell.column))return!1;if(!this.$dialog){this.$dialog=webix.ui(this.$init()),this.view._destroy_with_me.push(this.$dialog),this.$dialog.attachEvent("onHide",(function(){return t.$hide()}));var n=this.view.$$("cells");n.attachEvent("onScrollY",(function(){return t.syncScroll()})),n.attachEvent("onScrollX",(function(){return t.syncScroll()}))}if(!1===this.$show(this.$filter.value,e.options))return this.close();this.$dialog.show(this._getTargetNode())}},{key:"_getTargetNode",value:function(){var e=this.view.$$("cells");return e.getSpan(this.cell.row,this.cell.column)?e.getSpanNode(this.cell):e.getItemNode(this.cell)}},{key:"$show",value:function(e,t){var n=this.getList(),i=this.getFilter();i.config.mode!==this.$mode&&(i.define("conditions",this.getConditions(this.$mode)),i.define("mode",this.$mode));var r=e&&e.conditions&&e.conditions.type;r&&!tl(this.$mode,r)&&(e=""),n.clearAll(),n.data.importData(t),i.config.value="",i.setValue(webix.copy(e||{}))}},{key:"$init",value:function(){var e=this,t=webix.i18n.spreadsheet.labels;return{view:"popup",css:"ssheet_filter",padding:7,relative:"right",body:{margin:4,rows:[{view:"filter",field:"value",mode:"text",conditions:this.getConditions("text"),inputs:["text",{view:"ssheet-datepicker",timepicker:!0,batch:"datepicker",on:{onChange:function(){return e.getFilter().applyFilter()}}},{view:"ssheet-daterangepicker",timepicker:!0,batch:"daterangepicker",on:{onChange:function(){return e.getFilter().applyFilter()}}}],template:function(e){return e.$value||e.value}},{cols:[{},{view:"button",label:t.cancel,autowidth:!0,css:"webix_transparent",on:{onItemClick:function(){return e.close()}}},{view:"button",label:t.apply,autowidth:!0,css:"webix_secondary",on:{onItemClick:function(){return e.applyFilter()}}}]}]}}}},{key:"applyFilter",value:function(){var e=this.getFilter(),t=this.$filter.value,n=this.$filter.value=e.getValue();this.$filter.handler=il(this.$mode,n),this.view.filterSpreadSheet(),this.view.callEvent("onAction",["apply-filter",{row:this.cell.row,column:this.cell.column,value:t,newValue:n}]),this.setCellStyle(this.cell.row,this.cell.column,"ss_filter_active",Gs(n)),this.close()}},{key:"setCellStyle",value:function(e,t,n,i){var r=this.view.$$("cells"),o=this.getSpan(r,e,t);o&&(i?-1==o[3].indexOf(n)&&(o[3]+=" "+n):o[3]=o[3].replace(" "+n,"")),r[i?"addCellCss":"removeCellCss"](e,t,n)}},{key:"getSpan",value:function(e,t,n){var i=e.getSpan()[t];if(i)return i[n]}},{key:"getList",value:function(){return this.getFilter().getChildViews()[2]}},{key:"getFilter",value:function(){return this.$dialog.getBody().getChildViews()[0]}},{key:"syncScroll",value:function(){if(this.$dialog.isVisible()){var e=this._getTargetNode(),t=this.view.$$("cells"),n=!1;if(e){var i=webix.html.offset(e),r=webix.html.offset(t.$view.getElementsByClassName("webix_ss_body")[0]),o=i.y-r.y,a=i.x-r.x+i.width;n=o<0||o+i.height>r.height||a<0||a-i.width>r.width-webix.env.scrollSize}!e||n?this.$dialog.show({x:-9999,y:-9999}):this.$dialog.show(e)}}},{key:"getConditions",value:function(e){for(var t=webix.i18n.filter,n=nl(e),i=0;i<n.length;i++)n[i].id&&(n[i].value=t[n[i].id]);return n}}])}(Qa),al=Object.freeze({__proto__:null,DialogBox:ol,action:"start-filter"}),sl=function(e){function t(){return sn(this,t),an(this,t,arguments)}return hn(t,e),ln(t,[{key:"$show",value:function(){if(this.form=this.$dialog.$$("form"),this.list=this.$dialog.$$("list"),this.preview=this.$dialog.$$("preview"),this.cell=this.view.getSelectedId(!0),!this.cell.length)return!1;this.fillForm(this.view),this.view.$handleSelection=function(){return!1}}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"$init",value:function(){var e=this,t=webix.i18n.spreadsheet,n=t.labels,i=t.formats,r=Vi("int"),o=[{name:"zeros",view:"counter",css:"webix_ssheet_counter",label:n["decimal-places"],value:0,batch:"common"},{name:"separator",view:"checkbox",label:n.separator,batch:"common"},{view:"richselect",name:"symbol",label:n["currency-symbol"],options:ki,batch:"common"},{view:"formlist",label:n.negative,height:160,name:"negative",batch:"common",css:"webix_ssheet_format_negative",template:function(t){if(e.list){var n=e.getFormat(t.id),i={css:""},r=(n=Pi(n.fmt,n.delimiters))(-1234.56789,i);return"<span class='"+i.css+"'>"+r+"</span>"}},data:[{id:1},{id:2},{id:3},{id:4}]}],a=[{view:"text",label:n["format-pattern"],name:"format",labelPosition:"top",batch:"custom",placeholder:"[>100]0"+r.groupSign+"000"+r.decimalSign+"00;[>0]None"},{id:"docs",template:"<a href='https://webix-guides.gitbook.io/spreadsheet-user-guide/formatting_numbers#custom-number-format' target='_blank' class = 'docs'>"+n["format-docs"]+"</a>",borderless:!0,batch:"custom"}],s=[{name:"date",batch:"date",view:"formlist",labelWidth:90,height:160,label:n["date-format"],css:"webix_ssheet_format_date",template:function(e){return Pi(e.value,r)(45e3)},data:[i.dateFormat,i.timeFormat,i.fullDateFormat,i.longDateFormat]}];return{view:"ssheet-dialog",position:"center",width:460,head:n["format-title"],move:!0,body:{padding:0,cols:[{view:"list",id:"list",css:"webix_ssheet_format_type",width:120,scroll:!1,data:this.getFormats(),select:!0,on:{onSelectChange:function(t){switch(e.updateForm(),t[0]){case"custom":case"date":e.form.showBatch(t[0]);break;default:var n=e.form.elements;e.form.showBatch("common"),n.separator["percent"==t[0]?"hide":"show"](),n.symbol["price"==t[0]?"show":"hide"]()}}}},{view:"form",id:"form",height:340,paddingY:0,paddingX:20,elements:[{id:"preview",template:function(e){return e.value==t.table["format-error"]?e.value:"<span class ='"+e.css+"'>"+e.value+"</span>"},css:"webix_ssheet_format_preview",autoheight:!0,borderless:!0}].concat(o,a,s),elementsConfig:{labelWidth:140},on:{onChange:function(){return e.updateForm()}}}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.closeWin()}}}}},{key:"okClick",value:function(){var e=this,t=this.list.getSelectedId(),n="custom"==t?{format:this.form.getValues().format}:this.form.getValues();n.type=t,wn.set((function(){for(var t=0;t<e.cell.length;t++)Di(e.view,e.cell[t].row,e.cell[t].column,n.format,n)})),this.view.$$("cells").refresh(),this.closeWin()}},{key:"closeWin",value:function(){var e=si(this.view,this.cell[0].row,this.cell[0].column)||"common";Yi(e)||this.view.callEvent("onCommand",[{id:"toolbar-update",name:"format",value:e}]),this.close()}},{key:"getFormat",value:function(e){var t=this.list.getSelectedId(),n=this.form.getValues();return n.negative=e||n.negative,"custom"!=t?("date"!=t&&(n.date=""),{fmt:Ki(n=Gi(t,n)),delimiters:Vi(t)}):{fmt:n.format,delimiters:Vi(t)}}},{key:"fillForm",value:function(e){var t,n=webix.i18n.spreadsheet,i=si(e,this.cell[0].row,this.cell[0].column),r={zeros:0,separator:0,negative:1,date:n.formats.dateFormat,symbol:ki[0].value,format:""},o=i||"";r.format=Mi(o||"price"),"custom"!=(t=o?"string"==o?o="custom":Ai[o].values.type:o="price")&&webix.extend(r,Ai[o].values,!0);var a=this.view.$$("cells").getItem(this.cell[0].row),s=this.cell[0].column;this.value=webix.isUndefined(a[s])?"":a[s],this.form.setValues(r),this.list.select(t),this.updateForm()}},{key:"updateForm",value:function(){var e=this.form.elements,t=this.getFormat(),n=this.value,i=""===n||isNaN(n);nr(t,"date")&&(i||rr(n))?n=45e3:i&&!nr(t,"string")&&(n=1234.56789);var r={css:""};n=Pi(t.fmt,t.delimiters)(n,r),this.preview.parse({value:n,css:r.css}),e.negative.refresh(),e.date.refresh(),e.format.setValue(t.fmt)}},{key:"getFormats",value:function(){var e=webix.i18n.spreadsheet.labels;return[{id:"price",value:e.currency},{id:"int",value:e.number},{id:"percent",value:e.percent},{id:"date",value:e.date},{id:"custom",value:e["custom-format"]}]}}])}(Qa),ll=Object.freeze({__proto__:null,DialogBox:sl,action:"custom"});var ul=function(e){function t(){return sn(this,t),an(this,t,arguments)}return hn(t,e),ln(t,[{key:"_rulesToArr",value:function(){var e=this.view.conditions.handlers;return[{value:webix.i18n.spreadsheet.labels["conditional-common"],disabled:!0,$css:"webix_ssheet_cformats_type"}].concat(mn(e.date),[{value:webix.i18n.spreadsheet.labels["conditional-text"],disabled:!0,$css:"webix_ssheet_cformats_type"}],mn(e.text)).map((function(e){return e.value||(e.value=webix.i18n.filter[e.id]),e}))}},{key:"_getCondition",value:function(){var e=this,t=this.view,n=this._getDatalayout().getValue(),i=[];n.forEach((function(t){var n=[t.condition];"between"!=t.condition&&"notBetween"!=t.condition?n.push(e._normalizeValue(t.value,t.condition)):n.push([e._normalizeValue(t.value,t.condition),e._normalizeValue(t.value2,t.condition)]),n.push(t.style);for(var r=0;r<n.length;r++)if(""===n[r]||webix.isArray(n[r])&&-1!=n[r].indexOf(""))return!1;i.push(n)})),t.callEvent("onConditionSet",[i])}},{key:"_safeInt",value:function(e){var t=parseFloat(e);return t==e?t:e}},{key:"_setCondition",value:function(){var e=this,t=this.view.conditions.get(this.cell.row,this.cell.column),n=[];for(t&&t.forEach((function(t){var i={};i.condition=t[0],webix.isArray(t[1])?(i.value=e._formatValue(t[1][0],i.condition),i.value2=e._formatValue(t[1][1],i.condition)):i.value=e._formatValue(t[1],i.condition),i.style=t[2],n.push(i)}));n.length<3;)n.push({});this._getDatalayout().setValue(n)}},{key:"_getDatalayout",value:function(){return this.$dialog.getBody().getChildViews()[0].getChildViews()[1].getBody()}},{key:"_formatValue",value:function(e,t){return t&&this._isNotDateRule(t)||!this.editFormat||""===e||"="==e[0]?e.toString():(e=Cn(e),this.editFormat(e))}},{key:"_normalizeValue",value:function(e,t){this._isNotDateRule(t)||(this.editFormat?isNaN(e)?"="!=e[0]&&(e=webix.Date.strToDate(webix.i18n.spreadsheet.formats.parseDateTime)(e),e=isNaN(e)?"":Sn(e)):e=rr(e)?"":e:e=this._safeInt(e,10));return e}},{key:"_isNotDateRule",value:function(e){return"equal"!=e&&"notEqual"!=e&&Gn(this.view.conditions.handlers.text,(function(t){return t.id==e}))}},{key:"okClick",value:function(){this._getCondition(),this.close()}},{key:"$show",value:function(){var e=this;if(this.cell=this.view.getSelectedId(),!this.cell)return!1;var t=_r(this.view,this.cell.row,this.cell.column);"date"==t&&(this.editFormat=or(this.view,this.cell.row,this.cell.column)),this.$dialog.queryView("text","all").forEach((function(n){n.define({placeholder:"date"==t?e._formatValue(45e3):""}),n.refresh()})),this.view.$handleSelection=function(t,n,i,r){return e.activeValue&&i==r&&e.activeValue.setValue("="+i),!1},this._setCondition()}},{key:"$hide",value:function(){this.view.$handleSelection=null,delete this.editFormat,this._getDatalayout().clearAll()}},{key:"getRows",value:function(e){var t=this,n=this;return{view:"form",padding:0,borderless:!0,css:"webix_ssheet_cformats",elements:[{margin:10,padding:{right:4},cols:[{view:"richselect",name:"style",width:120,placeholder:webix.i18n.spreadsheet.labels["conditional-style"],css:"webix_ssheet_cformat_select",suggest:{padding:0,borderless:!0,css:"webix_ssheet_cformat_list",body:{template:function(e){var t="webix_ssheet_cformat "+e.css;return'<div class="'.concat(t,'">').concat(e.name,"</div>")},data:e}}},{view:"richselect",width:150,name:"condition",placeholder:webix.i18n.spreadsheet.labels["conditional-operator"],on:{onChange:function(e){var t=this.getFormView().elements;if(n.editFormat){if(n._isNotDateRule(e))t.value.define({placeholder:""});else{var i=n._normalizeValue(t.value.getValue(),e);t.value.setValue(n._formatValue(i,e)),t.value.define({placeholder:n._formatValue(45e3)})}t.value.refresh()}"between"==e||"notBetween"==e?t.value2.show():t.value2.hide()}},suggest:{view:"ssheet-form-suggest",body:{data:this._rulesToArr()}}},{cols:[{view:"text",on:{onFocus:function(e){t.activeValue=e},onBlur:function(e){var n=e.getValue();if(""!==n){var i=e.getFormView().elements.condition.getValue();n=t._normalizeValue(n,i),e.setValue(t._formatValue(n,i))}}},name:"value"},{view:"text",name:"value2",on:{onFocus:function(e){t.activeValue=e},onBlur:function(e){var n=e.getValue();if(""!==n){var i=e.getFormView().elements.condition.getValue();n=t._normalizeValue(n,i),e.setValue(t._formatValue(n,i))}}},hidden:!0}]},{view:"icon",css:"webix_ssheet_cformat_icon",icon:"wxi-trash",click:function(e){var n=webix.$$(e).getFormView(),i=t._getDatalayout();i.getValue();var r=i.getChildViews().indexOf(n);i.remove(i.getIdByIndex(r)),i.count()<3&&i.add({})}}]}]}}},{key:"$init",value:function(){var e,t=this,n=webix.skin.$active.layoutMargin.form;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["conditional-format"],position:"center",width:770,move:!0,margin:n,body:{margin:0,rows:[{height:36,padding:{left:12},cols:[{view:"label",width:131,label:webix.i18n.spreadsheet.labels.display},{view:"label",width:161,label:webix.i18n.spreadsheet.labels.condition},{view:"label",label:webix.i18n.spreadsheet.labels.value},{view:"icon",css:"webix_ssheet_cformat_icon",icon:"wxi-plus-circle",click:function(){var e=t._getDatalayout();e.getValue(),e.add({})}},{width:4+webix.env.scrollSize}]},{view:"scrollview",maxHeight:3*webix.skin.$active.inputHeight+4,borderless:!0,scroll:"y",body:{view:"datalayout",padding:0,borderless:!0,rows:[this.getRows((e=this.view.config.conditionStyle,e.map((function(e){return e.id=e.css,e}))))]}}]},on:{onSaveClick:function(){return t.okClick()},onCancelClick:function(){return t.close()}}}}}])}(Qa),cl=Object.freeze({__proto__:null,DialogBox:ul,action:"conditional-format"}),hl=function(e){function t(){return sn(this,t),an(this,t,arguments)}return hn(t,e),ln(t,[{key:"$show",value:function(e,t){this.view.$handleSelection=function(){return!1},t.elements.sheets.setValue(this.getSheets()),t.elements.filename.setValue("Data"),t.elements.filename.getInputNode().select()}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["export-title"],move:!0,position:"center",body:{view:"form",elements:[{view:"text",name:"filename",placeholder:webix.i18n.spreadsheet.labels["export-name"]},{view:"multicheckbox",name:"sheets",css:"webix_ssheet_multicheckbox"}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"getSheets",value:function(){for(var e=this.view,t=e._sheets,n=[],i=0;i<t.length;i++){var r=t[i].state;"veryHidden"!=r&&n.push({name:t[i].name,hidden:"hidden"==r,active:e._activeSheet===t[i].name?1:0})}return n}},{key:"okClick",value:function(){var e=this.$dialog.getBody().getValues();webix.toExcel(this.view,e),this.close()}}])}(Qa),dl=Object.freeze({__proto__:null,DialogBox:hl,action:"excel-export"}),fl=function(e){function t(){return sn(this,t),an(this,t,arguments)}return hn(t,e),ln(t,[{key:"$show",value:function(e,t){if(!this.view.getSelectedId())return!1;this.restoreValue(t)||t.clear(),t.elements.name.focus(),this.view.$handleSelection=function(e,n,i){return t.elements.url.setValue("#"+i),!1}}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"restoreValue",value:function(e){var t=this.view.getSelectedId();if(t){var n=this.view.getCellValue(t.row,t.column);if(n&&"string"==typeof n&&0===n.indexOf("=HYPERLINK")){var i=n.split('"');return e.setValues({name:i[3]||"",url:i[1]||""}),!0}}return!1}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["link-title"],move:!0,position:"center",body:{view:"form",elements:[{view:"text",name:"name",placeholder:webix.i18n.spreadsheet.labels["link-name"]},{view:"text",name:"url",placeholder:webix.i18n.spreadsheet.labels["link-url"]}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"okClick",value:function(){var e=this.view.getSelectedId(),t=this.$dialog.getBody().getValues(),n="";t.url&&(t.name=t.name||t.url,/^(#|(https?:\/\/))/i.test(t.url)||(t.url="http://"+t.url),n='=HYPERLINK("'.concat(t.url,'","').concat(t.name,'")')),this.view.setCellValue(e.row,e.column,n),this.view.refresh(),this.close()}}])}(Qa),gl=Object.freeze({__proto__:null,DialogBox:fl,action:"add-link"}),ml=function(e){function t(){return sn(this,t),an(this,t,arguments)}return hn(t,e),ln(t,[{key:"$show",value:function(e,t){var n=t.elements.sheets.getList();n.clearAll(),n.parse(this.getSheets(this.view)),t.setValues({data:"full",sheets:this.view.getActiveSheet()},!0)}},{key:"$init",value:function(){var e,t=this,n=webix.i18n.spreadsheet.labels,i=webix.env.printSizes.map((function(t){return"a4"==t.id&&(e="a4"),t.value=n["page-"+t.id]||t.id,t}));return e||(e=i[0].id),{view:"ssheet-dialog",head:n["print-title"],move:!0,modal:!0,width:580,position:"center",buttons:!1,on:{onHide:function(){webix.extend(t.view._printBorders,t.getValues(),!0),_o(t.view,!0)}},body:{view:"form",elementsConfig:{labelWidth:0},elements:[{type:"section",template:n["print-settings"]},{cols:[{view:"radio",name:"data",vertical:!0,options:[{id:"full",value:n.sheets},{id:"selection",value:n.selection}],on:{onChange:function(e){var t=this.getFormView().elements,n=t.sheets;"full"==e?(t.sheetnames.setValue(1),n.enable()):n.disable()}}},{padding:{right:30},rows:[{name:"sheets",view:"multiselect",width:160,stringResult:!1,suggest:{selectAll:!0,body:{data:[]}}},{}]},{rows:[{view:"checkbox",name:"sheetnames",value:1,labelRight:n["sheet-names"]},{view:"checkbox",name:"borderless",labelRight:n.borderless},{view:"checkbox",name:"skiprows",labelRight:n["skip-rows"]},{view:"checkbox",name:"margin",labelRight:n.margin},{view:"checkbox",name:"external",labelRight:n["external-ui"]}]}]},{type:"section",template:n["print-paper"]},{view:"radio",name:"paper",value:e,options:i},{type:"section",template:n["print-layout"]},{rows:[{view:"radio",name:"fit",value:"page",options:[{id:"page",value:n["page-width"]},{id:"data",value:n["page-actual"]}]},{view:"radio",name:"mode",value:"landscape",options:[{id:"portrait",value:n["page-portrait"]},{id:"landscape",value:n["page-landscape"]}]}]},{cols:[{},{view:"button",css:"ssheet_cancel_button",hotkey:"esc",value:n.cancel,autowidth:!0,click:function(){return t.close()}},{view:"button",value:n["print-borders"],autowidth:!0,click:function(){return t.printPreview()}},{view:"button",value:n.print,hotkey:"enter",autowidth:!0,click:function(){return t.okClick()}}]}]}}}},{key:"getValues",value:function(){var e=this.$dialog.getBody().getValues({disabled:!1});return e.margin=e.margin?0:{},e}},{key:"printPreview",value:function(){this.close(),this.view.showPrintBorders(!0)}},{key:"getSheets",value:function(e){return e._sheets.map((function(e){return{value:e.name,id:e.name}})).filter((function(t){return Gr(e,t.id)}))}},{key:"okClick",value:function(){var e=this.$dialog.getBody().getValues({disabled:!1});e.margin=e.margin?0:{},this.close(),webix.print(this.view,e)}}])}(Qa),vl=Object.freeze({__proto__:null,DialogBox:ml,action:"print"}),pl=function(e){function t(){return sn(this,t),an(this,t,arguments)}return hn(t,e),ln(t,[{key:"open",value:function(e){var t=this;if(this.cell=e.cell?e.cell:this.view.getSelectedId(),!this.cell||this.view.isCellLocked(this.cell.row,this.cell.column)&&!e.viewonly||!this.view.callEvent("onBeforeCommentShow",[this.cell.row,this.cell.column,!e.viewonly]))return!1;this.view.comments._activeComment={editStatus:!e.viewonly,cell:this.cell},this.$dialog||(this.$dialog=webix.ui(this.$init()),this.view._destroy_with_me.push(this.$dialog),this.view.comments.commentsView=this.$dialog,this.$dialog.attachEvent("onHide",(function(){return t.$hide()})),this.view.attachEvent("onCommentHide",(function(){return t.$dialog.hide()})));var n=this.$dialog.getBody(),i=this.view.$$("cells").getSpan(this.cell.row,this.cell.column),r=i?{row:this.cell.row,column:1*i[1]+i[2]-1}:this.cell;webix.delay((function(){t.$dialog.show(t.view.$$("cells").getItemNode(r)),t._setComment()})),!1===this.$show(this.$dialog,n)&&this.close()}},{key:"$show",value:function(){this.textarea=this.$dialog.queryView({view:"textarea"}),this.template=this.$dialog.queryView({view:"template"})}},{key:"$init",value:function(){var e=this;return{view:"popup",css:"ssheet_comments",minWidth:250,minHeight:150,relative:"right",resize:!0,on:{onViewResize:function(){e.$dialog.hide(),e.$dialog.show(),e.textarea.isVisible()&&e.textarea.focus()}},body:{animate:!1,cells:[{view:"template",css:"ssheet_comment_view",borderless:!0,scroll:"auto",onClick:{ssheet_comment_view:function(){e.view.config.readonly||e.view.isCellLocked(e.cell.row,e.cell.column)||e.showInput(e.view.comments.get(e.cell.row,e.cell.column))}}},{view:"textarea",on:{onChange:function(){e.addComment()},onFocus:function(){e.view.comments._activeComment={editStatus:!0,cell:e.cell}},onBlur:function(){e.view.comments._activeComment={},e.$dialog.hide()}}}]}}}},{key:"_setComment",value:function(){var e=this.view.comments.get(this.cell.row,this.cell.column);this.view.comments._activeComment.editStatus?this.showInput(e):this.showTemplate(e)}},{key:"showTemplate",value:function(e){this.template.show(),this.template.setHTML(e)}},{key:"showInput",value:function(e){var t=this;this.view._commentSel=!0,this.view.$$("cells").select(this.cell.row,this.cell.column),delete this.view._commentSel,webix.delay((function(){t.changeTextarea(e),t.textarea.show(),t.textarea.focus()}))}},{key:"addComment",value:function(){this.view.comments.add(this.cell.row,this.cell.column,this.textarea.getValue())}},{key:"changeTextarea",value:function(e){this.textarea.blockEvent(),this.textarea.setValue(e||""),this.textarea.unblockEvent()}}])}(Qa),bl=Object.freeze({__proto__:null,DialogBox:pl,action:"add-comment"}),wl=function(e){function t(){return sn(this,t),an(this,t,arguments)}return hn(t,e),ln(t,[{key:"open",value:function(e){this.group=e.group,this.header=e.value,Qa.prototype.open.apply(this,arguments)}},{key:"$show",value:function(){var e=this.view.getSelectedId();if(!e)return!1;this.view.$handleSelection=function(){return!1};var t=this.$dialog.getBody().elements;this.type=t.type,this.size=t.size,this.$dialog.getHead().getChildViews()[0].setHTML(this.header);var n,i=this.view.$$("cells");n="row"==this.group?i.getItem(e.row).$height||i.config.rowHeight:i.getColumnConfig(e.column).width||i.config.columnWidth,n/=this.view._zoom,this.type.getOption(1).value=webix.i18n.spreadsheet.labels["row"==this.group?"height":"width"],this.type.setValue(1),this.type.refresh(),this.size.setValue(Math.ceil(n)),this.size.focus()}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"okClick",value:function(){var e=this.type.getValue(),t="auto";1==e?t=1*this.size.getValue():3==e&&(t=this.view.$$("cells").config["row"==this.group?"rowHeight":"columnWidth"]),"row"==this.group?this.view.setRowHeight(null,t):this.view.setColumnWidth(null,t),this.close()}},{key:"$init",value:function(){var e=this,t=webix.i18n.spreadsheet.labels;return{view:"ssheet-dialog",position:"center",width:300,move:!0,body:{padding:0,cols:[{view:"radio",name:"type",vertical:!0,optionHeight:40,on:{onChange:function(t){1==t?e.size.enable():e.size.disable()}},options:[{id:1,value:""},{id:2,value:t["fit-content"]},{id:3,value:t["default-size"]}]},{rows:[{view:"text",name:"size",width:120}]}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}}])}(Qa),_l=Object.freeze({__proto__:null,DialogBox:wl,action:"resize"}),xl=function(e){function t(){return sn(this,t),an(this,t,arguments)}return hn(t,e),ln(t,[{key:"$show",value:function(e,t){var n=this,i=this.cell=this.view.getSelectedId();if(!i)return!1;this.restoreValue(t,i),this.view.$handleSelection=function(e,t,i,r){var o=n.$dialog.getBody().elements.type.getValue();return n.activeValue&&n.activeValue.isVisible()&&n.activeValue.setValue("="+("range"!=o?i:i+":"+r)),!1}}},{key:"$hide",value:function(){this.view.$handleSelection=null,this.$dialog.getBody().clear()}},{key:"restoreValue",value:function(e,t){var n=this.view.validation.get(t.row,t.column);n||(n={}),webix.extend(n,{type:"any",errorHandle:"information"}),e.setValues(n),this.formatInput(e.elements.value),this.formatInput(e.elements.value2)}},{key:"prepareConditions",value:function(){var e=this.view.validation.handlers;for(var t in e)e[t].map((function(e){return e.value||(e.value=webix.i18n.filter[e.id]),e}));this.handlers=e}},{key:"handleTypeChange",value:function(e,t){var n=this.$dialog.getBody(),i=n.elements,r=i.type.getValue(),o=i.condition;switch(r){case"any":n.showBatch("any");break;case"date":case"text":case"textLength":n.showBatch("value"),n.showBatch("condition",!0);break;case"number":n.showBatch("value"),n.showBatch("condition",!0),n.showBatch("number",!0);break;case"range":n.showBatch("value")}var a=o.getValue();if(o.isVisible()){o.getList().clearAll();var s=mn(this.handlers[r]);Gn(s,(function(e){return e.id==a}))||o.setValue(),o.getList().parse(s),"between"==a||"notBetween"==a?i.value2.show():i.value2.hide()}else i.value2.hide();var l=webix.i18n.spreadsheet.labels,u={text:l["validation-placeholder-text"]||"some text",textLength:l["validation-placeholder-number"]||123,date:l["validation-placeholder-date"]||or(this.view,this.cell.row,this.cell.column)(new Date),number:l["validation-placeholder-number"]||123,range:l["validation-placeholder-range"]||"=A1:A7"};i.value.config.placeholder=i.value2.config.placeholder=u[r],"date"==t?(i.value.setValue(this.normalizeValue(i.value.getValue(),"date")),i.value2.setValue(this.normalizeValue(i.value2.getValue(),"date"))):"date"==e&&(this.formatInput(i.value),this.formatInput(i.value2)),i.value.refresh(),i.value2.refresh()}},{key:"normalizeValue",value:function(e,t){webix.isUndefined(e)&&(e="");var n=isNaN(e);if(n&&"="==e[0])return e;"date"==(t=t||this.$dialog.getBody().elements.type.getValue())?e=n?""===(e=webix.Date.strToDate(webix.i18n.spreadsheet.formats.parseDateTime)(e))||isNaN(e)?"":Sn(e):rr(e)?"":e:"number"!=t&&"textLength"!=t||!n||(e="");return e}},{key:"formatValue",value:function(e,t){return"date"==t&&""!==e&&"="!=e[0]?(e=Cn(e),or(this.view,this.cell.row,this.cell.column)(e)):e.toString()}},{key:"formatInput",value:function(e){var t=e.getValue();if(""!==t){var n=e.getFormView().elements.type.getValue();t=this.normalizeValue(t,n),e.setValue(this.formatValue(t,n))}}},{key:"$init",value:function(){var e=this;this.prepareConditions();var t=webix.i18n.spreadsheet.labels;return{view:"ssheet-dialog",width:500,head:t["add-cell-validation"],move:!0,position:"center",body:{view:"form",elementsConfig:{labelWidth:170},rules:{value:webix.rules.isNotEmpty,value2:webix.rules.isNotEmpty,condition:webix.rules.isNotEmpty,errorHandle:webix.rules.isNotEmpty},elements:[{view:"richselect",label:t["validation-type"],name:"type",options:[{id:"any",value:t["validation-any"]},{id:"date",value:t["validation-date"]},{id:"number",value:t["validation-number"]},{id:"text",value:t["validation-text"]},{id:"textLength",value:t["validation-text-length"]},{id:"range",value:t["validation-range"]}],on:{onChange:function(t,n){return e.handleTypeChange(t,n)}}},{view:"checkbox",label:t["validation-integer"],batch:"number",name:"integer"},{view:"checkbox",label:t["validation-ignore-empty"],batch:"value",name:"ignoreEmpty"},{label:t.condition,required:!0,batch:"condition",view:"richselect",name:"condition",on:{onChange:function(e){var t=this.getFormView().elements;"between"==e||"notBetween"==e?t.value2.show():t.value2.hide(),t.condition.validate()}},suggest:{view:"ssheet-form-suggest",body:{data:[]}}},{batch:"value",cols:[{label:t.value,required:!0,view:"text",on:{onFocus:function(t){return e.activeValue=t},onBlur:function(t){e.formatInput(t),t.validate()}},name:"value"},{view:"text",required:!0,name:"value2",width:150,on:{onFocus:function(t){return e.activeValue=t},onBlur:function(t){e.formatInput(t),t.validate()}},hidden:!0}]},{name:"inputMessage",view:"textarea",label:t["validation-input-message"]},{view:"richselect",batch:"value",label:t["validation-error-handle"],name:"errorHandle",options:[{id:"information",value:t["validation-error-information"]},{id:"warning",value:t["validation-error-warning"]},{id:"stop",value:t["validation-error-stop"]}],on:{onChange:function(){this.validate()}}},{name:"errorTitle",view:"text",batch:"value",label:t["validation-error-title"]},{name:"errorMessage",view:"textarea",batch:"value",label:t["validation-error-message"]}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"okClick",value:function(){var e=this.$dialog.getBody();if(e.validate()){var t=e.getValues({hidden:!1});t.value=this.normalizeValue(t.value),t.value2&&(t.value=[t.value,this.normalizeValue(t.value2)],delete t.value2);var n=this.view;wn.set((function(){return n.eachSelectedCell((function(e){"any"!=t.type||t.inputMessage?n.validation.add(e.row,e.column,t):n.validation.remove(e.row,e.column)}))})),n.refresh(),this.close()}}}])}(Qa),yl=[ns,es,Ds,zs,Fs,al,ll,cl,dl,gl,vl,bl,_l,Object.freeze({__proto__:null,DialogBox:xl,action:"add-cell-validation"})];function Cl(e,t,n){us((function(){e.$handleSelection=null,e.parse(t),n&&(n.sheet&&e.showSheet(n.sheet),e._table.scrollTo(n.x,n.y))}))}var Sl=Object.freeze({__proto__:null,init:function(e){e.attachEvent("onCommand",(function(t,n,i){if("add"==t.id||"del"==t.id){var r=e._table.getSelectArea();!r||n&&i||(n=r.start,i=r.end),n&&i&&("column"==t.group&&"add"==t.id&&On(e.config.columnCount+(i.column-n.column)+1),wn.set((function(){!function(e,t,n,i){var r=i._table.getSelectArea(),o=i._table.getScrollState(),a="del"==e.id,s=i.serialize({sheets:a,viewIds:!0}),l=webix.copy(s),u={value:s,newValue:l};a||webix.extend(u,un(un({},e.group,t[e.group]),"extra",{count:n.row-t.row+1}));var c=a?Gn(l,(function(e){return e.name==i.getActiveSheet()})).content:l,h=[],d=c.spans;for(var f in d){var g=mo(d[f],e,t,n,0,c.data,h);(g[2]<=0||g[3]<=0)&&d.splice(f,1)}var m=function(e,t,n){var i=e.group,r="add"==e.id?1:"del"==e.id?-1:0;r&&("row"==i&&(r+=r*(n.row-t.row)),"column"==i&&(r+=r*(n.column-t.column)));return{name:i,inc:r}}(e,t,n);ls((function(){i.callEvent("onAction",["before-grid-change",{name:m.name,inc:m.inc,data:c,start:t}])}),i),"column"==e.group?a?function(e,t,n,i){var r=n.column-t.column+1;if(i.config.columnCount===r){if(t.column==n.column)return;n.column--,r--}i._mPage.removeColumn(t.column-1,r),i.config.columnCount-=r,i.callEvent("onColumnOperation",[e.id,t.column,n.column,i.getActiveSheet()])}(e,t,n,i):function(e,t,n,i){var r=n.column-t.column+1;i._mPage.addColumn(t.column-1,r),i.config.columnCount+=r,i.callEvent("onColumnOperation",[e.id,t.column,n.column,i.getActiveSheet()])}(e,t,n,i):"row"==e.group&&(a?function(e,t,n,i){var r=n.row-t.row+1;if(i.config.rowCount===r){if(t.row==n.row)return;n.row--,r--}i._mPage.removeRow(t.row-1,r),i.config.rowCount-=r,i.callEvent("onRowOperation",[e.id,t.row,n.row])}(e,t,n,i):function(e,t,n,i){var r=n.row-t.row+1;i._mPage.addRow(t.row-1,r),i.config.rowCount+=r,i.callEvent("onRowOperation",[e.id,t.row,n.row])}(e,t,n,i));var v=i.serialize();c.data=v.data,c.ranges=v.ranges,h.forEach((function(e){c.data.push(e)})),i.callEvent("onAction",["grid-change",u]),ls((function(){Cl(i,c,o)}),i),r&&(r=function(e,t){var n=t.config,i=n.rowCount,r=n.columnCount;1*e.start.row>i&&(e.start.row=i);1*e.end.row>i&&(e.end.row=i);1*e.start.column>r&&(e.start.column=r);1*e.end.column>r&&(e.end.column=r);if(t.isRowVisible(e.start.row)&&t.isRowVisible(e.end.row)&&t.isColumnVisible(e.start.column)&&t.isColumnVisible(e.end.column))return e}(r,i),r&&i.$$("cells").addSelectArea(r.start,r.end))}(t,n,i,e)})))}})),e.attachEvent("onUndo",(function(t,n,i,r,o,a){if("grid-change"==t){var s=e._table.getScrollState();a?o?e._mPage[n?"addRow":"addColumn"]((n||i)-1,a.count):e._mPage[n?"removeRow":"removeColumn"]((n||i)-1,a.count):s.sheet=e.getActiveSheet(),Cl(e,r,s)}}))}});function El(e){e._table._ssEditors={}}function $l(e,t,n){e._table.editStop(),Un(t,e,(function(e,t){e.getCellEditor(t.row,t.column,n)&&e.setCellEditor(t.row,t.column,null,n)}))}function Rl(e,t,n,i,r){var o=t.dropdown;e.setCellEditor(n,i,o),1===r&&e.setCellEditor(t.row,t.col,{})}var Al,kl,Tl,Il,Vl,Nl,Ml,Ol=Object.freeze({__proto__:null,clearEditors:$l,init:function(e){var t=e._table;e.attachEvent("onReset",(function(){return El(e)})),El(e),t.attachEvent("onBeforeEditStart",(function(t){var n=this.getColumnConfig(t.column);if(this._ssEditors[t.row]){var i=this._ssEditors[t.row][t.column];i&&(webix.extend(n,i,!0),webix.extend(n,{row:e.getRow(t.row)},!0),i.options&&("string"==typeof i.options?n.options=Bs(e,i.options,{unique:!0,order:!0,empty:i.empty}):webix.isArray(i.options)&&(n.options=Bs(e,i.options,{empty:i.empty})),n.collection&&(n.collection.clearAll(),n.collection.parse(n.options))))}})),t.attachEvent("onBeforeEditStop",(function(t,n,i){if(!i&&n.getFormat){var r=n.getValue(),o=n.getFormat(r);wn.set((function(){e.setCellValue(n.row,n.column,r),o?Di(e,n.row,n.column,Mi(o)):qi(e,n.row,n.column)}));var a=e.getSelectedId();a&&a.row==n.row&&a.column==n.column&&(o=Yi(o=o||"common")?"custom":o,e.callEvent("onCommand",[{id:"toolbar-update",name:"format",value:o}]))}})),t.attachEvent("onAfterEditStop",(function(e,t){var n=this.getColumnConfig(t.column);n.editor="text",delete n.popup,delete n.$popup,delete n.row})),e.attachEvent("onUndo",(function(t,n,i,r){"dropdown"==t&&e.setCellEditor(n,i,r)})),e.attachEvent("onAction",(function(t,n){"dropdown"==t?n.page==e.getActiveSheet()&&ho(e,n.row,n.column,"ss_editor",n.newValue):"before-grid-change"==t&&function(e,t,n,i,r){var o=i.editors;if(n)for(var a=o.length-1;a>=0;a--){var s=gn(o[a],3),l=s[0],u=s[1],c=s[2];if("row"==t&&l>=r.row||"column"==t&&u>=r.column){if("row"==t){if(l<r.row-n){o.splice(a,1);continue}o[a][0]=1*l+n}else if("column"==t){if(u<r.column-n){o.splice(a,1);continue}o[a][1]=1*u+n}c.options=jn(c.options,t,n,r)}}}(0,n.name,n.inc,n.data,n.start)}))},isEditor:function(e,t,n){var i=e._table._ssEditors;return i[t]&&!!i[t][n]},load:function(e,t){var n=t.editors;if(n)for(var i=0;i<n.length;i++)e.setCellEditor.apply(e,n[i])},pasteDropdown:Rl,serialize:function(e,t){var n,i,r=e._table._ssEditors,o=[];for(n in r)for(i in r[n])o.push([n,i,r[n][i]]);t.editors=o}});function Dl(e,t,n,i){var r=e.$$("cells");Tl=r.getSelectArea(),Al=function(e){var t=[],n=e._mData.getCopyManager();n.copy(e._mPage.cellID(Tl.start.row-1,Tl.start.column-1),e._mPage.cellID(Tl.end.row-1,Tl.end.column-1));for(var i=Tl.start.row;i<=Tl.end.row;i++){for(var r=[],o=Tl.start.column;o<=Tl.end.column;o++){var a=e.getCellValue(i,o);a=a&&"="==a[0]&&a.length>1?a:null;var s={text:e.getCellValue(i,o,!1),math:a,style:e.getStyle(i,o)},l=e.conditions.get(i,o),u=e.getCellEditor(i,o),c=e.getCellFilter(i,o),h=e._table.getSpan(i,o),d=e.validation.get(i,o);if(u||c||l||h||d){var f={row:i,col:o};l&&(f.condition=l),u&&(f.dropdown=u),c&&(f.filter=c),h&&(f.span=h),d&&(f.validation=d),s.extra=f}r.push(s)}t.push(r)}return t}(e),Ml={page:e.getActiveSheet(),view:e},i&&n&&n.writeText&&n.writeText(t.value),kl=t.value,Il&&0!==Object.keys(r._ssFilters).length&&(Vl=function(e,t){for(var n=Object.keys(e),i=Math.min.apply(null,n),r=Math.max.apply(null,n),o=t,a=1,s=i;s<=r;s++)if(e[s]){var l=Object.keys(e[s]);o=Math.min(o,Math.min.apply(null,l)),a=Math.max(a,Math.max.apply(null,l))}return Tl.start.row<=i&&Tl.end.row>=r&&Tl.start.column<=o&&Tl.end.column>=a}(r._ssFilters,e.config.columnCount))}function ql(e,t){var n=Fl(t);return webix.rules.isNumber(e)&&n&&(e=webix.Number.numToStr(n)(e)),e}function zl(e,t,n){n||(n="");var i=t.getSelectArea();if(i){var r=i.start,o=i.end,a=n===kl,s=a?Al:webix.csv.parse(n,t.config.delimiter);a||(s=function(e,t){var n=Fl(t);if(n)for(var i=0;i<e.length;i++)for(var r=0;r<e[i].length;r++){var o=webix.Number.parse(e[i][r],n);webix.rules.isNumber(o)&&(e[i][r]=o)}return e}(s,e.config));var l={id:"move",column:0,row:0,cut:Il},u=Ml&&Ml.view==e;!Nl&&a||(Il=0,Vl=0);var c=e.serialize();ls((function(){var n=s.length,i=s[0].length,c=o.column-r.column+1,h=o.row-r.row+1;if(function(e,t,n,i){var r,o=t.column+i[0].length-1;if(n>i.length){for(var a=0,s=n%i.length,l=0;l<s;l++)for(var u=0;u<i[l].length;u++)if(i[l][u].extra&&i[l][u].extra.span){var c=i[l][u].extra.span;if(c[0]==Tl.start.row+l&&c[1]==Tl.start.column+u){var h=l+c[3]-s;h>0&&(a=Math.max(h,a))}}r=t.row+n+a-1}else r=t.row+i.length-1;if(r>e.config.rowCount||o>e.config.columnCount){var d={id:"add"};r>e.config.rowCount&&(d.group="row",e.callEvent("onCommand",[d,{row:e.config.rowCount+1},{row:r}])),o>e.config.columnCount&&(d.group="column",e.callEvent("onCommand",[d,{column:e.config.columnCount+1},{column:o}]))}}(e,r,h,s),a){if(l.column=r.column-Tl.start.column,l.row=r.row-Tl.start.row,Vl){var d=t.getSelectArea();e.removeFilters(),t.addSelectArea(d.start,d.end)}var f=Il||Vl||!(h>n||c>i)?0:2;if("conditions"!=Nl)if(1==Il)u&&e._mData.getCopyManager().move(e._mPage.cellID(r.row-1,r.column-1),e._mData.getStore().getMeta().$clipboard),Ml&&!Ml.view.$destructed&&Ml.view.groupUndo((function(){for(var e=Tl.start.row;e<=Tl.end.row;e++)for(var t=Tl.start.column;t<=Tl.end.column;t++)Ml.view.setCellValue(e,t,null,Ml.page),Ml.view.setStyle(e,t,null,Ml.page)}));else if(u){var g;Nl&&(g=function(e,t){switch(Nl){case"formulas":return webix.extend(e,{value:t.formula||t.value},!0);case"styles":return webix.extend(e,{style:t.style,format:t.format},!0);case"values":return webix.extend(e,{value:t.value},!0);case"validation":return webix.extend(e,{validation:t.validation},!0)}}),e._mData.getCopyManager().paste(e._mPage.cellID(r.row-1,r.column-1),e._mPage.cellID(Math.max(r.row+Tl.end.row-Tl.start.row,o.row)-1,Math.max(r.column+Tl.end.column-Tl.start.column,o.column)-1),e._mData.getStore().getMeta().$clipboard,f,g)}if(2==f)for(var m=0,v=0;m<Math.max(h,n);m++,v++){v==s.length&&(v=0);for(var p=0,b=0;p<Math.max(c,i);p++,b++){b==s[0].length&&(b=0);var w={id:"move",column:l.column+Math.floor(p/i)*i,row:l.row+Math.floor(m/n)*n,cut:Il};Pl(e,r.row+m,r.column+p,s[v][b],w)}}else t.mapCells(r.row,r.column,n,null,(function(t,n,i,r,o){if(s[r]&&s[r].length>o){var a=s[r][o];Pl(e,n,i,a,l)}}),!0);1==Il&&(Il=2,Vl=!1)}else for(var _=0,x=0;_<Math.max(h,n);_++,x++){x==s.length&&(x=0);for(var y=0,C=0;y<Math.max(c,i);y++,C++)C==s[0].length&&(C=0),e.setCellValue(r.row+_,r.column+y,s[x][C])}}),e),e.callEvent("onAction",["paste",{value:c,newValue:e.serialize()}]),e.callEvent("onCommand",[{id:"toolbar-update"}]),e.refresh()}}function Pl(e,t,n,i,r){if("object"===pn(i)){var o=Ml&&Ml.view==e;if((!o||Ml.page!=e.getActiveSheet())&&(o||Nl&&"values"!=Nl&&"formulas"!=Nl||e.setCellValue(t,n,i.math&&"values"!=Nl?e._mData.getStore().transposeMath(i.math,r.row,r.column):i.text),i.style&&i.style.props&&(!Nl||"styles"==Nl))){var a=e.addStyle(i.style.props);e.setStyle(t,n,a)}var s=i.extra;s&&(!s.condition||Nl&&"conditions"!=Nl||Ca(e,s,t,n,Il),s.dropdown&&!Nl&&Rl(e,s,t,n,Il),s.filter&&Vl&&el(e,s,t,n,0,r),!s.validation||Nl&&"validation"!=Nl||Ma(e,s,t,n,Il)),Nl||vo(e,s,t,n,Il,r),e.saveCell(t,n,e.getActiveSheet())}}function Fl(e){var t=e.clipboardNumberFormat;return!t&&e.clipboardDecimalDelimiter&&(t={decimalDelimiter:e.clipboardDecimalDelimiter,decimalOptional:!0}),t&&webix.extend(t,{minusSign:webix.i18n.minusSign,minusPosition:webix.i18n.minusPosition}),t}var Ul=Object.freeze({__proto__:null,init:function(e){e.attachEvent("onSheetRename",(function(t,n){Ml&&Ml.page==t&&Ml.view==e&&(Ml.page=n)})),e.attachEvent("onSheetRemove",(function(t){Ml&&Ml.page==t&&Ml.view==e&&(Ml=null)}));var t=e.config.clipboard,n=navigator.clipboard;if(!1!==t){webix.clipbuffer.init();var i=document.querySelector(".webix_clipbuffer"),r=e.$$("cells");r.attachEvent("onSelectChange",(function(){return function(e,t){if(e._loading_data)return;var n=e.$$("cells");n.getSelectedId()&&webix.delay((function(){for(var i=[],r=n.getSelectArea(),o=r.start.row;o<=r.end.row;o++){for(var a=[],s=r.start.column;s<=r.end.column;s++)a.push(ql(e.getCellValue(o,s,!1),e.config));i.push(a)}var l=webix.csv.stringify(i,n.config.delimiter);n.getEditor()?t.value=l:(t.focus(),webix.clipbuffer.set(l)),webix.UIManager.setFocus(n)}))}(e,i)})),r.attachEvent("onKeyPress",(function(t,n){67!==t&&88!==t||!n.ctrlKey&&!n.metaKey||!r.getSelectedId()||(Il=1*(88===t),Dl(e,i))})),e.attachEvent("onCommand",(function(t){-1!=t.id.indexOf("paste")?(Nl=t.id.split("-")[1],n&&n.readText?n.readText().then((function(t){webix.clipbuffer.set(t),zl(e,r,i.value)})).catch((function(){zl(e,r,kl)})).finally((function(){Nl=null})):(zl(e,r,kl),Nl=null)):"copy"!=t.id&&"cut"!=t.id||(Il=1*("cut"==t.id),Dl(e,i,n,!0))})),e.attachEvent("onUndo",(function(t,n,i,o){if("paste"==t){var a=r.getScrollState(),s=r.getSelectArea();us((function(){e.$handleSelection=null,e.parse(o),r.addSelectArea(s.start,s.end),r.scrollTo(a.x,a.y)}))}})),e.config.readonly||r.attachEvent("onPaste",(function(t){zl(e,r,t)}))}}});function Ll(e,t){t?e["_hidden_"+t+"_hash"]={}:(e._hidden_cols_hash={},e._hidden_rows_hash={},e.filterSpreadSheet())}function Bl(e,t,n){if(!n||n==e.getActiveSheet())return!e._hidden_cols_hash[t];var i=Yr(e,n);if(i){var r=i.content.table;return!(r&&r.hidden&&r.hidden.column)||!Gn(r.hidden.column,(function(e){return e==t}))}}function Hl(e,t,n,i,r){if(!(t||r&&r!=e.getActiveSheet())){var o=e.getSelectedId(!0);if(!o.length)return;t=[o[0][i],o[o.length-1][i]]}var a,s=(a=t,webix.isArray(a)?a:[a,a]);n?("row"==i?Kl:Gl)({id:"hide",group:i},un({},i,s[0]),un({},i,s[1]),e,!1,r):("row"==i?Yl:Xl)({id:"hide",group:i},un({},i,s[0]),un({},i,s[1]),e,!1,r)}function jl(e,t,n){if(!n||n==e.getActiveSheet())return!e._hidden_rows_hash[t];var i=Yr(e,n);if(i){var r=i.content.table;return!(r&&r.hidden&&r.hidden.row)||!Gn(r.hidden.row,(function(e){return e==t}))}}function Wl(e){"column"==e.group?"show"==e.id?Xl.apply(this,arguments):"hide"==e.id&&Gl.apply(this,arguments):"row"==e.group&&("show"==e.id?Yl.apply(this,arguments):"hide"==e.id&&Kl.apply(this,arguments))}function Xl(e,t,n,i,r,o){if((o=o||i.getActiveSheet())==i.getActiveSheet()){var a=i.$$("cells"),s=a.getSelectArea(),l=i._hidden_cols_hash;if(e.neighbors)if(l[t.column-1])for(;l[t.column-1];)t.column--;else for(;l[n.column+1];)n.column++;wn.set((function(){for(var e=t.column;e<=n.column;e++)if(l[e]){delete l[e];var r=a.getColumnConfig(e-1||"rowId").header[0];r.css=r.css.replace("webix_ssheet_hide_column",""),a.showColumn(e)}var o=i._frozenColumns;o&&o>=t.column&&(i.freezeColumns(0),i.freezeColumns(o)),s&&a.addSelectArea(s.start,s.end)}),i)}else{var u=Yr(i,o);if(!u)return;var c=u.content.table;if(c&&c.hidden&&c.hidden.column)for(var h=function(e){var t=Kn(c.hidden.column,(function(t){return t==e}));-1!=t&&c.hidden.column.splice(t,1)},d=t.column;d<=n.column;d++)h(d)}r||i.callEvent("onColumnOperation",[e.id,t.column,n.column,o])}function Yl(e,t,n,i,r,o){if((o=o||i.getActiveSheet())==i.getActiveSheet()){var a=i.$$("cells"),s=a.getSelectArea(),l=i._hidden_rows_hash;if(e.neighbors)if(l[t.row-1])for(;l[t.row-1];)t.row--;else for(;l[n.row+1];)n.row++;wn.set((function(){var e=i._frozenRows;e&&i.freezeRows(0);for(var r=t.row;r<=n.row;r++)if(l[r])if(delete l[r],r-1==0){var o=a.getColumnConfig("rowId").header[0];o.css=o.css.replace("webix_ssheet_hide_row",""),a.refreshColumns()}else a.removeCellCss(r-1,"rowId","webix_ssheet_hide_row");i.filterSpreadSheet(),e&&i.freezeRows(e),s&&a.addSelectArea(s.start,s.end)}),i)}else{var u=Yr(i,o);if(!u)return;var c=u.content.table;if(c&&c.hidden&&c.hidden.row)for(var h=function(e){var t=Kn(c.hidden.row,(function(t){return t==e}));-1!=t&&c.hidden.row.splice(t,1)},d=t.row;d<=n.row;d++)h(d)}r||i.callEvent("onRowOperation",[e.id,t.row,n.row,o])}function Gl(e,t,n,i,r,o){if((o=o||i.getActiveSheet())==i.getActiveSheet()){var a=i.$$("cells"),s=n.column;if(i.$handleSelection=null,a.unselect(),n.column<1||t.column<1)return void delete i._hidden_cols_hash[t.column];for(;s>=t.column;){if(-1!=a.getColumnIndex(s)){i._hidden_cols_hash[s]=s;var l=a.getColumnConfig(s-1||"rowId").header[0];l.css=(l.css||"")+" webix_ssheet_hide_column",a.hideColumn(s)}s--}}else{var u=Yr(i,o);if(u){var c=u.content.table;c||(c=u.content.table={}),c.hidden||(c.hidden={}),c.hidden.rows||(c.hidden.column=[]);for(var h=function(e){Gn(c.hidden.column,(function(t){return t==e}))||c.hidden.column.push(e)},d=t.column;d<=n.column;d++)h(d)}}r||i.callEvent("onColumnOperation",[e.id,t.column,n.column,o])}function Kl(e,t,n,i,r,o){if((o=o||i.getActiveSheet())==i.getActiveSheet()){if(n.row<1||t.row<1)return void delete i._hidden_rows_hash[t.row];var a=i._frozenRows;a&&i.freezeRows(0);for(var s=i.$$("cells"),l=n.row;l>=t.row;){if(i._hidden_rows_hash[l]=l,l-1==0){var u=s.getColumnConfig("rowId").header[0];u.css=(u.css||"")+" webix_ssheet_hide_row",s.refreshColumns()}else s.addCellCss(l-1,"rowId","webix_ssheet_hide_row");l--}i.filterSpreadSheet(),a&&i.freezeRows(a)}else{var c=Yr(i,o);if(c){var h=c.content.table;h||(h=c.content.table={}),h.hidden||(h.hidden={}),h.hidden.row||(h.hidden.row=[]);for(var d=function(e){Gn(h.hidden.row,(function(t){return t==e}))||h.hidden.row.push(e)},f=t.row;f<=n.row;f++)d(f)}}r||i.callEvent("onRowOperation",[e.id,t.row,n.row,o])}var Ql=Object.freeze({__proto__:null,init:function(e){e.attachEvent("onCommand",(function(t){if("show"==t.id||"hide"==t.id){var n=e._table.getSelectArea();n&&Wl(t,webix.copy(n.start),webix.copy(n.end),e)}})),Ll(e),e.attachEvent("onUndo",(function(t,n,i,r,o){if(!("hide"!=t.id&&"show"!=t.id||"column"!=t.group&&"row"!=t.group)){var a=t.id;o||(a="hide"==a?"show":"hide");var s=n||i;Wl({id:a,group:t.group,neighbors:t.neighbors},s.start,s.end,e,!0)}})),e.attachEvent("onHardReset",(function(){return Ll(e)})),e.attachEvent("onAction",(function(t,n){"before-grid-change"==t&&function(e,t,n,i,r){if(i.table&&i.table.hidden&&i.table.hidden[t]&&i.table.hidden[t].length){Ll(e,"column"==t?"cols":"rows");for(var o=r[t],a=i.table.hidden[t],s=a.length-1;s>=0;s--){var l=1*a[s];n>0&&l>=o?a[s]=n+l:n<0&&l>=o&&(l<o-n?a.splice(s,1):a[s]=n+l)}}}(e,n.name,n.inc,n.data,n.start)}))},isColumnVisible:Bl,isRowVisible:jl,load:function(e,t){if(Ll(e),!webix.isUndefined(t.table)&&!webix.isUndefined(t.table.hidden)){var n=t.table.hidden;if(n.row&&n.row.length)for(var i=0;i<n.row.length;i++)Kl({id:"hide",group:"row"},{row:n.row[i]},{row:n.row[i]},e,!0);if(n.column&&n.column.length)for(var r=0;r<n.column.length;r++)Gl({id:"hide",group:"column"},{column:n.column[r]},{column:n.column[r]},e,!0)}},reset:Ll,serialize:function(e,t){var n=[],i=[];for(var r in e._hidden_rows_hash)n.push(r);for(var o in e._hidden_cols_hash)i.push(o);(n.length||i.length)&&(t.table.hidden={}),n.length&&(t.table.hidden.row=n),i.length&&(t.table.hidden.column=i)},setState:Hl});var Zl=Object.freeze({__proto__:null,init:function(e){var t=e._table,n=0;t.attachEvent("onAreaDrag",(function(){return n=new Date})),t.attachEvent("onBeforeAreaRemove",(function(){if(e.$handleSelection&&new Date-n<500)return!1})),t.attachEvent("onBeforeAreaAdd",(function(n){if("rowId"==n.start.column)return!1;var i=t.getEditor();if(!i||i.row==n.start.row&&i.column==n.start.column&&i.row==n.start.row&&i.column==n.start.column||t.editStop(),!e.$handleSelection)return!0;var r=Vn[n.start.column]+n.start.row,o=Vn[n.end.column]+n.end.row,a=e.$handleSelection(n.start,n.end,r,o);return!1!==a&&(e.$handleSelection=null,t.removeSelectArea()),a})),t.attachEvent("onBeforeBlockSelect",(function(n,i,r){if(!e.config.readonly&&r&&t.$handleStart){var o=t.getSelectArea(),a=o.start,s=o.end,l=n.row,u=i.row,c=n.column,h=i.column;if(a.row==l&&s.row>u)e.clearRange({start:{row:u+1,column:c},end:{row:s.row,column:h}},{values:!0});else if(a.column==c&&s.column>h)e.clearRange({start:{row:l,column:h+1},end:{row:u,column:s.column}},{values:!0});else{var d;if(l!=a.row||u!=s.row?d="row":c==a.column&&h==s.column||(d="column"),d){wn.start();for(var f="row"==d,g=f?c:l;g<=(f?h:u);g++){for(var m=[],v=[],p=a[d];p<=s[d];p++){var b=gn("row"==d?[p,g]:[g,p],2),w=b[0],_=b[1],x=e.getCellValue(w,_);webix.rules.isNumber(x)?(v[0]?(v[1]=p,webix.isUndefined(v.inc)&&(v.inc=x-v.firstValue)):(v.firstValue=x,v[0]=v[1]=p),m[p]=v):v=[]}for(var y=a[d]==(f?l:c),C=y?a[d]:s[d],S=y?1:-1,E=y?s[d]+1:a[d]-1,$=0,R=1;y?E<=(f?u:h):E>=(f?l:c);y?E++:E--,$++){$==s[d]-a[d]+1&&(R++,$=0);var A=C+$*S,k=gn(f?[A,g]:[g,A],2),T=k[0],I=k[1],V=e.getCellValue(T,I),N=m[A];N?V+=(N.inc||1)*(N[1]-N[0]+1)*R*S:"string"==typeof V&&"="==V[0]&&V.length>0&&(V=f?e._mData.getStore().transposeMath(V,E-C-$*S,0):e._mData.getStore().transposeMath(V,0,E-C-$*S));var M=gn(f?[E,g]:[g,E],2),O=M[0],D=M[1];e.setCellValue(O,D,V),e.setStyle(O,D,e.getStyle(T,I));var q=e.conditions.get(T,I);q?Ca(e,{condition:q},O,D):e.conditions.clear(O,D)}}wn.end()}}}})),webix.event(t.$view,"mousedown",(function(t){if(e.$handleSelection)return webix.html.preventEvent(t)}))}});function Jl(e,t,n){var i=n.getItem(e)[t];return void 0!==i&&""!==i}var eu={int:function(e,t){return function(n,i){if(!i[t])return-1;if(!n[t])return 1;var r=parseFloat(n[t])||e*(1/0),o=parseFloat(i[t])||e*(1/0);return(r>o?1:r==o?0:-1)*e}},str:function(e,t){return function(n,i){if(!i[t])return-1;if(!n[t])return 1;var r=n[t].toString().toLowerCase(),o=i[t].toString().toLowerCase();return(r>o?1:r==o?0:-1)*e}}};function tu(e,t,n){if(t=t||e._table.getSelectArea()){var i=t=Fn(t,e);t.start.row===t.end.row&&(i=function(e,t){for(var n=t.config.rowCount,i=t.config.columnCount,r=t._table,o=e.start.row,a=e.end.row,s=e.start.column,l=e.end.column,u=o-1;u>0&&Jl(u,e.start.column,r);u--)o=u;for(var c=a+1;c<n&&Jl(c,e.end.column,r);c++)a=c;for(var h=s-1;h>0&&Jl(e.start.row,h,r);h--)s=h;for(var d=l+1;d<i&&Jl(e.end.row,d,r);d++)l=d;var f={start:{row:o,column:s},end:{row:a,column:l}};return o==e.start.row&&a==e.end.row&&s==e.start.column&&l==e.end.column||t._table.addSelectArea(f.start,f.end),f}(t,e));var r=e.getCellValue(t.start.row,t.start.column,!1),o=isNaN(parseFloat(r))?"str":"int";n=n&&"asc"!==n?-1:1,wn.set((function(){return function(e,t,n,i,r){for(var o=e.start.column;o<=e.end.column;o++){for(var a=[],s=e.start.row;s<=e.end.row;s++)if(r.isRowVisible(s)){var l=r.getCellValue(s,o,!1),u=r.getStyle(s,o),c=r.getCellValue(s,o);c=c&&"="==c[0]?c:null;var h=r.conditions.get(s,o);h&&Sa("remove",s,o,h,null,r),a.push({value:l,style:u,math:c,row:s,conditions:h})}a.sort(eu[n](i,"value"));for(var d=e.start.row;d<=e.end.row;d++)if(r.isRowVisible(d)){var f=a.shift();if(r.setStyle(d,o,f.style||null),f.conditions&&Sa("update",d,o,null,f.conditions,r),f.math){var g=r._mData.getStore().transposeMath(f.math,d-f.row,0);r.setCellValue(d,o,g)}else r.setCellValue(d,o,f.value)}}r.refresh()}(i,t.start.column,o,n,e)}))}}var nu=Object.freeze({__proto__:null,init:function(e){e.attachEvent("onCommand",(function(t){"sort-asc"!==t.id&&"sort-desc"!==t.id||tu(e,null,t.id.replace("sort-",""))}))},sortRange:tu});function iu(e,t,n,i){if(-1==t.indexOf("!"))return t;for(var r=gr(t,e,!0),o=0;o<r.length;o++)if(webix.isArray(r[o])){var a=r[o][0]===n?i:r[o][0];-1!=a.indexOf(" ")&&(a="'".concat(a,"'")),r[o]="".concat(a,"!").concat(r[o][1])}return r.join("")}function ru(e){return"string"==typeof e&&"="==e[0]}var ou=Object.freeze({__proto__:null,init:function(e){e.attachEvent("onSheetRename",(function(t,n){e._sheets.forEach((function(i){var r=i.name==e.getActiveSheet();r&&(i.content=e.serialize()),i.content.editors&&i.content.editors.forEach((function(i){var r=i[2].options;if(r)if("string"==typeof r)i[2].options=iu(e,r,t,n);else for(var o=0;o<r.length;o++){var a=r[o];"string"==typeof a?ru(a)&&(r[o]=iu(e,a,t,n)):ru(a.id)&&(a.id=iu(e,a.id,t,n))}})),i.content.conditions&&(i.content.conditions.forEach((function(i){ru(i[3])&&(i[3]=iu(e,i[3],t,n))})),r&&(e.conditions.clear(),e.conditions.parse(i.content.conditions)))}))}))}});function au(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;if((i=i||e.getActiveSheet())==e.getActiveSheet()){var r=e.$$("cells");t=-1!=r.$view.className.indexOf("webix_borderless"),"toggle"==n&&(n=!t),n!=t&&(n?webix.html.addCss(r.$view,"webix_borderless",!0):webix.html.removeCss(r.$view,"webix_borderless"),e.callEvent("onCommand",[{id:"toolbar-update",name:"hide-gridlines",value:n}]))}else{var o=Yr(e,i);if(!o)return;o.content.table||(o.content.table={gridlines:1}),t=!o.content.table.gridlines,"toggle"===n&&(n=!t),o.content.table.gridlines=n?0:1}n!=t&&e.callEvent("onAction",["gridlines-hide",{newValue:n,value:t,page:i}])}var su=Object.freeze({__proto__:null,hideGridlines:au,init:function(e){e.attachEvent("onUndo",(function(t,n,i,r){"gridlines-hide"==t&&au(e,r)}))},load:function(e,t){var n=!1;webix.isUndefined(t.table)||webix.isUndefined(t.table.gridlines)||(n=!t.table.gridlines),au(e,n)},serialize:function(e,t){t.table.gridlines=-1!=e.$$("cells").$view.className.indexOf("webix_borderless")?0:1}});function lu(e,t,n){var i;if((n=n||e.getActiveSheet())==e.getActiveSheet()){var r=e.$$("cells"),o=!r.config.header;if("toggle"==t&&(t=!o),t!=o){r.config.header=!t,e.callEvent("onCommand",[{id:"toolbar-update",name:"hide-headers",value:t}]);var a=r.isColumnVisible("rowId");(a&&t||!a&&!t)&&r.hideColumn("rowId",{},!0,!!t),r.refreshColumns()}}else{var s=Yr(e,n);if(!s)return;s.content.table||(s.content.table={headers:1}),i=!s.content.table.headers,"toggle"===t&&(t=!i),s.content.table.headers=t?0:1}t!=i&&e.callEvent("onAction",["header-hide",{newValue:t,value:i,page:n}])}var uu=Object.freeze({__proto__:null,hideHeaders:lu,init:function(e){e.attachEvent("onUndo",(function(t,n,i,r){"header-hide"==t&&lu(e,r)}))},load:function(e,t){var n;t.table&&!webix.isUndefined(t.table.headers)&&(n=!t.table.headers),lu(e,n)},serialize:function(e,t){t.table.headers=e.$$("cells").config.header?1:0}});function cu(e,t,n,i,r){r=r||e.getActiveSheet();var o=fu(e,t,n,r);if(o){if(r!=e.getActiveSheet()){var a=Yr(e,r).content.comments,s=Kn(a,(function(e){return e[0]==t&&e[1]==n}));a.splice(s,1)}else delete e.comments._pull[t][n],e.$$("cells").updateItem(t,n);i||e.callEvent("onAction",["comment",{row:t,column:n,newValue:null,value:o,page:r}])}}function hu(e,t,n){wn.set((function(){Un(t,e,(function(e,t){fu(e,t.row,t.column,n)&&cu(e,t.row,t.column,!1,n)})),e.$$("cells").refresh()}))}function du(e,t,n,i,r,o){o=o||e.getActiveSheet();var a=fu(e,t,n,o)||null;if(o!=e.getActiveSheet()){var s=Yr(e,o);s.content.comments||(s.content.comments=[]),a?Gn(s.content.comments,(function(e){return e[0]==t&&e[1]==n}))[2]=i:s.content.comments.push([t,n,i])}else"string"==typeof i&&(i=i.trim()?i:""),e.comments._pull[t]=e.comments._pull[t]?e.comments._pull[t]:{},e.comments._pull[t][n]=i,e.$$("cells").addCellCss(t,n,"ssheet_commented_cell");r||e.callEvent("onAction",["comment",{row:t,column:n,newValue:i,value:a,page:o}])}function fu(e,t,n,i){var r;if(i&&i!=e.getActiveSheet()){var o=Yr(e,i);o&&o.content.comments&&(r=Gn(o.content.comments,(function(e){return e[0]==t&&e[1]==n})))&&(r=r[2])}else e.comments._pull[t]&&e.comments._pull[t][n]&&(r=e.comments._pull[t][n]);return r||""}var gu=Object.freeze({__proto__:null,init:function(e){e.comments={get:function(t,n,i){return fu(e,t,n,i)},add:function(t,n,i,r){du(e,t,n,i,!1,r)},remove:function(t,n,i){cu(e,t,n,!1,i)},_activeComment:{},_pull:{}},e.attachEvent("onReset",(function(){return function(e){e.comments._pull={}}(e)})),e.attachEvent("onUndo",(function(t,n,i,r){"comment"===t&&function(e,t,n,i){fu(e,t,n)&&cu(e,t,n,!0);i&&du(e,t,n,i,!0)}(e,n,i,r)})),e.attachEvent("onAction",(function(e,t){"before-grid-change"==e&&function(e,t,n,i,r){var o=i.comments,a=o.length;if(n)for(;a--;){var s=gn(o[a],2),l=s[0],u=s[1];(l&&"row"==t&&l>=r.row||u&&"column"==t&&u>=r.column)&&("row"==t?l<r.row-n?o.splice(a,1):o[a][0]=1*l+n:"column"==t&&(u<r.column-n?o.splice(a,1):o[a][1]=1*u+n))}}(0,t.name,t.inc,t.data,t.start)}))},load:function(e,t){var n,i=t.comments;if(i)for(n=0;n<i.length;n++)du(e,i[n][0],i[n][1],i[n][2],!0)},removeCommentsRange:hu,serialize:function(e,t){var n,i,r=[];for(n in e.comments._pull)for(i in e.comments._pull[n])e.comments._pull[n][i]&&r.push([n,i,e.comments._pull[n][i]]);t.comments=r}});function mu(e,t,n){var i;if((n=n||e.getActiveSheet())==e.getActiveSheet()){var r=e.$$("cells");i=r.config.showFormulas,"toggle"==t&&(t=!i),t!=i&&(r.config.showFormulas=t,e.callEvent("onCommand",[{id:"toolbar-update",name:"show-formulas",value:t}]),r.refresh())}else{var o=Yr(e,n);if(!o)return;o.content.table||(o.content.table={showFormulas:1}),i=o.content.table.showFormulas,"toggle"==t&&(t=!i),o.content.table.showFormulas=t?1:0}t!=i&&e.callEvent("onAction",["show-formulas",{newValue:t,value:i,page:n}])}var vu=Object.freeze({__proto__:null,init:function(e){e.attachEvent("onUndo",(function(t,n,i,r){"show-formulas"==t&&mu(e,r)}))},load:function(e,t){var n=!1;t.table&&t.table.showFormulas&&(n=t.table.showFormulas),mu(e,n)},serialize:function(e,t){t.table.showFormulas=e.$$("cells").config.showFormulas?1:0},showFormulas:mu});var pu=Object.freeze({__proto__:null,init:function(e){var t=[su,uu,oo,Ol,rl,Ql,gu,vu];e.attachEvent("onDataSerialize",(function(n){for(var i=0;i<t.length;i++)t[i].serialize&&t[i].serialize(e,n)})),e.attachEvent("onDataParse",(function(n){for(var i=0;i<t.length;i++)t[i].load&&t[i].load(e,n)}))}}),bu=[".xls",".xlt",".xla",".xlsx",".xlsm",".xltx",".xltm",".xlam",".xlsb"];var wu=Object.freeze({__proto__:null,init:function(e){var t;window.XMLHttpRequest&&(new XMLHttpRequest).upload&&((t=webix.ui({view:"uploader",apiOnly:!0,accept:bu.join()})).attachEvent("onBeforeFileAdd",webix.bind((function(t){return bu.indexOf("."+t.type.toLowerCase())>-1&&(e.reset(),t.file.options||(t.file.options={}),webix.extend(t.file.options,{cellDates:!1,sheetStubs:e.config.sheetStubs}),e.parse(t.file,"excel")),!1}),this)),e._destroy_with_me.push(t)),e.attachEvent("onCommand",(function(n){"excel-import"===n.id&&function(e,t){t?webix.delay((function(){return t.fileDialog()})):e.alert(webix.i18n.spreadsheet.labels["import-not-support"])}(e,t)}))}});function _u(e){return 3===(e=e.substring(1)).length&&(e+=e),e}function xu(e,t,n){var i=e.split(";"),r={};t&&(r={font:{},alignment:{},border:{}});for(var o=0;o<i.length;o++)i[o]&&(t?yu(r,i,o):Cu(r,i,o,n.table));return r}function yu(e,t,n){switch(Zn[n]){case"color":e.font.color={rgb:_u(t[n])};break;case"background":var i=_u(t[n]);i&&"ffffff"!==i.toLowerCase()&&(e.fill={fgColor:{rgb:i}});break;case"text-align":e.alignment.horizontal=t[n];break;case"font-family":e.font.name=t[n].replace(/'|,.*$/g,"");break;case"font-size":e.font.sz=.75*t[n].replace("px","");break;case"font-style":e.font.italic="italic"==t[n];break;case"underline":e.font.underline="underline"==t[n];break;case"strike":e.font.strike="strike"==t[n];break;case"font-weight":e.font.bold="bold"==t[n];break;case"vertical-align":e.alignment.vertical="middle"==t[n]?"center":t[n];break;case"wrap":e.alignment.wrapText="wrap"==t[n];break;case"borders":break;case"format":e.format=Mi(t[n],!0)||"";break;case"border-right":case"border-bottom":case"border-left":case"border-top":e.border[Zn[n].split("-")[1]]=Su(t[n],!0);break;case"indent":e.alignment.indent=t[n]}}function Cu(e,t,n,i){switch(Zn[n]){case"color":e.color=_u(t[n]);break;case"background":e.backgroundColor=_u(t[n]);break;case"text-align":e.textAlign=t[n];break;case"font-family":case"borders":case"format":break;case"font-size":e.fontSize=.75*t[n].replace("px","");break;case"font-style":e.italic="italic"==t[n];break;case"underline":e.underline="underline"==t[n];break;case"strike":e.strikethrough="strike"==t[n];break;case"font-weight":e.bold="bold"==t[n];break;case"vertical-align":e.vertAlign=t[n];break;case"wrap":e.whiteSpace="nowrap"!=t[n];break;case"border-right":case"border-bottom":case"border-left":case"border-top":var r=Zn[n].split("-")[1];e["border".concat(r[0].toUpperCase()+r.substring(1),"Color")]=Su(t[n]);break;case"indent":if(t[n]){var o="padding".concat("right"==t[2]?"Right":"Left"),a=i&&i[o]?i[o]:10;e[o]=a+6*t[n]}}}function Su(e,t){var n=gn(e.split(","),2),i=n[0],r=n[1];return t?{color:{rgb:_u(i)},style:r}:_u(i)}function Eu(e){if(!e)return{};for(var t=[],n=0;n<Zn.length;n++)t.push(e[Zn[n]]||"");return xu(t.join(";"),!0)}var $u=Object.freeze({__proto__:null,init:function(e){var t=e._table;e.$exportView=function(n){var i="pdf"==n.export_mode,r="excel"==n.export_mode,o={stubCells:!0,header:!1,footer:!1,heights:!0,rawValues:!i,filterHTML:!0,spans:!0,styles:!0,math:!i,hidden:r,xCorrection:t.config.header||n.hidden?1:0,ignore:{rowId:!0},conditions:!0};return webix.extend(n,o),r||i?function(e,t){var n=arguments,i=this,r="excel"==t.export_mode;!0===t.sheets?t.sheets=e._sheets.map((function(e){return e.name})):t.sheets&&t.sheets.length?"string"==typeof t.sheets&&(t.sheets=[t.sheets]):t.sheets=[e._activeSheet];if(r){if(e._sheets.length!=t.sheets.length)for(var o=0;o<e._sheets.length;o++){var a=e._sheets[o];"veryHidden"==a.state&&-1==t.sheets.indexOf(a.name)&&t.sheets.push(a.name)}}else t.sheets=t.sheets.filter((function(t){return Gr(e,t)}));t.dataOnly=!0;for(var s=[],l=e._activeSheet,u=function(o){var a=t.sheets[o],u=a.id||a;e.showSheet(u);var c=e._zoom;e.ignoreUndo((function(){return e.zoom(1)})),t.hidden&&(t.xCorrection=1);var h=a.options?webix.extend(a.options,t):webix.copy(t);u!=l&&(h._hidden=!0),h.name||(h.name=u);var d=!r&&"image"!=h.display,f=e.serialize(),g=gn(Qn(f.data,f.spans,0,0),2),m=g[0],v=g[1];if(!r&&(webix.isUndefined(h.textBefore)&&(h.textBefore=h.name),d)){h.ignore=h.ignore||{};for(var p=v+1;p<=e.config.columnCount;p++)h.ignore[p]=!0;var b=h.filter||function(){return!0};h.filter=function(e){return e.id<=m&&b.apply(i,n)}}var w=webix[r?"toExcel":"toPDF"](e._table,h);if(r&&(w[0].state=Yr(e,u).state||"visible"),d&&0==w[0].scheme.length)return 1;if((r||d)&&h.styles){var _=w[0].styles=function(e,t,n,i,r){e.compactStyles();var o=[],a={},s={},l=function(e){var t=Xn;return"excel"==e.export_mode?{font:{sz:.75*t["font-size"],name:t["font-family"].replace(/'|,.*$/g,"")},alignment:{horizontal:t["text-align"],vertical:"middle"==t["vertical-align"]?"center":t["vertical-align"],wrapText:"nowrap"!=t["white-space"]}}:{fontSize:.75*t["font-size"],textAlign:t["text-align"],whiteSpace:"nowrap"!=t["white-space"]}}(t);n&&t.docHeader&&(o=o.concat([{0:Eu(t.docHeader.css)},{}]));t.header&&o.push({});var u=o.length,c=e.$$("cells"),h=u;c.eachRow((function(u){if(!(u>i)){var d=0;c.eachColumn((function(i){if(!(d>r)){if(d>=t.xCorrection){var c,f,g=ai(e,{row:u,column:i},null,!0),m=d-t.xCorrection;if(o[h]=o[h]||{},g)if(a[g.id])c=webix.copy(a[g.id]);else{for(var v in c=xu(g.text,n,t),l)n?webix.extend(c[v],l[v]):c[v]||(c[v]=l[v]);a[g.id]=webix.copy(c)}else c=webix.copy(l);if(t.conditions){var p=function(e,t,n,i){var r=Ua(e,t,n),o=fa(e,t,n,r);if(o){if(i[o])return i[o];var a=webix.html.create("div",{class:o});document.body.appendChild(a);var s=window.getComputedStyle(a),l=s.backgroundColor,u=s.color;return document.body.removeChild(a),i[o]=[l,u],i[o]}}(e,u,i,s);p&&function(e,t,n){var i=t.map((function(e){return webix.color.rgbToHex(e)})),r=gn(i,2),o=r[0],a=r[1];n?(e.fill={fgColor:{rgb:o}},e.font.color={rgb:a}):(e.backgroundColor=o,e.color=a)}(c,p,n)}if(o[h][m]=c,t.math){var b=e.getCellValue(u,i);if("string"==typeof b&&"="==b[0]&&b.length>1){var w=e.getCellValue(u,i,!1);isNaN(w)&&(f="string")}}o[h][m].type=f||_r(e,u,i)}d++}}),t.hidden),h++}}),t.hidden),n&&t.docFooter&&(o=o.concat([{},{0:Eu(t.docFooter.css)}]));return o}(e,h,r,m,v);d&&function(e,t,n,i,r){var o=n.header?1:0;if(n.spans)for(var a=r.spans.sort((function(e,t){return e[1]<t[1]?1:e[1]>t[1]?-1:0})),s=0;s<a.length;s++)if(a[s][2]>1){var l=a[s][0]-1+o,u=a[s][1]-1,c=a[s][2];if(e[l]&&e[l][u]){e[l][u].colspan=c;var h=t[0].exportData[l-o];h&&h.splice(u+1,c-1);var d=Object.values(e[l]);d.splice(u+1,c-1),e[l]=d}}for(var f=t[0].exportData,g=0;g<f.length;g++)for(var m=0;m<f[g].length;m++){var v=i.$$("cells").config.rowHeight;if(n.heights&&r.sizes.length)for(var p=0;p<r.sizes.length;p++){var b=r.sizes[p][0];if(b&&b==g+1){v=r.sizes[p][2];break}}var w=e[g+o][m],_=w.vertAlign,x=.75*v-w.fontSize;w.paddingTop="top"==_?0:"bottom"==_?x:x/2,w.paddingBottom="bottom"==_?0:"top"==_?x:x/2}}(_,w,h,e,f)}s=s.concat(w),r?(s[o].ranges=[],e.ranges.serialize(u).forEach((function(e){var t=e[1].split("!");s[o].ranges.push({Sheet:e[2]?null:o,Name:e[0],Ref:t[0]+"!"+t[1].replace(/[0-9]+|[A-Z]+/gi,(function(e){return"$".concat(e)}))})}))):t.autowidth&&function(e,t){var n,i=t.orientation&&"landscape"==t.orientation?"height":"width";n=e.$width?e.$width:e[i];t[i]=Math.max(t[i]||0,n||0)}(h,t),e.ignoreUndo((function(){return e.zoom(c)}))},c=0;c<t.sheets.length;c++)u(c);return e.showSheet(l),delete t.dataOnly,s}(e,n):t},t.$getExportValue=function(t,n,i){var r=e.getCellValue(t,n,i.math),o=i.export_mode,a=i.math&&"="==r[0]&&r.length>1;if("pdf"!=o&&"csv"!=o||a||i.rawValues){if("excel"==o&&a)if(/^=(image|sparkline)\(/i.test(r))r="";else{for(var s,l,u,c=e._mPage.cellID(t-1,n-1),h=t+1;h<=e.config.rowCount;h++){var d=e._mPage.getCell(h-1,n-1);if(!d||d.source!==c)break;s=h}for(var f=n+1;f<=e.config.columnCount;f++){var g=e._mPage.getCell(t-1,f-1);if(!g||g.source!==c)break;l=f}(l||s)&&(u=Pn(t,n,s||t,l||n));var m=e.getCellValue(t,n,!1);/^=(checkbox|radio)\(/i.test(r)&&(r=m?"=TRUE()":"=FALSE()"),r={value:/^=hyperlink\(/i.test(r)?r.split('"')[3]:m,formula:r,ref:u}}}else r=Ua(e,t,n);return r}}});function Ru(e,t,n,i){for(var r=webix.copy(e.data),o=[],a=function(t){for(var n=function(n){var i=t+1,a=n+1,s=r[t][n];if(e.links.length){var l=Gn(e.links,(function(e){return e[0]==t&&e[1]==n}));l&&(l="string"==typeof l[2]&&"="==l[2][0]?l[2].slice(1):'"'.concat(l[2],'"'),s="string"==typeof s&&"="==s[0]?s.slice(1):'"'.concat(s,'"'),s="=HYPERLINK(".concat(l,", ").concat(s,")"))}o.push([i,a,s])},i=0;i<r[0].length;i++)n(i)},s=0;s<r.length;s++)a(s);if(e.data=o,e.spans)for(var l=0;l<e.spans.length;l++)e.spans[l][0]++,e.spans[l][1]++;if(t)for(var u=0;u<t.length;u++){var c=t[u].Sheet,h=webix.isUndefined(c);(h||c===n)&&(e.ranges=e.ranges||[],e.ranges.push([t[u].Name.toUpperCase(),t[u].Ref.substring(t[u].Ref.indexOf("!")+1).replace(/\$/g,""),h]))}if(e.styles&&function(e,t){for(var n=1,i={},r=[],o=[],a=0;a<e.styles.length;a++){for(var s=[],l=e.styles[a][2],u=void 0,c=function(){switch(Zn[h]){case"color":s[h]=l.font&&l.font.color&&Au(l.font.color.rgb)||"";break;case"background":s[h]=l.fill&&l.fill.fgColor&&Au(l.fill.fgColor.rgb)||"";break;case"text-align":s[h]=(l.alignment?l.alignment.horizontal:"")||Xn["text-align"];break;case"font-family":s[h]=l.font&&l.font.name?ku(l.font.name):"";break;case"font-size":s[h]=l.font&&l.font.sz&&l.font.sz/.75+"px"||"";break;case"font-style":s[h]=l.font&&l.font.italic?"italic":"";break;case"underline":s[h]=l.font&&l.font.underline?"underline":"";break;case"strike":s[h]=l.font&&l.font.strike?"strike":"";break;case"font-weight":s[h]=l.font&&l.font.bold?"bold":"";break;case"vertical-align":var e=l.alignment&&l.alignment.vertical||"";s[h]=("center"==e?"middle":e)||Xn["vertical-align"];break;case"wrap":s[h]=l.alignment&&l.alignment.wrapText?"wrap":"nowrap";break;case"borders":s[h]="";break;case"format":var n=l.numFmt,i="";n&&"General"!=n&&(n=n.replaceAll("\\",""),i=Ei[n]?Ei[n]:t.cache[n]?t.cache[n]:t.cache[n]="fmt"+t.count++,Gn(o,(function(e){return e[0]==i}))||o.push([i,n])),s[h]=i;break;case"border-right":case"border-bottom":case"border-left":case"border-top":s[h]=Tu(Zn[h],l);break;case"indent":s[h]=l.alignment&&l.alignment.indent?l.alignment.indent:""}},h=0;h<Zn.length;h++)c();u=i[s=s.join(";")]||"wss"+n;for(var d=0;d<e.data.length;d++)if(e.data[d][0]===e.styles[a][0]+1&&e.data[d][1]===e.styles[a][1]+1){e.data[d][3]=u;break}i[s]||(r.push([u,s]),i[s]=u,n++)}e.formats=o,e.styles=r}(e,i),e.types&&function(e){e.types.forEach((function(t){for(var n=0;n<e.data.length;n++)if(e.data[n][0]===t[0]+1&&e.data[n][1]===t[1]+1){e.data[n][4]=t[2];break}}))}(e),e.hidden&&function(e){for(var t={row:[],column:[]},n=0;n<e.hidden.length;n++){var i=e.hidden[n];"column"==i[0]?t.column.push(i[1]+1):t.row.push(i[1]+1)}e.table={hidden:t}}(e),e.sizes)for(var d=0;d<e.sizes.length;d++)"column"==e.sizes[d][0]?e.sizes[d]=[0,e.sizes[d][1]+1,e.sizes[d][2]]:e.sizes[d]=[e.sizes[d][1]+1,0,e.sizes[d][2]];return e}function Au(e){return 8===(e=e||"000000").length&&(e=e.substring(2)),"#"+e}function ku(e){for(var t=Xn["font-family"],n=0;n<Vo.length;n++)if(Vo[n].value==e){t=Vo[n].id;break}return t}function Tu(e,t){if(e=e.replace("border-",""),t.border&&t.border[e]){var n=t.border[e];if(n.color){var i=Au(n.color.rgb)||"",r=n.style||"";return"".concat(i,",").concat(r)}}return""}var Iu=Object.freeze({__proto__:null,init:function(e){e._parseExcel=function(t,n){var i=t.options||{};i.math=e.config.math;for(var r={sheets:[]},o={count:Si,cache:{}},a=0;a<t.names.length;a++)i.name=t.names[a],r.sheets.push({name:i.name,state:t.states[a],content:Ru(n.getSheet(t,i),t.ranges,a,o)});return r},e._parseCsv=function(e,t){e=t.getRecords(e);for(var n=webix.copy(e),i=[],r=0;r<n.length;r++)for(var o=n[r].split(t.cell),a=0;a<o.length;a++){var s=r+1,l=a+1;i.push([s,l,o[a]])}return{data:i}}}});var Vu=Object.freeze({__proto__:null,init:function(e){e.attachEvent("onCommand",(function(t){switch(t.id){case"clear-value":e.clearRange(null,{values:!0});break;case"clear-style":e.clearRange(null,{styles:!0});break;case"clear-conditional-formats":e.clearRange(null,{conditions:!0});break;case"clear-dropdown-editors":e.clearRange(null,{editors:!0});break;case"clear-filters":e.clearRange(null,{filters:!0});break;case"clear-all":wn.set((function(){e.clearRange(null,null)}));break;case"clear-comments":e.clearRange(null,{comments:!0})}}))}});function Nu(e,t,n,i){if(t)webix.isArray(t)||(t=[t,t]);else{if(i&&i!=e.getActiveSheet())return;var r=e.$$("cells").getSelectArea();r&&(t=[r.start[n],r.end[n]])}return t}function Mu(e,t,n,i){var r={},o={};(i=Nu(e,i,n))&&(r[n]=i[0],o[n]=i[1],e.callEvent("onCommand",[{id:t,group:n},r,o]))}function Ou(e,t,n,i,r){var o;if((n=Nu(e,n,t,r))&&(!r||r==e.getActiveSheet()||(o=Gn(e._sheets,(function(e){return e.name==r}))))){var a=e.$$("cells");wn.set((function(){for(var s=function(n){if("auto"==i)o||("row"==t?ra:ia)(n,e);else if(o){o.content.sizes||(o.content.sizes=[]);var s=Gn(o.content.sizes,(function(e){return"row"==t?e[0]==n:e[1]==n}));if(s){if(i==s[2])return 0;s[2]=i}else{if("row"==t){if(i==a.config.columWidth)return 0}else if(i==a.config.rowHeight)return 0;var l=[0,0,i];l["row"==t?0:1]=n,o.content.sizes.push(l)}e.callEvent("onAction",[t+"-resize",un(un(un({},t,n),"value",i),"page",r)])}else i*=e._zoom,a["row"==t?"setRowHeight":"setColumnWidth"](n,i)},l=n[0];l<=n[1];l++)s(l)}))}}var Du=Object.freeze({__proto__:null,deleteColumn:function(e){Mu(this,"del","column",e)},deleteRow:function(e){Mu(this,"del","row",e)},insertColumn:function(e){Mu(this,"add","column",e)},insertRow:function(e){Mu(this,"add","row",e)},setColumnWidth:function(e,t,n){Ou(this,"column",e,t,n)},setRowHeight:function(e,t,n){Ou(this,"row",e,t,n)}});var qu=Object.freeze({__proto__:null,isCellLocked:function(e,t,n){return ro(this,e,t,n)},lockCell:function(e,t,n,i){io(this,e,t,n,!1,i)}});function zu(e,t,n,i){if(i)for(var r=i.length-1;r>=0;r--){var o=i[r],a="row"==t?0:1,s="row"==t?3:2;o[a]<=n&&o[a]+o[s]-1>n&&(o[s]=n-o[a]+1),o[0]-o[3]==0&&o[1]-o[2]==0&&i.splice(r,1)}else{var l,u=e.$$("cells").getSpan();for(var c in u)if(!("row"==t&&c>n))for(var h in u[c])if(!("column"==t&&h>n)){var d=u[c][h],f="row"==t?1*c+d[1]-1:1*h+d[0]-1;f>n&&(l=!0,Pu(e,[c,h],"row"==t?d[0]:d[0]-(f-n),"row"==t?d[1]-(f-n):d[1]))}l&&e.refresh()}}function Pu(e,t,n,i){e.splitCell(t[0],t[1],null,!0),e.combineCells({cell:{row:t[0],column:t[1]},x:n,y:i},null,!0)}var Fu=Object.freeze({__proto__:null,freezeColumns:function(e,t){var n,i=this;wn.set((function(){if(t&&t!=i.getActiveSheet()){var r=Yr(i,t);r&&(r.content.table||(r.content.table={}),n=r.content.table.frozenColumns,r.content.table.frozenColumns=e,r.content.spans&&zu(i,"column",e,r.content.spans))}else{t||(t=i.getActiveSheet());var o=i.$$("cells");if(webix.isUndefined(e)){var a=o.getSelectArea();e=a?a.end.column:0}var s="rowId"==o.config.columns[0].id?1:0,l=s,u=!1;if(e&&e!=i._frozenColumns){for(var c=e;c>0&&!(l=o.getColumnIndex(c)+1);c--);l||(l=s)}else u=!0;zu(i,"column",e),o.unselect(),o.define("leftSplit",l),o.refreshColumns(),n=i._frozenColumns,i._frozenColumns=u||!e?0:e}i.callEvent("onAction",["freeze-column",{value:n||0,newValue:e,page:t}])}))},freezeRows:function(e,t){var n,i=this;wn.set((function(){if(t&&t!=i.getActiveSheet()){var r=Yr(i,t);r&&(r.content.table||(r.content.table={}),n=r.content.table.frozenRows,r.content.table.frozenRows=e,r.content.spans&&zu(i,"row",e,r.content.spans))}else{t||(t=i.getActiveSheet());var o=i.$$("cells");if(webix.isUndefined(e)){var a=o.getSelectArea();e=a?a.end.row:0}var s=0,l=!1;if(e&&e!=i._frozenRows)for(var u=e;u>0&&!(s=o.getIndexById(u)+1);u--);else l=!0;zu(i,"row",e),o.unselect(),o.define("topSplit",s),o.refreshColumns(),n=i._frozenRows,i._frozenRows=l||!e?0:e}i.callEvent("onAction",["freeze-row",{value:n||0,newValue:e,page:t}])}))}});var Uu=Object.freeze({__proto__:null,hideGridlines:function(e,t){au(this,e,t)}});var Lu=Object.freeze({__proto__:null,hideHeaders:function(e,t){lu(this,e,t)}});var Bu=Object.freeze({__proto__:null,hideColumn:function(e,t,n){Hl(this,e,t,"column",n)},hideRow:function(e,t,n){Hl(this,e,t,"row",n)},isColumnVisible:function(e,t){return Bl(this,e,t)},isRowVisible:function(e,t){return jl(this,e,t)}});var Hu=Object.freeze({__proto__:null,addCheckbox:function(e,t){var n=this;if(e||(e=this.$$("cells").getSelectArea()),e){var i=e.start,r=e.end;this.groupUndo((function(){for(var e=i.row;e<=r.row;e++)for(var o=i.column;o<=r.column;o++)n.setCellValue(e,o,"=checkbox()",t)})),this.refresh()}},addImage:function(e,t,n,i){this.setCellValue(e,t,function(e){return'=IMAGE("'.concat(e,'")')}(n),i),i&&i!=this.getActiveSheet()||this.refresh()},addRadio:function(e,t){var n=this;if(e||(e=this.$$("cells").getSelectArea()),e){var i=e.start,r=e.end;this.groupUndo((function(){for(var e=i.row;e<=r.row;e++)for(var o=i.column;o<=r.column;o++)n.setCellValue(e,o,"=radio(".concat(e-i.row+1,", ").concat(o-i.column+1,", ").concat(r.row-i.row+1,", ").concat(r.column-i.column+1,")"),t)})),this.refresh()}},addSparkline:function(e,t,n,i){var r=function(e){var t="bar"==(e=webix.copy(e)).type;t&&e.horizontal&&(e.type="barH");var n="=SPARKLINE(".concat(e.range,',"').concat(e.type,'"');return t?n+=',"'.concat(e.color,'","').concat(e.negativeColor,'"'):e.color&&(n+=',"'.concat(e.color,'"')),n+")"}(n);this.setCellValue(e,t,r,i),i&&i!=this.getActiveSheet()||this.refresh()},getSheetData:function(e){var t=this;if(this._mData.getPage(e))return{getValue:function(n,i,r){return t.getCellValue(n,i,r,e)},getRangeValue:function(n){return t.getRangeValue(n,e)}}},markCheckbox:function(e,t,n,i){/^=(checkbox)\(/i.test(this.getCellValue(e,t,!0,i))&&(this.setCellValue(e,t,"=checkbox(".concat(!1===n?0:1,")")),this.refresh())},markRadio:function(e,t,n,i){xn(this,e,t,n,i)},recalculate:function(){this._mData.getStore().recalculate(),this.callEvent("onMathRefresh",[]),this.refresh()},registerMathMethod:function(e,t){yn(this,e,t,!0)},setPlaceholder:function(e,t){"object"==pn(e)&&(t=e,e="*"),this._mData.getStore().setPlaceholder(e,t),this.refresh(),this.callEvent("onMathRefresh",[])}});var ju=Object.freeze({__proto__:null,addSheet:function(e,t,n){return qr(this,e,t,n)},addStyle:function(e,t,n){return ui(this,e,t,n)},clearRange:function(e,t,n){(e||(n&&n!=this.getActiveSheet()||(e=this._table.getSelectArea()),e))&&(t||(t={styles:!0,values:!0,editors:!0,filters:!0,conditions:!0,comments:!0}),t.styles&&_i(this,e,n),t.conditions&&ya(this,e,n),t.values&&this.setRangeValue(e,null,n),t.editors&&$l(this,e,n),t.filters&&Xs(this,e,n),t.comments&&hu(this,e,n),this.refresh())},clearSheet:function(){this.reset()},combineCells:function(e,t,n){var i=this,r=!t||t==this.getActiveSheet();if(!e){if(!r)return;var o=this.getSelectedId(!0);o.length>1&&(e=co(o))}wn.set((function(){e&&lo(i,e.cell,e.x,e.y,null,t)})),!n&&r&&this.refresh()},compactStyles:function(){return xi(this)},editSheet:function(e){zr(this,e)},getActiveSheet:function(){return this._activeSheet},getSheetState:function(e){return Yr(this,e).state||"visible"},getStyle:function(e,t,n){return ai(this,{row:e,column:t},n)},redo:function(){os(this)},removeSheet:function(e){Ur(this,e)},renameSheet:function(e,t){Lr(this,e,t)},serialize:function(e){var t={};return this.callEvent("onDataSerialize",[t,e]),e&&(e.compactStyles&&(t.styles=yi(t)),e.sheets)?function(e,t,n){var i=Yr(e,e._activeSheet);i.content=t,i.state=i.state||"visible";var r=webix.copy(e._sheets),o=!n||!1!==n.math,a=n&&n.compactStyles;return r.forEach((function(t){t.name!=e._activeSheet&&(t.content.data=Sr(e,o,t.name),t.state=t.state||"visible",a&&(t.content.styles=yi(t.content)),t.content.ranges=e.ranges.serialize(t.name))})),r}(this,t,e):t},setRangeStyle:function(e,t,n){wn.set((function(){gi(this,e,t,n)}),this)},setSheetState:function(e,t){Or(this,e,t)},setStyle:function(e,t,n,i){return fi(this,{row:e,column:t},n,i)},showCell:function(e,t){qa(this,e,t)},showSheet:function(e){Xr(this,e)},sortRange:function(e,t){tu(this,e,t)},splitCell:function(e,t,n,i){var r=!n||n==this.getActiveSheet();e&&t?uo(this,{row:e,column:t},n):r&&wn.set((function(){this.eachSelectedCell((function(e){uo(this,e)}))}),this),!i&&r&&this.refresh()},undo:function(){rs(this)}});function Wu(e,t,n,i,r){e._validation_restore=!0,r?(e.setStyle(t,n,i.style,r),e.setCellEditor(t,n,i.editor,r),e.setCellValue(t,n,i.value,r)):(e.undo(),e._ssUndoHistory.splice(e._ssUndoCursor+1)),delete e._validation_restore}function Xu(e,t){var n=t.errorHandle||"information",i="stop"==n?"alert-error":("warning"==n?"confirm-":"alert-")+n,r=webix.i18n.spreadsheet.labels;return e["warning"==n?"confirm":"alert"]({type:i,ok:r["validation-error-"+("stop"==n?"restore":"save")],cancel:r["validation-error-restore"],title:t.errorTitle||r["validation-error-title-text"],text:t.errorMessage||r["validation-error-message-text"]})}function Yu(e){return"boolean"==typeof e&&(e*=1),e||0===e?e:""}var Gu=Object.freeze({__proto__:null,_resetTable:function(){Fa(this)},eachSelectedCell:function(e){for(var t=this.getSelectedId(!0),n=0;n<t.length;n++)e.call(this,t[n])},getCellValue:function(e,t,n,i){if(i=i?this._mData.getPage(i):this._mPage)return Yu(i.getValue(e-1,t-1,!1!==n))},getColumn:function(e,t){if(!t||t==this.getActiveSheet())return this._table.getColumnConfig(e);var n,i=Yr(this,t);return i?(i.content.sizes&&(n=Gn(i.content.sizes,(function(t){return t[1]==e}))),n=n?n[2]:this.$$("cells").config.columnWidth,{id:e,width:n}):void 0},getRangeValue:function(e,t){t||(t=this.getActiveSheet());var n=qn(e,this,t),i=this._mData.getPage(n[4]);return n&&i?i.getRange(n[0]-1,n[1]-1,n[2]-1,n[3]-1).map(Yu):[]},getRow:function(e,t){var n,i,r=this,o=!t||t==this.getActiveSheet();if(o)n=webix.copy(this._table.getItem(e)),i=this.config.columnCount;else{var a,s=Yr(this,t);if(!s)return;s.content.sizes&&(a=Gn(s.content.sizes,(function(t){return t[0]==e}))),a=a?a[2]:this.$$("cells").config.rowHeight,n={id:e,$height:a},i=Qn(s.content.data,s.content.spans,1,1)[1]}for(var l=function(i){var a=(o?r._mPage:r._mData.getPage(t)).getCell(e-1,i-1);if(a){n[i]=a.value,[["style","$cellCss"],["type","$cellType"],["format","$cellFormat"]].forEach((function(e){var t=a[e[0]];t&&(n[e[1]]||(n[e[1]]={}),n[e[1]][i]=t)}));var s=r.getCellValue(e,i,!0,t);s&&"="==s[0]&&(n["$"+i]=s)}},u=1;u<=i;u++)l(u);return n},getSelectedId:function(e){var t=this._table.getSelectArea();if(!e)return t&&t.start.row?t.start:null;var n=[];if(t)for(var i=t.start,r=t.end,o=i.row;o<=r.row;o++)for(var a=i.column;a<=r.column;a++)n.push({row:o,column:a});return n},getSelectedRange:function(e){var t=this._table.getSelectArea();return t?(e&&(e=this.getActiveSheet()),Pn(t.start.row,t.start.column,t.end.row,t.end.column,e)):""},refresh:function(e){e?this._table.refreshColumns():this._table.refresh()},reset:function(e){var t={data:[]};e&&e.sheets&&(t=Wr(t)),this.parse(t)},setCellValue:function(e,t,n,i){var r=this;i||(i=this.getActiveSheet());var o=this._mData.getPage(i);if(o){n=Yu(n);var a,s,l,u=this.getCellValue(e,t,!0,i),c=_r(this,e,t,i);if(this._type_change||i==this.getActiveSheet()||(a=this.getStyle(e,t,i),s=this.getCellEditor(e,t,i)),"date"==c){var h=webix.Date.strToDate(webix.i18n.spreadsheet.formats.parseDateTime),d=isNaN(n)?Sn(h(n)):n;l=u==d}else"string"==c||""===n||isNaN(n)||u!=n||0===n||(l=!0,n*=1);l||u===n||wn.set((function(){if(r.callEvent("onBeforeValueChange",[e,t,n,u,i])){if(i!=r.getActiveSheet()){var l=Yr(r,i).content,h=Gn(l.data,(function(n){return n[0]==e&&n[1]==t}));h||(h=[e,t],l.data.push(h)),h[2]=n,r._page_value_set=!0,h[4]=null;var d=pr(r,l,h);delete r._page_value_set;var f=o.getCell(e-1,t-1,!0);if(f.$format=nr({fmt:ar(l,h)},"string")?1:0,o.setValue(e-1,t-1,d.value),h[2]=d.value,h[4]=f.type=d.type,r._type_change=!0,Hr(h,l,!0),f.style=h[3],delete r._type_change,r.callEvent("onCellChange",[e,t,n,i]),!r._validation_restore&&!r._type_change&&Ia(r,e,t,null,i)){var g=r.validation.get(e,t,i),m={value:u,style:a,editor:s};Xu(r,g).then((function(){"stop"==g.errorHandle&&Wu(r,e,t,m,i)})).fail((function(){Wu(r,e,t,m,i)}))}}else{var v=r.getSelectedId();Xa(r,v,!0),r._mPage.setValue(e-1,t-1,n),r._type_change||(r._type_change=!0,r.callEvent("onCellChange",[e,t,n,i]),delete r._type_change);var p=_r(r,e,t);if(c!=p&&"string"==p&&"="==n[0]&&n.length>1&&r._mPage.setValue(e-1,t-1,n),Xa(r,v),/^=hyperlink\(/i.test(n)){var b=r.getStyle(e,t),w=r.addStyle({color:"#0000ff",underline:"underline"},b);r.setStyle(e,t,w)}if(!r._validation_restore&&!r._type_change&&Ia(r,e,t,Ua(r,e,t))){var _=r.validation.get(e,t);Xu(r,_).then((function(){"stop"==_.errorHandle&&Wu(r)})).fail((function(){Wu(r)}))}}r._type_change||r.saveCell(e,t,i)}}))}},setRangeValue:function(e,t,n){wn.set((function(){for(var i=Fn(e,this),r=0,o=i.start.row;o<=i.end.row;o++)for(var a=i.start.column;a<=i.end.column;a++,r++)this.setCellValue(o,a,webix.isArray(t)?t[r]:t,n)}),this)}});var Ku=Object.freeze({__proto__:null,saveCell:function(e,t,n){var i=(n?this._mData.getPage(n):this._mPage).getCell(e-1,t-1);kn(this,"data",{row:e,column:t,value:this.getCellValue(e,t,null,n),page:n||this.getActiveSheet(),style:(i?i.style:"")||""})}});var Qu=Object.freeze({__proto__:null,getCellEditor:function(e,t,n){if(!n||n==this.getActiveSheet())return(this._table._ssEditors[e]||{})[t]||null;var i=Yr(this,n);if(i&&i.content.editors){var r=Gn(i.content.editors,(function(n){return n[0]==e&&n[1]==t}));return r?r[2]:null}},setCellEditor:function(e,t,n,i){var r;if((i=i||this.getActiveSheet())==this.getActiveSheet()){var o=this._table._ssEditors[e]=this._table._ssEditors[e]||{};r=o[t]||null,o[t]=n,n&&n.editor?this._table.addCellCss(e,t,"ss_editor"):(delete this._table._ssEditors[e][t],this._table.removeCellCss(e,t,"ss_editor"))}else{var a=Yr(this,i);if(!a)return;a.content.editors||(a.content.editors=[]);var s=Kn(a.content.editors,(function(n){return n[0]==e&&n[1]==t}));if(-1!=s)r=a.content.editors[s][2],a.content.editors.splice(s,1);else if(!n)return;n&&a.content.editors.push([e,t,n])}this.callEvent("onAction",["dropdown",{row:e,column:t,value:r,newValue:n,page:i}])}});var Zu=Object.freeze({__proto__:null,filterSpreadSheet:function(){var e=this,t=this._table;t.data.silent((function(){t.data.filter((function(t){return e.isRowVisible(t.id)}));for(var n=Ws(t),i=function(){var i=n[r],o=i.row,a=i.column,s=i.handler,l=i.lastRow,u=!1;t.data.filter((function(n){var i=n.id;if(i<=o||"function"!=typeof s)return!0;var r=t.getSpan(i,a);if(r){if(r[0]==o&&r[1]==a)return!0;i=r[0]}var c=String(e.getCellValue(i,a,!1));if(l){if(i>l)return!0}else if(u||!c)return u=!0;return s(c)}),1,!0)},r=0;r<n.length;r++)i()})),t.callEvent("onAfterFilter",[]),t.refresh()},getCellFilter:function(e,t,n){if(!n||n==this.getActiveSheet())return(this._table._ssFilters[e]||{})[t];var i=Yr(this,n);return i&&i.content.filters&&Gn(i.content.filters,(function(n){return n[0]==e&&n[1]==t}))||null},removeFilters:function(e){var t=this;if(e&&e!=this.getActiveSheet()){var n=Yr(this,e);if(n&&n.content.filters){for(var i=0;i<n.content.filters.length;i++){var r=n.content.filters[i];this.callEvent("onAction",["filter",{row:r[0],column:r[1],value:r[2],newValue:null,page:e||this.getActiveSheet()}])}n.content.filters=[]}}else{for(var o=Ws(this._table),a=0;a<o.length;a++){var s=o[a],l=s.row,u=s.column;this.setCellFilter(l,u,null)}this._table._ssFilters={},this._table.data.filter((function(e){return t.isRowVisible(e.id)}))}},setCellFilter:function(e,t,n,i){var r;if((i=i||this.getActiveSheet())==this.getActiveSheet()||(r=Yr(this,i))){var o;if(n=function(e,t,n,i,r){i&&((webix.isArray(i)||"string"==typeof i)&&(i={options:i}),i.options=Ys(e,t,n,i.options,null,r));return i}(this,e,t,n,r),r){r.content.filters||(r.content.filters=[]);var a=Kn(r.content.filters,(function(n){return n[0]==e&&n[1]==t}));if(-1!=a)o=r.content.filters[a][2],r.content.filters.splice(a,1);else if(!n)return;n&&r.content.filters.push([e,t,n])}else{var s=this._table._ssFilters[e]=this._table._ssFilters[e]||{};if(o=s[t]||null,s[t]=n,n&&"object"==pn(n)){if(this._table.addCellCss(e,t,"ss_filter"),n.value&&Gs(n.value)&&this._table.addCellCss(e,t,"ss_filter_active"),webix.extend(n,{row:e,column:t},!0),!n.handler&&n.value&&n.value.condition){var l=n.mode||Js(this,e,t);n.handler=il(l,n.value)}}else delete this._table._ssFilters[e][t],this._table.removeCellCss(e,t,"ss_filter"),this._table.removeCellCss(e,t,"ss_filter_active")}this.callEvent("onAction",["filter",{row:e,column:t,value:o,newValue:n,page:i}])}}});var Ju=Object.freeze({__proto__:null,alert:function(e){return webix.alert(webix.extend({container:this.$view,css:"webix_ssheet_alert",ok:webix.i18n.spreadsheet.labels.ok},e,!0))},confirm:function(e){return webix.confirm(webix.extend({container:this.$view,css:"webix_ssheet_confirm",ok:webix.i18n.spreadsheet.labels.ok,cancel:webix.i18n.spreadsheet.labels.cancel},e,!0))}});var ec=Object.freeze({__proto__:null,groupUndo:function(e){wn.set(e,this)},ignoreUndo:function(e){ls(e,this)},resetUndo:function(){as(this)}});var tc=Object.freeze({__proto__:null,changeDecimals:function(e,t,n,i){Wi(this,n,e,t,i)},setFormat:function(e,t,n,i){Di(this,e,t,n,null,i)}});var nc=Object.freeze({__proto__:null,showFormulas:function(e,t){mu(this,e,t)}});var ic=Object.freeze({__proto__:null,showPrintBorders:function(e){var t=!!this._printBorders.$render;"toggle"==e&&(e=!t),e!=t&&(e?_o(this):(delete this._printBorders.$render,this.refresh()),this.callEvent("onCommand",[{id:"toolbar-update",name:"print-borders",value:e}]),this.callEvent("onAction",["print-borders",{newValue:e,value:t}]))}});var rc=Object.freeze({__proto__:null,zoom:function(e,t){$o(this,e,!1,t)}});var oc=[{id:"file",submenu:[{id:"sheet",submenu:[{id:"new-sheet"},{id:"copy-sheet"},{id:"remove-sheet"},{id:"hide-sheet"}]},{id:"excel-import"},{id:"excel-export"},{id:"print"},{id:"print-borders"}]},{id:"edit",submenu:[{id:"add-range"},{id:"add-dropdown"},{id:"add-link"},{id:"lock-cell"},{id:"conditional-format"},{id:"clear",submenu:[{id:"clear-value"},{id:"clear-style"},{id:"clear-conditional-formats"},{id:"clear-dropdown-editors"},{id:"clear-filters"},{id:"clear-comments"},{$template:"Separator"},{id:"clear-all"}]},{id:"validation",submenu:[{id:"add-cell-validation"},{id:"remove-cell-validation"},{id:"highlight-invalid-data"},{id:"remove-highlight-invalid-data"}]}]},{id:"insert",submenu:[{id:"image",submenu:[{id:"add-image-cell"},{id:"add-image-top"}]},{id:"graph",submenu:[{id:"add-sparkline"},{id:"add-chart"}]},{id:"controls",submenu:[{id:"add-checkbox"},{id:"add-radio"}]},{id:"add-comment"}]},{id:"data",submenu:[{id:"sort",submenu:[{id:"sort-asc"},{id:"sort-desc"}]},{id:"create-filter"}]},{id:"view",submenu:[{id:"columns",submenu:[{id:"insert-column"},{id:"delete-column"},{id:"show-column"},{id:"hide-column"},{id:"resize-column"}]},{id:"rows",submenu:[{id:"insert-row"},{id:"delete-row"},{id:"show-row"},{id:"hide-row"},{id:"resize-row"}]},{$template:"Separator"},{id:"freeze-columns"},{id:"freeze-rows"},{id:"hide-gridlines"},{id:"hide-headers"},{id:"show-formulas"}]}],ac=[{id:"file",submenu:[{id:"excel-export"},{id:"print"},{id:"print-borders"}]},{id:"view",submenu:[{id:"hide-gridlines"},{id:"hide-headers"},{id:"show-formulas"}]}],sc={getMenuData:function(e,t){var n;for(n=0;n<e.length;n++)"string"==typeof e[n]&&(e[n]={id:e[n]}),"resize-column"!=e[n].id&&"resize-row"!=e[n].id||t.resizeCell?(e[n].value||(e[n].value=webix.i18n.spreadsheet.menus[e[n].id]),e[n].submenu&&(e[n].submenu=this.getMenuData(e[n].submenu,t))):(e.splice(n,1),n--);return e}};function lc(e){e.attachEvent("onComponentInit",(function(){return function(e){e.$$("menu")&&e.$$("menu").attachEvent("onMenuItemClick",(function(t){return function(e,t){e.callEvent("onMenuItemClick",[t])&&(uc[t]?uc[t](e):e.callEvent("onCommand",[{id:t}]))}(e,t)}))}(e)}));var t=e.config,n={view:"menu",borderless:!0,css:"webix_ssheet_menu",id:"menu",autowidth:!0,type:{height:40},data:sc.getMenuData(webix.isArray(t.menu)?t.menu:webix.copy(t.readonly?ac:oc),t)};return e.callEvent("onViewInit",["menu",n]),n}var uc={undo:function(e){return e.undo()},redo:function(e){return e.redo()},"insert-column":function(e){return e.insertColumn()},"delete-column":function(e){return e.deleteColumn()},"show-column":function(e){return e.callEvent("onCommand",[{id:"show",group:"column",neighbors:!0}])},"hide-column":function(e){return e.hideColumn(null,!0)},"resize-column":function(e){return e.callEvent("onCommand",[{id:"resize",group:"column",value:webix.i18n.spreadsheet.menus["resize-column"]}])},"insert-row":function(e){return e.insertRow()},"delete-row":function(e){return e.deleteRow()},"show-row":function(e){return e.callEvent("onCommand",[{id:"show",group:"row",neighbors:!0}])},"hide-row":function(e){return e.hideRow(null,!0)},"resize-row":function(e){return e.callEvent("onCommand",[{id:"resize",group:"row",value:webix.i18n.spreadsheet.menus["resize-row"]}])},"freeze-columns":function(e){return e.freezeColumns()},"freeze-rows":function(e){return e.freezeRows()},"hide-gridlines":function(e){return e.hideGridlines("toggle")},"hide-headers":function(e){return e.hideHeaders("toggle")},"show-formulas":function(e){return e.showFormulas("toggle")},"print-borders":function(e){return e.showPrintBorders("toggle")}};var cc={name:"spreadsheet",_base_index:{count:1},defaults:{spans:!0,liveEditor:!0,rowCount:50,math:!0,columnCount:20,resizeCell:!0,sheetTabWidth:90,conditionStyle:[{name:sa("normal"),css:"webix_ssheet_condition_regular"},{name:sa("neutral"),css:"webix_ssheet_condition_neutral"},{name:sa("bad"),css:"webix_ssheet_condition_bad"},{name:sa("good"),css:"webix_ssheet_condition_good"}]},$init:function(){var e=this;this.$index=this._base_index.count++,this.$view.className+=" webix_ssheet",_n(),this.$ready.unshift(this._sub_init),this.$ready.unshift(Ii),this.$ready.push(this._set_handlers),this._destroy_with_me=[],this.attachEvent("onDestruct",(function(){e._destroy_with_me.forEach((function(e){return e.destructor()}))}))},$skin:function(){!function(){var e=webix.skin.$name;if(Wn.width=webix.skin.$active.inputHeight+2,Wn.titleHeight="mini"==e||"compact"==e?18:20,webix.skin.$active.spreadsheet)return Xn=webix.skin.$active.spreadsheet;Xn["font-family"]=Yn[e],"contrast"==e?(Xn.background="#393939",Xn.color="#ffffff"):"material"==e||"mini"==e?Xn.color="#475466":"willow"==e?Xn.color="#2C2F3C":"dark"==e&&(Xn.background="#2A2B2D",Xn.color="#ffffff")}()},_sub_init:function(){var e=this.config,t=e.readonly,n=[];e.menu&&n.push(lc(this)),(t&&(e.toolbar||e.buttons)||!t&&!1!==e.toolbar)&&n.push(Wo(this)),e.subbar&&n.push(e.subbar),!t&&e.liveEditor&&n.push(Wa(this));var i={editable:!t,liveEditor:e.liveEditor};e.rowHeight&&(i.rowHeight=e.rowHeight),e.columnWidth&&(i.columnWidth=e.columnWidth),t?n.push(za(this,i)):n.push({cols:[za(this,i),Ts(this)]});var r=!0===e.bottombar?Tr(this):e.bottombar;r&&n.push(r),Ar(this),t||function(e){e.attachEvent("onComponentInit",(function(){return e.$$("context").attachTo(e._table.$view)}));var t=webix.i18n.spreadsheet.menus,n=[];!1!==e.config.clipboard&&(n=[{id:"cut",value:t.cut},{id:"copy",value:t.copy},{id:"paste",value:t.paste},{id:"special-paste",value:t["special-paste"],submenu:[{id:"paste-values",value:t["paste-values"]},{id:"paste-formulas",value:t["paste-formulas"]},{id:"paste-styles",value:t["paste-styles"]},{id:"paste-conditions",value:t["paste-conditions"]},{id:"paste-validation",value:t["paste-validation"]}]}]);var i={data:n.concat([{id:"clear",value:t.clear,submenu:Oo()},{id:"validation",value:t.validation,submenu:[{id:"add-cell-validation",value:t["add-cell-validation"]},{id:"remove-cell-validation",value:t["remove-cell-validation"]},{id:"highlight-invalid-data",value:t["highlight-invalid-data"]},{id:"remove-highlight-invalid-data",value:t["remove-highlight-invalid-data"]}]},{id:"lock-cell",value:t["lock-cell"]},{$template:"Separator"},{id:"sort",value:t.sort,submenu:[{id:"sort-asc",value:t["sort-asc"]},{id:"sort-desc",value:t["sort-desc"]}]},{id:"create-filter",value:t["create-filter"]},{$template:"Separator"},{id:"add-range",value:t["add-range"]},{id:"add-link",value:t["add-link"]},{id:"add-comment",value:t["add-comment"]}]),column:No(e),row:Mo(e)},r={view:"contextmenu",id:"context",padding:0,submenuConfig:{padding:0,on:{onBeforeShow:function(){this.sizeToContent()}}},data:[],on:{onMenuItemClick:function(t){e.callEvent("onCommand",[this.getMenuItem(t)])},onShow:function(){delete e._context},onBeforeShow:function(t){var n,r;if(e._context=!0,webix.callEvent("onClick",[]),!(r=e._table.locate(t)))return!1;if(n="",r.header&&"rowId"!==r.column?(Zo(r.column,e)||Qo(r.column,e),n="column"):r.row&&("rowId"===r.column?(ea(r.row,e)||Go(r.row,e),n="row"):(Jo(r.row,r.column,e)||e._table.addSelectArea(r,r),n="data")),n){var o=function(e,t,n){var i={area:t,data:n};return e.callEvent("onContextMenuConfig",[i])?i&&i.data:null}(e,n,i[n]);if(o)return this.clearAll(),this.parse(o),this.sizeToContent(),webix.html.preventEvent(t),!0}return!1}}};e.callEvent("onViewInit",["context",r]);var o=e.ui(r);e._destroy_with_me.push(o)}(this),function(e){for(var t={},n=e.config.readonly?[bl,dl,vl,al]:yl,i=0;i<n.length;i++)t[n[i].action]=new n[i].DialogBox(e);e.attachEvent("onCommand",(function(e){var n=t[e.id];n&&n.open(e)})),e.attachEvent("onAction",(function(e,n){if("add-view"==e&&!n.newValue){var i=t["add-image-top"];i&&i.viewid==n.row&&i.close()}}))}(this),this.rows_setter(n)},_set_handlers:function(){var e=this;this._table||(this._table=this.$$("cells"),function(e){for(var t=[To,Sl,$a,Ci,Ul,sr,Zl,nu,ds,aa,Ql,oo,po,to,sr,Er,$n,Hs,ou,Ol,pu,yr,wu,rl,So,$u,Iu,Vu,gu,Tn,uu,su,As,vu,Oa],n=0;n<t.length;n++)t[n].init&&t[n].init(e)}(this),Fa(this,this.config.columnCount,this.config.rowCount),La(this),this._table.attachEvent("onAfterAreaAdd",(function(){return e.callEvent("onAfterSelect",[e.getSelectedId(!0)])})),this.callEvent("onComponentInit",[]))},$onLoad:function(e,t){this._set_handlers();var n=e.excel;n?e=this._parseExcel(e,t):e.data||"string"!=typeof e||!t.cell&&!t.row||(e=this._parseCsv(e,t)),function(e,t,n){e._loading_data=!0,t=webix.isArray(t)?{sheets:t}:t;var i=e.config.prepareData||n;if(!t.sheets&&e._activeSheet){var r=e._activeSheet;Yr(e,r).content=t,Br(e,r,t,i),Kr(e,t)}else jr(e,t,i);e._loading_data=!1}(this,e,n)}};!function(e){for(var t=[Du,qu,Fu,Uu,Lu,Bu,Hu,ju,Gu,Ku,Qu,Zu,Ju,ec,tc,nc,ic,rc],n=0;n<t.length;n++)webix.extend(e,t[n])}(cc),webix.protoUI(cc,webix.AtomDataLoader,webix.IdSpace,webix.ui.layout)}));
//# sourceMappingURL=spreadsheet.js.map
